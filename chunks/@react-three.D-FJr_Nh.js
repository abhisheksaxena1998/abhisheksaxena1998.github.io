import{r as d,j as N}from"./react.DPZx3FLm.js";import{L as Me,T as We,R as qt,U as Vt,a as Xt,O as Ne,P as Ge,S as tt,b as Se,N as Yt,A as Zt,B as Kt,M as Jt,C as Qt,V as U,c as ht,W as er,d as tr,e as rr,f as nr,g as or,h as ir,i as sr,D as ar,j as be,k as qe,l as cr,m as lr,E as gt,n as ur,o as fr,p as dr,q as ce,r as pr,s as mr,t as vr}from"./three.BGCKtVBI.js";import{c as rt}from"./debounce.tuDiy50U.js";import{F as hr,u as gr}from"./its-fine.CYyqFiI1.js";import{R as yr,c as ae}from"./react-reconciler.BT5ybwFy.js";import{s as nt}from"./scheduler.CzFDRTuY.js";import{g as Z}from"./@babel.CqxtU2kl.js";import{c as br}from"./react-dom.stFbKHXB.js";import{c as yt}from"./zustand.vGk91Pjf.js";import"./maath.C0syz0TI.js";import{D as wr,G as Ve,a as Er,M as Re,O as xr}from"./three-stdlib.7YU_snHy.js";import{s as Cr,p as _r,c as Pr}from"./suspend-react.BKIKQNXN.js";const Mr="modulepreload",Sr=function(e){return"/"+e},ot={},jn=function(t,r,i){let l=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const p=document.querySelector("meta[property=csp-nonce]"),c=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));l=Promise.allSettled(r.map(u=>{if(u=Sr(u),u in ot)return;ot[u]=!0;const m=u.endsWith(".css"),n=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${n}`))return;const o=document.createElement("link");if(o.rel=m?"stylesheet":Mr,m||(o.as="script"),o.crossOrigin="",o.href=u,c&&o.setAttribute("nonce",c),document.head.appendChild(o),m)return new Promise((f,v)=>{o.addEventListener("load",f),o.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(p){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=p,window.dispatchEvent(c),!c.defaultPrevented)throw p}return l.then(p=>{for(const c of p||[])c.status==="rejected"&&s(c.reason);return t().catch(s)})},Xe={},Rr=e=>void Object.assign(Xe,e);function Or(e,t){function r(n,{args:o=[],attach:f,...v},y){let w=`${n[0].toUpperCase()}${n.slice(1)}`,g;if(n==="primitive"){if(v.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const a=v.object;g=ie(a,{type:n,root:y,attach:f,primitive:!0})}else{const a=Xe[w];if(!a)throw new Error(`R3F: ${w} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");g=ie(new a(...o),{type:n,root:y,attach:f,memoizedProps:{args:o}})}return g.__r3f.attach===void 0&&(g instanceof Kt?g.__r3f.attach="geometry":g instanceof Jt&&(g.__r3f.attach="material")),w!=="inject"&&Ae(g,v),g}function i(n,o){let f=!1;if(o){var v,y;(v=o.__r3f)!=null&&v.attach?je(n,o,o.__r3f.attach):o.isObject3D&&n.isObject3D&&(n.add(o),f=!0),f||(y=n.__r3f)==null||y.objects.push(o),o.__r3f||ie(o,{}),o.__r3f.parent=n,$e(o),se(o)}}function l(n,o,f){let v=!1;if(o){var y,w;if((y=o.__r3f)!=null&&y.attach)je(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){o.parent=n,o.dispatchEvent({type:"added"}),n.dispatchEvent({type:"childadded",child:o});const g=n.children.filter(h=>h!==o),a=g.indexOf(f);n.children=[...g.slice(0,a),o,...g.slice(a)],v=!0}v||(w=n.__r3f)==null||w.objects.push(o),o.__r3f||ie(o,{}),o.__r3f.parent=n,$e(o),se(o)}}function s(n,o,f=!1){n&&[...n].forEach(v=>p(o,v,f))}function p(n,o,f){if(o){var v,y,w;if(o.__r3f&&(o.__r3f.parent=null),(v=n.__r3f)!=null&&v.objects&&(n.__r3f.objects=n.__r3f.objects.filter(P=>P!==o)),(y=o.__r3f)!=null&&y.attach)lt(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){var g;n.remove(o),(g=o.__r3f)!=null&&g.root&&Hr(Ce(o),o)}const h=(w=o.__r3f)==null?void 0:w.primitive,x=!h&&(f===void 0?o.dispose!==null:f);if(!h){var a;s((a=o.__r3f)==null?void 0:a.objects,o,x),s(o.children,o,x)}if(delete o.__r3f,x&&o.dispose&&o.type!=="Scene"){const P=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?nt.unstable_scheduleCallback(nt.unstable_IdlePriority,P):P()}se(n)}}function c(n,o,f,v){var y;const w=(y=n.__r3f)==null?void 0:y.parent;if(!w)return;const g=r(o,f,n.__r3f.root);if(n.children){for(const a of n.children)a.__r3f&&i(g,a);n.children=n.children.filter(a=>!a.__r3f)}n.__r3f.objects.forEach(a=>i(g,a)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||p(w,n),g.parent&&(g.__r3f.autoRemovedBeforeAppend=!0),i(w,g),g.raycast&&g.__r3f.eventCount&&Ce(g).getState().internal.interaction.push(g),[v,v.alternate].forEach(a=>{a!==null&&(a.stateNode=g,a.ref&&(typeof a.ref=="function"?a.ref(g):a.ref.current=g))})}const u=()=>{};return{reconciler:yr({createInstance:r,removeChild:p,appendChild:i,appendInitialChild:i,insertBefore:l,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,o)=>{if(!o)return;const f=n.getState().scene;f.__r3f&&(f.__r3f.root=n,i(f,o))},removeChildFromContainer:(n,o)=>{o&&p(n.getState().scene,o)},insertInContainerBefore:(n,o,f)=>{if(!o||!f)return;const v=n.getState().scene;v.__r3f&&l(v,o,f)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var o;return!!((o=n==null?void 0:n.__r3f)!=null?o:{}).handlers},prepareUpdate(n,o,f,v){var y;if(((y=n==null?void 0:n.__r3f)!=null?y:{}).primitive&&v.object&&v.object!==n)return[!0];{const{args:g=[],children:a,...h}=v,{args:x=[],children:P,...C}=f;if(!Array.isArray(g))throw new Error("R3F: the args prop must be an array!");if(g.some((S,O)=>S!==x[O]))return[!0];const E=Pt(n,h,C,!0);return E.changes.length?[!1,E]:null}},commitUpdate(n,[o,f],v,y,w,g){o?c(n,v,w,g):Ae(n,f)},commitMount(n,o,f,v){var y;const w=(y=n.__r3f)!=null?y:{};n.raycast&&w.handlers&&w.eventCount&&Ce(n).getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>ie(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var o;const{attach:f,parent:v}=(o=n.__r3f)!=null?o:{};f&&v&&lt(v,n,f),n.isObject3D&&(n.visible=!1),se(n)},unhideInstance(n,o){var f;const{attach:v,parent:y}=(f=n.__r3f)!=null?f:{};v&&y&&je(y,n,v),(n.isObject3D&&o.visible==null||o.visible)&&(n.visible=!0),se(n)},createTextInstance:u,hideTextInstance:u,unhideTextInstance:u,getCurrentEventPriority:()=>t?t():ae.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&T.fun(performance.now)?performance.now:T.fun(Date.now)?Date.now:()=>0,scheduleTimeout:T.fun(setTimeout)?setTimeout:void 0,cancelTimeout:T.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ae}}var it,st;const Oe=e=>"colorSpace"in e||"outputColorSpace"in e,bt=()=>{var e;return(e=Xe.ColorManagement)!=null?e:null},wt=e=>e&&e.isOrthographicCamera,jr=e=>e&&e.hasOwnProperty("current"),ve=typeof window<"u"&&((it=window.document)!=null&&it.createElement||((st=window.navigator)==null?void 0:st.product)==="ReactNative")?d.useLayoutEffect:d.useEffect;function Et(e){const t=d.useRef(e);return ve(()=>void(t.current=e),[e]),t}function Ar({set:e}){return ve(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class xt extends d.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}xt.getDerivedStateFromError=()=>({error:!0});const Ct="__default",at=new Map,Lr=e=>e&&!!e.memoized&&!!e.changes;function _t(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const fe=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function Ce(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const T={obj:e=>e===Object(e)&&!T.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:l=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(T.str(e)||T.num(e)||T.boo(e))return e===t;const s=T.obj(e);if(s&&i==="reference")return e===t;const p=T.arr(e);if(p&&r==="reference")return e===t;if((p||s)&&e===t)return!0;let c;for(c in e)if(!(c in t))return!1;if(s&&r==="shallow"&&i==="shallow"){for(c in l?t:e)if(!T.equ(e[c],t[c],{strict:l,objects:"reference"}))return!1}else for(c in l?t:e)if(e[c]!==t[c])return!1;if(T.und(c)){if(p&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Tr(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function Dr(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ie(e,t){const r=e;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Be(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),l=i.pop();return r=i.reduce((s,p)=>s[p],e),{target:r,key:l}}else return{target:r,key:t}}const ct=/-\d+$/;function je(e,t,r){if(T.str(r)){if(ct.test(r)){const s=r.replace(ct,""),{target:p,key:c}=Be(e,s);Array.isArray(p[c])||(p[c]=[])}const{target:i,key:l}=Be(e,r);t.__r3f.previousAttach=i[l],i[l]=t}else t.__r3f.previousAttach=r(e,t)}function lt(e,t,r){var i,l;if(T.str(r)){const{target:s,key:p}=Be(e,r),c=t.__r3f.previousAttach;c===void 0?delete s[p]:s[p]=c}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(l=t.__r3f)==null||delete l.previousAttach}function Pt(e,{children:t,key:r,ref:i,...l},{children:s,key:p,ref:c,...u}={},m=!1){const n=e.__r3f,o=Object.entries(l),f=[];if(m){const y=Object.keys(u);for(let w=0;w<y.length;w++)l.hasOwnProperty(y[w])||o.unshift([y[w],Ct+"remove"])}o.forEach(([y,w])=>{var g;if((g=e.__r3f)!=null&&g.primitive&&y==="object"||T.equ(w,u[y]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(y))return f.push([y,w,!0,[]]);let a=[];y.includes("-")&&(a=y.split("-")),f.push([y,w,!1,a]);for(const h in l){const x=l[h];h.startsWith(`${y}-`)&&f.push([h,x,!1,h.split("-")])}});const v={...l};return n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.args&&(v.args=n.memoizedProps.args),n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.attach&&(v.attach=n.memoizedProps.attach),{memoized:v,changes:f}}const zr=typeof process<"u"&&!1;function Ae(e,t){var r;const i=e.__r3f,l=i==null?void 0:i.root,s=l==null||l.getState==null?void 0:l.getState(),{memoized:p,changes:c}=Lr(t)?t:Pt(e,t),u=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=p);for(let n=0;n<c.length;n++){let[o,f,v,y]=c[n];if(Oe(e)){const h="srgb",x="srgb-linear";o==="encoding"?(o="colorSpace",f=f===3001?h:x):o==="outputEncoding"&&(o="outputColorSpace",f=f===3001?h:x)}let w=e,g=w[o];if(y.length&&(g=y.reduce((a,h)=>a[h],e),!(g&&g.set))){const[a,...h]=y.reverse();w=h.reverse().reduce((x,P)=>x[P],e),o=a}if(f===Ct+"remove")if(w.constructor){let a=at.get(w.constructor);a||(a=new w.constructor,at.set(w.constructor,a)),f=a[o]}else f=0;if(v&&i)f?i.handlers[o]=f:delete i.handlers[o],i.eventCount=Object.keys(i.handlers).length;else if(g&&g.set&&(g.copy||g instanceof Me)){if(Array.isArray(f))g.fromArray?g.fromArray(f):g.set(...f);else if(g.copy&&f&&f.constructor&&(zr?g.constructor.name===f.constructor.name:g.constructor===f.constructor))g.copy(f);else if(f!==void 0){const a=g instanceof Qt;!a&&g.setScalar?g.setScalar(f):g instanceof Me&&f instanceof Me?g.mask=f.mask:g.set(f),!bt()&&s&&!s.linear&&a&&g.convertSRGBToLinear()}}else if(w[o]=f,w[o]instanceof We&&w[o].format===qt&&w[o].type===Vt&&s){const a=w[o];Oe(a)&&Oe(s.gl)?a.colorSpace=s.gl.outputColorSpace:a.encoding=s.gl.outputEncoding}se(e)}if(i&&i.parent&&e.raycast&&u!==i.eventCount){const n=Ce(e).getState().internal,o=n.interaction.indexOf(e);o>-1&&n.interaction.splice(o,1),i.eventCount&&n.interaction.push(e)}return!(c.length===1&&c[0][0]==="onUpdate")&&c.length&&(r=e.__r3f)!=null&&r.parent&&$e(e),e}function se(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function $e(e){e.onUpdate==null||e.onUpdate(e)}function kr(e,t){e.manual||(wt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function we(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Fr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ae.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ae.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ae.ContinuousEventPriority;default:return ae.DefaultEventPriority}}function Mt(e,t,r,i){const l=r.get(t);l&&(r.delete(t),r.size===0&&(e.delete(i),l.target.releasePointerCapture(i)))}function Hr(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,l)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(l)}),r.capturedMap.forEach((i,l)=>{Mt(r.capturedMap,t,i,l)})}function Ir(e){function t(u){const{internal:m}=e.getState(),n=u.offsetX-m.initialClick[0],o=u.offsetY-m.initialClick[1];return Math.round(Math.sqrt(n*n+o*o))}function r(u){return u.filter(m=>["Move","Over","Enter","Out","Leave"].some(n=>{var o;return(o=m.__r3f)==null?void 0:o.handlers["onPointer"+n]}))}function i(u,m){const n=e.getState(),o=new Set,f=[],v=m?m(n.internal.interaction):n.internal.interaction;for(let a=0;a<v.length;a++){const h=fe(v[a]);h&&(h.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(u,n);function y(a){const h=fe(a);if(!h||!h.events.enabled||h.raycaster.camera===null)return[];if(h.raycaster.camera===void 0){var x;h.events.compute==null||h.events.compute(u,h,(x=h.previousRoot)==null?void 0:x.getState()),h.raycaster.camera===void 0&&(h.raycaster.camera=null)}return h.raycaster.camera?h.raycaster.intersectObject(a,!0):[]}let w=v.flatMap(y).sort((a,h)=>{const x=fe(a.object),P=fe(h.object);return!x||!P?a.distance-h.distance:P.events.priority-x.events.priority||a.distance-h.distance}).filter(a=>{const h=we(a);return o.has(h)?!1:(o.add(h),!0)});n.events.filter&&(w=n.events.filter(w,n));for(const a of w){let h=a.object;for(;h;){var g;(g=h.__r3f)!=null&&g.eventCount&&f.push({...a,eventObject:h}),h=h.parent}}if("pointerId"in u&&n.internal.capturedMap.has(u.pointerId))for(let a of n.internal.capturedMap.get(u.pointerId).values())o.has(we(a.intersection))||f.push(a.intersection);return f}function l(u,m,n,o){const f=e.getState();if(u.length){const v={stopped:!1};for(const y of u){const w=fe(y.object)||f,{raycaster:g,pointer:a,camera:h,internal:x}=w,P=new U(a.x,a.y,0).unproject(h),C=M=>{var b,j;return(b=(j=x.capturedMap.get(M))==null?void 0:j.has(y.eventObject))!=null?b:!1},E=M=>{const b={intersection:y,target:m.target};x.capturedMap.has(M)?x.capturedMap.get(M).set(y.eventObject,b):x.capturedMap.set(M,new Map([[y.eventObject,b]])),m.target.setPointerCapture(M)},S=M=>{const b=x.capturedMap.get(M);b&&Mt(x.capturedMap,y.eventObject,b,M)};let O={};for(let M in m){let b=m[M];typeof b!="function"&&(O[M]=b)}let _={...y,...O,pointer:a,intersections:u,stopped:v.stopped,delta:n,unprojectedPoint:P,ray:g.ray,camera:h,stopPropagation(){const M="pointerId"in m&&x.capturedMap.get(m.pointerId);if((!M||M.has(y.eventObject))&&(_.stopped=v.stopped=!0,x.hovered.size&&Array.from(x.hovered.values()).find(b=>b.eventObject===y.eventObject))){const b=u.slice(0,u.indexOf(y));s([...b,y])}},target:{hasPointerCapture:C,setPointerCapture:E,releasePointerCapture:S},currentTarget:{hasPointerCapture:C,setPointerCapture:E,releasePointerCapture:S},nativeEvent:m};if(o(_),v.stopped===!0)break}}return u}function s(u){const{internal:m}=e.getState();for(const n of m.hovered.values())if(!u.length||!u.find(o=>o.object===n.object&&o.index===n.index&&o.instanceId===n.instanceId)){const f=n.eventObject.__r3f,v=f==null?void 0:f.handlers;if(m.hovered.delete(we(n)),f!=null&&f.eventCount){const y={...n,intersections:u};v.onPointerOut==null||v.onPointerOut(y),v.onPointerLeave==null||v.onPointerLeave(y)}}}function p(u,m){for(let n=0;n<m.length;n++){const o=m[n].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(u)}}function c(u){switch(u){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return m=>{const{internal:n}=e.getState();"pointerId"in m&&n.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(m.pointerId)&&(n.capturedMap.delete(m.pointerId),s([]))})}}return function(n){const{onPointerMissed:o,internal:f}=e.getState();f.lastEvent.current=n;const v=u==="onPointerMove",y=u==="onClick"||u==="onContextMenu"||u==="onDoubleClick",g=i(n,v?r:void 0),a=y?t(n):0;u==="onPointerDown"&&(f.initialClick=[n.offsetX,n.offsetY],f.initialHits=g.map(x=>x.eventObject)),y&&!g.length&&a<=2&&(p(n,f.interaction),o&&o(n)),v&&s(g);function h(x){const P=x.eventObject,C=P.__r3f,E=C==null?void 0:C.handlers;if(C!=null&&C.eventCount)if(v){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const S=we(x),O=f.hovered.get(S);O?O.stopped&&x.stopPropagation():(f.hovered.set(S,x),E.onPointerOver==null||E.onPointerOver(x),E.onPointerEnter==null||E.onPointerEnter(x))}E.onPointerMove==null||E.onPointerMove(x)}else{const S=E[u];S?(!y||f.initialHits.includes(P))&&(p(n,f.interaction.filter(O=>!f.initialHits.includes(O))),S(x)):y&&f.initialHits.includes(P)&&p(n,f.interaction.filter(O=>!f.initialHits.includes(O)))}}l(g,n,a,h)}}return{handlePointer:c}}const St=e=>!!(e!=null&&e.render),Rt=d.createContext(null),Wr=(e,t)=>{const r=yt((c,u)=>{const m=new U,n=new U,o=new U;function f(a=u().camera,h=n,x=u().size){const{width:P,height:C,top:E,left:S}=x,O=P/C;h instanceof U?o.copy(h):o.set(...h);const _=a.getWorldPosition(m).distanceTo(o);if(wt(a))return{width:P/a.zoom,height:C/a.zoom,top:E,left:S,factor:1,distance:_,aspect:O};{const M=a.fov*Math.PI/180,b=2*Math.tan(M/2)*_,j=b*(P/C);return{width:j,height:b,top:E,left:S,factor:P/j,distance:_,aspect:O}}}let v;const y=a=>c(h=>({performance:{...h.performance,current:a}})),w=new ht;return{set:c,get:u,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(a=1)=>e(u(),a),advance:(a,h)=>t(a,h,u()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new ir,pointer:w,mouse:w,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const a=u();v&&clearTimeout(v),a.performance.current!==a.performance.min&&y(a.performance.min),v=setTimeout(()=>y(u().performance.max),a.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:f},setEvents:a=>c(h=>({...h,events:{...h.events,...a}})),setSize:(a,h,x,P,C)=>{const E=u().camera,S={width:a,height:h,top:P||0,left:C||0,updateStyle:x};c(O=>({size:S,viewport:{...O.viewport,...f(E,n,S)}}))},setDpr:a=>c(h=>{const x=_t(a);return{viewport:{...h.viewport,dpr:x,initialDpr:h.viewport.initialDpr||x}}}),setFrameloop:(a="always")=>{const h=u().clock;h.stop(),h.elapsedTime=0,a!=="never"&&(h.start(),h.elapsedTime=0),c(()=>({frameloop:a}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:d.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(a,h,x)=>{const P=u().internal;return P.priority=P.priority+(h>0?1:0),P.subscribers.push({ref:a,priority:h,store:x}),P.subscribers=P.subscribers.sort((C,E)=>C.priority-E.priority),()=>{const C=u().internal;C!=null&&C.subscribers&&(C.priority=C.priority-(h>0?1:0),C.subscribers=C.subscribers.filter(E=>E.ref!==a))}}}}}),i=r.getState();let l=i.size,s=i.viewport.dpr,p=i.camera;return r.subscribe(()=>{const{camera:c,size:u,viewport:m,gl:n,set:o}=r.getState();if(u.width!==l.width||u.height!==l.height||m.dpr!==s){var f;l=u,s=m.dpr,kr(c,u),n.setPixelRatio(m.dpr);const v=(f=u.updateStyle)!=null?f:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(u.width,u.height,v)}c!==p&&(p=c,o(v=>({viewport:{...v.viewport,...v.viewport.getCurrentViewport(c)}})))}),r.subscribe(c=>e(c)),r};let Ee,Br=new Set,$r=new Set,Ur=new Set;function Le(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function de(e,t){switch(e){case"before":return Le(Br,t);case"after":return Le($r,t);case"tail":return Le(Ur,t)}}let Te,De;function ze(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Te=t.internal.subscribers,Ee=0;Ee<Te.length;Ee++)De=Te[Ee],De.ref.current(De.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Nr(e){let t=!1,r=!1,i,l,s;function p(m){l=requestAnimationFrame(p),t=!0,i=0,de("before",m),r=!0;for(const o of e.values()){var n;s=o.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((n=s.gl.xr)!=null&&n.isPresenting)&&(i+=ze(m,s))}if(r=!1,de("after",m),i===0)return de("tail",m),t=!1,cancelAnimationFrame(l)}function c(m,n=1){var o;if(!m)return e.forEach(f=>c(f.store.getState(),n));(o=m.gl.xr)!=null&&o.isPresenting||!m.internal.active||m.frameloop==="never"||(n>1?m.internal.frames=Math.min(60,m.internal.frames+n):r?m.internal.frames=2:m.internal.frames=1,t||(t=!0,requestAnimationFrame(p)))}function u(m,n=!0,o,f){if(n&&de("before",m),o)ze(m,o,f);else for(const v of e.values())ze(m,v.store.getState());n&&de("after",m)}return{loop:p,invalidate:c,advance:u}}function Ot(){const e=d.useContext(Rt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function $(e=r=>r,t){return Ot()(e,t)}function he(e,t=0){const r=Ot(),i=r.getState().internal.subscribe,l=Et(e);return ve(()=>i(l,t,r),[t,i,r]),null}const ut=new WeakMap;function jt(e,t){return function(r,...i){let l=ut.get(r);return l||(l=new r,ut.set(r,l)),e&&e(l),Promise.all(i.map(s=>new Promise((p,c)=>l.load(s,u=>{u.scene&&Object.assign(u,Tr(u.scene)),p(u)},t,u=>c(new Error(`Could not load ${s}: ${u==null?void 0:u.message}`))))))}}function K(e,t,r,i){const l=Array.isArray(t)?t:[t],s=Cr(jt(r,i),[e,...l],{equal:T.equ});return Array.isArray(t)?s:s[0]}K.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return _r(jt(r),[e,...i])};K.clear=function(e,t){const r=Array.isArray(t)?t:[t];return Pr([e,...r])};const le=new Map,{invalidate:ft,advance:dt}=Nr(le),{reconciler:_e,applyProps:G}=Or(le,Fr),oe={objects:"shallow",strict:!1},Gr=(e,t)=>{const r=typeof e=="function"?e(t):e;return St(r)?r:new er({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function qr(e,t){const r=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:l,top:s,left:p,updateStyle:c=r}=t;return{width:i,height:l,top:s,left:p,updateStyle:c}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:l,top:s,left:p}=e.parentElement.getBoundingClientRect();return{width:i,height:l,top:s,left:p,updateStyle:r}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:r};return{width:0,height:0,top:0,left:0}}function Vr(e){const t=le.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const l=typeof reportError=="function"?reportError:console.error,s=i||Wr(ft,dt),p=r||_e.createContainer(s,ae.ConcurrentRoot,null,!1,null,"",l,null);t||le.set(e,{fiber:p,store:s});let c,u=!1,m;return{configure(n={}){let{gl:o,size:f,scene:v,events:y,onCreated:w,shadows:g=!1,linear:a=!1,flat:h=!1,legacy:x=!1,orthographic:P=!1,frameloop:C="always",dpr:E=[1,2],performance:S,raycaster:O,camera:_,onPointerMissed:M}=n,b=s.getState(),j=b.gl;b.gl||b.set({gl:j=Gr(o,e)});let H=b.raycaster;H||b.set({raycaster:H=new Xt});const{params:J,...z}=O||{};if(T.equ(z,H,oe)||G(H,{...z}),T.equ(J,H.params,oe)||G(H,{params:{...H.params,...J}}),!b.camera||b.camera===m&&!T.equ(m,_,oe)){m=_;const A=_ instanceof tr,L=A?_:P?new Ne(0,0,0,0,.1,1e3):new Ge(75,0,.1,1e3);A||(L.position.z=5,_&&(G(L,_),("aspect"in _||"left"in _||"right"in _||"bottom"in _||"top"in _)&&(L.manual=!0,L.updateProjectionMatrix())),!b.camera&&!(_!=null&&_.rotation)&&L.lookAt(0,0,0)),b.set({camera:L}),H.camera=L}if(!b.scene){let A;v instanceof tt?A=v:(A=new tt,v&&G(A,v)),b.set({scene:ie(A)})}if(!b.xr){var q;const A=(R,Y)=>{const V=s.getState();V.frameloop!=="never"&&dt(R,!0,V,Y)},L=()=>{const R=s.getState();R.gl.xr.enabled=R.gl.xr.isPresenting,R.gl.xr.setAnimationLoop(R.gl.xr.isPresenting?A:null),R.gl.xr.isPresenting||ft(R)},F={connect(){const R=s.getState().gl;R.xr.addEventListener("sessionstart",L),R.xr.addEventListener("sessionend",L)},disconnect(){const R=s.getState().gl;R.xr.removeEventListener("sessionstart",L),R.xr.removeEventListener("sessionend",L)}};typeof((q=j.xr)==null?void 0:q.addEventListener)=="function"&&F.connect(),b.set({xr:F})}if(j.shadowMap){const A=j.shadowMap.enabled,L=j.shadowMap.type;if(j.shadowMap.enabled=!!g,T.boo(g))j.shadowMap.type=Se;else if(T.str(g)){var k;const F={basic:rr,percentage:nr,soft:Se,variance:or};j.shadowMap.type=(k=F[g])!=null?k:Se}else T.obj(g)&&Object.assign(j.shadowMap,g);(A!==j.shadowMap.enabled||L!==j.shadowMap.type)&&(j.shadowMap.needsUpdate=!0)}const I=bt();I&&("enabled"in I?I.enabled=!x:"legacyMode"in I&&(I.legacyMode=x)),u||G(j,{outputEncoding:a?3e3:3001,toneMapping:h?Yt:Zt}),b.legacy!==x&&b.set(()=>({legacy:x})),b.linear!==a&&b.set(()=>({linear:a})),b.flat!==h&&b.set(()=>({flat:h})),o&&!T.fun(o)&&!St(o)&&!T.equ(o,j,oe)&&G(j,o),y&&!b.events.handlers&&b.set({events:y(s)});const W=qr(e,f);return T.equ(W,b.size,oe)||b.setSize(W.width,W.height,W.updateStyle,W.top,W.left),E&&b.viewport.dpr!==_t(E)&&b.setDpr(E),b.frameloop!==C&&b.setFrameloop(C),b.onPointerMissed||b.set({onPointerMissed:M}),S&&!T.equ(S,b.performance,oe)&&b.set(A=>({performance:{...A.performance,...S}})),c=w,u=!0,this},render(n){return u||this.configure(),_e.updateContainer(N.jsx(Xr,{store:s,children:n,onCreated:c,rootElement:e}),p,null,()=>{}),s},unmount(){At(e)}}}function Xr({store:e,children:t,onCreated:r,rootElement:i}){return ve(()=>{const l=e.getState();l.set(s=>({internal:{...s.internal,active:!0}})),r&&r(l),e.getState().events.connected||l.events.connect==null||l.events.connect(i)},[]),N.jsx(Rt.Provider,{value:e,children:t})}function At(e,t){const r=le.get(e),i=r==null?void 0:r.fiber;if(i){const l=r==null?void 0:r.store.getState();l&&(l.internal.active=!1),_e.updateContainer(null,i,null,()=>{l&&setTimeout(()=>{try{var s,p,c,u;l.events.disconnect==null||l.events.disconnect(),(s=l.gl)==null||(p=s.renderLists)==null||p.dispose==null||p.dispose(),(c=l.gl)==null||c.forceContextLoss==null||c.forceContextLoss(),(u=l.gl)!=null&&u.xr&&l.xr.disconnect(),Dr(l),le.delete(e)}catch{}},500)})}}_e.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:d.version});const ke={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Yr(e){const{handlePointer:t}=Ir(e);return{priority:1,enabled:!0,compute(r,i,l){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(ke).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:l}=e.getState();(r=l.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(l.lastEvent.current)},connect:r=>{var i;const{set:l,events:s}=e.getState();s.disconnect==null||s.disconnect(),l(p=>({events:{...p.events,connected:r}})),Object.entries((i=s.handlers)!=null?i:[]).forEach(([p,c])=>{const[u,m]=ke[p];r.addEventListener(u,c,{passive:m})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var l;Object.entries((l=i.handlers)!=null?l:[]).forEach(([s,p])=>{if(i&&i.connected instanceof HTMLElement){const[c]=ke[s];i.connected.removeEventListener(c,p)}}),r(s=>({events:{...s.events,connected:void 0}}))}}}}function Zr({debounce:e,scroll:t,polyfill:r,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const l=r||typeof window<"u"&&window.ResizeObserver,[s,p]=d.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!l)return s.width=1280,s.height=800,[()=>{},s,()=>{}];const c=d.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),u=e?typeof e=="number"?e:e.scroll:null,m=e?typeof e=="number"?e:e.resize:null,n=d.useRef(!1);d.useEffect(()=>(n.current=!0,()=>void(n.current=!1)));const[o,f,v]=d.useMemo(()=>{const a=()=>{if(!c.current.element)return;const{left:h,top:x,width:P,height:C,bottom:E,right:S,x:O,y:_}=c.current.element.getBoundingClientRect(),M={left:h,top:x,width:P,height:C,bottom:E,right:S,x:O,y:_};c.current.element instanceof HTMLElement&&i&&(M.height=c.current.element.offsetHeight,M.width=c.current.element.offsetWidth),Object.freeze(M),n.current&&!en(c.current.lastBounds,M)&&p(c.current.lastBounds=M)};return[a,m?rt(a,m):a,u?rt(a,u):a]},[p,i,u,m]);function y(){c.current.scrollContainers&&(c.current.scrollContainers.forEach(a=>a.removeEventListener("scroll",v,!0)),c.current.scrollContainers=null),c.current.resizeObserver&&(c.current.resizeObserver.disconnect(),c.current.resizeObserver=null),c.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",c.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",c.current.orientationHandler))}function w(){var a;c.current.element&&(c.current.resizeObserver=new l(f),(a=c.current.resizeObserver)==null||a.observe(c.current.element),t&&c.current.scrollContainers&&c.current.scrollContainers.forEach(h=>h.addEventListener("scroll",v,{capture:!0,passive:!0})),c.current.orientationHandler=()=>{v()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",c.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",c.current.orientationHandler))}const g=a=>{!a||a===c.current.element||(y(),c.current.element=a,c.current.scrollContainers=Lt(a),w())};return Jr(v,!!t),Kr(f),d.useEffect(()=>{y(),w()},[t,v,f]),d.useEffect(()=>y,[]),[g,s,o]}function Kr(e){d.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function Jr(e,t){d.useEffect(()=>{if(t){const r=e;return window.addEventListener("scroll",r,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",r,!0)}},[e,t])}function Lt(e){const t=[];if(!e||e===document.body)return t;const{overflow:r,overflowX:i,overflowY:l}=window.getComputedStyle(e);return[r,i,l].some(s=>s==="auto"||s==="scroll")&&t.push(e),[...t,...Lt(e.parentElement)]}const Qr=["x","y","top","bottom","left","right","width","height"],en=(e,t)=>Qr.every(r=>e[r]===t[r]),tn=d.forwardRef(function({children:t,fallback:r,resize:i,style:l,gl:s,events:p=Yr,eventSource:c,eventPrefix:u,shadows:m,linear:n,flat:o,legacy:f,orthographic:v,frameloop:y,dpr:w,performance:g,raycaster:a,camera:h,scene:x,onPointerMissed:P,onCreated:C,...E},S){d.useMemo(()=>Rr(sr),[]);const O=gr(),[_,M]=Zr({scroll:!0,debounce:{scroll:50,resize:0},...i}),b=d.useRef(null),j=d.useRef(null);d.useImperativeHandle(S,()=>b.current);const H=Et(P),[J,z]=d.useState(!1),[q,k]=d.useState(!1);if(J)throw J;if(q)throw q;const I=d.useRef(null);ve(()=>{const A=b.current;M.width>0&&M.height>0&&A&&(I.current||(I.current=Vr(A)),I.current.configure({gl:s,events:p,shadows:m,linear:n,flat:o,legacy:f,orthographic:v,frameloop:y,dpr:w,performance:g,raycaster:a,camera:h,scene:x,size:M,onPointerMissed:(...L)=>H.current==null?void 0:H.current(...L),onCreated:L=>{L.events.connect==null||L.events.connect(c?jr(c)?c.current:c:j.current),u&&L.setEvents({compute:(F,R)=>{const Y=F[u+"X"],V=F[u+"Y"];R.pointer.set(Y/R.size.width*2-1,-(V/R.size.height)*2+1),R.raycaster.setFromCamera(R.pointer,R.camera)}}),C==null||C(L)}}),I.current.render(N.jsx(O,{children:N.jsx(xt,{set:k,children:N.jsx(d.Suspense,{fallback:N.jsx(Ar,{set:z}),children:t})})})))}),d.useEffect(()=>{const A=b.current;if(A)return()=>At(A)},[]);const W=c?"none":"auto";return N.jsx("div",{ref:j,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:W,...l},...E,children:N.jsx("div",{ref:_,style:{width:"100%",height:"100%"},children:N.jsx("canvas",{ref:b,style:{display:"block"},children:r})})})}),An=d.forwardRef(function(t,r){return N.jsx(hr,{children:N.jsx(tn,{...t,ref:r})})}),ge=new U,Ye=new U,rn=new U,pt=new ht;function nn(e,t,r){const i=ge.setFromMatrixPosition(e.matrixWorld);i.project(t);const l=r.width/2,s=r.height/2;return[i.x*l+l,-(i.y*s)+s]}function on(e,t){const r=ge.setFromMatrixPosition(e.matrixWorld),i=Ye.setFromMatrixPosition(t.matrixWorld),l=r.sub(i),s=t.getWorldDirection(rn);return l.angleTo(s)>Math.PI/2}function sn(e,t,r,i){const l=ge.setFromMatrixPosition(e.matrixWorld),s=l.clone();s.project(t),pt.set(s.x,s.y),r.setFromCamera(pt,t);const p=r.intersectObjects(i,!0);if(p.length){const c=p[0].distance;return l.distanceTo(r.ray.origin)<c}return!0}function an(e,t){if(t instanceof Ne)return t.zoom;if(t instanceof Ge){const r=ge.setFromMatrixPosition(e.matrixWorld),i=Ye.setFromMatrixPosition(t.matrixWorld),l=t.fov*Math.PI/180,s=r.distanceTo(i);return 1/(2*Math.tan(l/2)*s)}else return 1}function cn(e,t,r){if(t instanceof Ge||t instanceof Ne){const i=ge.setFromMatrixPosition(e.matrixWorld),l=Ye.setFromMatrixPosition(t.matrixWorld),s=i.distanceTo(l),p=(r[1]-r[0])/(t.far-t.near),c=r[1]-p*t.far;return Math.round(p*s+c)}}const Ue=e=>Math.abs(e)<1e-10?0:e;function Tt(e,t,r=""){let i="matrix3d(";for(let l=0;l!==16;l++)i+=Ue(t[l]*e.elements[l])+(l!==15?",":")");return r+i}const ln=(e=>t=>Tt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),un=(e=>(t,r)=>Tt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function fn(e){return e&&typeof e=="object"&&"current"in e}const Ln=d.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:l,center:s,fullscreen:p,portal:c,distanceFactor:u,sprite:m=!1,transform:n=!1,occlude:o,onOcclude:f,castShadow:v,receiveShadow:y,material:w,geometry:g,zIndexRange:a=[16777271,0],calculatePosition:h=nn,as:x="div",wrapperClass:P,pointerEvents:C="auto",...E},S)=>{const{gl:O,camera:_,scene:M,size:b,raycaster:j,events:H,viewport:J}=$(),[z]=d.useState(()=>document.createElement(x)),q=d.useRef(),k=d.useRef(null),I=d.useRef(0),W=d.useRef([0,0]),A=d.useRef(null),L=d.useRef(null),F=(c==null?void 0:c.current)||H.connected||O.domElement.parentNode,R=d.useRef(null),Y=d.useRef(!1),V=d.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&fn(o[0]),[o]);d.useLayoutEffect(()=>{const B=O.domElement;o&&o==="blending"?(B.style.zIndex=`${Math.floor(a[0]/2)}`,B.style.position="absolute",B.style.pointerEvents="none"):(B.style.zIndex=null,B.style.position=null,B.style.pointerEvents=null)},[o]),d.useLayoutEffect(()=>{if(k.current){const B=q.current=br(z);if(M.updateMatrixWorld(),n)z.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const D=h(k.current,_,b);z.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${D[0]}px,${D[1]}px,0);transform-origin:0 0;`}return F&&(l?F.prepend(z):F.appendChild(z)),()=>{F&&F.removeChild(z),B.unmount()}}},[F,n]),d.useLayoutEffect(()=>{P&&(z.className=P)},[P]);const Ke=d.useMemo(()=>n?{position:"absolute",top:0,left:0,width:b.width,height:b.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:s?"translate3d(-50%,-50%,0)":"none",...p&&{top:-b.height/2,left:-b.width/2,width:b.width,height:b.height},...r},[r,s,p,b,n]),Ht=d.useMemo(()=>({position:"absolute",pointerEvents:C}),[C]);d.useLayoutEffect(()=>{if(Y.current=!1,n){var B;(B=q.current)==null||B.render(d.createElement("div",{ref:A,style:Ke},d.createElement("div",{ref:L,style:Ht},d.createElement("div",{ref:S,className:i,style:r,children:e}))))}else{var D;(D=q.current)==null||D.render(d.createElement("div",{ref:S,style:Ke,className:i,children:e}))}});const ne=d.useRef(!0);he(B=>{if(k.current){_.updateMatrixWorld(),k.current.updateWorldMatrix(!0,!1);const D=n?W.current:h(k.current,_,b);if(n||Math.abs(I.current-_.zoom)>t||Math.abs(W.current[0]-D[0])>t||Math.abs(W.current[1]-D[1])>t){const Q=on(k.current,_);let X=!1;V&&(Array.isArray(o)?X=o.map(ee=>ee.current):o!=="blending"&&(X=[M]));const ue=ne.current;if(X){const ee=sn(k.current,_,j,X);ne.current=ee&&!Q}else ne.current=!Q;ue!==ne.current&&(f?f(!ne.current):z.style.display=ne.current?"block":"none");const ye=Math.floor(a[0]/2),It=o?V?[a[0],ye]:[ye-1,0]:a;if(z.style.zIndex=`${cn(k.current,_,It)}`,n){const[ee,Qe]=[b.width/2,b.height/2],Pe=_.projectionMatrix.elements[5]*Qe,{isOrthographicCamera:et,top:Wt,left:Bt,bottom:$t,right:Ut}=_,Nt=ln(_.matrixWorldInverse),Gt=et?`scale(${Pe})translate(${Ue(-(Ut+Bt)/2)}px,${Ue((Wt+$t)/2)}px)`:`translateZ(${Pe}px)`;let te=k.current.matrixWorld;m&&(te=_.matrixWorldInverse.clone().transpose().copyPosition(te).scale(k.current.scale),te.elements[3]=te.elements[7]=te.elements[11]=0,te.elements[15]=1),z.style.width=b.width+"px",z.style.height=b.height+"px",z.style.perspective=et?"":`${Pe}px`,A.current&&L.current&&(A.current.style.transform=`${Gt}${Nt}translate(${ee}px,${Qe}px)`,L.current.style.transform=un(te,1/((u||10)/400)))}else{const ee=u===void 0?1:an(k.current,_)*u;z.style.transform=`translate3d(${D[0]}px,${D[1]}px,0) scale(${ee})`}W.current=D,I.current=_.zoom}}if(!V&&R.current&&!Y.current)if(n){if(A.current){const D=A.current.children[0];if(D!=null&&D.clientWidth&&D!=null&&D.clientHeight){const{isOrthographicCamera:Q}=_;if(Q||g)E.scale&&(Array.isArray(E.scale)?E.scale instanceof U?R.current.scale.copy(E.scale.clone().divideScalar(1)):R.current.scale.set(1/E.scale[0],1/E.scale[1],1/E.scale[2]):R.current.scale.setScalar(1/E.scale));else{const X=(u||10)/400,ue=D.clientWidth*X,ye=D.clientHeight*X;R.current.scale.set(ue,ye,1)}Y.current=!0}}}else{const D=z.children[0];if(D!=null&&D.clientWidth&&D!=null&&D.clientHeight){const Q=1/J.factor,X=D.clientWidth*Q,ue=D.clientHeight*Q;R.current.scale.set(X,ue,1),Y.current=!0}R.current.lookAt(B.camera.position)}});const Je=d.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return d.createElement("group",Z({},E,{ref:k}),o&&!V&&d.createElement("mesh",{castShadow:v,receiveShadow:y,ref:R},g||d.createElement("planeGeometry",null),w||d.createElement("shaderMaterial",{side:ar,vertexShader:Je.vertexShader,fragmentShader:Je.fragmentShader})))});let pe=0;const Tn=yt(e=>(be.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-pe)/(i-pe)*100})},be.onLoad=()=>{e({active:!1})},be.onError=t=>e(r=>({errors:[...r.errors,t]})),be.onProgress=(t,r,i)=>{r===i&&(pe=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-pe)/(i-pe)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),Fe=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Dt(e,t){const r=$(s=>s.gl),i=K(qe,Fe(e)?Object.values(e):e);return d.useLayoutEffect(()=>{t==null||t(i)},[t]),d.useEffect(()=>{if("initTexture"in r){let s=[];Array.isArray(i)?s=i:i instanceof We?s=[i]:Fe(i)&&(s=Object.values(i)),s.forEach(p=>{p instanceof We&&r.initTexture(p)})}},[r,i]),d.useMemo(()=>{if(Fe(e)){const s={};let p=0;for(const c in e)s[c]=i[p++];return s}else return i},[e,i])}Dt.preload=e=>K.preload(qe,e);Dt.clear=e=>K.clear(qe,e);const dn=()=>parseInt(cr.replace(/\D+/g,"")),zt=dn();function pn(e){return Array.isArray(e)}function He(e=[0,0,0]){return pn(e)?e:e instanceof U||e instanceof gt?[e.x,e.y,e.z]:[e,e,e]}const Dn=d.forwardRef(function({debug:t,depthTest:r=!1,polygonOffsetFactor:i=-10,map:l,mesh:s,children:p,position:c,rotation:u,scale:m,...n},o){const f=d.useRef(null);d.useImperativeHandle(o,()=>f.current);const v=d.useRef(null);return d.useLayoutEffect(()=>{const y=(s==null?void 0:s.current)||f.current.parent,w=f.current;if(!(y instanceof lr))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const g={position:new U,rotation:new gt,scale:new U(1,1,1)};if(y){G(g,{position:c,scale:m});const a=y.matrixWorld.clone();if(y.matrixWorld.identity(),!u||typeof u=="number"){const h=new ur;h.position.copy(g.position),h.lookAt(y.position),typeof u=="number"&&h.rotateZ(u),G(g,{rotation:h.rotation})}else G(g,{rotation:u});return w.geometry=new wr(y,g.position,g.rotation,g.scale),v.current&&(G(v.current,g),v.current.traverse(h=>h.raycast=()=>null)),y.matrixWorld=a,()=>{w.geometry.dispose()}}},[s,...He(c),...He(m),...He(u)]),d.createElement("mesh",Z({ref:f,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":r,"material-map":l},n),p,t&&d.createElement("mesh",{ref:v},d.createElement("boxGeometry",null),d.createElement("meshNormalMaterial",{wireframe:!0}),d.createElement("axesHelper",null)))});let xe=null,kt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Ft(e=!0,t=!0,r){return i=>{r&&r(i),e&&(xe||(xe=new Er),xe.setDecoderPath(typeof e=="string"?e:kt),i.setDRACOLoader(xe)),t&&i.setMeshoptDecoder(typeof Re=="function"?Re():Re)}}const Ze=(e,t,r,i)=>K(Ve,e,Ft(t,r,i));Ze.preload=(e,t,r,i)=>K.preload(Ve,e,Ft(t,r,i));Ze.clear=e=>K.clear(Ve,e);Ze.setDecoderPath=e=>{kt=e};const zn=d.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:l=!0,keyEvents:s=!1,onChange:p,onStart:c,onEnd:u,...m},n)=>{const o=$(E=>E.invalidate),f=$(E=>E.camera),v=$(E=>E.gl),y=$(E=>E.events),w=$(E=>E.setEvents),g=$(E=>E.set),a=$(E=>E.get),h=$(E=>E.performance),x=t||f,P=i||y.connected||v.domElement,C=d.useMemo(()=>new xr(x),[x]);return he(()=>{C.enabled&&C.update()},-1),d.useEffect(()=>(s&&C.connect(s===!0?P:s),C.connect(P),()=>void C.dispose()),[s,P,r,C,o]),d.useEffect(()=>{const E=_=>{o(),r&&h.regress(),p&&p(_)},S=_=>{c&&c(_)},O=_=>{u&&u(_)};return C.addEventListener("change",E),C.addEventListener("start",S),C.addEventListener("end",O),()=>{C.removeEventListener("start",S),C.removeEventListener("end",O),C.removeEventListener("change",E)}},[p,c,u,C,o,w]),d.useEffect(()=>{if(e){const E=a().controls;return g({controls:C}),()=>g({controls:E})}},[e,C]),d.createElement("primitive",Z({ref:n,object:C,enableDamping:l},m))}),Ie=zt>=154?"opaque_fragment":"output_fragment";class mn extends fr{constructor(t){super(t),this.onBeforeCompile=(r,i)=>{const{isWebGL2:l}=i.capabilities;r.fragmentShader=r.fragmentShader.replace(`#include <${Ie}>`,`
        ${l?`#include <${Ie}>`:`#extension GL_OES_standard_derivatives : enable
#include <${Ie}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${zt>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const kn=d.forwardRef((e,t)=>{const[r]=d.useState(()=>new mn(null));return d.createElement("primitive",Z({},e,{object:r,ref:t,attach:"material"}))}),Fn=d.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:i=1,floatIntensity:l=1,floatingRange:s=[-.1,.1],autoInvalidate:p=!1,...c},u)=>{const m=d.useRef(null);d.useImperativeHandle(u,()=>m.current,[]);const n=d.useRef(Math.random()*1e4);return he(o=>{var f,v;if(!t||r===0)return;p&&o.invalidate();const y=n.current+o.clock.getElapsedTime();m.current.rotation.x=Math.cos(y/4*r)/8*i,m.current.rotation.y=Math.sin(y/4*r)/8*i,m.current.rotation.z=Math.sin(y/4*r)/20*i;let w=Math.sin(y/4*r)/10;w=dr.mapLinear(w,-.1,.1,(f=s==null?void 0:s[0])!==null&&f!==void 0?f:-.1,(v=s==null?void 0:s[1])!==null&&v!==void 0?v:.1),m.current.position.y=w*l,m.current.updateMatrix()}),d.createElement("group",c,d.createElement("group",{ref:m,matrixAutoUpdate:!1},e))});let re,me;const vn=d.createContext(null),mt=new pr,vt=new U,hn=d.forwardRef(({children:e,range:t,limit:r=1e3,...i},l)=>{const s=d.useRef(null);d.useImperativeHandle(l,()=>s.current,[]);const[p,c]=d.useState([]),[[u,m,n]]=d.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);d.useEffect(()=>{s.current.geometry.attributes.position.needsUpdate=!0}),he(()=>{for(s.current.updateMatrix(),s.current.updateMatrixWorld(),mt.copy(s.current.matrixWorld).invert(),s.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,p.length),re=0;re<p.length;re++)me=p[re].current,me.getWorldPosition(vt).applyMatrix4(mt),vt.toArray(u,re*3),s.current.geometry.attributes.position.needsUpdate=!0,me.matrixWorldNeedsUpdate=!0,me.color.toArray(m,re*3),s.current.geometry.attributes.color.needsUpdate=!0,n.set([me.size],re),s.current.geometry.attributes.size.needsUpdate=!0});const o=d.useMemo(()=>({getParent:()=>s,subscribe:f=>(c(v=>[...v,f]),()=>c(v=>v.filter(y=>y.current!==f.current)))}),[]);return d.createElement("points",Z({userData:{instances:p},matrixAutoUpdate:!1,ref:s,raycast:()=>null},i),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:u.length/3,array:u,itemSize:3,usage:ce}),d.createElement("bufferAttribute",{attach:"attributes-color",count:m.length/3,array:m,itemSize:3,usage:ce}),d.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:ce})),d.createElement(vn.Provider,{value:o},e))}),gn=d.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:l=3,...s},p)=>{const c=d.useRef(null);return d.useImperativeHandle(p,()=>c.current,[]),he(()=>{const u=c.current.geometry.attributes;u.position.needsUpdate=!0,r&&(u.color.needsUpdate=!0),i&&(u.size.needsUpdate=!0)}),d.createElement("points",Z({ref:c},s),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/l,array:t,itemSize:l,usage:ce}),r&&d.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/l,array:r,itemSize:3,usage:ce}),i&&d.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/l,array:i,itemSize:1,usage:ce})),e)}),Hn=d.forwardRef((e,t)=>e.positions instanceof Float32Array?d.createElement(gn,Z({},e,{ref:t})):d.createElement(hn,Z({},e,{ref:t})));function In({all:e,scene:t,camera:r}){const i=$(({gl:p})=>p),l=$(({camera:p})=>p),s=$(({scene:p})=>p);return d.useLayoutEffect(()=>{const p=[];e&&(t||s).traverse(m=>{m.visible===!1&&(p.push(m),m.visible=!0)}),i.compile(t||s,r||l);const c=new mr(128);new vr(.01,1e5,c).update(i,t||s),c.dispose(),p.forEach(m=>m.visible=!1)},[]),null}export{An as C,Dn as D,Fn as F,Ln as H,zn as O,In as P,jn as _,he as a,Hn as b,kn as c,Ze as d,Tn as e,Dt as u};
