import{b as C,g as j,h as De,c as Y,d as ze}from"./@babel-Xj_bk_MP.js";import{n as Ve,t as xe,g as w,d as Ee,v as Ge,e as te}from"./@rc-component-lPyAtwCK.js";import{c as oe}from"./classnames-uKr76nPM.js";import{B as Je,t as Qe}from"./rc-input-UAvidU0N.js";import{r}from"./react-gY946ZKh.js";import{b as Xe,l as z,L as Ze,f as Me,M as ue}from"./rc-util-RBoppPtV.js";function en(e,i){var u=r.useRef(null);function h(){try{var m=e.selectionStart,N=e.selectionEnd,c=e.value,b=c.substring(0,m),g=c.substring(N);u.current={start:m,end:N,value:c,beforeTxt:b,afterTxt:g}}catch{}}function d(){if(e&&u.current&&i)try{var m=e.value,N=u.current,c=N.beforeTxt,b=N.afterTxt,g=N.start,s=m.length;if(m.endsWith(b))s=m.length-u.current.afterTxt.length;else if(m.startsWith(c))s=c.length;else{var p=c[g-1],v=m.indexOf(p,g-1);v!==-1&&(s=v+1)}e.setSelectionRange(s,s)}catch(f){Xe(!1,"Something warning of cursor restore. Please fire issue about this: ".concat(f.message))}}return[h,d]}var nn=200,an=600;function rn(e){var i=e.prefixCls,u=e.upNode,h=e.downNode,d=e.upDisabled,m=e.downDisabled,N=e.onStep,c=r.useRef(),b=r.useRef([]),g=r.useRef();g.current=N;var s=function(){clearTimeout(c.current)},p=function(x,H){x.preventDefault(),s(),g.current(H);function U(){g.current(H),c.current=setTimeout(U,nn)}c.current=setTimeout(U,an)};r.useEffect(function(){return function(){s(),b.current.forEach(function(I){return z.cancel(I)})}},[]);var v=Ze();if(v)return null;var f="".concat(i,"-handler"),y=oe(f,"".concat(f,"-up"),C({},"".concat(f,"-up-disabled"),d)),P=oe(f,"".concat(f,"-down"),C({},"".concat(f,"-down-disabled"),m)),R=function(){return b.current.push(z(s))},k={unselectable:"on",role:"button",onMouseUp:R,onMouseLeave:R};return r.createElement("div",{className:"".concat(f,"-wrap")},r.createElement("span",j({},k,{onMouseDown:function(x){p(x,!0)},"aria-label":"Increase Value","aria-disabled":d,className:y}),u||r.createElement("span",{unselectable:"on",className:"".concat(i,"-handler-up-inner")})),r.createElement("span",j({},k,{onMouseDown:function(x){p(x,!1)},"aria-label":"Decrease Value","aria-disabled":m,className:P}),h||r.createElement("span",{unselectable:"on",className:"".concat(i,"-handler-down-inner")})))}function ye(e){var i=typeof e=="number"?Ve(e):xe(e).fullStr,u=i.includes(".");return u?xe(i.replace(/(\d)\.(\d)/g,"$1$2.")).fullStr:e+"0"}const tn=function(){var e=r.useRef(0),i=function(){z.cancel(e.current)};return r.useEffect(function(){return i},[]),function(u){i(),e.current=z(function(){u()})}};var un=["prefixCls","className","style","min","max","step","defaultValue","value","disabled","readOnly","upHandler","downHandler","keyboard","wheel","controls","classNames","stringMode","parser","formatter","precision","decimalSeparator","onChange","onInput","onPressEnter","onStep","changeOnBlur"],on=["disabled","style","prefixCls","value","prefix","suffix","addonBefore","addonAfter","className","classNames"],Ce=function(i,u){return i||u.isEmpty()?u.toString():u.toNumber()},Re=function(i){var u=w(i);return u.isInvalidate()?null:u},ln=r.forwardRef(function(e,i){var u,h=e.prefixCls,d=h===void 0?"rc-input-number":h,m=e.className,N=e.style,c=e.min,b=e.max,g=e.step,s=g===void 0?1:g,p=e.defaultValue,v=e.value,f=e.disabled,y=e.readOnly,P=e.upHandler,R=e.downHandler,k=e.keyboard,I=e.wheel,x=e.controls,H=x===void 0?!0:x;e.classNames;var U=e.stringMode,L=e.parser,D=e.formatter,V=e.precision,M=e.decimalSeparator,G=e.onChange,J=e.onInput,Q=e.onPressEnter,X=e.onStep,le=e.changeOnBlur,Be=le===void 0?!0:le,_e=De(e,un),se="".concat(d,"-input"),O=r.useRef(null),Ue=r.useState(!1),ie=Y(Ue,2),ce=ie[0],fe=ie[1],E=r.useRef(!1),A=r.useRef(!1),T=r.useRef(!1),Oe=r.useState(function(){return w(v??p)}),de=Y(Oe,2),l=de[0],ve=de[1];function Ae(a){v===void 0&&ve(a)}var Z=r.useCallback(function(a,n){if(!n)return V>=0?V:Math.max(Ee(a),Ee(s))},[V,s]),ee=r.useCallback(function(a){var n=String(a);if(L)return L(n);var o=n;return M&&(o=o.replace(M,".")),o.replace(/[^\w.-]+/g,"")},[L,M]),ne=r.useRef(""),me=r.useCallback(function(a,n){if(D)return D(a,{userTyping:n,input:String(ne.current)});var o=typeof a=="number"?Ve(a):a;if(!n){var t=Z(o,n);if(Ge(o)&&(M||t>=0)){var S=M||".";o=te(o,S,t)}}return o},[D,Z,M]),$e=r.useState(function(){var a=p??v;return l.isInvalidate()&&["string","number"].includes(ze(a))?Number.isNaN(a)?"":a:me(l.toString(),!1)}),pe=Y($e,2),$=pe[0],ge=pe[1];ne.current=$;function F(a,n){ge(me(a.isInvalidate()?a.toString(!1):a.toString(!n),n))}var B=r.useMemo(function(){return Re(b)},[b,V]),_=r.useMemo(function(){return Re(c)},[c,V]),Ne=r.useMemo(function(){return!B||!l||l.isInvalidate()?!1:B.lessEquals(l)},[B,l]),be=r.useMemo(function(){return!_||!l||l.isInvalidate()?!1:l.lessEquals(_)},[_,l]),Fe=en(O.current,ce),Se=Y(Fe,2),Ke=Se[0],Pe=Se[1],we=function(n){return B&&!n.lessEquals(B)?B:_&&!_.lessEquals(n)?_:null},ae=function(n){return!we(n)},W=function(n,o){var t=n,S=ae(t)||t.isEmpty();if(!t.isEmpty()&&!o&&(t=we(t)||t,S=!0),!y&&!f&&S){var K=t.toString(),re=Z(K,o);return re>=0&&(t=w(te(K,".",re)),ae(t)||(t=w(te(K,".",re,!0)))),t.equals(l)||(Ae(t),G==null||G(t.isEmpty()?null:Ce(U,t)),v===void 0&&F(t,o)),t}return l},ke=tn(),he=function a(n){if(Ke(),ne.current=n,ge(n),!A.current){var o=ee(n),t=w(o);t.isNaN()||W(t,!0)}J==null||J(n),ke(function(){var S=n;L||(S=n.replace(/ã€‚/g,".")),S!==n&&a(S)})},He=function(){A.current=!0},Le=function(){A.current=!1,he(O.current.value)},Te=function(n){he(n.target.value)},q=function(n){var o;if(!(n&&Ne||!n&&be)){E.current=!1;var t=w(T.current?ye(s):s);n||(t=t.negate());var S=(l||w(0)).add(t.toString()),K=W(S,!1);X==null||X(Ce(U,K),{offset:T.current?ye(s):s,type:n?"up":"down"}),(o=O.current)===null||o===void 0||o.focus()}},Ie=function(n){var o=w(ee($)),t=o;o.isNaN()?t=W(l,n):t=W(o,n),v!==void 0?F(l,!1):t.isNaN()||F(t,!1)},We=function(){E.current=!0},qe=function(n){var o=n.key,t=n.shiftKey;E.current=!0,T.current=t,o==="Enter"&&(A.current||(E.current=!1),Ie(!1),Q==null||Q(n)),k!==!1&&!A.current&&["Up","ArrowUp","Down","ArrowDown"].includes(o)&&(q(o==="Up"||o==="ArrowUp"),n.preventDefault())},Ye=function(){E.current=!1,T.current=!1};r.useEffect(function(){var a=function(t){I!==!1&&(q(t.deltaY<0),t.preventDefault())},n=O.current;if(n)return n.addEventListener("wheel",a),function(){return n.removeEventListener("wheel",a)}},[q]);var je=function(){Be&&Ie(!1),fe(!1),E.current=!1};return ue(function(){l.isInvalidate()||F(l,!1)},[V,D]),ue(function(){var a=w(v);ve(a);var n=w(ee($));(!a.equals(n)||!E.current||D)&&F(a,E.current)},[v]),ue(function(){D&&Pe()},[$]),r.createElement("div",{className:oe(d,m,(u={},C(u,"".concat(d,"-focused"),ce),C(u,"".concat(d,"-disabled"),f),C(u,"".concat(d,"-readonly"),y),C(u,"".concat(d,"-not-a-number"),l.isNaN()),C(u,"".concat(d,"-out-of-range"),!l.isInvalidate()&&!ae(l)),u)),style:N,onFocus:function(){fe(!0)},onBlur:je,onKeyDown:qe,onKeyUp:Ye,onCompositionStart:He,onCompositionEnd:Le,onBeforeInput:We},H&&r.createElement(rn,{prefixCls:d,upNode:P,downNode:R,upDisabled:Ne,downDisabled:be,onStep:q}),r.createElement("div",{className:"".concat(se,"-wrap")},r.createElement("input",j({autoComplete:"off",role:"spinbutton","aria-valuemin":c,"aria-valuemax":b,"aria-valuenow":l.isInvalidate()?null:l.toString(),step:s},_e,{ref:Me(O,i),className:se,value:$,onChange:Te,disabled:f,readOnly:y}))))}),sn=r.forwardRef(function(e,i){var u=e.disabled,h=e.style,d=e.prefixCls,m=e.value,N=e.prefix,c=e.suffix,b=e.addonBefore,g=e.addonAfter,s=e.className,p=e.classNames,v=De(e,on),f=r.useRef(null),y=function(R){f.current&&Qe(f.current,R)};return r.createElement(Je,{className:s,triggerFocus:y,prefixCls:d,value:m,disabled:u,style:h,prefix:N,suffix:c,addonAfter:g,addonBefore:b,classNames:p,components:{affixWrapper:"div",groupWrapper:"div",wrapper:"div",groupAddon:"div"}},r.createElement(ln,j({prefixCls:d,disabled:u,ref:Me(f,i),className:p==null?void 0:p.input},v)))});sn.displayName="InputNumber";export{sn as I};
