import{A as e,b as n,t,K as r,e as a}from"./rc-util.DIscDwjl.js";import{e as o,f as l,k as i,b as u,c,g as s,d}from"./@babel.BGkJ1U9u.js";import{u as f,b as v,B as p}from"./rc-select.BuTKHpzX.js";import{r as h}from"./react.DlfX74Oz.js";import{a as m,c as y,T as g}from"./rc-tree.Cc4Zd_Hp.js";import"./classnames.BmZ8OyLm.js";import"./rc-overflow.xAG-NA1s.js";import"./react-dom.tsMZo23m.js";import"./rc-resize-observer.onB48-vm.js";import"./rc-motion.BpKOU8X5.js";function b(e){return!e||e.disabled||e.disableCheckbox||!1===e.checkable}function k(e){return null==e}var C=function(){return null},S=["children","value"];function E(n){return e(n).map((function(e){if(!h.isValidElement(e)||!e.type)return null;var n=e,t=n.key,r=n.props,a=r.children,l=r.value,u=i(r,S),c=o({key:t,value:l},u),s=E(a);return s.length&&(c.children=s),c})).filter((function(e){return e}))}function w(e){if(!e)return e;var t=o({},e);return"props"in t||Object.defineProperty(t,"props",{get:function(){return n(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),t}}),t}function x(e){var n=h.useRef();n.current=e;var t=h.useCallback((function(){return n.current.apply(n,arguments)}),[]);return t}function D(e,n,t){return h.useMemo((function(){return e?t?function(e,n){var t=n.id,r=n.pId,a=n.rootPId,l={},i=[];return e.map((function(e){var n=o({},e),r=n[t];return l[r]=n,n.key=n.key||r,n})).forEach((function(e){var n=e[r],t=l[n];t&&(t.children=t.children||[],t.children.push(e)),(n===a||!t&&null===a)&&i.push(e)})),i}(e,o({id:"id",pId:"pId",rootPId:null},!0!==t?t:{})):e:E(n)}),[n,t,e])}var I=h.createContext(null),N=h.createContext(null),T={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},M=function(e,n){var a=f(),o=a.prefixCls,i=a.multiple,u=a.searchValue,d=a.toggleOpen,v=a.open,p=a.notFoundContent,m=h.useContext(N),y=m.virtual,k=m.listHeight,C=m.listItemHeight,S=m.listItemScrollOffset,E=m.treeData,w=m.fieldNames,x=m.onSelect,D=m.dropdownMatchSelectWidth,M=m.treeExpandAction,K=m.treeTitleRender,L=m.onPopupScroll,V=h.useContext(I),P=V.checkable,O=V.checkedKeys,A=V.halfCheckedKeys,H=V.treeExpandedKeys,R=V.treeDefaultExpandAll,j=V.treeDefaultExpandedKeys,W=V.onTreeExpand,F=V.treeIcon,_=V.showTreeIcon,U=V.switcherIcon,G=V.treeLine,z=V.treeNodeFilterProp,B=V.loadData,J=V.treeLoadedKeys,$=V.treeMotion,q=V.onTreeLoad,Q=V.keyEntities,X=h.useRef(),Y=t((function(){return E}),[v,E],(function(e,n){return n[0]&&e[1]!==n[1]})),Z=h.useState(null),ee=c(Z,2),ne=ee[0],te=ee[1],re=Q[ne],ae=h.useMemo((function(){return P?{checked:O,halfChecked:A}:null}),[P,O,A]);h.useEffect((function(){var e;v&&!i&&O.length&&(null===(e=X.current)||void 0===e||e.scrollTo({key:O[0]}),te(O[0]))}),[v]);var oe=String(u).toLowerCase(),le=h.useState(j),ie=c(le,2),ue=ie[0],ce=ie[1],se=h.useState(null),de=c(se,2),fe=de[0],ve=de[1],pe=h.useMemo((function(){return H?l(H):u?fe:ue}),[ue,fe,H,u]);h.useEffect((function(){u&&ve(function(e,n){var t=[];return function e(r){r.forEach((function(r){var a=r[n.children];a&&(t.push(r[n.value]),e(a))}))}(e),t}(E,w))}),[u]);var he=function(e){e.preventDefault()},me=function(e,n){var t=n.node;P&&b(t)||(x(t.key,{selected:!O.includes(t.key)}),i||d(!1))};if(h.useImperativeHandle(n,(function(){var e;return{scrollTo:null===(e=X.current)||void 0===e?void 0:e.scrollTo,onKeyDown:function(e){var n;switch(e.which){case r.UP:case r.DOWN:case r.LEFT:case r.RIGHT:null===(n=X.current)||void 0===n||n.onKeyDown(e);break;case r.ENTER:if(re){var t=(null==re?void 0:re.node)||{},a=t.selectable,o=t.value;!1!==a&&me(0,{node:{key:ne},selected:!O.includes(o)})}break;case r.ESC:d(!1)}},onKeyUp:function(){}}})),0===Y.length)return h.createElement("div",{role:"listbox",className:"".concat(o,"-empty"),onMouseDown:he},p);var ye={fieldNames:w};return J&&(ye.loadedKeys=J),pe&&(ye.expandedKeys=pe),h.createElement("div",{onMouseDown:he},re&&v&&h.createElement("span",{style:T,"aria-live":"assertive"},re.node.value),h.createElement(g,s({ref:X,focusable:!1,prefixCls:"".concat(o,"-tree"),treeData:Y,height:k,itemHeight:C,itemScrollOffset:S,virtual:!1!==y&&!1!==D,multiple:i,icon:F,showIcon:_,switcherIcon:U,showLine:G,loadData:u?null:B,motion:$,activeKey:ne,checkable:P,checkStrictly:!0,checkedKeys:ae,selectedKeys:P?[]:O,defaultExpandAll:R,titleRender:K},ye,{onActiveChange:te,onSelect:me,onCheck:me,onExpand:function(e){ce(e),ve(e),W&&W(e)},onLoad:q,filterTreeNode:function(e){return!!oe&&String(e[z]).toLowerCase().includes(oe)},expandAction:M,onScroll:L})))},K=h.forwardRef(M),L="SHOW_ALL",V="SHOW_PARENT",P="SHOW_CHILD";function O(e,n,t,r){var a=new Set(e);return n===P?e.filter((function(e){var n=t[e];return!(n&&n.children&&n.children.some((function(e){var n=e.node;return a.has(n[r.value])}))&&n.children.every((function(e){var n=e.node;return b(n)||a.has(n[r.value])})))})):n===V?e.filter((function(e){var n=t[e],r=n?n.parent:null;return!(r&&!b(r.node)&&a.has(r.key))})):e}var A=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","listItemScrollOffset","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion","treeTitleRender","onPopupScroll"];var H=h.forwardRef((function(e,t){var r,f,g=e.id,b=e.prefixCls,S=void 0===b?"rc-tree-select":b,E=e.value,T=e.defaultValue,M=e.onChange,V=e.onSelect,H=e.onDeselect,R=e.searchValue,j=e.inputValue,W=e.onSearch,F=e.autoClearSearchValue,_=void 0===F||F,U=e.filterTreeNode,G=e.treeNodeFilterProp,z=void 0===G?"value":G,B=e.showCheckedStrategy,J=e.treeNodeLabelProp,$=e.multiple,q=e.treeCheckable,Q=e.treeCheckStrictly,X=e.labelInValue,Y=e.fieldNames,Z=e.treeDataSimpleMode,ee=e.treeData,ne=e.children,te=e.loadData,re=e.treeLoadedKeys,ae=e.onTreeLoad,oe=e.treeDefaultExpandAll,le=e.treeExpandedKeys,ie=e.treeDefaultExpandedKeys,ue=e.onTreeExpand,ce=e.treeExpandAction,se=e.virtual,de=e.listHeight,fe=void 0===de?200:de,ve=e.listItemHeight,pe=void 0===ve?20:ve,he=e.listItemScrollOffset,me=void 0===he?0:he,ye=e.onDropdownVisibleChange,ge=e.dropdownMatchSelectWidth,be=void 0===ge||ge,ke=e.treeLine,Ce=e.treeIcon,Se=e.showTreeIcon,Ee=e.switcherIcon,we=e.treeMotion,xe=e.treeTitleRender,De=e.onPopupScroll,Ie=i(e,A),Ne=v(g),Te=q&&!Q,Me=q||Q,Ke=Q||X,Le=Me||$,Ve=a(T,{value:E}),Pe=c(Ve,2),Oe=Pe[0],Ae=Pe[1],He=h.useMemo((function(){return q?B||P:L}),[B,q]),Re=h.useMemo((function(){return function(e){var n=e||{},t=n.label,r=n.value||"value";return{_title:t?[t]:["title","label"],value:r,key:r,children:n.children||"children"}}(Y)}),[JSON.stringify(Y)]),je=a("",{value:void 0!==R?R:j,postState:function(e){return e||""}}),We=c(je,2),Fe=We[0],_e=We[1],Ue=D(ee,ne,Z),Ge=function(e,n){return h.useMemo((function(){return y(e,{fieldNames:n,initWrapper:function(e){return o(o({},e),{},{valueEntities:new Map})},processEntity:function(e,t){var r=e.node[n.value];t.valueEntities.set(r,e)}})}),[e,n])}(Ue,Re),ze=Ge.keyEntities,Be=Ge.valueEntities,Je=h.useCallback((function(e){var n=[],t=[];return e.forEach((function(e){Be.has(e)?t.push(e):n.push(e)})),{missingRawValues:n,existRawValues:t}}),[Be]),$e=function(e,n,t){var r=t.treeNodeFilterProp,a=t.filterTreeNode,l=t.fieldNames.children;return h.useMemo((function(){if(!n||!1===a)return e;var t;if("function"==typeof a)t=a;else{var i=n.toUpperCase();t=function(e,n){var t=n[r];return String(t).toUpperCase().includes(i)}}return function e(r){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r.reduce((function(r,i){var c=i[l],s=a||t(n,w(i)),d=e(c||[],s);return(s||d.length)&&r.push(o(o({},i),{},u({isLeaf:void 0},l,d))),r}),[])}(e)}),[e,n,l,r,a])}(Ue,Fe,{fieldNames:Re,treeNodeFilterProp:z,filterTreeNode:U}),qe=h.useCallback((function(e){if(e){if(J)return e[J];for(var n=Re._title,t=0;t<n.length;t+=1){var r=e[n[t]];if(void 0!==r)return r}}}),[Re,J]),Qe=h.useCallback((function(e){var n=function(e){return Array.isArray(e)?e:void 0!==e?[e]:[]}(e);return n.map((function(e){return function(e){return!e||"object"!==d(e)}(e)?{value:e}:e}))}),[]),Xe=h.useCallback((function(e){return Qe(e).map((function(e){var n,t,r=e.label,a=e.value,o=e.halfChecked,l=Be.get(a);if(l)r=xe?xe(l.node):null!==(t=r)&&void 0!==t?t:qe(l.node),n=l.node.disabled;else if(void 0===r){r=Qe(Oe).find((function(e){return e.value===a})).label}return{label:r,value:a,halfChecked:o,disabled:n}}))}),[Be,qe,Qe,Oe]),Ye=h.useMemo((function(){return Qe(null===Oe?[]:Oe)}),[Qe,Oe]),Ze=h.useMemo((function(){var e=[],n=[];return Ye.forEach((function(t){t.halfChecked?n.push(t):e.push(t)})),[e,n]}),[Ye]),en=c(Ze,2),nn=en[0],tn=en[1],rn=h.useMemo((function(){return nn.map((function(e){return e.value}))}),[nn]),an=function(e,n,t,r){return h.useMemo((function(){var a=e.map((function(e){return e.value})),o=n.map((function(e){return e.value})),i=a.filter((function(e){return!r[e]}));if(t){var u=m(a,!0,r);a=u.checkedKeys,o=u.halfCheckedKeys}return[Array.from(new Set([].concat(l(i),l(a)))),o]}),[e,n,t,r])}(nn,tn,Te,ze),on=c(an,2),ln=on[0],un=on[1],cn=h.useMemo((function(){var e=O(ln,He,ze,Re).map((function(e){var n,t;return null!==(n=null===(t=ze[e])||void 0===t||null===(t=t.node)||void 0===t?void 0:t[Re.value])&&void 0!==n?n:e})).map((function(e){var n=nn.find((function(n){return n.value===e})),t=X?null==n?void 0:n.label:null==xe?void 0:xe(n);return{value:e,label:t}})),n=Xe(e),t=n[0];return!Le&&t&&k(t.value)&&k(t.label)?[]:n.map((function(e){var n;return o(o({},e),{},{label:null!==(n=e.label)&&void 0!==n?n:e.value})}))}),[Re,Le,ln,nn,Xe,He,ze]),sn=(r=cn,f=h.useRef({valueLabels:new Map}),h.useMemo((function(){var e=f.current.valueLabels,n=new Map,t=r.map((function(t){var r,a=t.value,l=null!==(r=t.label)&&void 0!==r?r:e.get(a);return n.set(a,l),o(o({},t),{},{label:l})}));return f.current.valueLabels=n,[t]}),[r])),dn=c(sn,1)[0],fn=x((function(e,t,r){var a=Xe(e);if(Ae(a),_&&_e(""),M){var o=e;if(Te){var i=O(e,He,ze,Re);o=i.map((function(e){var n=Be.get(e);return n?n.node[Re.value]:e}))}var u=t||{triggerValue:void 0,selected:void 0},c=u.triggerValue,s=u.selected,d=o;if(Q){var f=tn.filter((function(e){return!o.includes(e.value)}));d=[].concat(l(d),l(f))}var v=Xe(d),p={preValue:nn,triggerValue:c},m=!0;(Q||"selection"===r&&!s)&&(m=!1),function(e,t,r,a,o,l){var i=null,u=null;function c(){u||(u=[],function e(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n.map((function(n,c){var s="".concat(a,"-").concat(c),d=n[l.value],f=r.includes(d),v=e(n[l.children]||[],s,f),p=h.createElement(C,n,v.map((function(e){return e.node})));if(t===d&&(i=p),f){var m={pos:s,node:p,children:v};return o||u.push(m),m}return null})).filter((function(e){return e}))}(a),u.sort((function(e,n){var t=e.node.props.value,a=n.node.props.value;return r.indexOf(t)-r.indexOf(a)})))}Object.defineProperty(e,"triggerNode",{get:function(){return n(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),c(),i}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return n(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),c(),o?u:u.map((function(e){return e.node}))}})}(p,c,e,Ue,m,Re),Me?p.checked=s:p.selected=s;var y=Ke?v:v.map((function(e){return e.value}));M(Le?y:y[0],Ke?null:v.map((function(e){return e.label})),p)}})),vn=h.useCallback((function(e,n){var t,r=n.selected,a=n.source,o=ze[e],i=null==o?void 0:o.node,u=null!==(t=null==i?void 0:i[Re.value])&&void 0!==t?t:e;if(Le){var c=r?[].concat(l(rn),[u]):ln.filter((function(e){return e!==u}));if(Te){var s,d=Je(c),f=d.missingRawValues,v=d.existRawValues.map((function(e){return Be.get(e).key}));if(r)s=m(v,!0,ze).checkedKeys;else s=m(v,{checked:!1,halfCheckedKeys:un},ze).checkedKeys;c=[].concat(l(f),l(s.map((function(e){return ze[e].node[Re.value]}))))}fn(c,{selected:r,triggerValue:u},a||"option")}else fn([u],{selected:!0,triggerValue:u},"option");r||!Le?null==V||V(u,w(i)):null==H||H(u,w(i))}),[Je,Be,ze,Re,Le,rn,fn,Te,V,H,ln,un]),pn=h.useCallback((function(e){if(ye){var t={};Object.defineProperty(t,"documentClickClose",{get:function(){return n(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),ye(e,t)}}),[ye]),hn=x((function(e,n){var t=e.map((function(e){return e.value}));"clear"!==n.type?n.values.length&&vn(n.values[0].value,{selected:!1,source:"selection"}):fn(t,{},"selection")})),mn=h.useMemo((function(){return{virtual:se,dropdownMatchSelectWidth:be,listHeight:fe,listItemHeight:pe,listItemScrollOffset:me,treeData:$e,fieldNames:Re,onSelect:vn,treeExpandAction:ce,treeTitleRender:xe,onPopupScroll:De}}),[se,be,fe,pe,me,$e,Re,vn,ce,xe,De]),yn=h.useMemo((function(){return{checkable:Me,loadData:te,treeLoadedKeys:re,onTreeLoad:ae,checkedKeys:ln,halfCheckedKeys:un,treeDefaultExpandAll:oe,treeExpandedKeys:le,treeDefaultExpandedKeys:ie,onTreeExpand:ue,treeIcon:Ce,treeMotion:we,showTreeIcon:Se,switcherIcon:Ee,treeLine:ke,treeNodeFilterProp:z,keyEntities:ze}}),[Me,te,re,ae,ln,un,oe,le,ie,ue,Ce,we,Se,Ee,ke,z,ze]);return h.createElement(N.Provider,{value:mn},h.createElement(I.Provider,{value:yn},h.createElement(p,s({ref:t},Ie,{id:Ne,prefixCls:S,mode:Le?"multiple":void 0,displayValues:dn,onDisplayValuesChange:hn,searchValue:Fe,onSearch:function(e){_e(e),null==W||W(e)},OptionList:K,emptyOptions:!Ue.length,onDropdownVisibleChange:pn,dropdownMatchSelectWidth:be}))))}));H.TreeNode=C,H.SHOW_ALL=L,H.SHOW_PARENT=V,H.SHOW_CHILD=P;export{H as G,L as S,C as T,V as a,P as b};
