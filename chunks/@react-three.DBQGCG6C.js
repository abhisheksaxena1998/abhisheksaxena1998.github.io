import{r as e,j as t}from"./react.DlfX74Oz.js";import{L as n,T as r,R as o,U as a,a as i,O as s,P as c,S as l,b as u,N as d,A as f,B as p,M as m,C as h,V as v,c as g,W as y,d as b,e as w,f as E,g as x,h as _,i as M,D as P,j as C,k as S,l as j,m as z,E as A,n as O,o as R,p as L,q as k,r as T,s as I,t as D}from"./three.rOuRJdlK.js";import{c as H}from"./debounce.D-884Op3.js";import{F,u as W}from"./its-fine.DYVreC3C.js";import{R as $,c as q}from"./react-reconciler.B7HHsesO.js";import{s as U}from"./scheduler.CQYGjB7w.js";import{g as B}from"./@babel.BGkJ1U9u.js";import{c as N}from"./react-dom.tsMZo23m.js";import{c as G}from"./zustand.Bxt5cgz0.js";import"./maath.5AhDMpeo.js";import{D as V,G as X,a as Y,M as Z,O as J}from"./three-stdlib.CCj_tvVd.js";import{s as K,p as Q,c as ee}from"./suspend-react.BjVxDtan.js";const te={},ne=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),n=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(t.map((e=>{if((e=function(e){return"/"+e}(e))in te)return;te[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const o=document.createElement("link");return o.rel=t?"stylesheet":"modulepreload",t||(o.as="script"),o.crossOrigin="",o.href=e,n&&o.setAttribute("nonce",n),document.head.appendChild(o),t?new Promise(((t,n)=>{o.addEventListener("load",t),o.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${e}`))))})):void 0})))}function o(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then((t=>{for(const e of t||[])"rejected"===e.status&&o(e.reason);return e().catch(o)}))},re={};var oe,ae;const ie=e=>"colorSpace"in e||"outputColorSpace"in e,se=()=>{var e;return null!=(e=re.ColorManagement)?e:null},ce=e=>e&&e.isOrthographicCamera,le="undefined"!=typeof window&&(null!=(oe=window.document)&&oe.createElement||"ReactNative"===(null==(ae=window.navigator)?void 0:ae.product))?e.useLayoutEffect:e.useEffect;function ue(t){const n=e.useRef(t);return le((()=>{n.current=t}),[t]),n}function de({set:e}){return le((()=>(e(new Promise((()=>null))),()=>e(!1))),[e]),null}class fe extends e.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}fe.getDerivedStateFromError=()=>({error:!0});const pe="__default",me=new Map,he=e=>e&&!!e.memoized&&!!e.changes;function ve(e){var t;const n="undefined"!=typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const ge=e=>{var t;return null==(t=e.__r3f)?void 0:t.root.getState()};function ye(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const be={obj:e=>e===Object(e)&&!be.arr(e)&&"function"!=typeof e,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,boo:e=>"boolean"==typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:r="reference",strict:o=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(be.str(e)||be.num(e)||be.boo(e))return e===t;const a=be.obj(e);if(a&&"reference"===r)return e===t;const i=be.arr(e);if(i&&"reference"===n)return e===t;if((i||a)&&e===t)return!0;let s;for(s in e)if(!(s in t))return!1;if(a&&"shallow"===n&&"shallow"===r){for(s in o?t:e)if(!be.equ(e[s],t[s],{strict:o,objects:"reference"}))return!1}else for(s in o?t:e)if(e[s]!==t[s])return!1;if(be.und(s)){if(i&&0===e.length&&0===t.length)return!0;if(a&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function we(e,t){return e.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Ee(e,t){let n=e;if(t.includes("-")){const r=t.split("-"),o=r.pop();return n=r.reduce(((e,t)=>e[t]),e),{target:n,key:o}}return{target:n,key:t}}const xe=/-\d+$/;function _e(e,t,n){if(be.str(n)){if(xe.test(n)){const t=n.replace(xe,""),{target:r,key:o}=Ee(e,t);Array.isArray(r[o])||(r[o]=[])}const{target:r,key:o}=Ee(e,n);t.__r3f.previousAttach=r[o],r[o]=t}else t.__r3f.previousAttach=n(e,t)}function Me(e,t,n){var r,o;if(be.str(n)){const{target:r,key:o}=Ee(e,n),a=t.__r3f.previousAttach;void 0===a?delete r[o]:r[o]=a}else null==(r=t.__r3f)||null==r.previousAttach||r.previousAttach(e,t);null==(o=t.__r3f)||delete o.previousAttach}function Pe(e,{children:t,key:n,ref:r,...o},{children:a,key:i,ref:s,...c}={},l=!1){const u=e.__r3f,d=Object.entries(o),f=[];if(l){const e=Object.keys(c);for(let t=0;t<e.length;t++)o.hasOwnProperty(e[t])||d.unshift([e[t],pe+"remove"])}d.forEach((([t,n])=>{var r;if(null!=(r=e.__r3f)&&r.primitive&&"object"===t)return;if(be.equ(n,c[t]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(t))return f.push([t,n,!0,[]]);let a=[];t.includes("-")&&(a=t.split("-")),f.push([t,n,!1,a]);for(const e in o){const n=o[e];e.startsWith(`${t}-`)&&f.push([e,n,!1,e.split("-")])}}));const p={...o};return null!=u&&u.memoizedProps&&null!=u&&u.memoizedProps.args&&(p.args=u.memoizedProps.args),null!=u&&u.memoizedProps&&null!=u&&u.memoizedProps.attach&&(p.attach=u.memoizedProps.attach),{memoized:p,changes:f}}const Ce="undefined"!=typeof process&&!1;function Se(e,t){var i;const s=e.__r3f,c=null==s?void 0:s.root,l=null==c||null==c.getState?void 0:c.getState(),{memoized:u,changes:d}=he(t)?t:Pe(e,t),f=null==s?void 0:s.eventCount;e.__r3f&&(e.__r3f.memoizedProps=u);for(let p=0;p<d.length;p++){let[t,i,c,u]=d[p];if(ie(e)){const e=3001,n="srgb",r="srgb-linear";"encoding"===t?(t="colorSpace",i=i===e?n:r):"outputEncoding"===t&&(t="outputColorSpace",i=i===e?n:r)}let f=e,m=f[t];if(u.length&&(m=u.reduce(((e,t)=>e[t]),e),!m||!m.set)){const[n,...r]=u.reverse();f=r.reverse().reduce(((e,t)=>e[t]),e),t=n}if(i===pe+"remove")if(f.constructor){let e=me.get(f.constructor);e||(e=new f.constructor,me.set(f.constructor,e)),i=e[t]}else i=0;if(c&&s)i?s.handlers[t]=i:delete s.handlers[t],s.eventCount=Object.keys(s.handlers).length;else if(m&&m.set&&(m.copy||m instanceof n)){if(Array.isArray(i))m.fromArray?m.fromArray(i):m.set(...i);else if(m.copy&&i&&i.constructor&&(Ce?m.constructor.name===i.constructor.name:m.constructor===i.constructor))m.copy(i);else if(void 0!==i){const e=m instanceof h;!e&&m.setScalar?m.setScalar(i):m instanceof n&&i instanceof n?m.mask=i.mask:m.set(i),!se()&&l&&!l.linear&&e&&m.convertSRGBToLinear()}}else if(f[t]=i,f[t]instanceof r&&f[t].format===o&&f[t].type===a&&l){const e=f[t];ie(e)&&ie(l.gl)?e.colorSpace=l.gl.outputColorSpace:e.encoding=l.gl.outputEncoding}je(e)}if(s&&s.parent&&e.raycast&&f!==s.eventCount){const t=ye(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),s.eventCount&&t.interaction.push(e)}return!(1===d.length&&"onUpdate"===d[0][0])&&d.length&&null!=(i=e.__r3f)&&i.parent&&ze(e),e}function je(e){var t,n;const r=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();r&&0===r.internal.frames&&r.invalidate()}function ze(e){null==e.onUpdate||e.onUpdate(e)}function Ae(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Oe(e,t,n,r){const o=n.get(t);o&&(n.delete(t),0===n.size&&(e.delete(r),o.target.releasePointerCapture(r)))}function Re(e){function t(e){return e.filter((e=>["Move","Over","Enter","Out","Leave"].some((t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))))}function n(t){const{internal:n}=e.getState();for(const e of n.hovered.values())if(!t.length||!t.find((t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId))){const r=e.eventObject.__r3f,o=null==r?void 0:r.handlers;if(n.hovered.delete(Ae(e)),null!=r&&r.eventCount){const n={...e,intersections:t};null==o.onPointerOut||o.onPointerOut(n),null==o.onPointerLeave||o.onPointerLeave(n)}}}function r(e,t){for(let n=0;n<t.length;n++){const r=t[n].__r3f;null==r||null==r.handlers.onPointerMissed||r.handlers.onPointerMissed(e)}}return{handlePointer:function(o){switch(o){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return t=>{const{internal:r}=e.getState();"pointerId"in t&&r.capturedMap.has(t.pointerId)&&requestAnimationFrame((()=>{r.capturedMap.has(t.pointerId)&&(r.capturedMap.delete(t.pointerId),n([]))}))}}return function(a){const{onPointerMissed:i,internal:s}=e.getState();s.lastEvent.current=a;const c="onPointerMove"===o,l="onClick"===o||"onContextMenu"===o||"onDoubleClick"===o,u=function(t,n){const r=e.getState(),o=new Set,a=[],i=n?n(r.internal.interaction):r.internal.interaction;for(let e=0;e<i.length;e++){const t=ge(i[e]);t&&(t.raycaster.camera=void 0)}r.previousRoot||null==r.events.compute||r.events.compute(t,r);let s=i.flatMap((function(e){const n=ge(e);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(t,n,null==(r=n.previousRoot)?void 0:r.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]):[];var r})).sort(((e,t)=>{const n=ge(e.object),r=ge(t.object);return n&&r&&r.events.priority-n.events.priority||e.distance-t.distance})).filter((e=>{const t=Ae(e);return!o.has(t)&&(o.add(t),!0)}));r.events.filter&&(s=r.events.filter(s,r));for(const e of s){let t=e.object;for(;t;){var c;null!=(c=t.__r3f)&&c.eventCount&&a.push({...e,eventObject:t}),t=t.parent}}if("pointerId"in t&&r.internal.capturedMap.has(t.pointerId))for(let e of r.internal.capturedMap.get(t.pointerId).values())o.has(Ae(e.intersection))||a.push(e.intersection);return a}(a,c?t:void 0),d=l?function(t){const{internal:n}=e.getState(),r=t.offsetX-n.initialClick[0],o=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}(a):0;"onPointerDown"===o&&(s.initialClick=[a.offsetX,a.offsetY],s.initialHits=u.map((e=>e.eventObject))),l&&!u.length&&d<=2&&(r(a,s.interaction),i&&i(a)),c&&n(u),function(t,r,o,a){const i=e.getState();if(t.length){const e={stopped:!1};for(const s of t){const c=ge(s.object)||i,{raycaster:l,pointer:u,camera:d,internal:f}=c,p=new v(u.x,u.y,0).unproject(d),m=e=>{var t,n;return null!=(t=null==(n=f.capturedMap.get(e))?void 0:n.has(s.eventObject))&&t},h=e=>{const t={intersection:s,target:r.target};f.capturedMap.has(e)?f.capturedMap.get(e).set(s.eventObject,t):f.capturedMap.set(e,new Map([[s.eventObject,t]])),r.target.setPointerCapture(e)},g=e=>{const t=f.capturedMap.get(e);t&&Oe(f.capturedMap,s.eventObject,t,e)};let y={};for(let e in r){let t=r[e];"function"!=typeof t&&(y[e]=t)}let b={...s,...y,pointer:u,intersections:t,stopped:e.stopped,delta:o,unprojectedPoint:p,ray:l.ray,camera:d,stopPropagation(){const o="pointerId"in r&&f.capturedMap.get(r.pointerId);(!o||o.has(s.eventObject))&&(b.stopped=e.stopped=!0,f.hovered.size&&Array.from(f.hovered.values()).find((e=>e.eventObject===s.eventObject)))&&n([...t.slice(0,t.indexOf(s)),s])},target:{hasPointerCapture:m,setPointerCapture:h,releasePointerCapture:g},currentTarget:{hasPointerCapture:m,setPointerCapture:h,releasePointerCapture:g},nativeEvent:r};if(a(b),!0===e.stopped)break}}}(u,a,d,(function(e){const t=e.eventObject,n=t.__r3f,i=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(c){if(i.onPointerOver||i.onPointerEnter||i.onPointerOut||i.onPointerLeave){const t=Ae(e),n=s.hovered.get(t);n?n.stopped&&e.stopPropagation():(s.hovered.set(t,e),null==i.onPointerOver||i.onPointerOver(e),null==i.onPointerEnter||i.onPointerEnter(e))}null==i.onPointerMove||i.onPointerMove(e)}else{const n=i[o];n?l&&!s.initialHits.includes(t)||(r(a,s.interaction.filter((e=>!s.initialHits.includes(e)))),n(e)):l&&s.initialHits.includes(t)&&r(a,s.interaction.filter((e=>!s.initialHits.includes(e))))}}))}}}}const Le=e=>!(null==e||!e.render),ke=e.createContext(null),Te=(t,n)=>{const r=G(((r,o)=>{const a=new v,i=new v,s=new v;function c(e=o().camera,t=i,n=o().size){const{width:r,height:c,top:l,left:u}=n,d=r/c;t instanceof v?s.copy(t):s.set(...t);const f=e.getWorldPosition(a).distanceTo(s);if(ce(e))return{width:r/e.zoom,height:c/e.zoom,top:l,left:u,factor:1,distance:f,aspect:d};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*f,o=n*(r/c);return{width:o,height:n,top:l,left:u,factor:r/o,distance:f,aspect:d}}}let l;const u=e=>r((t=>({performance:{...t.performance,current:e}}))),d=new g;return{set:r,get:o,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(e=1)=>t(o(),e),advance:(e,t)=>n(e,t,o()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new _,pointer:d,mouse:d,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const e=o();l&&clearTimeout(l),e.performance.current!==e.performance.min&&u(e.performance.min),l=setTimeout((()=>u(o().performance.max)),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:e=>r((t=>({...t,events:{...t.events,...e}}))),setSize:(e,t,n,a,s)=>{const l=o().camera,u={width:e,height:t,top:a||0,left:s||0,updateStyle:n};r((e=>({size:u,viewport:{...e.viewport,...c(l,i,u)}})))},setDpr:e=>r((t=>{const n=ve(e);return{viewport:{...t.viewport,dpr:n,initialDpr:t.viewport.initialDpr||n}}})),setFrameloop:(e="always")=>{const t=o().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),r((()=>({frameloop:e})))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:e.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(e,t,n)=>{const r=o().internal;return r.priority=r.priority+(t>0?1:0),r.subscribers.push({ref:e,priority:t,store:n}),r.subscribers=r.subscribers.sort(((e,t)=>e.priority-t.priority)),()=>{const n=o().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter((t=>t.ref!==e)))}}}}})),o=r.getState();let a=o.size,i=o.viewport.dpr,s=o.camera;return r.subscribe((()=>{const{camera:e,size:t,viewport:n,gl:o,set:c}=r.getState();if(t.width!==a.width||t.height!==a.height||n.dpr!==i){var l;a=t,i=n.dpr,function(e,t){e.manual||(ce(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}(e,t),o.setPixelRatio(n.dpr);const r=null!=(l=t.updateStyle)?l:"undefined"!=typeof HTMLCanvasElement&&o.domElement instanceof HTMLCanvasElement;o.setSize(t.width,t.height,r)}e!==s&&(s=e,c((t=>({viewport:{...t.viewport,...t.viewport.getCurrentViewport(e)}}))))})),r.subscribe((e=>t(e))),r};let Ie,De,He,Fe=new Set,We=new Set,$e=new Set;function qe(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function Ue(e,t){switch(e){case"before":return qe(Fe,t);case"after":return qe(We,t);case"tail":return qe($e,t)}}function Be(e,t,n){let r=t.clock.getDelta();for("never"===t.frameloop&&"number"==typeof e&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),De=t.internal.subscribers,Ie=0;Ie<De.length;Ie++)He=De[Ie],He.ref.current(He.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function Ne(){const t=e.useContext(ke);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function Ge(e=e=>e,t){return Ne()(e,t)}function Ve(e,t=0){const n=Ne(),r=n.getState().internal.subscribe,o=ue(e);return le((()=>r(o,t,n)),[t,r,n]),null}const Xe=new WeakMap;function Ye(e,t){return function(n,...r){let o=Xe.get(n);return o||(o=new n,Xe.set(n,o)),e&&e(o),Promise.all(r.map((e=>new Promise(((n,r)=>o.load(e,(e=>{e.scene&&Object.assign(e,function(e){const t={nodes:{},materials:{}};return e&&e.traverse((e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)})),t}(e.scene)),n(e)}),t,(t=>r(new Error(`Could not load ${e}: ${null==t?void 0:t.message}`)))))))))}}function Ze(e,t,n,r){const o=Array.isArray(t)?t:[t],a=K(Ye(n,r),[e,...o],{equal:be.equ});return Array.isArray(t)?a:a[0]}Ze.preload=function(e,t,n){const r=Array.isArray(t)?t:[t];return Q(Ye(n),[e,...r])},Ze.clear=function(e,t){const n=Array.isArray(t)?t:[t];return ee([e,...n])};const Je=new Map,{invalidate:Ke,advance:Qe}=function(e){let t,n,r,o=!1,a=!1;function i(s){n=requestAnimationFrame(i),o=!0,t=0,Ue("before",s),a=!0;for(const n of e.values()){var c;r=n.store.getState(),!r.internal.active||!("always"===r.frameloop||r.internal.frames>0)||null!=(c=r.gl.xr)&&c.isPresenting||(t+=Be(s,r))}if(a=!1,Ue("after",s),0===t)return Ue("tail",s),o=!1,cancelAnimationFrame(n)}return{loop:i,invalidate:function t(n,r=1){var s;if(!n)return e.forEach((e=>t(e.store.getState(),r)));null!=(s=n.gl.xr)&&s.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=r>1?Math.min(60,n.internal.frames+r):a?2:1,o||(o=!0,requestAnimationFrame(i)))},advance:function(t,n=!0,r,o){if(n&&Ue("before",t),r)Be(t,r,o);else for(const a of e.values())Be(t,a.store.getState());n&&Ue("after",t)}}}(Je),{reconciler:et,applyProps:tt}=function(e,t){function n(e,{args:t=[],attach:n,...r},o){let a,i=`${e[0].toUpperCase()}${e.slice(1)}`;if("primitive"===e){if(void 0===r.object)throw new Error("R3F: Primitives without 'object' are invalid!");a=we(r.object,{type:e,root:o,attach:n,primitive:!0})}else{const r=re[i];if(!r)throw new Error(`R3F: ${i} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(t))throw new Error("R3F: The args prop must be an array!");a=we(new r(...t),{type:e,root:o,attach:n,memoizedProps:{args:t}})}return void 0===a.__r3f.attach&&(a instanceof p?a.__r3f.attach="geometry":a instanceof m&&(a.__r3f.attach="material")),"inject"!==i&&Se(a,r),a}function r(e,t){let n=!1;var r,o;t&&(null!=(r=t.__r3f)&&r.attach?_e(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),n=!0),n||null==(o=e.__r3f)||o.objects.push(t),t.__r3f||we(t,{}),t.__r3f.parent=e,ze(t),je(t))}function o(e,t,n){let r=!1;if(t){var o,a;if(null!=(o=t.__r3f)&&o.attach)_e(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"}),e.dispatchEvent({type:"childadded",child:t});const o=e.children.filter((e=>e!==t)),a=o.indexOf(n);e.children=[...o.slice(0,a),t,...o.slice(a)],r=!0}r||null==(a=e.__r3f)||a.objects.push(t),t.__r3f||we(t,{}),t.__r3f.parent=e,ze(t),je(t)}}function a(e,t,n=!1){e&&[...e].forEach((e=>i(t,e,n)))}function i(e,t,n){if(t){var r,o,i;if(t.__r3f&&(t.__r3f.parent=null),null!=(r=e.__r3f)&&r.objects&&(e.__r3f.objects=e.__r3f.objects.filter((e=>e!==t))),null!=(o=t.__r3f)&&o.attach)Me(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var s;e.remove(t),null!=(s=t.__r3f)&&s.root&&function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter((e=>e!==t)),n.initialHits=n.initialHits.filter((e=>e!==t)),n.hovered.forEach(((e,r)=>{e.eventObject!==t&&e.object!==t||n.hovered.delete(r)})),n.capturedMap.forEach(((e,r)=>{Oe(n.capturedMap,t,e,r)}))}(ye(t),t)}const l=null==(i=t.__r3f)?void 0:i.primitive,u=!l&&(void 0===n?null!==t.dispose:n);var c;if(!l)a(null==(c=t.__r3f)?void 0:c.objects,t,u),a(t.children,t,u);if(delete t.__r3f,u&&t.dispose&&"Scene"!==t.type){const e=()=>{try{t.dispose()}catch(e){}};"undefined"==typeof IS_REACT_ACT_ENVIRONMENT?U.unstable_scheduleCallback(U.unstable_IdlePriority,e):e()}je(e)}}const s=()=>{};return{reconciler:$({createInstance:n,removeChild:i,appendChild:r,appendInitialChild:r,insertBefore:o,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(e,t)=>{if(!t)return;const n=e.getState().scene;n.__r3f&&(n.__r3f.root=e,r(n,t))},removeChildFromContainer:(e,t)=>{t&&i(e.getState().scene,t)},insertInContainerBefore:(e,t,n)=>{if(!t||!n)return;const r=e.getState().scene;r.__r3f&&o(r,t,n)},getRootHostContext:()=>null,getChildHostContext:e=>e,finalizeInitialChildren(e){var t;const n=null!=(t=null==e?void 0:e.__r3f)?t:{};return Boolean(n.handlers)},prepareUpdate(e,t,n,r){var o;if((null!=(o=null==e?void 0:e.__r3f)?o:{}).primitive&&r.object&&r.object!==e)return[!0];{const{args:t=[],children:o,...a}=r,{args:i=[],children:s,...c}=n;if(!Array.isArray(t))throw new Error("R3F: the args prop must be an array!");if(t.some(((e,t)=>e!==i[t])))return[!0];const l=Pe(e,a,c,!0);return l.changes.length?[!1,l]:null}},commitUpdate(e,[t,o],a,s,c,l){t?function(e,t,o,a){var s;const c=null==(s=e.__r3f)?void 0:s.parent;if(!c)return;const l=n(t,o,e.__r3f.root);if(e.children){for(const t of e.children)t.__r3f&&r(l,t);e.children=e.children.filter((e=>!e.__r3f))}e.__r3f.objects.forEach((e=>r(l,e))),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||i(c,e),l.parent&&(l.__r3f.autoRemovedBeforeAppend=!0),r(c,l),l.raycast&&l.__r3f.eventCount&&ye(l).getState().internal.interaction.push(l);[a,a.alternate].forEach((e=>{null!==e&&(e.stateNode=l,e.ref&&("function"==typeof e.ref?e.ref(l):e.ref.current=l))}))}(e,a,c,l):Se(e,o)},commitMount(e,t,n,r){var o;const a=null!=(o=e.__r3f)?o:{};e.raycast&&a.handlers&&a.eventCount&&ye(e).getState().internal.interaction.push(e)},getPublicInstance:e=>e,prepareForCommit:()=>null,preparePortalMount:e=>we(e.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(e){var t;const{attach:n,parent:r}=null!=(t=e.__r3f)?t:{};n&&r&&Me(r,e,n),e.isObject3D&&(e.visible=!1),je(e)},unhideInstance(e,t){var n;const{attach:r,parent:o}=null!=(n=e.__r3f)?n:{};r&&o&&_e(o,e,r),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),je(e)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():q.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:"undefined"!=typeof performance&&be.fun(performance.now)?performance.now:be.fun(Date.now)?Date.now:()=>0,scheduleTimeout:be.fun(setTimeout)?setTimeout:void 0,cancelTimeout:be.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Se}}(0,(function(){var e;const t="undefined"!=typeof self&&self||"undefined"!=typeof window&&window;if(!t)return q.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return q.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return q.ContinuousEventPriority;default:return q.DefaultEventPriority}})),nt={objects:"shallow",strict:!1},rt=(e,t)=>{const n="function"==typeof e?e(t):e;return Le(n)?n:new y({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function ot(e){const n=Je.get(e),r=null==n?void 0:n.fiber,o=null==n?void 0:n.store;n&&console.warn("R3F.createRoot should only be called once!");const a="function"==typeof reportError?reportError:console.error,p=o||Te(Ke,Qe),m=r||et.createContainer(p,q.ConcurrentRoot,null,!1,null,"",a,null);let h;n||Je.set(e,{fiber:m,store:p});let v,g=!1;return{configure(t={}){let{gl:n,size:r,scene:o,events:a,onCreated:m,shadows:y=!1,linear:_=!1,flat:M=!1,legacy:P=!1,orthographic:C=!1,frameloop:S="always",dpr:j=[1,2],performance:z,raycaster:A,camera:O,onPointerMissed:R}=t,L=p.getState(),k=L.gl;L.gl||L.set({gl:k=rt(n,e)});let T=L.raycaster;T||L.set({raycaster:T=new i});const{params:I,...D}=A||{};if(be.equ(D,T,nt)||tt(T,{...D}),be.equ(I,T.params,nt)||tt(T,{params:{...T.params,...I}}),!L.camera||L.camera===v&&!be.equ(v,O,nt)){v=O;const e=O instanceof b,t=e?O:C?new s(0,0,0,0,.1,1e3):new c(75,0,.1,1e3);e||(t.position.z=5,O&&(tt(t,O),("aspect"in O||"left"in O||"right"in O||"bottom"in O||"top"in O)&&(t.manual=!0,t.updateProjectionMatrix())),L.camera||null!=O&&O.rotation||t.lookAt(0,0,0)),L.set({camera:t}),T.camera=t}if(!L.scene){let e;o instanceof l?e=o:(e=new l,o&&tt(e,o)),L.set({scene:we(e)})}if(!L.xr){var H;const e=(e,t)=>{const n=p.getState();"never"!==n.frameloop&&Qe(e,!0,n,t)},t=()=>{const t=p.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||Ke(t)},n={connect(){const e=p.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){const e=p.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"==typeof(null==(H=k.xr)?void 0:H.addEventListener)&&n.connect(),L.set({xr:n})}if(k.shadowMap){const e=k.shadowMap.enabled,t=k.shadowMap.type;if(k.shadowMap.enabled=!!y,be.boo(y))k.shadowMap.type=u;else if(be.str(y)){var F;const e={basic:w,percentage:E,soft:u,variance:x};k.shadowMap.type=null!=(F=e[y])?F:u}else be.obj(y)&&Object.assign(k.shadowMap,y);e===k.shadowMap.enabled&&t===k.shadowMap.type||(k.shadowMap.needsUpdate=!0)}const W=se();if(W&&("enabled"in W?W.enabled=!P:"legacyMode"in W&&(W.legacyMode=P)),!g){tt(k,{outputEncoding:_?3e3:3001,toneMapping:M?d:f})}L.legacy!==P&&L.set((()=>({legacy:P}))),L.linear!==_&&L.set((()=>({linear:_}))),L.flat!==M&&L.set((()=>({flat:M}))),!n||be.fun(n)||Le(n)||be.equ(n,k,nt)||tt(k,n),a&&!L.events.handlers&&L.set({events:a(p)});const $=function(e,t){const n="undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement;if(t){const{width:e,height:r,top:o,left:a,updateStyle:i=n}=t;return{width:e,height:r,top:o,left:a,updateStyle:i}}if("undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:t,height:r,top:o,left:a}=e.parentElement.getBoundingClientRect();return{width:t,height:r,top:o,left:a,updateStyle:n}}return"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0,updateStyle:n}:{width:0,height:0,top:0,left:0}}(e,r);return be.equ($,L.size,nt)||L.setSize($.width,$.height,$.updateStyle,$.top,$.left),j&&L.viewport.dpr!==ve(j)&&L.setDpr(j),L.frameloop!==S&&L.setFrameloop(S),L.onPointerMissed||L.set({onPointerMissed:R}),z&&!be.equ(z,L.performance,nt)&&L.set((e=>({performance:{...e.performance,...z}}))),h=m,g=!0,this},render(n){return g||this.configure(),et.updateContainer(t.jsx(at,{store:p,children:n,onCreated:h,rootElement:e}),m,null,(()=>{})),p},unmount(){it(e)}}}function at({store:e,children:n,onCreated:r,rootElement:o}){return le((()=>{const t=e.getState();t.set((e=>({internal:{...e.internal,active:!0}}))),r&&r(t),e.getState().events.connected||null==t.events.connect||t.events.connect(o)}),[]),t.jsx(ke.Provider,{value:e,children:n})}function it(e,t){const n=Je.get(e),r=null==n?void 0:n.fiber;if(r){const t=null==n?void 0:n.store.getState();t&&(t.internal.active=!1),et.updateContainer(null,r,null,(()=>{t&&setTimeout((()=>{try{var n,r,o,a;null==t.events.disconnect||t.events.disconnect(),null==(n=t.gl)||null==(r=n.renderLists)||null==r.dispose||r.dispose(),null==(o=t.gl)||null==o.forceContextLoss||o.forceContextLoss(),null!=(a=t.gl)&&a.xr&&t.xr.disconnect(),function(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const t in e)null==t.dispose||t.dispose(),delete e[t]}(t),Je.delete(e)}catch(i){}}),500)}))}}et.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:e.version});const st={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function ct(e){const{handlePointer:t}=Re(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(st).reduce(((e,n)=>({...e,[n]:t(n)})),{}),update:()=>{var t;const{events:n,internal:r}=e.getState();null!=(t=r.lastEvent)&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var n;const{set:r,events:o}=e.getState();null==o.disconnect||o.disconnect(),r((e=>({events:{...e.events,connected:t}}))),Object.entries(null!=(n=o.handlers)?n:[]).forEach((([e,n])=>{const[r,o]=st[e];t.addEventListener(r,n,{passive:o})}))},disconnect:()=>{const{set:t,events:n}=e.getState();var r;n.connected&&(Object.entries(null!=(r=n.handlers)?r:[]).forEach((([e,t])=>{if(n&&n.connected instanceof HTMLElement){const[r]=st[e];n.connected.removeEventListener(r,t)}})),t((e=>({events:{...e.events,connected:void 0}}))))}}}function lt({debounce:t,scroll:n,polyfill:r,offsetSize:o}={debounce:0,scroll:!1,offsetSize:!1}){const a=r||"undefined"!=typeof window&&window.ResizeObserver,[i,s]=e.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!a)return i.width=1280,i.height=800,[()=>{},i,()=>{}];const c=e.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:i,orientationHandler:null}),l=t?"number"==typeof t?t:t.scroll:null,u=t?"number"==typeof t?t:t.resize:null,d=e.useRef(!1);e.useEffect((()=>(d.current=!0,()=>{d.current=!1})));const[f,p,m]=e.useMemo((()=>{const e=()=>{if(!c.current.element)return;const{left:e,top:t,width:n,height:r,bottom:a,right:i,x:l,y:u}=c.current.element.getBoundingClientRect(),f={left:e,top:t,width:n,height:r,bottom:a,right:i,x:l,y:u};c.current.element instanceof HTMLElement&&o&&(f.height=c.current.element.offsetHeight,f.width=c.current.element.offsetWidth),Object.freeze(f),d.current&&!ft(c.current.lastBounds,f)&&s(c.current.lastBounds=f)};return[e,u?H(e,u):e,l?H(e,l):e]}),[s,o,l,u]);function h(){c.current.scrollContainers&&(c.current.scrollContainers.forEach((e=>e.removeEventListener("scroll",m,!0))),c.current.scrollContainers=null),c.current.resizeObserver&&(c.current.resizeObserver.disconnect(),c.current.resizeObserver=null),c.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",c.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",c.current.orientationHandler))}function v(){var e;c.current.element&&(c.current.resizeObserver=new a(p),null==(e=c.current.resizeObserver)||e.observe(c.current.element),n&&c.current.scrollContainers&&c.current.scrollContainers.forEach((e=>e.addEventListener("scroll",m,{capture:!0,passive:!0}))),c.current.orientationHandler=()=>{m()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",c.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",c.current.orientationHandler))}var g,y,b;return g=m,y=Boolean(n),e.useEffect((()=>{if(y){const e=g;return window.addEventListener("scroll",e,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",e,!0)}}}),[g,y]),b=p,e.useEffect((()=>{const e=b;return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}}),[b]),e.useEffect((()=>{h(),v()}),[n,m,p]),e.useEffect((()=>h),[]),[e=>{e&&e!==c.current.element&&(h(),c.current.element=e,c.current.scrollContainers=ut(e),v())},i,f]}function ut(e){const t=[];if(!e||e===document.body)return t;const{overflow:n,overflowX:r,overflowY:o}=window.getComputedStyle(e);return[n,r,o].some((e=>"auto"===e||"scroll"===e))&&t.push(e),[...t,...ut(e.parentElement)]}const dt=["x","y","top","bottom","left","right","width","height"],ft=(e,t)=>dt.every((n=>e[n]===t[n])),pt=e.forwardRef((function({children:n,fallback:r,resize:o,style:a,gl:i,events:s=ct,eventSource:c,eventPrefix:l,shadows:u,linear:d,flat:f,legacy:p,orthographic:m,frameloop:h,dpr:v,performance:g,raycaster:y,camera:b,scene:w,onPointerMissed:E,onCreated:x,..._},P){e.useMemo((()=>{return e=M,void Object.assign(re,e);var e}),[]);const C=W(),[S,j]=lt({scroll:!0,debounce:{scroll:50,resize:0},...o}),z=e.useRef(null),A=e.useRef(null);e.useImperativeHandle(P,(()=>z.current));const O=ue(E),[R,L]=e.useState(!1),[k,T]=e.useState(!1);if(R)throw R;if(k)throw k;const I=e.useRef(null);le((()=>{const r=z.current;j.width>0&&j.height>0&&r&&(I.current||(I.current=ot(r)),I.current.configure({gl:i,events:s,shadows:u,linear:d,flat:f,legacy:p,orthographic:m,frameloop:h,dpr:v,performance:g,raycaster:y,camera:b,scene:w,size:j,onPointerMissed:(...e)=>null==O.current?void 0:O.current(...e),onCreated:e=>{var t;null==e.events.connect||e.events.connect(c?(t=c)&&t.hasOwnProperty("current")?c.current:c:A.current),l&&e.setEvents({compute:(e,t)=>{const n=e[l+"X"],r=e[l+"Y"];t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==x||x(e)}}),I.current.render(t.jsx(C,{children:t.jsx(fe,{set:T,children:t.jsx(e.Suspense,{fallback:t.jsx(de,{set:L}),children:n})})})))})),e.useEffect((()=>{const e=z.current;if(e)return()=>it(e)}),[]);const D=c?"none":"auto";return t.jsx("div",{ref:A,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:D,...a},..._,children:t.jsx("div",{ref:S,style:{width:"100%",height:"100%"},children:t.jsx("canvas",{ref:z,style:{display:"block"},children:r})})})})),mt=e.forwardRef((function(e,n){return t.jsx(F,{children:t.jsx(pt,{...e,ref:n})})})),ht=new v,vt=new v,gt=new v,yt=new g;function bt(e,t,n){const r=ht.setFromMatrixPosition(e.matrixWorld);r.project(t);const o=n.width/2,a=n.height/2;return[r.x*o+o,-r.y*a+a]}const wt=e=>Math.abs(e)<1e-10?0:e;function Et(e,t,n=""){let r="matrix3d(";for(let o=0;16!==o;o++)r+=wt(t[o]*e.elements[o])+(15!==o?",":")");return n+r}const xt=(e=>t=>Et(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),_t=(()=>(e,t)=>{return Et(e,[1/(n=t),1/n,1/n,1,-1/n,-1/n,-1/n,-1,1/n,1/n,1/n,1,1,1,1,1],"translate(-50%,-50%)");var n})();const Mt=e.forwardRef((({children:t,eps:n=.001,style:r,className:o,prepend:a,center:i,fullscreen:l,portal:u,distanceFactor:d,sprite:f=!1,transform:p=!1,occlude:m,onOcclude:h,castShadow:g,receiveShadow:y,material:b,geometry:w,zIndexRange:E=[16777271,0],calculatePosition:x=bt,as:_="div",wrapperClass:M,pointerEvents:C="auto",...S},j)=>{const{gl:z,camera:A,scene:O,size:R,raycaster:L,events:k,viewport:T}=Ge(),[I]=e.useState((()=>document.createElement(_))),D=e.useRef(),H=e.useRef(null),F=e.useRef(0),W=e.useRef([0,0]),$=e.useRef(null),q=e.useRef(null),U=(null==u?void 0:u.current)||k.connected||z.domElement.parentNode,G=e.useRef(null),V=e.useRef(!1),X=e.useMemo((()=>m&&"blending"!==m||Array.isArray(m)&&m.length&&function(e){return e&&"object"==typeof e&&"current"in e}(m[0])),[m]);e.useLayoutEffect((()=>{const e=z.domElement;m&&"blending"===m?(e.style.zIndex=`${Math.floor(E[0]/2)}`,e.style.position="absolute",e.style.pointerEvents="none"):(e.style.zIndex=null,e.style.position=null,e.style.pointerEvents=null)}),[m]),e.useLayoutEffect((()=>{if(H.current){const e=D.current=N(I);if(O.updateMatrixWorld(),p)I.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const e=x(H.current,A,R);I.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${e[0]}px,${e[1]}px,0);transform-origin:0 0;`}return U&&(a?U.prepend(I):U.appendChild(I)),()=>{U&&U.removeChild(I),e.unmount()}}}),[U,p]),e.useLayoutEffect((()=>{M&&(I.className=M)}),[M]);const Y=e.useMemo((()=>p?{position:"absolute",top:0,left:0,width:R.width,height:R.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:i?"translate3d(-50%,-50%,0)":"none",...l&&{top:-R.height/2,left:-R.width/2,width:R.width,height:R.height},...r}),[r,i,l,R,p]),Z=e.useMemo((()=>({position:"absolute",pointerEvents:C})),[C]);e.useLayoutEffect((()=>{var n,a;(V.current=!1,p)?null==(n=D.current)||n.render(e.createElement("div",{ref:$,style:Y},e.createElement("div",{ref:q,style:Z},e.createElement("div",{ref:j,className:o,style:r,children:t})))):null==(a=D.current)||a.render(e.createElement("div",{ref:j,style:Y,className:o,children:t}))}));const J=e.useRef(!0);Ve((e=>{if(H.current){A.updateMatrixWorld(),H.current.updateWorldMatrix(!0,!1);const e=p?W.current:x(H.current,A,R);if(p||Math.abs(F.current-A.zoom)>n||Math.abs(W.current[0]-e[0])>n||Math.abs(W.current[1]-e[1])>n){const t=function(e,t){const n=ht.setFromMatrixPosition(e.matrixWorld),r=vt.setFromMatrixPosition(t.matrixWorld),o=n.sub(r),a=t.getWorldDirection(gt);return o.angleTo(a)>Math.PI/2}(H.current,A);let n=!1;X&&(Array.isArray(m)?n=m.map((e=>e.current)):"blending"!==m&&(n=[O]));const r=J.current;if(n){const e=function(e,t,n,r){const o=ht.setFromMatrixPosition(e.matrixWorld),a=o.clone();a.project(t),yt.set(a.x,a.y),n.setFromCamera(yt,t);const i=n.intersectObjects(r,!0);if(i.length){const e=i[0].distance;return o.distanceTo(n.ray.origin)<e}return!0}(H.current,A,L,n);J.current=e&&!t}else J.current=!t;r!==J.current&&(h?h(!J.current):I.style.display=J.current?"block":"none");const o=Math.floor(E[0]/2),a=m?X?[E[0],o]:[o-1,0]:E;if(I.style.zIndex=`${function(e,t,n){if(t instanceof c||t instanceof s){const r=ht.setFromMatrixPosition(e.matrixWorld),o=vt.setFromMatrixPosition(t.matrixWorld),a=r.distanceTo(o),i=(n[1]-n[0])/(t.far-t.near),s=n[1]-i*t.far;return Math.round(i*a+s)}}(H.current,A,a)}`,p){const[e,t]=[R.width/2,R.height/2],n=A.projectionMatrix.elements[5]*t,{isOrthographicCamera:r,top:o,left:a,bottom:i,right:s}=A,c=xt(A.matrixWorldInverse),l=r?`scale(${n})translate(${wt(-(s+a)/2)}px,${wt((o+i)/2)}px)`:`translateZ(${n}px)`;let u=H.current.matrixWorld;f&&(u=A.matrixWorldInverse.clone().transpose().copyPosition(u).scale(H.current.scale),u.elements[3]=u.elements[7]=u.elements[11]=0,u.elements[15]=1),I.style.width=R.width+"px",I.style.height=R.height+"px",I.style.perspective=r?"":`${n}px`,$.current&&q.current&&($.current.style.transform=`${l}${c}translate(${e}px,${t}px)`,q.current.style.transform=_t(u,1/((d||10)/400)))}else{const t=void 0===d?1:function(e,t){if(t instanceof s)return t.zoom;if(t instanceof c){const n=ht.setFromMatrixPosition(e.matrixWorld),r=vt.setFromMatrixPosition(t.matrixWorld),o=t.fov*Math.PI/180,a=n.distanceTo(r);return 1/(2*Math.tan(o/2)*a)}return 1}(H.current,A)*d;I.style.transform=`translate3d(${e[0]}px,${e[1]}px,0) scale(${t})`}W.current=e,F.current=A.zoom}}if(!X&&G.current&&!V.current)if(p){if($.current){const e=$.current.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){const{isOrthographicCamera:t}=A;if(t||w)S.scale&&(Array.isArray(S.scale)?S.scale instanceof v?G.current.scale.copy(S.scale.clone().divideScalar(1)):G.current.scale.set(1/S.scale[0],1/S.scale[1],1/S.scale[2]):G.current.scale.setScalar(1/S.scale));else{const t=(d||10)/400,n=e.clientWidth*t,r=e.clientHeight*t;G.current.scale.set(n,r,1)}V.current=!0}}}else{const t=I.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){const e=1/T.factor,n=t.clientWidth*e,r=t.clientHeight*e;G.current.scale.set(n,r,1),V.current=!0}G.current.lookAt(e.camera.position)}}));const K=e.useMemo((()=>({vertexShader:p?void 0:'\n          /*\n            This shader is from the THREE\'s SpriteMaterial.\n            We need to turn the backing plane into a Sprite\n            (make it always face the camera) if "transfrom"\n            is false.\n          */\n          #include <common>\n\n          void main() {\n            vec2 center = vec2(0., 1.);\n            float rotation = 0.0;\n\n            // This is somewhat arbitrary, but it seems to work well\n            // Need to figure out how to derive this dynamically if it even matters\n            float size = 0.03;\n\n            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n            vec2 scale;\n            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\n            bool isPerspective = isPerspectiveMatrix( projectionMatrix );\n            if ( isPerspective ) scale *= - mvPosition.z;\n\n            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;\n            vec2 rotatedPosition;\n            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n            mvPosition.xy += rotatedPosition;\n\n            gl_Position = projectionMatrix * mvPosition;\n          }\n      ',fragmentShader:"\n        void main() {\n          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n        }\n      "})),[p]);return e.createElement("group",B({},S,{ref:H}),m&&!X&&e.createElement("mesh",{castShadow:g,receiveShadow:y,ref:G},w||e.createElement("planeGeometry",null),b||e.createElement("shaderMaterial",{side:P,vertexShader:K.vertexShader,fragmentShader:K.fragmentShader})))}));let Pt=0;const Ct=G((e=>(C.onStart=(t,n,r)=>{e({active:!0,item:t,loaded:n,total:r,progress:(n-Pt)/(r-Pt)*100})},C.onLoad=()=>{e({active:!1})},C.onError=t=>e((e=>({errors:[...e.errors,t]}))),C.onProgress=(t,n,r)=>{n===r&&(Pt=r),e({active:!0,item:t,loaded:n,total:r,progress:(n-Pt)/(r-Pt)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}))),St=e=>e===Object(e)&&!Array.isArray(e)&&"function"!=typeof e;function jt(t,n){const o=Ge((e=>e.gl)),a=Ze(S,St(t)?Object.values(t):t);e.useLayoutEffect((()=>{null==n||n(a)}),[n]),e.useEffect((()=>{if("initTexture"in o){let e=[];Array.isArray(a)?e=a:a instanceof r?e=[a]:St(a)&&(e=Object.values(a)),e.forEach((e=>{e instanceof r&&o.initTexture(e)}))}}),[o,a]);return e.useMemo((()=>{if(St(t)){const e={};let n=0;for(const r in t)e[r]=a[n++];return e}return a}),[t,a])}jt.preload=e=>Ze.preload(S,e),jt.clear=e=>Ze.clear(S,e);const zt=(()=>parseInt(j.replace(/\D+/g,"")))();function At(e=[0,0,0]){return function(e){return Array.isArray(e)}(e)?e:e instanceof v||e instanceof A?[e.x,e.y,e.z]:[e,e,e]}const Ot=e.forwardRef((function({debug:t,depthTest:n=!1,polygonOffsetFactor:r=-10,map:o,mesh:a,children:i,position:s,rotation:c,scale:l,...u},d){const f=e.useRef(null);e.useImperativeHandle(d,(()=>f.current));const p=e.useRef(null);return e.useLayoutEffect((()=>{const e=(null==a?void 0:a.current)||f.current.parent,t=f.current;if(!(e instanceof z))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const n={position:new v,rotation:new A,scale:new v(1,1,1)};if(e){tt(n,{position:s,scale:l});const r=e.matrixWorld.clone();if(e.matrixWorld.identity(),c&&"number"!=typeof c)tt(n,{rotation:c});else{const t=new O;t.position.copy(n.position),t.lookAt(e.position),"number"==typeof c&&t.rotateZ(c),tt(n,{rotation:t.rotation})}return t.geometry=new V(e,n.position,n.rotation,n.scale),p.current&&(tt(p.current,n),p.current.traverse((e=>e.raycast=()=>null))),e.matrixWorld=r,()=>{t.geometry.dispose()}}}),[a,...At(s),...At(l),...At(c)]),e.createElement("mesh",B({ref:f,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":r,"material-depthTest":n,"material-map":o},u),i,t&&e.createElement("mesh",{ref:p},e.createElement("boxGeometry",null),e.createElement("meshNormalMaterial",{wireframe:!0}),e.createElement("axesHelper",null)))}));let Rt=null,Lt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function kt(e=!0,t=!0,n){return r=>{n&&n(r),e&&(Rt||(Rt=new Y),Rt.setDecoderPath("string"==typeof e?e:Lt),r.setDRACOLoader(Rt)),t&&r.setMeshoptDecoder("function"==typeof Z?Z():Z)}}const Tt=(e,t,n,r)=>Ze(X,e,kt(t,n,r));Tt.preload=(e,t,n,r)=>Ze.preload(X,e,kt(t,n,r)),Tt.clear=e=>Ze.clear(X,e),Tt.setDecoderPath=e=>{Lt=e};const It=e.forwardRef((({makeDefault:t,camera:n,regress:r,domElement:o,enableDamping:a=!0,keyEvents:i=!1,onChange:s,onStart:c,onEnd:l,...u},d)=>{const f=Ge((e=>e.invalidate)),p=Ge((e=>e.camera)),m=Ge((e=>e.gl)),h=Ge((e=>e.events)),v=Ge((e=>e.setEvents)),g=Ge((e=>e.set)),y=Ge((e=>e.get)),b=Ge((e=>e.performance)),w=n||p,E=o||h.connected||m.domElement,x=e.useMemo((()=>new J(w)),[w]);return Ve((()=>{x.enabled&&x.update()}),-1),e.useEffect((()=>(i&&x.connect(!0===i?E:i),x.connect(E),()=>{x.dispose()})),[i,E,r,x,f]),e.useEffect((()=>{const e=e=>{f(),r&&b.regress(),s&&s(e)},t=e=>{c&&c(e)},n=e=>{l&&l(e)};return x.addEventListener("change",e),x.addEventListener("start",t),x.addEventListener("end",n),()=>{x.removeEventListener("start",t),x.removeEventListener("end",n),x.removeEventListener("change",e)}}),[s,c,l,x,f,v]),e.useEffect((()=>{if(t){const e=y().controls;return g({controls:x}),()=>g({controls:e})}}),[t,x]),e.createElement("primitive",B({ref:d,object:x,enableDamping:a},u))})),Dt=zt>=154?"opaque_fragment":"output_fragment";class Ht extends R{constructor(e){super(e),this.onBeforeCompile=(e,t)=>{const{isWebGL2:n}=t.capabilities;e.fragmentShader=e.fragmentShader.replace(`#include <${Dt}>`,`\n        ${n?`#include <${Dt}>`:`#extension GL_OES_standard_derivatives : enable\n#include <${Dt}>`}\n      vec2 cxy = 2.0 * gl_PointCoord - 1.0;\n      float r = dot(cxy, cxy);\n      float delta = fwidth(r);     \n      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);\n      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );\n      #include <tonemapping_fragment>\n      #include <${zt>=154?"colorspace_fragment":"encodings_fragment"}>\n      `)}}}const Ft=e.forwardRef(((t,n)=>{const[r]=e.useState((()=>new Ht(null)));return e.createElement("primitive",B({},t,{object:r,ref:n,attach:"material"}))})),Wt=e.forwardRef((({children:t,enabled:n=!0,speed:r=1,rotationIntensity:o=1,floatIntensity:a=1,floatingRange:i=[-.1,.1],autoInvalidate:s=!1,...c},l)=>{const u=e.useRef(null);e.useImperativeHandle(l,(()=>u.current),[]);const d=e.useRef(1e4*Math.random());return Ve((e=>{var t,c;if(!n||0===r)return;s&&e.invalidate();const l=d.current+e.clock.getElapsedTime();u.current.rotation.x=Math.cos(l/4*r)/8*o,u.current.rotation.y=Math.sin(l/4*r)/8*o,u.current.rotation.z=Math.sin(l/4*r)/20*o;let f=Math.sin(l/4*r)/10;f=L.mapLinear(f,-.1,.1,null!==(t=null==i?void 0:i[0])&&void 0!==t?t:-.1,null!==(c=null==i?void 0:i[1])&&void 0!==c?c:.1),u.current.position.y=f*a,u.current.updateMatrix()})),e.createElement("group",c,e.createElement("group",{ref:u,matrixAutoUpdate:!1},t))}));let $t,qt;const Ut=e.createContext(null),Bt=new T,Nt=new v,Gt=e.forwardRef((({children:t,range:n,limit:r=1e3,...o},a)=>{const i=e.useRef(null);e.useImperativeHandle(a,(()=>i.current),[]);const[s,c]=e.useState([]),[[l,u,d]]=e.useState((()=>[new Float32Array(3*r),Float32Array.from({length:3*r},(()=>1)),Float32Array.from({length:r},(()=>1))]));e.useEffect((()=>{i.current.geometry.attributes.position.needsUpdate=!0})),Ve((()=>{for(i.current.updateMatrix(),i.current.updateMatrixWorld(),Bt.copy(i.current.matrixWorld).invert(),i.current.geometry.drawRange.count=Math.min(r,void 0!==n?n:r,s.length),$t=0;$t<s.length;$t++)qt=s[$t].current,qt.getWorldPosition(Nt).applyMatrix4(Bt),Nt.toArray(l,3*$t),i.current.geometry.attributes.position.needsUpdate=!0,qt.matrixWorldNeedsUpdate=!0,qt.color.toArray(u,3*$t),i.current.geometry.attributes.color.needsUpdate=!0,d.set([qt.size],$t),i.current.geometry.attributes.size.needsUpdate=!0}));const f=e.useMemo((()=>({getParent:()=>i,subscribe:e=>(c((t=>[...t,e])),()=>c((t=>t.filter((t=>t.current!==e.current)))))})),[]);return e.createElement("points",B({userData:{instances:s},matrixAutoUpdate:!1,ref:i,raycast:()=>null},o),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:l.length/3,array:l,itemSize:3,usage:k}),e.createElement("bufferAttribute",{attach:"attributes-color",count:u.length/3,array:u,itemSize:3,usage:k}),e.createElement("bufferAttribute",{attach:"attributes-size",count:d.length,array:d,itemSize:1,usage:k})),e.createElement(Ut.Provider,{value:f},t))})),Vt=e.forwardRef((({children:t,positions:n,colors:r,sizes:o,stride:a=3,...i},s)=>{const c=e.useRef(null);return e.useImperativeHandle(s,(()=>c.current),[]),Ve((()=>{const e=c.current.geometry.attributes;e.position.needsUpdate=!0,r&&(e.color.needsUpdate=!0),o&&(e.size.needsUpdate=!0)})),e.createElement("points",B({ref:c},i),e.createElement("bufferGeometry",null,e.createElement("bufferAttribute",{attach:"attributes-position",count:n.length/a,array:n,itemSize:a,usage:k}),r&&e.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/a,array:r,itemSize:3,usage:k}),o&&e.createElement("bufferAttribute",{attach:"attributes-size",count:o.length/a,array:o,itemSize:1,usage:k})),t)})),Xt=e.forwardRef(((t,n)=>t.positions instanceof Float32Array?e.createElement(Vt,B({},t,{ref:n})):e.createElement(Gt,B({},t,{ref:n}))));function Yt({all:t,scene:n,camera:r}){const o=Ge((({gl:e})=>e)),a=Ge((({camera:e})=>e)),i=Ge((({scene:e})=>e));return e.useLayoutEffect((()=>{const e=[];t&&(n||i).traverse((t=>{!1===t.visible&&(e.push(t),t.visible=!0)})),o.compile(n||i,r||a);const s=new I(128);new D(.01,1e5,s).update(o,n||i),s.dispose(),e.forEach((e=>e.visible=!1))}),[]),null}export{mt as C,Ot as D,Wt as F,Mt as H,It as O,Yt as P,ne as _,Ve as a,Xt as b,Ft as c,Tt as d,Ct as e,jt as u};
