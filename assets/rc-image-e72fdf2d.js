import{c as L,e as _,b as J,h as Re,g as de,f as tt,d as Ve}from"./@babel-28107d12.js";import{c as ue}from"./classnames-325479d5.js";import{H as He,o as ot,l as at,K as Ye,I as _e,p as Xe,J as nt}from"./rc-util-cfa393e8.js";import{r as t,a as ve}from"./react-d998b26c.js";import{D as rt}from"./rc-dialog-47dc37fc.js";import{P as it}from"./@rc-component-72898980.js";import{C as st}from"./rc-motion-839c9e2f.js";var $e=["crossOrigin","decoding","draggable","loading","referrerPolicy","sizes","srcSet","useMap","alt"],ye=t.createContext(null),ze=0;function lt(m,e){var n=t.useState(function(){return ze+=1,String(ze)}),c=L(n,1),f=c[0],o=t.useContext(ye),u={data:e,canPreview:m};return t.useEffect(function(){if(o)return o.register(f,u)},[]),t.useEffect(function(){o&&o.register(f,u)},[m,e]),f}function ct(m){return new Promise(function(e){var n=document.createElement("img");n.onerror=function(){return e(!1)},n.onload=function(){return e(!0)},n.src=m})}function Ke(m){var e=m.src,n=m.isCustomPlaceholder,c=m.fallback,f=t.useState(n?"loading":"normal"),o=L(f,2),u=o[0],a=o[1],l=t.useRef(!1),i=u==="error";t.useEffect(function(){var C=!0;return ct(e).then(function(v){!v&&C&&a("error")}),function(){C=!1}},[e]),t.useEffect(function(){n&&!l.current?a("loading"):i&&a("normal")},[e]);var b=function(){a("normal")},s=function(v){l.current=!1,u==="loading"&&v!==null&&v!==void 0&&v.complete&&(v.naturalWidth||v.naturalHeight)&&(l.current=!0,b())},y=i&&c?{src:c}:{onLoad:b,src:e};return[s,y,u]}function We(m,e,n,c){var f=e+n,o=(n-c)/2;if(n>c){if(e>0)return J({},m,o);if(e<0&&f<c)return J({},m,-o)}else if(e<0||f>c)return J({},m,e<0?o:-o);return{}}function ut(m,e,n,c){var f=He(),o=f.width,u=f.height,a=null;return m<=o&&e<=u?a={x:0,y:0}:(m>o||e>u)&&(a=_(_({},We("x",n,m,o)),We("y",c,e,u))),a}var Ne={x:0,y:0,rotate:0,scale:1,flipX:!1,flipY:!1};function ft(m,e,n,c){var f=t.useRef(null),o=t.useRef([]),u=t.useState(Ne),a=L(u,2),l=a[0],i=a[1],b=function(v){i(Ne),c&&!ot(Ne,l)&&c({transform:Ne,action:v})},s=function(v,T){f.current===null&&(o.current=[],f.current=at(function(){i(function(h){var w=h;return o.current.forEach(function(p){w=_(_({},w),p)}),f.current=null,c==null||c({transform:w,action:T}),w})})),o.current.push(_(_({},l),v))},y=function(v,T,h,w){var p=m.current,oe=p.width,W=p.height,k=p.offsetWidth,V=p.offsetHeight,H=p.offsetLeft,g=p.offsetTop,N=v,R=l.scale*v;R>n?(N=n/l.scale,R=n):R<e&&(N=e/l.scale,R=e);var A=h??innerWidth/2,O=w??innerHeight/2,Y=N-1,K=Y*oe*.5,Q=Y*W*.5,z=Y*(A-l.x-H),j=Y*(O-l.y-g),E=l.x-(z-K),G=l.y-(j-Q);if(v<1&&R===1){var D=k*R,F=V*R,U=He(),ee=U.width,P=U.height;D<=ee&&F<=P&&(E=0,G=0)}s({x:E,y:G,scale:R},T)};return{transform:l,resetTransform:b,updateTransform:s,dispatchZoomChange:y}}var mt=function(e){var n=e.visible,c=e.maskTransitionName,f=e.getContainer,o=e.prefixCls,u=e.rootClassName,a=e.icons,l=e.countRender,i=e.showSwitch,b=e.showProgress,s=e.current,y=e.transform,C=e.count,v=e.scale,T=e.minScale,h=e.maxScale,w=e.closeIcon,p=e.onSwitchLeft,oe=e.onSwitchRight,W=e.onClose,k=e.onZoomIn,V=e.onZoomOut,H=e.onRotateRight,g=e.onRotateLeft,N=e.onFlipX,R=e.onFlipY,A=e.toolbarRender,O=t.useContext(ye),Y=a.rotateLeft,K=a.rotateRight,Q=a.zoomIn,z=a.zoomOut,j=a.close,E=a.left,G=a.right,D=a.flipX,F=a.flipY,U="".concat(o,"-operations-operation");t.useEffect(function(){var S=function(Z){Z.keyCode===Ye.ESC&&W()};return n&&window.addEventListener("keydown",S),function(){window.removeEventListener("keydown",S)}},[n]);var ee=[{icon:F,onClick:R,type:"flipY"},{icon:D,onClick:N,type:"flipX"},{icon:Y,onClick:g,type:"rotateLeft"},{icon:K,onClick:H,type:"rotateRight"},{icon:z,onClick:V,type:"zoomOut",disabled:v===T},{icon:Q,onClick:k,type:"zoomIn",disabled:v===h}],P=ee.map(function(S){var I,Z=S.icon,q=S.onClick,d=S.type,ne=S.disabled;return t.createElement("div",{className:ue(U,(I={},J(I,"".concat(o,"-operations-operation-").concat(d),!0),J(I,"".concat(o,"-operations-operation-disabled"),!!ne),I)),onClick:q,key:d},Z)}),ae=t.createElement("div",{className:"".concat(o,"-operations")},P);return t.createElement(st,{visible:n,motionName:c},function(S){var I=S.className,Z=S.style;return t.createElement(it,{open:!0,getContainer:f??document.body},t.createElement("div",{className:ue("".concat(o,"-operations-wrapper"),I,u),style:Z},w===null?null:t.createElement("button",{className:"".concat(o,"-close"),onClick:W},w||j),i&&t.createElement(t.Fragment,null,t.createElement("div",{className:ue("".concat(o,"-switch-left"),J({},"".concat(o,"-switch-left-disabled"),s===0)),onClick:p},E),t.createElement("div",{className:ue("".concat(o,"-switch-right"),J({},"".concat(o,"-switch-right-disabled"),s===C-1)),onClick:oe},G)),t.createElement("div",{className:"".concat(o,"-footer")},b&&t.createElement("div",{className:"".concat(o,"-progress")},l?l(s+1,C):"".concat(s+1," / ").concat(C)),A?A(ae,_({icons:{flipYIcon:P[0],flipXIcon:P[1],rotateLeftIcon:P[2],rotateRightIcon:P[3],zoomOutIcon:P[4],zoomInIcon:P[5]},actions:{onFlipY:R,onFlipX:N,onRotateLeft:g,onRotateRight:H,onZoomOut:V,onZoomIn:k},transform:y},O?{current:s,total:C}:{})):ae)))})},pe=1,vt=1,dt=["fallback","src","imgRef"],gt=["prefixCls","src","alt","fallback","movable","onClose","visible","icons","rootClassName","closeIcon","getContainer","current","count","countRender","scaleStep","minScale","maxScale","transitionName","maskTransitionName","imageRender","imgCommonProps","toolbarRender","onTransform","onChange"],Ct=function(e){var n=e.fallback,c=e.src,f=e.imgRef,o=Re(e,dt),u=Ke({src:c,fallback:n}),a=L(u,2),l=a[0],i=a[1];return ve.createElement("img",de({ref:function(s){f.current=s,l(s)}},o,i))},je=function(e){var n=e.prefixCls,c=e.src,f=e.alt,o=e.fallback,u=e.movable,a=u===void 0?!0:u,l=e.onClose,i=e.visible,b=e.icons,s=b===void 0?{}:b,y=e.rootClassName,C=e.closeIcon,v=e.getContainer,T=e.current,h=T===void 0?0:T,w=e.count,p=w===void 0?1:w,oe=e.countRender,W=e.scaleStep,k=W===void 0?.5:W,V=e.minScale,H=V===void 0?1:V,g=e.maxScale,N=g===void 0?50:g,R=e.transitionName,A=R===void 0?"zoom":R,O=e.maskTransitionName,Y=O===void 0?"fade":O,K=e.imageRender,Q=e.imgCommonProps,z=e.toolbarRender,j=e.onTransform,E=e.onChange,G=Re(e,gt),D=t.useRef(),F=t.useRef({deltaX:0,deltaY:0,transformX:0,transformY:0}),U=t.useState(!1),ee=L(U,2),P=ee[0],ae=ee[1],S=t.useContext(ye),I=S&&p>1,Z=S&&p>=1,q=ft(D,H,N,j),d=q.transform,ne=q.resetTransform,X=q.updateTransform,re=q.dispatchZoomChange,xe=t.useState(!0),fe=L(xe,2),me=fe[0],B=fe[1],$=d.rotate,M=d.scale,ie=d.x,se=d.y,Ee=ue(J({},"".concat(n,"-moving"),P));t.useEffect(function(){me||B(!0)},[me]);var Me=function(){ne("close")},ge=function(){re(pe+k,"zoomIn")},Le=function(){re(pe/(pe+k),"zoomOut")},Te=function(){X({rotate:$+90},"rotateRight")},Oe=function(){X({rotate:$-90},"rotateLeft")},le=function(){X({flipX:!d.flipX},"flipX")},ce=function(){X({flipY:!d.flipY},"flipY")},Pe=function(r){r==null||r.preventDefault(),r==null||r.stopPropagation(),h>0&&(B(!1),ne("prev"),E==null||E(h-1,h))},Ie=function(r){r==null||r.preventDefault(),r==null||r.stopPropagation(),h<p-1&&(B(!1),ne("next"),E==null||E(h+1,h))},ke=function(){if(i&&P){ae(!1);var r=F.current,Ce=r.transformX,he=r.transformY,te=ie!==Ce&&se!==he;if(!te)return;var we=D.current.offsetWidth*M,Se=D.current.offsetHeight*M,be=D.current.getBoundingClientRect(),Qe=be.left,et=be.top,Ze=$%180!==0,Ae=ut(Ze?Se:we,Ze?we:Se,Qe,et);Ae&&X(_({},Ae),"dragRebound")}},Ue=function(r){!a||r.button!==0||(r.preventDefault(),r.stopPropagation(),F.current={deltaX:r.pageX-d.x,deltaY:r.pageY-d.y,transformX:d.x,transformY:d.y},ae(!0))},De=function(r){i&&P&&X({x:r.pageX-F.current.deltaX,y:r.pageY-F.current.deltaY},"move")},qe=function(r){if(!(!i||r.deltaY==0)){var Ce=Math.abs(r.deltaY/100),he=Math.min(Ce,vt),te=pe+he*k;r.deltaY>0&&(te=pe/te),re(te,"wheel",r.clientX,r.clientY)}},Be=function(r){!i||!I||(r.keyCode===Ye.LEFT?Pe():r.keyCode===Ye.RIGHT&&Ie())},Je=function(r){i&&(M!==1?X({x:0,y:0,scale:1},"doubleClick"):re(pe+k,"doubleClick",r.clientX,r.clientY))};t.useEffect(function(){var x,r,Ce,he;if(a){Ce=_e(window,"mouseup",ke,!1),he=_e(window,"mousemove",De,!1);try{window.top!==window.self&&(x=_e(window.top,"mouseup",ke,!1),r=_e(window.top,"mousemove",De,!1))}catch{}}return function(){var te,we,Se,be;(te=Ce)===null||te===void 0||te.remove(),(we=he)===null||we===void 0||we.remove(),(Se=x)===null||Se===void 0||Se.remove(),(be=r)===null||be===void 0||be.remove()}},[i,P,ie,se,$,a]),t.useEffect(function(){var x=_e(window,"keydown",Be,!1);return function(){x.remove()}},[i,I,h]);var Fe=ve.createElement(Ct,de({},Q,{width:e.width,height:e.height,imgRef:D,className:"".concat(n,"-img"),alt:f,style:{transform:"translate3d(".concat(d.x,"px, ").concat(d.y,"px, 0) scale3d(").concat(d.flipX?"-":"").concat(M,", ").concat(d.flipY?"-":"").concat(M,", 1) rotate(").concat($,"deg)"),transitionDuration:!me&&"0s"},fallback:o,src:c,onWheel:qe,onMouseDown:Ue,onDoubleClick:Je}));return ve.createElement(ve.Fragment,null,ve.createElement(rt,de({transitionName:A,maskTransitionName:Y,closable:!1,keyboard:!0,prefixCls:n,onClose:l,visible:i,wrapClassName:Ee,rootClassName:y,getContainer:v},G,{afterClose:Me}),ve.createElement("div",{className:"".concat(n,"-img-wrapper")},K?K(Fe,_({transform:d},S?{current:h}:{})):Fe)),ve.createElement(mt,{visible:i,transform:d,maskTransitionName:Y,closeIcon:C,getContainer:v,prefixCls:n,rootClassName:y,icons:s,countRender:oe,showSwitch:I,showProgress:Z,current:h,count:p,scale:M,minScale:H,maxScale:N,toolbarRender:z,onSwitchLeft:Pe,onSwitchRight:Ie,onZoomIn:ge,onZoomOut:Le,onRotateRight:Te,onRotateLeft:Oe,onFlipX:le,onFlipY:ce,onClose:l}))};function ht(m){var e=t.useState({}),n=L(e,2),c=n[0],f=n[1],o=t.useCallback(function(a,l){return f(function(i){return _(_({},i),{},J({},a,l))}),function(){f(function(i){var b=_({},i);return delete b[a],b})}},[]),u=t.useMemo(function(){return m?m.map(function(a){if(typeof a=="string")return{data:{src:a}};var l={};return Object.keys(a).forEach(function(i){["src"].concat(tt($e)).includes(i)&&(l[i]=a[i])}),{data:l}}):Object.keys(c).reduce(function(a,l){var i=c[l],b=i.canPreview,s=i.data;return b&&a.push({data:s,id:l}),a},[])},[m,c]);return[u,o]}var wt=["visible","onVisibleChange","getContainer","current","movable","minScale","maxScale","countRender","closeIcon","onChange","onTransform","toolbarRender","imageRender"],St=["src"],bt=function(e){var n,c=e.previewPrefixCls,f=c===void 0?"rc-image-preview":c,o=e.children,u=e.icons,a=u===void 0?{}:u,l=e.items,i=e.preview,b=e.fallback,s=Ve(i)==="object"?i:{},y=s.visible,C=s.onVisibleChange,v=s.getContainer,T=s.current,h=s.movable,w=s.minScale,p=s.maxScale,oe=s.countRender,W=s.closeIcon,k=s.onChange,V=s.onTransform,H=s.toolbarRender,g=s.imageRender,N=Re(s,wt),R=ht(l),A=L(R,2),O=A[0],Y=A[1],K=Xe(0,{value:T}),Q=L(K,2),z=Q[0],j=Q[1],E=t.useState(!1),G=L(E,2),D=G[0],F=G[1],U=((n=O[z])===null||n===void 0?void 0:n.data)||{},ee=U.src,P=Re(U,St),ae=Xe(!!y,{value:y,onChange:function($,M){C==null||C($,M,z)}}),S=L(ae,2),I=S[0],Z=S[1],q=t.useState(null),d=L(q,2),ne=d[0],X=d[1],re=t.useCallback(function(B,$,M){var ie=O.findIndex(function(se){return se.id===B});Z(!0),X({x:$,y:M}),j(ie<0?0:ie),F(!0)},[O]);t.useEffect(function(){I?D||j(0):F(!1)},[I]);var xe=function($,M){j($),k==null||k($,M)},fe=function(){Z(!1),X(null)},me=t.useMemo(function(){return{register:Y,onPreview:re}},[Y,re]);return t.createElement(ye.Provider,{value:me},o,t.createElement(je,de({"aria-hidden":!I,movable:h,visible:I,prefixCls:f,closeIcon:W,onClose:fe,mousePosition:ne,imgCommonProps:P,src:ee,fallback:b,icons:a,minScale:w,maxScale:p,getContainer:v,current:z,count:O.length,countRender:oe,onTransform:V,toolbarRender:H,imageRender:g,onChange:xe},N)))},pt=["src","alt","onPreviewClose","prefixCls","previewPrefixCls","placeholder","fallback","width","height","style","preview","className","onClick","onError","wrapperClassName","wrapperStyle","rootClassName"],Rt=["src","visible","onVisibleChange","getContainer","mask","maskClassName","movable","icons","scaleStep","minScale","maxScale","imageRender","toolbarRender"],Ge=function(e){var n=e.src,c=e.alt,f=e.onPreviewClose,o=e.prefixCls,u=o===void 0?"rc-image":o,a=e.previewPrefixCls,l=a===void 0?"".concat(u,"-preview"):a,i=e.placeholder,b=e.fallback,s=e.width,y=e.height,C=e.style,v=e.preview,T=v===void 0?!0:v,h=e.className,w=e.onClick,p=e.onError,oe=e.wrapperClassName,W=e.wrapperStyle,k=e.rootClassName,V=Re(e,pt),H=i&&i!==!0,g=Ve(T)==="object"?T:{},N=g.src,R=g.visible,A=R===void 0?void 0:R,O=g.onVisibleChange,Y=O===void 0?f:O,K=g.getContainer,Q=K===void 0?void 0:K,z=g.mask,j=g.maskClassName,E=g.movable,G=g.icons,D=g.scaleStep,F=g.minScale,U=g.maxScale,ee=g.imageRender,P=g.toolbarRender,ae=Re(g,Rt),S=N??n,I=Xe(!!A,{value:A,onChange:Y}),Z=L(I,2),q=Z[0],d=Z[1],ne=Ke({src:n,isCustomPlaceholder:H,fallback:b}),X=L(ne,3),re=X[0],xe=X[1],fe=X[2],me=t.useState(null),B=L(me,2),$=B[0],M=B[1],ie=t.useContext(ye),se=!!T,Ee=function(){d(!1),M(null)},Me=ue(u,oe,k,J({},"".concat(u,"-error"),fe==="error")),ge=t.useMemo(function(){var le={};return $e.forEach(function(ce){e[ce]!==void 0&&(le[ce]=e[ce])}),le},$e.map(function(le){return e[le]})),Le=t.useMemo(function(){return _(_({},ge),{},{src:S})},[S,ge]),Te=lt(se,Le),Oe=function(ce){var Pe=nt(ce.target),Ie=Pe.left,ke=Pe.top;ie?ie.onPreview(Te,Ie,ke):(M({x:Ie,y:ke}),d(!0)),w==null||w(ce)};return t.createElement(t.Fragment,null,t.createElement("div",de({},V,{className:Me,onClick:se?Oe:w,style:_({width:s,height:y},W)}),t.createElement("img",de({},ge,{className:ue("".concat(u,"-img"),J({},"".concat(u,"-img-placeholder"),i===!0),h),style:_({height:y},C),ref:re},xe,{width:s,height:y,onError:p})),fe==="loading"&&t.createElement("div",{"aria-hidden":"true",className:"".concat(u,"-placeholder")},i),z&&se&&t.createElement("div",{className:ue("".concat(u,"-mask"),j),style:{display:(C==null?void 0:C.display)==="none"?"none":void 0}},z)),!ie&&se&&t.createElement(je,de({"aria-hidden":!q,visible:q,prefixCls:l,onClose:Ee,mousePosition:$,src:S,alt:c,fallback:b,getContainer:Q,icons:G,movable:E,scaleStep:D,minScale:F,maxScale:U,rootClassName:k,imageRender:ee,imgCommonProps:ge,toolbarRender:P},ae)))};Ge.PreviewGroup=bt;Ge.displayName="Image";export{Ge as I};
