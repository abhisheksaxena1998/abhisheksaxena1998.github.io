import{g as q}from"./@babel-28107d12.js";import{r as u}from"./react-d998b26c.js";import{L as Ce,T as It,R as Ht,U as Bt,a as Ut,O as Be,P as Ue,S as Qe,b as Se,N as Gt,A as Nt,B as qt,M as Vt,C as Xt,V as B,c as Yt,W as Zt,d as Kt,e as Jt,f as Qt,g as er,h as tr,i as rr,D as nr,j as we,k as Ge,l as or,m as ir,E as pt,n as sr,o as ar,p as cr,q as ae,r as lr,s as ur,t as fr}from"./three-eee75409.js";import{u as dr}from"./react-use-measure-761a5d94.js";import{F as pr,u as mr}from"./its-fine-845edb61.js";import{R as hr,c as se}from"./react-reconciler-32468f67.js";import{s as et}from"./scheduler-765c72db.js";import{c as vr}from"./react-dom-890fecd1.js";import{c as mt}from"./zustand-5d5ab9ea.js";import{D as gr,G as Ne,a as yr,M as Re,O as br}from"./three-stdlib-0b7f9bf5.js";import{m as qe}from"./react-merge-refs-239dbb3c.js";import{s as wr,p as Er,c as _r}from"./suspend-react-4f9dedb1.js";const xr="modulepreload",Pr=function(e){return"/"+e},tt={},_n=function(t,r,i){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(a=>{if(a=Pr(a),a in tt)return;tt[a]=!0;const m=a.endsWith(".css"),v=m?'[rel="stylesheet"]':"";if(!!i)for(let n=s.length-1;n>=0;n--){const o=s[n];if(o.href===a&&(!m||o.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${v}`))return;const g=document.createElement("link");if(g.rel=m?"stylesheet":xr,m||(g.as="script",g.crossOrigin=""),g.href=a,document.head.appendChild(g),m)return new Promise((n,o)=>{g.addEventListener("load",n),g.addEventListener("error",()=>o(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>t()).catch(a=>{const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=a,window.dispatchEvent(m),!m.defaultPrevented)throw a})},Ve={},Mr=e=>void Object.assign(Ve,e);function Cr(e,t){function r(n,{args:o=[],attach:h,...f},p){let x=`${n[0].toUpperCase()}${n.slice(1)}`,y;if(n==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const d=f.object;y=oe(d,{type:n,root:p,attach:h,primitive:!0})}else{const d=Ve[x];if(!d)throw new Error(`R3F: ${x} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");y=oe(new d(...o),{type:n,root:p,attach:h,memoizedProps:{args:o}})}return y.__r3f.attach===void 0&&(y instanceof qt?y.__r3f.attach="geometry":y instanceof Vt&&(y.__r3f.attach="material")),x!=="inject"&&je(y,f),y}function i(n,o){let h=!1;if(o){var f,p;(f=o.__r3f)!=null&&f.attach?Ae(n,o,o.__r3f.attach):o.isObject3D&&n.isObject3D&&(n.add(o),h=!0),h||(p=n.__r3f)==null||p.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=n,Ie(o),ie(o)}}function s(n,o,h){let f=!1;if(o){var p,x;if((p=o.__r3f)!=null&&p.attach)Ae(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){o.parent=n,o.dispatchEvent({type:"added"});const d=n.children.filter(b=>b!==o),l=d.indexOf(h);n.children=[...d.slice(0,l),o,...d.slice(l)],f=!0}const y=(x=n.__r3f)==null?void 0:x.objects;if(!f&&y){const d=y.indexOf(h);d!==-1?y.splice(d,0,o):y.push(o)}o.__r3f||oe(o,{}),o.__r3f.parent=n,Ie(o),ie(o)}}function a(n,o,h=!1){n&&[...n].forEach(f=>m(o,f,h))}function m(n,o,h){if(o){var f,p,x;o.__r3f&&(o.__r3f.parent=null);const l=(f=n.__r3f)==null?void 0:f.objects;if(l){const _=l.indexOf(o);_!==-1&&l.splice(_,1)}if((p=o.__r3f)!=null&&p.attach)st(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){var y;n.remove(o),(y=o.__r3f)!=null&&y.root&&kr(o.__r3f.root,o)}const b=(x=o.__r3f)==null?void 0:x.primitive,P=h===void 0?o.dispose!==null&&!b:h;if(!b){var d;a((d=o.__r3f)==null?void 0:d.objects,o,P),a(o.children,o,P)}delete o.__r3f,P&&o.dispose&&o.type!=="Scene"&&et.unstable_scheduleCallback(et.unstable_IdlePriority,()=>{try{o.dispose()}catch{}}),ie(n)}}function v(n,o,h,f){var p;const x=(p=n.__r3f)==null?void 0:p.parent;if(!x)return;const y=r(o,h,n.__r3f.root);if(n.children){for(const l of n.children)l.__r3f&&i(y,l);n.children=n.children.filter(l=>!l.__r3f)}n.__r3f.objects.forEach(l=>i(y,l)),n.__r3f.objects=[];const d=!!y.parent;n.__r3f.autoRemovedBeforeAppend?i(x,y):(s(x,y,n),m(x,n)),y.__r3f.autoRemovedBeforeAppend=d,y.raycast&&y.__r3f.eventCount&&y.__r3f.root.getState().internal.interaction.push(y),[f,f.alternate].forEach(l=>{l!==null&&(l.stateNode=y,l.ref&&(typeof l.ref=="function"?l.ref(y):l.ref.current=y))})}const c=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:hr({createInstance:r,removeChild:m,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,o)=>{if(!o)return;const h=n.getState().scene;h.__r3f&&(h.__r3f.root=n,i(h,o))},removeChildFromContainer:(n,o)=>{o&&m(n.getState().scene,o)},insertInContainerBefore:(n,o,h)=>{if(!o||!h)return;const f=n.getState().scene;f.__r3f&&s(f,o,h)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var o;return!!((o=n==null?void 0:n.__r3f)!=null?o:{}).handlers},prepareUpdate(n,o,h,f){var p;if(((p=n==null?void 0:n.__r3f)!=null?p:{}).primitive&&f.object&&f.object!==n)return[!0];{const{args:y=[],children:d,...l}=f,{args:b=[],children:P,..._}=h;if(!Array.isArray(y))throw new Error("R3F: the args prop must be an array!");if(y.some((C,R)=>C!==b[R]))return[!0];const E=Et(n,l,_,!0);return E.changes.length?[!1,E]:null}},commitUpdate(n,[o,h],f,p,x,y){o?v(n,f,x,y):je(n,h)},commitMount(n,o,h,f){var p;const x=(p=n.__r3f)!=null?p:{};n.raycast&&x.handlers&&x.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>oe(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var o;const{attach:h,parent:f}=(o=n.__r3f)!=null?o:{};h&&f&&st(f,n,h),n.isObject3D&&(n.visible=!1),ie(n)},unhideInstance(n,o){var h;const{attach:f,parent:p}=(h=n.__r3f)!=null?h:{};f&&p&&Ae(p,n,f),(n.isObject3D&&o.visible==null||o.visible)&&(n.visible=!0),ie(n)},createTextInstance:c,hideTextInstance:c,unhideTextInstance:c,getCurrentEventPriority:()=>t?t():se.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&T.fun(performance.now)?performance.now:T.fun(Date.now)?Date.now:()=>0,scheduleTimeout:T.fun(setTimeout)?setTimeout:void 0,cancelTimeout:T.fun(clearTimeout)?clearTimeout:void 0}),applyProps:je}}var rt,nt;const Oe=e=>"colorSpace"in e||"outputColorSpace"in e,ht=()=>{var e;return(e=Ve.ColorManagement)!=null?e:null},vt=e=>e&&e.isOrthographicCamera,Sr=e=>e&&e.hasOwnProperty("current"),me=typeof window<"u"&&((rt=window.document)!=null&&rt.createElement||((nt=window.navigator)==null?void 0:nt.product)==="ReactNative")?u.useLayoutEffect:u.useEffect;function gt(e){const t=u.useRef(e);return me(()=>void(t.current=e),[e]),t}function Rr({set:e}){return me(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class yt extends u.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}yt.getDerivedStateFromError=()=>({error:!0});const bt="__default",ot=new Map,Or=e=>e&&!!e.memoized&&!!e.changes;function wt(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const ue=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},T={obj:e=>e===Object(e)&&!T.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(T.str(e)||T.num(e))return e===t;const a=T.obj(e);if(a&&i==="reference")return e===t;const m=T.arr(e);if(m&&r==="reference")return e===t;if((m||a)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;if(a&&r==="shallow"&&i==="shallow"){for(v in s?t:e)if(!T.equ(e[v],t[v],{strict:s,objects:"reference"}))return!1}else for(v in s?t:e)if(e[v]!==t[v])return!1;if(T.und(v)){if(m&&e.length===0&&t.length===0||a&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Ar(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function jr(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function oe(e,t){const r=e;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function $e(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return r=i.reduce((a,m)=>a[m],e),{target:r,key:s}}else return{target:r,key:t}}const it=/-\d+$/;function Ae(e,t,r){if(T.str(r)){if(it.test(r)){const a=r.replace(it,""),{target:m,key:v}=$e(e,a);Array.isArray(m[v])||(m[v]=[])}const{target:i,key:s}=$e(e,r);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=r(e,t)}function st(e,t,r){var i,s;if(T.str(r)){const{target:a,key:m}=$e(e,r),v=t.__r3f.previousAttach;v===void 0?delete a[m]:a[m]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function Et(e,{children:t,key:r,ref:i,...s},{children:a,key:m,ref:v,...c}={},g=!1){var n;const o=(n=e==null?void 0:e.__r3f)!=null?n:{},h=Object.entries(s),f=[];if(g){const x=Object.keys(c);for(let y=0;y<x.length;y++)s.hasOwnProperty(x[y])||h.unshift([x[y],bt+"remove"])}h.forEach(([x,y])=>{var d;if((d=e.__r3f)!=null&&d.primitive&&x==="object"||T.equ(y,c[x]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(x))return f.push([x,y,!0,[]]);let l=[];x.includes("-")&&(l=x.split("-")),f.push([x,y,!1,l]);for(const b in s){const P=s[b];b.startsWith(`${x}-`)&&f.push([b,P,!1,b.split("-")])}});const p={...s};return o.memoizedProps&&o.memoizedProps.args&&(p.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(p.attach=o.memoizedProps.attach),{memoized:p,changes:f}}const Tr=typeof process<"u"&&!1;function je(e,t){var r,i,s;const a=(r=e.__r3f)!=null?r:{},m=a.root,v=(i=m==null||m.getState==null?void 0:m.getState())!=null?i:{},{memoized:c,changes:g}=Or(t)?t:Et(e,t),n=a.eventCount;e.__r3f&&(e.__r3f.memoizedProps=c);for(let h=0;h<g.length;h++){let[f,p,x,y]=g[h];if(Oe(e)){const P="srgb",_="srgb-linear";f==="encoding"?(f="colorSpace",p=p===3001?P:_):f==="outputEncoding"&&(f="outputColorSpace",p=p===3001?P:_)}let d=e,l=d[f];if(y.length&&(l=y.reduce((b,P)=>b[P],e),!(l&&l.set))){const[b,...P]=y.reverse();d=P.reverse().reduce((_,E)=>_[E],e),f=b}if(p===bt+"remove")if(d.constructor){let b=ot.get(d.constructor);b||(b=new d.constructor,ot.set(d.constructor,b)),p=b[f]}else p=0;if(x)p?a.handlers[f]=p:delete a.handlers[f],a.eventCount=Object.keys(a.handlers).length;else if(l&&l.set&&(l.copy||l instanceof Ce)){if(Array.isArray(p))l.fromArray?l.fromArray(p):l.set(...p);else if(l.copy&&p&&p.constructor&&(Tr?l.constructor.name===p.constructor.name:l.constructor===p.constructor))l.copy(p);else if(p!==void 0){const b=l instanceof Xt;!b&&l.setScalar?l.setScalar(p):l instanceof Ce&&p instanceof Ce?l.mask=p.mask:l.set(p),!ht()&&!v.linear&&b&&l.convertSRGBToLinear()}}else if(d[f]=p,d[f]instanceof It&&d[f].format===Ht&&d[f].type===Bt){const b=d[f];Oe(b)&&Oe(v.gl)?b.colorSpace=v.gl.outputColorSpace:b.encoding=v.gl.outputEncoding}ie(e)}if(a.parent&&v.internal&&e.raycast&&n!==a.eventCount){const h=v.internal.interaction.indexOf(e);h>-1&&v.internal.interaction.splice(h,1),a.eventCount&&v.internal.interaction.push(e)}return!(g.length===1&&g[0][0]==="onUpdate")&&g.length&&(s=e.__r3f)!=null&&s.parent&&Ie(e),e}function ie(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function Ie(e){e.onUpdate==null||e.onUpdate(e)}function Dr(e,t){e.manual||(vt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function Ee(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Lr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return se.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return se.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return se.ContinuousEventPriority;default:return se.DefaultEventPriority}}function _t(e,t,r,i){const s=r.get(t);s&&(r.delete(t),r.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function kr(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(s)}),r.capturedMap.forEach((i,s)=>{_t(r.capturedMap,t,i,s)})}function Fr(e){function t(c){const{internal:g}=e.getState(),n=c.offsetX-g.initialClick[0],o=c.offsetY-g.initialClick[1];return Math.round(Math.sqrt(n*n+o*o))}function r(c){return c.filter(g=>["Move","Over","Enter","Out","Leave"].some(n=>{var o;return(o=g.__r3f)==null?void 0:o.handlers["onPointer"+n]}))}function i(c,g){const n=e.getState(),o=new Set,h=[],f=g?g(n.internal.interaction):n.internal.interaction;for(let d=0;d<f.length;d++){const l=ue(f[d]);l&&(l.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(c,n);function p(d){const l=ue(d);if(!l||!l.events.enabled||l.raycaster.camera===null)return[];if(l.raycaster.camera===void 0){var b;l.events.compute==null||l.events.compute(c,l,(b=l.previousRoot)==null?void 0:b.getState()),l.raycaster.camera===void 0&&(l.raycaster.camera=null)}return l.raycaster.camera?l.raycaster.intersectObject(d,!0):[]}let x=f.flatMap(p).sort((d,l)=>{const b=ue(d.object),P=ue(l.object);return!b||!P?d.distance-l.distance:P.events.priority-b.events.priority||d.distance-l.distance}).filter(d=>{const l=Ee(d);return o.has(l)?!1:(o.add(l),!0)});n.events.filter&&(x=n.events.filter(x,n));for(const d of x){let l=d.object;for(;l;){var y;(y=l.__r3f)!=null&&y.eventCount&&h.push({...d,eventObject:l}),l=l.parent}}if("pointerId"in c&&n.internal.capturedMap.has(c.pointerId))for(let d of n.internal.capturedMap.get(c.pointerId).values())o.has(Ee(d.intersection))||h.push(d.intersection);return h}function s(c,g,n,o){const h=e.getState();if(c.length){const f={stopped:!1};for(const p of c){const x=ue(p.object)||h,{raycaster:y,pointer:d,camera:l,internal:b}=x,P=new B(d.x,d.y,0).unproject(l),_=O=>{var w,A;return(w=(A=b.capturedMap.get(O))==null?void 0:A.has(p.eventObject))!=null?w:!1},E=O=>{const w={intersection:p,target:g.target};b.capturedMap.has(O)?b.capturedMap.get(O).set(p.eventObject,w):b.capturedMap.set(O,new Map([[p.eventObject,w]])),g.target.setPointerCapture(O)},C=O=>{const w=b.capturedMap.get(O);w&&_t(b.capturedMap,p.eventObject,w,O)};let R={};for(let O in g){let w=g[O];typeof w!="function"&&(R[O]=w)}let M={...p,...R,pointer:d,intersections:c,stopped:f.stopped,delta:n,unprojectedPoint:P,ray:y.ray,camera:l,stopPropagation(){const O="pointerId"in g&&b.capturedMap.get(g.pointerId);if((!O||O.has(p.eventObject))&&(M.stopped=f.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(w=>w.eventObject===p.eventObject))){const w=c.slice(0,c.indexOf(p));a([...w,p])}},target:{hasPointerCapture:_,setPointerCapture:E,releasePointerCapture:C},currentTarget:{hasPointerCapture:_,setPointerCapture:E,releasePointerCapture:C},nativeEvent:g};if(o(M),f.stopped===!0)break}}return c}function a(c){const{internal:g}=e.getState();for(const n of g.hovered.values())if(!c.length||!c.find(o=>o.object===n.object&&o.index===n.index&&o.instanceId===n.instanceId)){const h=n.eventObject.__r3f,f=h==null?void 0:h.handlers;if(g.hovered.delete(Ee(n)),h!=null&&h.eventCount){const p={...n,intersections:c};f.onPointerOut==null||f.onPointerOut(p),f.onPointerLeave==null||f.onPointerLeave(p)}}}function m(c,g){for(let n=0;n<g.length;n++){const o=g[n].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(c)}}function v(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>a([]);case"onLostPointerCapture":return g=>{const{internal:n}=e.getState();"pointerId"in g&&n.capturedMap.has(g.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(g.pointerId)&&(n.capturedMap.delete(g.pointerId),a([]))})}}return function(n){const{onPointerMissed:o,internal:h}=e.getState();h.lastEvent.current=n;const f=c==="onPointerMove",p=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",y=i(n,f?r:void 0),d=p?t(n):0;c==="onPointerDown"&&(h.initialClick=[n.offsetX,n.offsetY],h.initialHits=y.map(b=>b.eventObject)),p&&!y.length&&d<=2&&(m(n,h.interaction),o&&o(n)),f&&a(y);function l(b){const P=b.eventObject,_=P.__r3f,E=_==null?void 0:_.handlers;if(_!=null&&_.eventCount)if(f){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const C=Ee(b),R=h.hovered.get(C);R?R.stopped&&b.stopPropagation():(h.hovered.set(C,b),E.onPointerOver==null||E.onPointerOver(b),E.onPointerEnter==null||E.onPointerEnter(b))}E.onPointerMove==null||E.onPointerMove(b)}else{const C=E[c];C?(!p||h.initialHits.includes(P))&&(m(n,h.interaction.filter(R=>!h.initialHits.includes(R))),C(b)):p&&h.initialHits.includes(P)&&m(n,h.interaction.filter(R=>!h.initialHits.includes(R)))}}s(y,n,d,l)}}return{handlePointer:v}}const xt=e=>!!(e!=null&&e.render),Pt=u.createContext(null),zr=(e,t)=>{const r=mt((v,c)=>{const g=new B,n=new B,o=new B;function h(d=c().camera,l=n,b=c().size){const{width:P,height:_,top:E,left:C}=b,R=P/_;l instanceof B?o.copy(l):o.set(...l);const M=d.getWorldPosition(g).distanceTo(o);if(vt(d))return{width:P/d.zoom,height:_/d.zoom,top:E,left:C,factor:1,distance:M,aspect:R};{const O=d.fov*Math.PI/180,w=2*Math.tan(O/2)*M,A=w*(P/_);return{width:A,height:w,top:E,left:C,factor:P/A,distance:M,aspect:R}}}let f;const p=d=>v(l=>({performance:{...l.performance,current:d}})),x=new Yt;return{set:v,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(d=1)=>e(c(),d),advance:(d,l)=>t(d,l,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new tr,pointer:x,mouse:x,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const d=c();f&&clearTimeout(f),d.performance.current!==d.performance.min&&p(d.performance.min),f=setTimeout(()=>p(c().performance.max),d.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:h},setEvents:d=>v(l=>({...l,events:{...l.events,...d}})),setSize:(d,l,b,P,_)=>{const E=c().camera,C={width:d,height:l,top:P||0,left:_||0,updateStyle:b};v(R=>({size:C,viewport:{...R.viewport,...h(E,n,C)}}))},setDpr:d=>v(l=>{const b=wt(d);return{viewport:{...l.viewport,dpr:b,initialDpr:l.viewport.initialDpr||b}}}),setFrameloop:(d="always")=>{const l=c().clock;l.stop(),l.elapsedTime=0,d!=="never"&&(l.start(),l.elapsedTime=0),v(()=>({frameloop:d}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:u.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(d,l,b)=>{const P=c().internal;return P.priority=P.priority+(l>0?1:0),P.subscribers.push({ref:d,priority:l,store:b}),P.subscribers=P.subscribers.sort((_,E)=>_.priority-E.priority),()=>{const _=c().internal;_!=null&&_.subscribers&&(_.priority=_.priority-(l>0?1:0),_.subscribers=_.subscribers.filter(E=>E.ref!==d))}}}}}),i=r.getState();let s=i.size,a=i.viewport.dpr,m=i.camera;return r.subscribe(()=>{const{camera:v,size:c,viewport:g,gl:n,set:o}=r.getState();if(c.width!==s.width||c.height!==s.height||g.dpr!==a){var h;s=c,a=g.dpr,Dr(v,c),n.setPixelRatio(g.dpr);const f=(h=c.updateStyle)!=null?h:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(c.width,c.height,f)}v!==m&&(m=v,o(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(v)}})))}),r.subscribe(v=>e(v)),r};let _e,Wr=new Set,$r=new Set,Ir=new Set;function Te(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function fe(e,t){switch(e){case"before":return Te(Wr,t);case"after":return Te($r,t);case"tail":return Te(Ir,t)}}let De,Le;function ke(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),De=t.internal.subscribers,_e=0;_e<De.length;_e++)Le=De[_e],Le.ref.current(Le.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Hr(e){let t=!1,r,i,s;function a(c){i=requestAnimationFrame(a),t=!0,r=0,fe("before",c);for(const n of e.values()){var g;s=n.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((g=s.gl.xr)!=null&&g.isPresenting)&&(r+=ke(c,s))}if(fe("after",c),r===0)return fe("tail",c),t=!1,cancelAnimationFrame(i)}function m(c,g=1){var n;if(!c)return e.forEach(o=>m(o.store.getState()),g);(n=c.gl.xr)!=null&&n.isPresenting||!c.internal.active||c.frameloop==="never"||(c.internal.frames=Math.min(60,c.internal.frames+g),t||(t=!0,requestAnimationFrame(a)))}function v(c,g=!0,n,o){if(g&&fe("before",c),n)ke(c,n,o);else for(const h of e.values())ke(c,h.store.getState());g&&fe("after",c)}return{loop:a,invalidate:m,advance:v}}function Mt(){const e=u.useContext(Pt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function H(e=r=>r,t){return Mt()(e,t)}function he(e,t=0){const r=Mt(),i=r.getState().internal.subscribe,s=gt(e);return me(()=>i(s,t,r),[t,i,r]),null}const at=new WeakMap;function Ct(e,t){return function(r,...i){let s=at.get(r);return s||(s=new r,at.set(r,s)),e&&e(s),Promise.all(i.map(a=>new Promise((m,v)=>s.load(a,c=>{c.scene&&Object.assign(c,Ar(c.scene)),m(c)},t,c=>v(new Error(`Could not load ${a}: ${c==null?void 0:c.message}`)))))).finally(()=>s.dispose==null?void 0:s.dispose())}}function Y(e,t,r,i){const s=Array.isArray(t)?t:[t],a=wr(Ct(r,i),[e,...s],{equal:T.equ});return Array.isArray(t)?a:a[0]}Y.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return Er(Ct(r),[e,...i])};Y.clear=function(e,t){const r=Array.isArray(t)?t:[t];return _r([e,...r])};const ce=new Map,{invalidate:ct,advance:lt}=Hr(ce),{reconciler:Pe,applyProps:N}=Cr(ce,Lr),ne={objects:"shallow",strict:!1},Br=(e,t)=>{const r=typeof e=="function"?e(t):e;return xt(r)?r:new Zt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Ur(e,t){const r=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:s,top:a,left:m,updateStyle:v=r}=t;return{width:i,height:s,top:a,left:m,updateStyle:v}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:s,top:a,left:m}=e.parentElement.getBoundingClientRect();return{width:i,height:s,top:a,left:m,updateStyle:r}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:r};return{width:0,height:0,top:0,left:0}}function Gr(e){const t=ce.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,a=i||zr(ct,lt),m=r||Pe.createContainer(a,se.ConcurrentRoot,null,!1,null,"",s,null);t||ce.set(e,{fiber:m,store:a});let v,c=!1,g;return{configure(n={}){let{gl:o,size:h,scene:f,events:p,onCreated:x,shadows:y=!1,linear:d=!1,flat:l=!1,legacy:b=!1,orthographic:P=!1,frameloop:_="always",dpr:E=[1,2],performance:C,raycaster:R,camera:M,onPointerMissed:O}=n,w=a.getState(),A=w.gl;w.gl||w.set({gl:A=Br(o,e)});let W=w.raycaster;W||w.set({raycaster:W=new Ut});const{params:Z,...k}=R||{};if(T.equ(k,W,ne)||N(W,{...k}),T.equ(Z,W.params,ne)||N(W,{params:{...W.params,...Z}}),!w.camera||w.camera===g&&!T.equ(g,M,ne)){g=M;const D=M instanceof Kt,S=D?M:P?new Be(0,0,0,0,.1,1e3):new Ue(75,0,.1,1e3);D||(S.position.z=5,M&&N(S,M),!w.camera&&!(M!=null&&M.rotation)&&S.lookAt(0,0,0)),w.set({camera:S}),W.camera=S}if(!w.scene){let D;f instanceof Qe?D=f:(D=new Qe,f&&N(D,f)),w.set({scene:oe(D)})}if(!w.xr){var V;const D=(L,ge)=>{const ye=a.getState();ye.frameloop!=="never"&&lt(L,!0,ye,ge)},S=()=>{const L=a.getState();L.gl.xr.enabled=L.gl.xr.isPresenting,L.gl.xr.setAnimationLoop(L.gl.xr.isPresenting?D:null),L.gl.xr.isPresenting||ct(L)},G={connect(){const L=a.getState().gl;L.xr.addEventListener("sessionstart",S),L.xr.addEventListener("sessionend",S)},disconnect(){const L=a.getState().gl;L.xr.removeEventListener("sessionstart",S),L.xr.removeEventListener("sessionend",S)}};typeof((V=A.xr)==null?void 0:V.addEventListener)=="function"&&G.connect(),w.set({xr:G})}if(A.shadowMap){const D=A.shadowMap.enabled,S=A.shadowMap.type;if(A.shadowMap.enabled=!!y,T.boo(y))A.shadowMap.type=Se;else if(T.str(y)){var F;const G={basic:Jt,percentage:Qt,soft:Se,variance:er};A.shadowMap.type=(F=G[y])!=null?F:Se}else T.obj(y)&&Object.assign(A.shadowMap,y);(D!==A.shadowMap.enabled||S!==A.shadowMap.type)&&(A.shadowMap.needsUpdate=!0)}const $=ht();$&&("enabled"in $?$.enabled=!b:"legacyMode"in $&&($.legacyMode=b)),N(A,{outputEncoding:d?3e3:3001,toneMapping:l?Gt:Nt}),w.legacy!==b&&w.set(()=>({legacy:b})),w.linear!==d&&w.set(()=>({linear:d})),w.flat!==l&&w.set(()=>({flat:l})),o&&!T.fun(o)&&!xt(o)&&!T.equ(o,A,ne)&&N(A,o),p&&!w.events.handlers&&w.set({events:p(a)});const z=Ur(e,h);return T.equ(z,w.size,ne)||w.setSize(z.width,z.height,z.updateStyle,z.top,z.left),E&&w.viewport.dpr!==wt(E)&&w.setDpr(E),w.frameloop!==_&&w.setFrameloop(_),w.onPointerMissed||w.set({onPointerMissed:O}),C&&!T.equ(C,w.performance,ne)&&w.set(D=>({performance:{...D.performance,...C}})),v=x,c=!0,this},render(n){return c||this.configure(),Pe.updateContainer(u.createElement(Nr,{store:a,children:n,onCreated:v,rootElement:e}),m,null,()=>{}),a},unmount(){St(e)}}}function Nr({store:e,children:t,onCreated:r,rootElement:i}){return me(()=>{const s=e.getState();s.set(a=>({internal:{...a.internal,active:!0}})),r&&r(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),u.createElement(Pt.Provider,{value:e},t)}function St(e,t){const r=ce.get(e),i=r==null?void 0:r.fiber;if(i){const s=r==null?void 0:r.store.getState();s&&(s.internal.active=!1),Pe.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var a,m,v,c;s.events.disconnect==null||s.events.disconnect(),(a=s.gl)==null||(m=a.renderLists)==null||m.dispose==null||m.dispose(),(v=s.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(c=s.gl)!=null&&c.xr&&s.xr.disconnect(),jr(s),ce.delete(e),t&&t(e)}catch{}},500)})}}Pe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:u.version});const Fe={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function qr(e){const{handlePointer:t}=Fr(e);return{priority:1,enabled:!0,compute(r,i,s){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Fe).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:s}=e.getState();(r=s.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:r=>{var i;const{set:s,events:a}=e.getState();a.disconnect==null||a.disconnect(),s(m=>({events:{...m.events,connected:r}})),Object.entries((i=a.handlers)!=null?i:[]).forEach(([m,v])=>{const[c,g]=Fe[m];r.addEventListener(c,v,{passive:g})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([a,m])=>{if(i&&i.connected instanceof HTMLElement){const[v]=Fe[a];i.connected.removeEventListener(v,m)}}),r(a=>({events:{...a.events,connected:void 0}}))}}}}const Vr=u.forwardRef(function({children:t,fallback:r,resize:i,style:s,gl:a,events:m=qr,eventSource:v,eventPrefix:c,shadows:g,linear:n,flat:o,legacy:h,orthographic:f,frameloop:p,dpr:x,performance:y,raycaster:d,camera:l,scene:b,onPointerMissed:P,onCreated:_,...E},C){u.useMemo(()=>Mr(rr),[]);const R=mr(),[M,O]=dr({scroll:!0,debounce:{scroll:50,resize:0},...i}),w=u.useRef(null),A=u.useRef(null);u.useImperativeHandle(C,()=>w.current);const W=gt(P),[Z,k]=u.useState(!1),[V,F]=u.useState(!1);if(Z)throw Z;if(V)throw V;const $=u.useRef(null);me(()=>{const U=w.current;O.width>0&&O.height>0&&U&&($.current||($.current=Gr(U)),$.current.configure({gl:a,events:m,shadows:g,linear:n,flat:o,legacy:h,orthographic:f,frameloop:p,dpr:x,performance:y,raycaster:d,camera:l,scene:b,size:O,onPointerMissed:(...z)=>W.current==null?void 0:W.current(...z),onCreated:z=>{z.events.connect==null||z.events.connect(v?Sr(v)?v.current:v:A.current),c&&z.setEvents({compute:(D,S)=>{const G=D[c+"X"],L=D[c+"Y"];S.pointer.set(G/S.size.width*2-1,-(L/S.size.height)*2+1),S.raycaster.setFromCamera(S.pointer,S.camera)}}),_==null||_(z)}}),$.current.render(u.createElement(R,null,u.createElement(yt,{set:F},u.createElement(u.Suspense,{fallback:u.createElement(Rr,{set:k})},t)))))}),u.useEffect(()=>{const U=w.current;if(U)return()=>St(U)},[]);const K=v?"none":"auto";return u.createElement("div",q({ref:A,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:K,...s}},E),u.createElement("div",{ref:M,style:{width:"100%",height:"100%"}},u.createElement("canvas",{ref:w,style:{display:"block"}},r)))}),xn=u.forwardRef(function(t,r){return u.createElement(pr,null,u.createElement(Vr,q({},t,{ref:r})))}),ve=new B,Xe=new B,Xr=new B;function Yr(e,t,r){const i=ve.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=r.width/2,a=r.height/2;return[i.x*s+s,-(i.y*a)+a]}function Zr(e,t){const r=ve.setFromMatrixPosition(e.matrixWorld),i=Xe.setFromMatrixPosition(t.matrixWorld),s=r.sub(i),a=t.getWorldDirection(Xr);return s.angleTo(a)>Math.PI/2}function Kr(e,t,r,i){const s=ve.setFromMatrixPosition(e.matrixWorld),a=s.clone();a.project(t),r.setFromCamera(a,t);const m=r.intersectObjects(i,!0);if(m.length){const v=m[0].distance;return s.distanceTo(r.ray.origin)<v}return!0}function Jr(e,t){if(t instanceof Be)return t.zoom;if(t instanceof Ue){const r=ve.setFromMatrixPosition(e.matrixWorld),i=Xe.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,a=r.distanceTo(i);return 1/(2*Math.tan(s/2)*a)}else return 1}function Qr(e,t,r){if(t instanceof Ue||t instanceof Be){const i=ve.setFromMatrixPosition(e.matrixWorld),s=Xe.setFromMatrixPosition(t.matrixWorld),a=i.distanceTo(s),m=(r[1]-r[0])/(t.far-t.near),v=r[1]-m*t.far;return Math.round(m*a+v)}}const He=e=>Math.abs(e)<1e-10?0:e;function Rt(e,t,r=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=He(t[s]*e.elements[s])+(s!==15?",":")");return r+i}const en=(e=>t=>Rt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),tn=(e=>(t,r)=>Rt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function rn(e){return e&&typeof e=="object"&&"current"in e}const Pn=u.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:s,center:a,fullscreen:m,portal:v,distanceFactor:c,sprite:g=!1,transform:n=!1,occlude:o,onOcclude:h,castShadow:f,receiveShadow:p,material:x,geometry:y,zIndexRange:d=[16777271,0],calculatePosition:l=Yr,as:b="div",wrapperClass:P,pointerEvents:_="auto",...E},C)=>{const{gl:R,camera:M,scene:O,size:w,raycaster:A,events:W,viewport:Z}=H(),[k]=u.useState(()=>document.createElement(b)),V=u.useRef(),F=u.useRef(null),$=u.useRef(0),K=u.useRef([0,0]),U=u.useRef(null),z=u.useRef(null),D=(v==null?void 0:v.current)||W.connected||R.domElement.parentNode,S=u.useRef(null),G=u.useRef(!1),L=u.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&rn(o[0]),[o]);u.useLayoutEffect(()=>{const I=R.domElement;o&&o==="blending"?(I.style.zIndex=`${Math.floor(d[0]/2)}`,I.style.position="absolute",I.style.pointerEvents="none"):(I.style.zIndex=null,I.style.position=null,I.style.pointerEvents=null)},[o]),u.useLayoutEffect(()=>{if(F.current){const I=V.current=vr(k);if(O.updateMatrixWorld(),n)k.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const j=l(F.current,M,w);k.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${j[0]}px,${j[1]}px,0);transform-origin:0 0;`}return D&&(s?D.prepend(k):D.appendChild(k)),()=>{D&&D.removeChild(k),I.unmount()}}},[D,n]),u.useLayoutEffect(()=>{P&&(k.className=P)},[P]);const ge=u.useMemo(()=>n?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:a?"translate3d(-50%,-50%,0)":"none",...m&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...r},[r,a,m,w,n]),ye=u.useMemo(()=>({position:"absolute",pointerEvents:_}),[_]);u.useLayoutEffect(()=>{if(G.current=!1,n){var I;(I=V.current)==null||I.render(u.createElement("div",{ref:U,style:ge},u.createElement("div",{ref:z,style:ye},u.createElement("div",{ref:C,className:i,style:r,children:e}))))}else{var j;(j=V.current)==null||j.render(u.createElement("div",{ref:C,style:ge,className:i,children:e}))}});const re=u.useRef(!0);he(I=>{if(F.current){M.updateMatrixWorld(),F.current.updateWorldMatrix(!0,!1);const j=n?K.current:l(F.current,M,w);if(n||Math.abs($.current-M.zoom)>t||Math.abs(K.current[0]-j[0])>t||Math.abs(K.current[1]-j[1])>t){const J=Zr(F.current,M);let X=!1;L&&(Array.isArray(o)?X=o.map(Q=>Q.current):o!=="blending"&&(X=[O]));const le=re.current;if(X){const Q=Kr(F.current,M,A,X);re.current=Q&&!J}else re.current=!J;le!==re.current&&(h?h(!re.current):k.style.display=re.current?"block":"none");const be=Math.floor(d[0]/2),Dt=o?L?[d[0],be]:[be-1,0]:d;if(k.style.zIndex=`${Qr(F.current,M,Dt)}`,n){const[Q,Ke]=[w.width/2,w.height/2],Me=M.projectionMatrix.elements[5]*Ke,{isOrthographicCamera:Je,top:Lt,left:kt,bottom:Ft,right:zt}=M,Wt=en(M.matrixWorldInverse),$t=Je?`scale(${Me})translate(${He(-(zt+kt)/2)}px,${He((Lt+Ft)/2)}px)`:`translateZ(${Me}px)`;let ee=F.current.matrixWorld;g&&(ee=M.matrixWorldInverse.clone().transpose().copyPosition(ee).scale(F.current.scale),ee.elements[3]=ee.elements[7]=ee.elements[11]=0,ee.elements[15]=1),k.style.width=w.width+"px",k.style.height=w.height+"px",k.style.perspective=Je?"":`${Me}px`,U.current&&z.current&&(U.current.style.transform=`${$t}${Wt}translate(${Q}px,${Ke}px)`,z.current.style.transform=tn(ee,1/((c||10)/400)))}else{const Q=c===void 0?1:Jr(F.current,M)*c;k.style.transform=`translate3d(${j[0]}px,${j[1]}px,0) scale(${Q})`}K.current=j,$.current=M.zoom}}if(!L&&S.current&&!G.current)if(n){if(U.current){const j=U.current.children[0];if(j!=null&&j.clientWidth&&j!=null&&j.clientHeight){const{isOrthographicCamera:J}=M;if(J||y)E.scale&&(Array.isArray(E.scale)?E.scale instanceof B?S.current.scale.copy(E.scale.clone().divideScalar(1)):S.current.scale.set(1/E.scale[0],1/E.scale[1],1/E.scale[2]):S.current.scale.setScalar(1/E.scale));else{const X=(c||10)/400,le=j.clientWidth*X,be=j.clientHeight*X;S.current.scale.set(le,be,1)}G.current=!0}}}else{const j=k.children[0];if(j!=null&&j.clientWidth&&j!=null&&j.clientHeight){const J=1/Z.factor,X=j.clientWidth*J,le=j.clientHeight*J;S.current.scale.set(X,le,1),G.current=!0}S.current.lookAt(I.camera.position)}});const Ze=u.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return u.createElement("group",q({},E,{ref:F}),o&&!L&&u.createElement("mesh",{castShadow:f,receiveShadow:p,ref:S},y||u.createElement("planeGeometry",null),x||u.createElement("shaderMaterial",{side:nr,vertexShader:Ze.vertexShader,fragmentShader:Ze.fragmentShader})))});let de=0;const Mn=mt(e=>(we.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-de)/(i-de)*100})},we.onLoad=()=>{e({active:!1})},we.onError=t=>e(r=>({errors:[...r.errors,t]})),we.onProgress=(t,r,i)=>{r===i&&(de=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-de)/(i-de)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),ut=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Ot(e,t){const r=H(s=>s.gl),i=Y(Ge,ut(e)?Object.values(e):e);if(u.useLayoutEffect(()=>{t==null||t(i)},[t]),u.useEffect(()=>{"initTexture"in r&&(Array.isArray(i)?i:[i]).forEach(r.initTexture)},[r,i]),ut(e)){const s=Object.keys(e),a={};return s.forEach(m=>Object.assign(a,{[m]:i[s.indexOf(m)]})),a}else return i}Ot.preload=e=>Y.preload(Ge,e);Ot.clear=e=>Y.clear(Ge,e);const nn=()=>parseInt(or.replace(/\D+/g,"")),At=nn();function on(e){return Array.isArray(e)}function ze(e=[0,0,0]){return on(e)?e:e instanceof B||e instanceof pt?[e.x,e.y,e.z]:[e,e,e]}const Cn=u.forwardRef(function({debug:t,depthTest:r=!1,polygonOffsetFactor:i=-10,map:s,mesh:a,children:m,position:v,rotation:c,scale:g,...n},o){const h=u.useRef(null);u.useImperativeHandle(o,()=>h.current);const f=u.useRef(null);return u.useLayoutEffect(()=>{const p=(a==null?void 0:a.current)||h.current.parent,x=h.current;if(!(p instanceof ir))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const y={position:new B,rotation:new pt,scale:new B(1,1,1)};if(p){N(y,{position:v,scale:g});const d=p.matrixWorld.clone();if(p.matrixWorld.identity(),!c||typeof c=="number"){const l=new sr;l.position.copy(y.position),l.lookAt(p.position),typeof c=="number"&&l.rotateZ(c),N(y,{rotation:l.rotation})}else N(y,{rotation:c});return x.geometry=new gr(p,y.position,y.rotation,y.scale),f.current&&(N(f.current,y),f.current.traverse(l=>l.raycast=()=>null)),p.matrixWorld=d,()=>{x.geometry.dispose()}}},[a,...ze(v),...ze(g),...ze(c)]),u.createElement("mesh",q({ref:h,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":r,"material-map":s},n),m,t&&u.createElement("mesh",{ref:f},u.createElement("boxGeometry",null),u.createElement("meshNormalMaterial",{wireframe:!0}),u.createElement("axesHelper",null)))});let xe=null,jt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Tt(e,t,r){return i=>{r&&r(i),e&&(xe||(xe=new yr),xe.setDecoderPath(typeof e=="string"?e:jt),i.setDRACOLoader(xe)),t&&i.setMeshoptDecoder(typeof Re=="function"?Re():Re)}}function Ye(e,t=!0,r=!0,i){return Y(Ne,e,Tt(t,r,i))}Ye.preload=(e,t=!0,r=!0,i)=>Y.preload(Ne,e,Tt(t,r,i));Ye.clear=e=>Y.clear(Ne,e);Ye.setDecoderPath=e=>{jt=e};const Sn=u.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:s=!0,keyEvents:a=!1,onChange:m,onStart:v,onEnd:c,...g},n)=>{const o=H(E=>E.invalidate),h=H(E=>E.camera),f=H(E=>E.gl),p=H(E=>E.events),x=H(E=>E.setEvents),y=H(E=>E.set),d=H(E=>E.get),l=H(E=>E.performance),b=t||h,P=i||p.connected||f.domElement,_=u.useMemo(()=>new br(b),[b]);return he(()=>{_.enabled&&_.update()},-1),u.useEffect(()=>(a&&_.connect(a===!0?P:a),_.connect(P),()=>void _.dispose()),[a,P,r,_,o]),u.useEffect(()=>{const E=M=>{o(),r&&l.regress(),m&&m(M)},C=M=>{v&&v(M)},R=M=>{c&&c(M)};return _.addEventListener("change",E),_.addEventListener("start",C),_.addEventListener("end",R),()=>{_.removeEventListener("start",C),_.removeEventListener("end",R),_.removeEventListener("change",E)}},[m,v,c,_,o,x]),u.useEffect(()=>{if(e){const E=d().controls;return y({controls:_}),()=>y({controls:E})}},[e,_]),u.createElement("primitive",q({ref:n,object:_,enableDamping:s},g))}),We=At>=154?"opaque_fragment":"output_fragment";class sn extends ar{constructor(t){super(t),this.onBeforeCompile=(r,i)=>{const{isWebGL2:s}=i.capabilities;r.fragmentShader=r.fragmentShader.replace(`#include <${We}>`,`
        ${s?`#include <${We}>`:`#extension GL_OES_standard_derivatives : enable
#include <${We}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${At>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const Rn=u.forwardRef((e,t)=>{const[r]=u.useState(()=>new sn(null));return u.createElement("primitive",q({},e,{object:r,ref:t,attach:"material"}))}),On=u.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:i=1,floatIntensity:s=1,floatingRange:a=[-.1,.1],...m},v)=>{const c=u.useRef(null),g=u.useRef(Math.random()*1e4);return he(n=>{var o,h;if(!t||r===0)return;const f=g.current+n.clock.getElapsedTime();c.current.rotation.x=Math.cos(f/4*r)/8*i,c.current.rotation.y=Math.sin(f/4*r)/8*i,c.current.rotation.z=Math.sin(f/4*r)/20*i;let p=Math.sin(f/4*r)/10;p=cr.mapLinear(p,-.1,.1,(o=a==null?void 0:a[0])!==null&&o!==void 0?o:-.1,(h=a==null?void 0:a[1])!==null&&h!==void 0?h:.1),c.current.position.y=p*s,c.current.updateMatrix()}),u.createElement("group",m,u.createElement("group",{ref:qe([c,v]),matrixAutoUpdate:!1},e))});let te,pe;const an=u.createContext(null),ft=new lr,dt=new B,cn=u.forwardRef(({children:e,range:t,limit:r=1e3,...i},s)=>{const a=u.useRef(null),[m,v]=u.useState([]),[[c,g,n]]=u.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);u.useEffect(()=>{a.current.geometry.attributes.position.needsUpdate=!0}),he(()=>{for(a.current.updateMatrix(),a.current.updateMatrixWorld(),ft.copy(a.current.matrixWorld).invert(),a.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,m.length),te=0;te<m.length;te++)pe=m[te].current,pe.getWorldPosition(dt).applyMatrix4(ft),dt.toArray(c,te*3),a.current.geometry.attributes.position.needsUpdate=!0,pe.matrixWorldNeedsUpdate=!0,pe.color.toArray(g,te*3),a.current.geometry.attributes.color.needsUpdate=!0,n.set([pe.size],te),a.current.geometry.attributes.size.needsUpdate=!0});const o=u.useMemo(()=>({getParent:()=>a,subscribe:h=>(v(f=>[...f,h]),()=>v(f=>f.filter(p=>p.current!==h.current)))}),[]);return u.createElement("points",q({userData:{instances:m},matrixAutoUpdate:!1,ref:qe([s,a]),raycast:()=>null},i),u.createElement("bufferGeometry",null,u.createElement("bufferAttribute",{attach:"attributes-position",count:c.length/3,array:c,itemSize:3,usage:ae}),u.createElement("bufferAttribute",{attach:"attributes-color",count:g.length/3,array:g,itemSize:3,usage:ae}),u.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:ae})),u.createElement(an.Provider,{value:o},e))}),ln=u.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:s=3,...a},m)=>{const v=u.useRef(null);return he(()=>{const c=v.current.geometry.attributes;c.position.needsUpdate=!0,r&&(c.color.needsUpdate=!0),i&&(c.size.needsUpdate=!0)}),u.createElement("points",q({ref:qe([m,v])},a),u.createElement("bufferGeometry",null,u.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/s,array:t,itemSize:s,usage:ae}),r&&u.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/s,array:r,itemSize:3,usage:ae}),i&&u.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/s,array:i,itemSize:1,usage:ae})),e)}),An=u.forwardRef((e,t)=>e.positions instanceof Float32Array?u.createElement(ln,q({},e,{ref:t})):u.createElement(cn,q({},e,{ref:t})));function jn({all:e,scene:t,camera:r}){const i=H(({gl:m})=>m),s=H(({camera:m})=>m),a=H(({scene:m})=>m);return u.useLayoutEffect(()=>{const m=[];e&&(t||a).traverse(g=>{g.visible===!1&&(m.push(g),g.visible=!0)}),i.compile(t||a,r||s);const v=new ur(128);new fr(.01,1e5,v).update(i,t||a),v.dispose(),m.forEach(g=>g.visible=!1)},[]),null}export{xn as C,Cn as D,On as F,Pn as H,Sn as O,jn as P,_n as _,he as a,An as b,Rn as c,Ye as d,Mn as e,Ot as u};
