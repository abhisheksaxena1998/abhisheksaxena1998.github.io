import{C as q,u as Zl,Q as Zn,v as Us,V as P,c as K,P as zt,O as jn,w as hn,x as fn,o as rr,r as se,y as An,z as Yr,F as $t,G as st,H as ql,I as ec,J as tc,K as Tt,X as Nt,Y as nc,m as no,k as rc,Z as ic,_ as Wn,$ as sc,a0 as gn,a1 as zr,a2 as Zt,n as ac,M as Ci,a3 as oc,a4 as ro,D as lc,a5 as cc,B as yn,a6 as uc,l as Ke,a7 as hc,a8 as fc,a9 as dc,aa as io,ab as Ei,p as Vn,ac as pc,ad as so,ae as mc,af as Ac,R as wt,ag as ao,ah as oo,ai as lo,aj as co,ak as uo,al as ho,am as fo,an as po,ao as mo,ap as gc,aq as Ji,ar as Ao,as as ie,at as he,au as Tc,av as vc,aw as Re,ax as Ie,ay as te,az as $r,aA as fs,aB as Cc,aC as Ec,aD as X,aE as ds,aF as ji,aG as go,aH as Or,aI as Tn,aJ as To,aK as Rc,aL as Bc,aM as yc,aN as Qt,aO as Sc,aP as xc,aQ as Mc,aR as Ic,T as Wi,aS as bc,aT as Hs,aU as Pc,aV as _c,aW as wc,aX as Xn,aY as Fr,N as vo,aZ as Dr,a_ as Ri,a$ as Co,b0 as Oc,b1 as Fc,q as Bi,b2 as Dc,b3 as Nc,b4 as Lc,b5 as Gc,b6 as kc,b7 as Gn,b8 as Qn,b9 as Ks,ba as Js,bb as yi,bc as Uc,bd as Hc,U as gt,be as Nr,bf as mr,h as Kc}from"./three-4dacbd90.js";import"./mmd-parser-06216fd5.js";import{K as js,a as Jc,r as jc,V as Wc,b as Vc,c as Xc,d as Eo,e as Ro,f as Bo,g as ps,h as yo,i as So,j as xo,k as ms,l as Mo,m as Io,n as As,o as bo}from"./ktx-parse-b17e1334.js";import{Q as Qc}from"./zstddec-5cb485fa.js";import"./opentype.js-95d064b1.js";var Yc=Object.defineProperty,zc=(t,e,n)=>e in t?Yc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,x=(t,e,n)=>(zc(t,typeof e!="symbol"?e+"":e,n),n);function Ws(t,e){if(e===gc)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(e===Ji||e===Ao){let n=t.getIndex();if(n===null){const a=[],o=t.getAttribute("position");if(o!==void 0){for(let l=0;l<o.count;l++)a.push(l);t.setIndex(a),n=t.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t}const r=n.count-2,i=[];if(n)if(e===Ji)for(let a=1;a<=r;a++)i.push(n.getX(0)),i.push(n.getX(a)),i.push(n.getX(a+1));else for(let a=0;a<r;a++)a%2===0?(i.push(n.getX(a)),i.push(n.getX(a+1)),i.push(n.getX(a+2))):(i.push(n.getX(a+2)),i.push(n.getX(a+1)),i.push(n.getX(a)));i.length/3!==r&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=t.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}new q;const Po=class{parse(t,e={decodeSpeed:5,encodeSpeed:5,encoderMethod:Po.MESH_EDGEBREAKER_ENCODING,quantization:[16,8,8,8,8],exportUvs:!0,exportNormals:!0,exportColor:!1}){if(t instanceof yn&&t.isBufferGeometry)throw new Error("DRACOExporter: The first parameter of parse() is now an instance of Mesh or Points.");if(DracoEncoderModule===void 0)throw new Error("THREE.DRACOExporter: required the draco_encoder to work.");const n=t.geometry,r=DracoEncoderModule(),i=new r.Encoder;let s,a;if(!n.isBufferGeometry)throw new Error("THREE.DRACOExporter.parse(geometry, options): geometry is not a THREE.BufferGeometry instance.");if(t instanceof Ke&&t.isMesh){s=new r.MeshBuilder,a=new r.Mesh;const f=n.getAttribute("position");s.AddFloatAttributeToMesh(a,r.POSITION,f.count,f.itemSize,f.array);const T=n.getIndex();if(T!==null)s.AddFacesToMesh(a,T.count/3,T.array);else{const g=new(f.count>65535?Uint32Array:Uint16Array)(f.count);for(let d=0;d<g.length;d++)g[d]=d;s.AddFacesToMesh(a,f.count,g)}if(e.exportNormals){const g=n.getAttribute("normal");g!==void 0&&s.AddFloatAttributeToMesh(a,r.NORMAL,g.count,g.itemSize,g.array)}if(e.exportUvs){const g=n.getAttribute("uv");g!==void 0&&s.AddFloatAttributeToMesh(a,r.TEX_COORD,g.count,g.itemSize,g.array)}if(e.exportColor){const g=n.getAttribute("color");g!==void 0&&s.AddFloatAttributeToMesh(a,r.COLOR,g.count,g.itemSize,g.array)}}else if(t instanceof io&&t.isPoints){s=new r.PointCloudBuilder,a=new r.PointCloud;const f=n.getAttribute("position");if(s.AddFloatAttribute(a,r.POSITION,f.count,f.itemSize,f.array),e.exportColor){const T=n.getAttribute("color");T!==void 0&&s.AddFloatAttribute(a,r.COLOR,T.count,T.itemSize,T.array)}}else throw new Error("DRACOExporter: Unsupported object type.");const o=new r.DracoInt8Array,l=e.encodeSpeed!==void 0?e.encodeSpeed:5,c=e.decodeSpeed!==void 0?e.decodeSpeed:5;if(i.SetSpeedOptions(l,c),e.encoderMethod!==void 0&&i.SetEncodingMethod(e.encoderMethod),e.quantization!==void 0)for(let f=0;f<5;f++)e.quantization[f]!==void 0&&i.SetAttributeQuantization(f,e.quantization[f]);let u;if(t instanceof Ke&&t.isMesh?u=i.EncodeMeshToDracoBuffer(a,o):u=i.EncodePointCloudToDracoBuffer(a,!0,o),r.destroy(a),u===0)throw new Error("THREE.DRACOExporter: Draco encoding failed.");const h=new Int8Array(new ArrayBuffer(u));for(let f=0;f<u;f++)h[f]=o.GetValue(f);return r.destroy(o),r.destroy(i),r.destroy(s),h}};let lt=Po;x(lt,"MESH_EDGEBREAKER_ENCODING",1);x(lt,"MESH_SEQUENTIAL_ENCODING",0);x(lt,"POINT_CLOUD",0);x(lt,"TRIANGULAR_MESH",1);x(lt,"INVALID",-1);x(lt,"POSITION",0);x(lt,"NORMAL",1);x(lt,"COLOR",2);x(lt,"TEX_COORD",3);x(lt,"GENERIC",4);const _o=class extends Ke{constructor(t,e={}){super(t),this.isReflector=!0,this.type="Reflector",this.camera=new zt;const n=this,r=e.color!==void 0?new q(e.color):new q(8355711),i=e.textureWidth||512,s=e.textureHeight||512,a=e.clipBias||0,o=e.shader||_o.ReflectorShader,l=e.multisample!==void 0?e.multisample:4,c=new Fr,u=new P,h=new P,f=new P,T=new se,g=new P(0,0,-1),d=new An,A=new P,v=new P,m=new An,p=new se,C=this.camera,B=new Re(i,s,{samples:l,type:Ie}),S=new ie({uniforms:he.clone(o.uniforms),fragmentShader:o.fragmentShader,vertexShader:o.vertexShader});S.uniforms.tDiffuse.value=B.texture,S.uniforms.color.value=r,S.uniforms.textureMatrix.value=p,this.material=S,this.onBeforeRender=function(y,R,M){if(h.setFromMatrixPosition(n.matrixWorld),f.setFromMatrixPosition(M.matrixWorld),T.extractRotation(n.matrixWorld),u.set(0,0,1),u.applyMatrix4(T),A.subVectors(h,f),A.dot(u)>0)return;A.reflect(u).negate(),A.add(h),T.extractRotation(M.matrixWorld),g.set(0,0,-1),g.applyMatrix4(T),g.add(f),v.subVectors(h,g),v.reflect(u).negate(),v.add(h),C.position.copy(A),C.up.set(0,1,0),C.up.applyMatrix4(T),C.up.reflect(u),C.lookAt(v),C.far=M.far,C.updateMatrixWorld(),C.projectionMatrix.copy(M.projectionMatrix),p.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),p.multiply(C.projectionMatrix),p.multiply(C.matrixWorldInverse),p.multiply(n.matrixWorld),c.setFromNormalAndCoplanarPoint(u,h),c.applyMatrix4(C.matrixWorldInverse),d.set(c.normal.x,c.normal.y,c.normal.z,c.constant);const I=C.projectionMatrix;m.x=(Math.sign(d.x)+I.elements[8])/I.elements[0],m.y=(Math.sign(d.y)+I.elements[9])/I.elements[5],m.z=-1,m.w=(1+I.elements[10])/I.elements[14],d.multiplyScalar(2/d.dot(m)),I.elements[2]=d.x,I.elements[6]=d.y,I.elements[10]=d.z+1-a,I.elements[14]=d.w,n.visible=!1;const b=y.getRenderTarget(),O=y.xr.enabled,w=y.shadowMap.autoUpdate,k=y.toneMapping;let U=!1;"outputColorSpace"in y?U=y.outputColorSpace==="srgb":U=y.outputEncoding===3001,y.xr.enabled=!1,y.shadowMap.autoUpdate=!1,"outputColorSpace"in y?y.outputColorSpace="linear-srgb":y.outputEncoding=3e3,y.toneMapping=vo,y.setRenderTarget(B),y.state.buffers.depth.setMask(!0),y.autoClear===!1&&y.clear(),y.render(R,C),y.xr.enabled=O,y.shadowMap.autoUpdate=w,y.toneMapping=k,"outputColorSpace"in y?y.outputColorSpace=U?"srgb":"srgb-linear":y.outputEncoding=U?3001:3e3,y.setRenderTarget(b);const H=M.viewport;H!==void 0&&y.state.viewport(H),n.visible=!0},this.getRenderTarget=function(){return B},this.dispose=function(){B.dispose(),n.material.dispose()}}};let Vi=_o;x(Vi,"ReflectorShader",{uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <${parseInt(rr.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>

		}`});const wo=class extends Ke{constructor(t,e={}){super(t),this.isRefractor=!0,this.type="Refractor",this.camera=new zt;const n=this,r=e.color!==void 0?new q(e.color):new q(8355711),i=e.textureWidth||512,s=e.textureHeight||512,a=e.clipBias||0,o=e.shader||wo.RefractorShader,l=e.multisample!==void 0?e.multisample:4,c=this.camera;c.matrixAutoUpdate=!1,c.userData.refractor=!0;const u=new Fr,h=new se,f=new Re(i,s,{samples:l,type:Ie});this.material=new ie({uniforms:he.clone(o.uniforms),vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,transparent:!0}),this.material.uniforms.color.value=r,this.material.uniforms.tDiffuse.value=f.texture,this.material.uniforms.textureMatrix.value=h;const T=function(){const m=new P,p=new P,C=new se,B=new P,S=new P;return function(R){return m.setFromMatrixPosition(n.matrixWorld),p.setFromMatrixPosition(R.matrixWorld),B.subVectors(m,p),C.extractRotation(n.matrixWorld),S.set(0,0,1),S.applyMatrix4(C),B.dot(S)<0}}(),g=function(){const m=new P,p=new P,C=new Zn,B=new P;return function(){n.matrixWorld.decompose(p,C,B),m.set(0,0,1).applyQuaternion(C).normalize(),m.negate(),u.setFromNormalAndCoplanarPoint(m,p)}}(),d=function(){const m=new Fr,p=new An,C=new An;return function(S){c.matrixWorld.copy(S.matrixWorld),c.matrixWorldInverse.copy(c.matrixWorld).invert(),c.projectionMatrix.copy(S.projectionMatrix),c.far=S.far,m.copy(u),m.applyMatrix4(c.matrixWorldInverse),p.set(m.normal.x,m.normal.y,m.normal.z,m.constant);const y=c.projectionMatrix;C.x=(Math.sign(p.x)+y.elements[8])/y.elements[0],C.y=(Math.sign(p.y)+y.elements[9])/y.elements[5],C.z=-1,C.w=(1+y.elements[10])/y.elements[14],p.multiplyScalar(2/p.dot(C)),y.elements[2]=p.x,y.elements[6]=p.y,y.elements[10]=p.z+1-a,y.elements[14]=p.w}}();function A(m){h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(m.projectionMatrix),h.multiply(m.matrixWorldInverse),h.multiply(n.matrixWorld)}function v(m,p,C){n.visible=!1;const B=m.getRenderTarget(),S=m.xr.enabled,y=m.shadowMap.autoUpdate,R=m.toneMapping;let M=!1;"outputColorSpace"in m?M=m.outputColorSpace==="srgb":M=m.outputEncoding===3001,m.xr.enabled=!1,m.shadowMap.autoUpdate=!1,"outputColorSpace"in m?m.outputColorSpace="linear-srgb":m.outputEncoding=3e3,m.toneMapping=vo,m.setRenderTarget(f),m.autoClear===!1&&m.clear(),m.render(p,c),m.xr.enabled=S,m.shadowMap.autoUpdate=y,m.toneMapping=R,m.setRenderTarget(B),"outputColorSpace"in m?m.outputColorSpace=M?"srgb":"srgb-linear":m.outputEncoding=M?3001:3e3;const I=C.viewport;I!==void 0&&m.state.viewport(I),n.visible=!0}this.onBeforeRender=function(m,p,C){C.userData.refractor!==!0&&T(C)&&(g(),A(C),d(C),v(m,p,C))},this.getRenderTarget=function(){return f},this.dispose=function(){f.dispose(),n.material.dispose()}}};let Xi=wo;x(Xi,"RefractorShader",{uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`

		uniform mat4 textureMatrix;

		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform sampler2D tDiffuse;

		varying vec4 vUv;

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <${parseInt(rr.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>

		}`});const $c=new yn,Qi=class extends Ke{constructor(){super(Qi.Geometry,new Tt({opacity:0,transparent:!0})),this.isLensflare=!0,this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;const t=new P,e=new P,n=new Dr(new Uint8Array(16*16*3),16,16,wt);n.minFilter=te,n.magFilter=te,n.wrapS=Qt,n.wrapT=Qt;const r=new Dr(new Uint8Array(16*16*3),16,16,wt);r.minFilter=te,r.magFilter=te,r.wrapS=Qt,r.wrapT=Qt;const i=Qi.Geometry,s=new Ri({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;

				void main() {

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				void main() {

					gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );

				}`,depthTest:!0,depthWrite:!1,transparent:!1}),a=new Ri({uniforms:{map:{value:n},scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;
				attribute vec2 uv;

				varying vec2 vUV;

				void main() {

					vUV = uv;

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				uniform sampler2D map;

				varying vec2 vUV;

				void main() {

					gl_FragColor = texture2D( map, vUV );

				}`,depthTest:!1,depthWrite:!1,transparent:!1}),o=new Ke(i,s),l=[],c=Oo.Shader,u=new Ri({uniforms:{map:{value:null},occlusionMap:{value:r},color:{value:new q(16777215)},scale:{value:new K},screenPosition:{value:new P}},vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:Co,transparent:!0,depthWrite:!1}),h=new Ke(i,u);this.addElement=function(A){l.push(A)};const f=new K,T=new K,g=new Oc,d=new An;this.onBeforeRender=function(A,v,m){A.getCurrentViewport(d);const p=d.w/d.z,C=d.z/2,B=d.w/2;let S=16/d.w;if(f.set(S*p,S),g.min.set(d.x,d.y),g.max.set(d.x+(d.z-16),d.y+(d.w-16)),e.setFromMatrixPosition(this.matrixWorld),e.applyMatrix4(m.matrixWorldInverse),!(e.z>0)&&(t.copy(e).applyMatrix4(m.projectionMatrix),T.x=d.x+t.x*C+C-8,T.y=d.y+t.y*B+B-8,g.containsPoint(T))){A.copyFramebufferToTexture(T,n);let y=s.uniforms;y.scale.value=f,y.screenPosition.value=t,A.renderBufferDirect(m,null,i,s,o,null),A.copyFramebufferToTexture(T,r),y=a.uniforms,y.scale.value=f,y.screenPosition.value=t,A.renderBufferDirect(m,null,i,a,o,null);const R=-t.x*2,M=-t.y*2;for(let I=0,b=l.length;I<b;I++){const O=l[I],w=u.uniforms;w.color.value.copy(O.color),w.map.value=O.texture,w.screenPosition.value.x=t.x+R*O.distance,w.screenPosition.value.y=t.y+M*O.distance,S=O.size/d.w;const k=d.w/d.z;w.scale.value.set(S*k,S),u.uniformsNeedUpdate=!0,A.renderBufferDirect(m,null,i,u,h,null)}}},this.dispose=function(){s.dispose(),a.dispose(),u.dispose(),n.dispose(),r.dispose();for(let A=0,v=l.length;A<v;A++)l[A].texture.dispose()}}};let Zc=Qi;x(Zc,"Geometry",$c);class Oo{constructor(e,n=1,r=0,i=new q(16777215)){this.texture=e,this.size=n,this.distance=r,this.color=i}}x(Oo,"Shader",{uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:`

		precision highp float;

		uniform vec3 screenPosition;
		uniform vec2 scale;

		uniform sampler2D occlusionMap;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vUV = uv;

			vec2 pos = position.xy;

			vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );

			vVisibility =        visibility.r / 9.0;
			vVisibility *= 1.0 - visibility.g / 9.0;
			vVisibility *=       visibility.b / 9.0;

			gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );

		}`,fragmentShader:`

		precision highp float;

		uniform sampler2D map;
		uniform vec3 color;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vec4 texture = texture2D( map, vUV );
			texture.a *= vVisibility;
			gl_FragColor = texture;
			gl_FragColor.rgb *= color;

		}`});class Yn{constructor(e=Math){x(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),x(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),x(this,"p",[]),x(this,"perm",[]),x(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),x(this,"dot",(n,r,i)=>n[0]*r+n[1]*i),x(this,"dot3",(n,r,i,s)=>n[0]*r+n[1]*i+n[2]*s),x(this,"dot4",(n,r,i,s,a)=>n[0]*r+n[1]*i+n[2]*s+n[3]*a),x(this,"noise",(n,r)=>{let i,s,a;const o=.5*(Math.sqrt(3)-1),l=(n+r)*o,c=Math.floor(n+l),u=Math.floor(r+l),h=(3-Math.sqrt(3))/6,f=(c+u)*h,T=c-f,g=u-f,d=n-T,A=r-g;let v=0,m=1;d>A&&(v=1,m=0);const p=d-v+h,C=A-m+h,B=d-1+2*h,S=A-1+2*h,y=c&255,R=u&255,M=this.perm[y+this.perm[R]]%12,I=this.perm[y+v+this.perm[R+m]]%12,b=this.perm[y+1+this.perm[R+1]]%12;let O=.5-d*d-A*A;O<0?i=0:(O*=O,i=O*O*this.dot(this.grad3[M],d,A));let w=.5-p*p-C*C;w<0?s=0:(w*=w,s=w*w*this.dot(this.grad3[I],p,C));let k=.5-B*B-S*S;return k<0?a=0:(k*=k,a=k*k*this.dot(this.grad3[b],B,S)),70*(i+s+a)}),x(this,"noise3d",(n,r,i)=>{let s,a,o,l;const c=.3333333333333333,u=(n+r+i)*c,h=Math.floor(n+u),f=Math.floor(r+u),T=Math.floor(i+u),g=1/6,d=(h+f+T)*g,A=h-d,v=f-d,m=T-d,p=n-A,C=r-v,B=i-m;let S,y,R,M,I,b;p>=C?C>=B?(S=1,y=0,R=0,M=1,I=1,b=0):p>=B?(S=1,y=0,R=0,M=1,I=0,b=1):(S=0,y=0,R=1,M=1,I=0,b=1):C<B?(S=0,y=0,R=1,M=0,I=1,b=1):p<B?(S=0,y=1,R=0,M=0,I=1,b=1):(S=0,y=1,R=0,M=1,I=1,b=0);const O=p-S+g,w=C-y+g,k=B-R+g,U=p-M+2*g,H=C-I+2*g,j=B-b+2*g,ne=p-1+3*g,Q=C-1+3*g,Y=B-1+3*g,ve=h&255,ye=f&255,Ne=T&255,de=this.perm[ve+this.perm[ye+this.perm[Ne]]]%12,tt=this.perm[ve+S+this.perm[ye+y+this.perm[Ne+R]]]%12,re=this.perm[ve+M+this.perm[ye+I+this.perm[Ne+b]]]%12,ce=this.perm[ve+1+this.perm[ye+1+this.perm[Ne+1]]]%12;let pe=.6-p*p-C*C-B*B;pe<0?s=0:(pe*=pe,s=pe*pe*this.dot3(this.grad3[de],p,C,B));let z=.6-O*O-w*w-k*k;z<0?a=0:(z*=z,a=z*z*this.dot3(this.grad3[tt],O,w,k));let ue=.6-U*U-H*H-j*j;ue<0?o=0:(ue*=ue,o=ue*ue*this.dot3(this.grad3[re],U,H,j));let fe=.6-ne*ne-Q*Q-Y*Y;return fe<0?l=0:(fe*=fe,l=fe*fe*this.dot3(this.grad3[ce],ne,Q,Y)),32*(s+a+o+l)}),x(this,"noise4d",(n,r,i,s)=>{const a=this.grad4,o=this.simplex,l=this.perm,c=(Math.sqrt(5)-1)/4,u=(5-Math.sqrt(5))/20;let h,f,T,g,d;const A=(n+r+i+s)*c,v=Math.floor(n+A),m=Math.floor(r+A),p=Math.floor(i+A),C=Math.floor(s+A),B=(v+m+p+C)*u,S=v-B,y=m-B,R=p-B,M=C-B,I=n-S,b=r-y,O=i-R,w=s-M,k=I>b?32:0,U=I>O?16:0,H=b>O?8:0,j=I>w?4:0,ne=b>w?2:0,Q=O>w?1:0,Y=k+U+H+j+ne+Q;let ve,ye,Ne,de,tt,re,ce,pe,z,ue,fe,Ee;ve=o[Y][0]>=3?1:0,ye=o[Y][1]>=3?1:0,Ne=o[Y][2]>=3?1:0,de=o[Y][3]>=3?1:0,tt=o[Y][0]>=2?1:0,re=o[Y][1]>=2?1:0,ce=o[Y][2]>=2?1:0,pe=o[Y][3]>=2?1:0,z=o[Y][0]>=1?1:0,ue=o[Y][1]>=1?1:0,fe=o[Y][2]>=1?1:0,Ee=o[Y][3]>=1?1:0;const _e=I-ve+u,nt=b-ye+u,yt=O-Ne+u,Mn=w-de+u,an=I-tt+2*u,Ut=b-re+2*u,Ht=O-ce+2*u,on=w-pe+2*u,In=I-z+3*u,bn=b-ue+3*u,ln=O-fe+3*u,Kt=w-Ee+3*u,Pn=I-1+4*u,_n=b-1+4*u,cn=O-1+4*u,wn=w-1+4*u,St=v&255,xt=m&255,mt=p&255,E=C&255,_=l[St+l[xt+l[mt+l[E]]]]%32,G=l[St+ve+l[xt+ye+l[mt+Ne+l[E+de]]]]%32,V=l[St+tt+l[xt+re+l[mt+ce+l[E+pe]]]]%32,Te=l[St+z+l[xt+ue+l[mt+fe+l[E+Ee]]]]%32,At=l[St+1+l[xt+1+l[mt+1+l[E+1]]]]%32;let we=.6-I*I-b*b-O*O-w*w;we<0?h=0:(we*=we,h=we*we*this.dot4(a[_],I,b,O,w));let un=.6-_e*_e-nt*nt-yt*yt-Mn*Mn;un<0?f=0:(un*=un,f=un*un*this.dot4(a[G],_e,nt,yt,Mn));let Mt=.6-an*an-Ut*Ut-Ht*Ht-on*on;Mt<0?T=0:(Mt*=Mt,T=Mt*Mt*this.dot4(a[V],an,Ut,Ht,on));let Se=.6-In*In-bn*bn-ln*ln-Kt*Kt;Se<0?g=0:(Se*=Se,g=Se*Se*this.dot4(a[Te],In,bn,ln,Kt));let xe=.6-Pn*Pn-_n*_n-cn*cn-wn*wn;return xe<0?d=0:(xe*=xe,d=xe*xe*this.dot4(a[At],Pn,_n,cn,wn)),27*(h+f+T+g+d)});for(let n=0;n<256;n++)this.p[n]=Math.floor(e.random()*256);for(let n=0;n<512;n++)this.perm[n]=this.p[n&255]}}const Me=class extends yn{constructor(t={}){super(),this.isLightningStrike=!0,this.type="LightningStrike",this.init(Me.copyParameters(t,t)),this.createMesh()}static createRandomGenerator(){const e=[];for(let r=0;r<2053;r++)e.push(Math.random());const n={currentSeed:0,random:function(){const r=e[n.currentSeed];return n.currentSeed=(n.currentSeed+1)%2053,r},getSeed:function(){return n.currentSeed/2053},setSeed:function(r){n.currentSeed=Math.floor(r*2053)%2053}};return n}static copyParameters(t={},e={}){const n=function(r){return e===t?r:r.clone()};return t.sourceOffset=e.sourceOffset!==void 0?n(e.sourceOffset):new P(0,100,0),t.destOffset=e.destOffset!==void 0?n(e.destOffset):new P(0,0,0),t.timeScale=e.timeScale!==void 0?e.timeScale:1,t.roughness=e.roughness!==void 0?e.roughness:.9,t.straightness=e.straightness!==void 0?e.straightness:.7,t.up0=e.up0!==void 0?n(e.up0):new P(0,0,1),t.up1=e.up1!==void 0?n(e.up1):new P(0,0,1),t.radius0=e.radius0!==void 0?e.radius0:1,t.radius1=e.radius1!==void 0?e.radius1:1,t.radius0Factor=e.radius0Factor!==void 0?e.radius0Factor:.5,t.radius1Factor=e.radius1Factor!==void 0?e.radius1Factor:.2,t.minRadius=e.minRadius!==void 0?e.minRadius:.2,t.isEternal=e.isEternal!==void 0?e.isEternal:e.birthTime===void 0||e.deathTime===void 0,t.birthTime=e.birthTime,t.deathTime=e.deathTime,t.propagationTimeFactor=e.propagationTimeFactor!==void 0?e.propagationTimeFactor:.1,t.vanishingTimeFactor=e.vanishingTimeFactor!==void 0?e.vanishingTimeFactor:.9,t.subrayPeriod=e.subrayPeriod!==void 0?e.subrayPeriod:4,t.subrayDutyCycle=e.subrayDutyCycle!==void 0?e.subrayDutyCycle:.6,t.maxIterations=e.maxIterations!==void 0?e.maxIterations:9,t.isStatic=e.isStatic!==void 0?e.isStatic:!1,t.ramification=e.ramification!==void 0?e.ramification:5,t.maxSubrayRecursion=e.maxSubrayRecursion!==void 0?e.maxSubrayRecursion:3,t.recursionProbability=e.recursionProbability!==void 0?e.recursionProbability:.6,t.generateUVs=e.generateUVs!==void 0?e.generateUVs:!1,t.randomGenerator=e.randomGenerator,t.noiseSeed=e.noiseSeed,t.onDecideSubrayCreation=e.onDecideSubrayCreation,t.onSubrayCreation=e.onSubrayCreation,t}update(t){this.isStatic||(this.rayParameters.isEternal||this.rayParameters.birthTime<=t&&t<=this.rayParameters.deathTime?(this.updateMesh(t),t<this.subrays[0].endPropagationTime?this.state=Me.RAY_PROPAGATING:t>this.subrays[0].beginVanishingTime?this.state=Me.RAY_VANISHING:this.state=Me.RAY_STEADY,this.visible=!0):(this.visible=!1,t<this.rayParameters.birthTime?this.state=Me.RAY_UNBORN:this.state=Me.RAY_EXTINGUISHED))}init(t){this.rayParameters=t,this.maxIterations=t.maxIterations!==void 0?Math.floor(t.maxIterations):9,t.maxIterations=this.maxIterations,this.isStatic=t.isStatic!==void 0?t.isStatic:!1,t.isStatic=this.isStatic,this.ramification=t.ramification!==void 0?Math.floor(t.ramification):5,t.ramification=this.ramification,this.maxSubrayRecursion=t.maxSubrayRecursion!==void 0?Math.floor(t.maxSubrayRecursion):3,t.maxSubrayRecursion=this.maxSubrayRecursion,this.recursionProbability=t.recursionProbability!==void 0?t.recursionProbability:.6,t.recursionProbability=this.recursionProbability,this.generateUVs=t.generateUVs!==void 0?t.generateUVs:!1,t.generateUVs=this.generateUVs,t.randomGenerator!==void 0?(this.randomGenerator=t.randomGenerator,this.seedGenerator=t.randomGenerator,t.noiseSeed!==void 0&&this.seedGenerator.setSeed(t.noiseSeed)):(this.randomGenerator=Me.createRandomGenerator(),this.seedGenerator=Math),t.onDecideSubrayCreation!==void 0?this.onDecideSubrayCreation=t.onDecideSubrayCreation:(this.createDefaultSubrayCreationCallbacks(),t.onSubrayCreation!==void 0&&(this.onSubrayCreation=t.onSubrayCreation)),this.state=Me.RAY_INITIALIZED,this.maxSubrays=Math.ceil(1+Math.pow(this.ramification,Math.max(0,this.maxSubrayRecursion-1))),t.maxSubrays=this.maxSubrays,this.maxRaySegments=2*(1<<this.maxIterations),this.subrays=[];for(let e=0;e<this.maxSubrays;e++)this.subrays.push(this.createSubray());this.raySegments=[];for(let e=0;e<this.maxRaySegments;e++)this.raySegments.push(this.createSegment());this.time=0,this.timeFraction=0,this.currentSegmentCallback=null,this.currentCreateTriangleVertices=this.generateUVs?this.createTriangleVerticesWithUVs:this.createTriangleVerticesWithoutUVs,this.numSubrays=0,this.currentSubray=null,this.currentSegmentIndex=0,this.isInitialSegment=!1,this.subrayProbability=0,this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.vertices=null,this.uvs=null,this.indices=null,this.positionAttribute=null,this.uvsAttribute=null,this.simplexX=new Yn(this.seedGenerator),this.simplexY=new Yn(this.seedGenerator),this.simplexZ=new Yn(this.seedGenerator),this.forwards=new P,this.forwardsFill=new P,this.side=new P,this.down=new P,this.middlePos=new P,this.middleLinPos=new P,this.newPos=new P,this.vPos=new P,this.cross1=new P}createMesh(){const t=1<<this.maxIterations,e=3*(t+1)*this.maxSubrays,n=18*t*this.maxSubrays;this.vertices=new Float32Array(e*3),this.indices=new Uint32Array(n),this.generateUVs&&(this.uvs=new Float32Array(e*2)),this.fillMesh(0),this.setIndex(new Fc(this.indices,1)),this.positionAttribute=new Xn(this.vertices,3),this.setAttribute("position",this.positionAttribute),this.generateUVs&&(this.uvsAttribute=new Xn(new Float32Array(this.uvs),2),this.setAttribute("uv",this.uvsAttribute)),this.isStatic||(this.index.usage=Bi,this.positionAttribute.usage=Bi,this.generateUVs&&(this.uvsAttribute.usage=Bi)),this.vertices=this.positionAttribute.array,this.indices=this.index.array,this.generateUVs&&(this.uvs=this.uvsAttribute.array)}updateMesh(t){this.fillMesh(t),this.drawRange.count=this.currentIndex,this.index.needsUpdate=!0,this.positionAttribute.needsUpdate=!0,this.generateUVs&&(this.uvsAttribute.needsUpdate=!0)}fillMesh(t){const e=this;this.currentVertex=0,this.currentIndex=0,this.currentCoordinate=0,this.currentUVCoordinate=0,this.fractalRay(t,function(r){const i=e.currentSubray;t<i.birthTime||(this.rayParameters.isEternal&&e.currentSubray.recursion==0?(e.createPrism(r),e.onDecideSubrayCreation(r,e)):t<i.endPropagationTime?e.timeFraction>=r.fraction0*i.propagationTimeFactor&&(e.createPrism(r),e.onDecideSubrayCreation(r,e)):t<i.beginVanishingTime?(e.createPrism(r),e.onDecideSubrayCreation(r,e)):(e.timeFraction<=i.vanishingTimeFactor+r.fraction1*(1-i.vanishingTimeFactor)&&e.createPrism(r),e.onDecideSubrayCreation(r,e)))})}addNewSubray(){return this.subrays[this.numSubrays++]}initSubray(t,e){t.pos0.copy(e.sourceOffset),t.pos1.copy(e.destOffset),t.up0.copy(e.up0),t.up1.copy(e.up1),t.radius0=e.radius0,t.radius1=e.radius1,t.birthTime=e.birthTime,t.deathTime=e.deathTime,t.timeScale=e.timeScale,t.roughness=e.roughness,t.straightness=e.straightness,t.propagationTimeFactor=e.propagationTimeFactor,t.vanishingTimeFactor=e.vanishingTimeFactor,t.maxIterations=this.maxIterations,t.seed=e.noiseSeed!==void 0?e.noiseSeed:0,t.recursion=0}fractalRay(t,e){this.time=t,this.currentSegmentCallback=e,this.numSubrays=0,this.initSubray(this.addNewSubray(),this.rayParameters);for(let n=0;n<this.numSubrays;n++){const r=this.subrays[n];this.currentSubray=r,this.randomGenerator.setSeed(r.seed),r.endPropagationTime=Vn.lerp(r.birthTime,r.deathTime,r.propagationTimeFactor),r.beginVanishingTime=Vn.lerp(r.deathTime,r.birthTime,1-r.vanishingTimeFactor);const i=this.randomGenerator.random;r.linPos0.set(i(),i(),i()).multiplyScalar(1e3),r.linPos1.set(i(),i(),i()).multiplyScalar(1e3),this.timeFraction=(t-r.birthTime)/(r.deathTime-r.birthTime),this.currentSegmentIndex=0,this.isInitialSegment=!0;const s=this.getNewSegment();s.iteration=0,s.pos0.copy(r.pos0),s.pos1.copy(r.pos1),s.linPos0.copy(r.linPos0),s.linPos1.copy(r.linPos1),s.up0.copy(r.up0),s.up1.copy(r.up1),s.radius0=r.radius0,s.radius1=r.radius1,s.fraction0=0,s.fraction1=1,s.positionVariationFactor=1-r.straightness,this.subrayProbability=this.ramification*Math.pow(this.recursionProbability,r.recursion)/(1<<r.maxIterations),this.fractalRayRecursive(s)}this.currentSegmentCallback=null,this.currentSubray=null}fractalRayRecursive(t){if(t.iteration>=this.currentSubray.maxIterations){this.currentSegmentCallback(t);return}this.forwards.subVectors(t.pos1,t.pos0);let e=this.forwards.length();e<1e-6&&(this.forwards.set(0,0,.01),e=this.forwards.length());const n=(t.radius0+t.radius1)*.5,r=(t.fraction0+t.fraction1)*.5,i=this.time*this.currentSubray.timeScale*Math.pow(2,t.iteration);this.middlePos.lerpVectors(t.pos0,t.pos1,.5),this.middleLinPos.lerpVectors(t.linPos0,t.linPos1,.5);const s=this.middleLinPos;this.newPos.set(this.simplexX.noise4d(s.x,s.y,s.z,i),this.simplexY.noise4d(s.x,s.y,s.z,i),this.simplexZ.noise4d(s.x,s.y,s.z,i)),this.newPos.multiplyScalar(t.positionVariationFactor*e),this.newPos.add(this.middlePos);const a=this.getNewSegment();a.pos0.copy(t.pos0),a.pos1.copy(this.newPos),a.linPos0.copy(t.linPos0),a.linPos1.copy(this.middleLinPos),a.up0.copy(t.up0),a.up1.copy(t.up1),a.radius0=t.radius0,a.radius1=n,a.fraction0=t.fraction0,a.fraction1=r,a.positionVariationFactor=t.positionVariationFactor*this.currentSubray.roughness,a.iteration=t.iteration+1;const o=this.getNewSegment();o.pos0.copy(this.newPos),o.pos1.copy(t.pos1),o.linPos0.copy(this.middleLinPos),o.linPos1.copy(t.linPos1),this.cross1.crossVectors(t.up0,this.forwards.normalize()),o.up0.crossVectors(this.forwards,this.cross1).normalize(),o.up1.copy(t.up1),o.radius0=n,o.radius1=t.radius1,o.fraction0=r,o.fraction1=t.fraction1,o.positionVariationFactor=t.positionVariationFactor*this.currentSubray.roughness,o.iteration=t.iteration+1,this.fractalRayRecursive(a),this.fractalRayRecursive(o)}createPrism(t){this.forwardsFill.subVectors(t.pos1,t.pos0).normalize(),this.isInitialSegment&&(this.currentCreateTriangleVertices(t.pos0,t.up0,this.forwardsFill,t.radius0,0),this.isInitialSegment=!1),this.currentCreateTriangleVertices(t.pos1,t.up0,this.forwardsFill,t.radius1,t.fraction1),this.createPrismFaces()}createTriangleVerticesWithoutUVs(t,e,n,r){this.side.crossVectors(e,n).multiplyScalar(r*Me.COS30DEG),this.down.copy(e).multiplyScalar(-r*Me.SIN30DEG);const i=this.vPos,s=this.vertices;i.copy(t).sub(this.side).add(this.down),s[this.currentCoordinate++]=i.x,s[this.currentCoordinate++]=i.y,s[this.currentCoordinate++]=i.z,i.copy(t).add(this.side).add(this.down),s[this.currentCoordinate++]=i.x,s[this.currentCoordinate++]=i.y,s[this.currentCoordinate++]=i.z,i.copy(e).multiplyScalar(r).add(t),s[this.currentCoordinate++]=i.x,s[this.currentCoordinate++]=i.y,s[this.currentCoordinate++]=i.z,this.currentVertex+=3}createTriangleVerticesWithUVs(t,e,n,r,i){this.side.crossVectors(e,n).multiplyScalar(r*Me.COS30DEG),this.down.copy(e).multiplyScalar(-r*Me.SIN30DEG);const s=this.vPos,a=this.vertices,o=this.uvs;s.copy(t).sub(this.side).add(this.down),a[this.currentCoordinate++]=s.x,a[this.currentCoordinate++]=s.y,a[this.currentCoordinate++]=s.z,o[this.currentUVCoordinate++]=i,o[this.currentUVCoordinate++]=0,s.copy(t).add(this.side).add(this.down),a[this.currentCoordinate++]=s.x,a[this.currentCoordinate++]=s.y,a[this.currentCoordinate++]=s.z,o[this.currentUVCoordinate++]=i,o[this.currentUVCoordinate++]=.5,s.copy(e).multiplyScalar(r).add(t),a[this.currentCoordinate++]=s.x,a[this.currentCoordinate++]=s.y,a[this.currentCoordinate++]=s.z,o[this.currentUVCoordinate++]=i,o[this.currentUVCoordinate++]=1,this.currentVertex+=3}createPrismFaces(t){const e=this.indices;t=this.currentVertex-6,e[this.currentIndex++]=t+1,e[this.currentIndex++]=t+2,e[this.currentIndex++]=t+5,e[this.currentIndex++]=t+1,e[this.currentIndex++]=t+5,e[this.currentIndex++]=t+4,e[this.currentIndex++]=t+0,e[this.currentIndex++]=t+1,e[this.currentIndex++]=t+4,e[this.currentIndex++]=t+0,e[this.currentIndex++]=t+4,e[this.currentIndex++]=t+3,e[this.currentIndex++]=t+2,e[this.currentIndex++]=t+0,e[this.currentIndex++]=t+3,e[this.currentIndex++]=t+2,e[this.currentIndex++]=t+3,e[this.currentIndex++]=t+5}createDefaultSubrayCreationCallbacks(){const t=this.randomGenerator.random;this.onDecideSubrayCreation=function(s,a){const o=a.currentSubray,l=a.rayParameters.subrayPeriod,c=a.rayParameters.subrayDutyCycle,u=a.rayParameters.isEternal&&o.recursion==0?-t()*l:Vn.lerp(o.birthTime,o.endPropagationTime,s.fraction0)-t()*l,h=a.time-u,f=Math.floor(h/l),T=t()*(f+1),g=h%l<=c*l;let d=0;if(g&&(d=a.subrayProbability),o.recursion<a.maxSubrayRecursion&&a.numSubrays<a.maxSubrays&&t()<d){const A=a.addNewSubray(),v=a.randomGenerator.getSeed();A.seed=T,a.randomGenerator.setSeed(T),A.recursion=o.recursion+1,A.maxIterations=Math.max(1,o.maxIterations-1),A.linPos0.set(t(),t(),t()).multiplyScalar(1e3),A.linPos1.set(t(),t(),t()).multiplyScalar(1e3),A.up0.copy(o.up0),A.up1.copy(o.up1),A.radius0=s.radius0*a.rayParameters.radius0Factor,A.radius1=Math.min(a.rayParameters.minRadius,s.radius1*a.rayParameters.radius1Factor),A.birthTime=u+f*l,A.deathTime=A.birthTime+l*c,!a.rayParameters.isEternal&&o.recursion==0&&(A.birthTime=Math.max(A.birthTime,o.birthTime),A.deathTime=Math.min(A.deathTime,o.deathTime)),A.timeScale=o.timeScale*2,A.roughness=o.roughness,A.straightness=o.straightness,A.propagationTimeFactor=o.propagationTimeFactor,A.vanishingTimeFactor=o.vanishingTimeFactor,a.onSubrayCreation(s,o,A,a),a.randomGenerator.setSeed(v)}};const e=new P,n=new P,r=new P,i=new P;this.onSubrayCreation=function(s,a,o,l){l.subrayCylinderPosition(s,a,o,.5,.6,.2)},this.subrayConePosition=function(s,a,o,l,c,u){o.pos0.copy(s.pos0),e.subVectors(a.pos1,a.pos0),n.copy(e).normalize(),e.multiplyScalar(s.fraction0+(1-s.fraction0)*(t()*l));const h=e.length();r.crossVectors(a.up0,n);const f=2*Math.PI*t();r.multiplyScalar(Math.cos(f)),i.copy(a.up0).multiplyScalar(Math.sin(f)),o.pos1.copy(r).add(i).multiplyScalar(h*c*(u+t()*(1-u))).add(e).add(a.pos0)},this.subrayCylinderPosition=function(s,a,o,l,c,u){o.pos0.copy(s.pos0),e.subVectors(a.pos1,a.pos0),n.copy(e).normalize(),e.multiplyScalar(s.fraction0+(1-s.fraction0)*((2*t()-1)*l));const h=e.length();r.crossVectors(a.up0,n);const f=2*Math.PI*t();r.multiplyScalar(Math.cos(f)),i.copy(a.up0).multiplyScalar(Math.sin(f)),o.pos1.copy(r).add(i).multiplyScalar(h*c*(u+t()*(1-u))).add(e).add(a.pos0)}}createSubray(){return{seed:0,maxIterations:0,recursion:0,pos0:new P,pos1:new P,linPos0:new P,linPos1:new P,up0:new P,up1:new P,radius0:0,radius1:0,birthTime:0,deathTime:0,timeScale:0,roughness:0,straightness:0,propagationTimeFactor:0,vanishingTimeFactor:0,endPropagationTime:0,beginVanishingTime:0}}createSegment(){return{iteration:0,pos0:new P,pos1:new P,linPos0:new P,linPos1:new P,up0:new P,up1:new P,radius0:0,radius1:0,fraction0:0,fraction1:0,positionVariationFactor:0}}getNewSegment(){return this.raySegments[this.currentSegmentIndex++]}copy(t){return super.copy(t),this.init(Me.copyParameters({},t.rayParameters)),this}clone(){return new this.constructor(Me.copyParameters({},this.rayParameters))}};let Lt=Me;x(Lt,"RAY_INITIALIZED",0);x(Lt,"RAY_UNBORN",1);x(Lt,"RAY_PROPAGATING",2);x(Lt,"RAY_STEADY",3);x(Lt,"RAY_VANISHING",4);x(Lt,"RAY_EXTINGUISHED",5);x(Lt,"COS30DEG",Math.cos(30*Math.PI/180));x(Lt,"SIN30DEG",Math.sin(30*Math.PI/180));const jt=class extends Ke{constructor(t,e={}){super(t),this.isReflectorForSSRPass=!0,this.type="ReflectorForSSRPass";const n=this,r=e.color!==void 0?new q(e.color):new q(8355711),i=e.textureWidth||512,s=e.textureHeight||512,a=e.clipBias||0,o=e.shader||jt.ReflectorShader,l=e.useDepthTexture===!0,c=new P(0,1,0),u=new P,h=new P;n.needsUpdate=!1,n.maxDistance=jt.ReflectorShader.uniforms.maxDistance.value,n.opacity=jt.ReflectorShader.uniforms.opacity.value,n.color=r,n.resolution=e.resolution||new K(window.innerWidth,window.innerHeight),n._distanceAttenuation=jt.ReflectorShader.defines.DISTANCE_ATTENUATION,Object.defineProperty(n,"distanceAttenuation",{get(){return n._distanceAttenuation},set(b){n._distanceAttenuation!==b&&(n._distanceAttenuation=b,n.material.defines.DISTANCE_ATTENUATION=b,n.material.needsUpdate=!0)}}),n._fresnel=jt.ReflectorShader.defines.FRESNEL,Object.defineProperty(n,"fresnel",{get(){return n._fresnel},set(b){n._fresnel!==b&&(n._fresnel=b,n.material.defines.FRESNEL=b,n.material.needsUpdate=!0)}});const f=new P,T=new P,g=new P,d=new se,A=new P(0,0,-1),v=new P,m=new P,p=new se,C=new zt;let B;l&&(B=new $r,B.type=fs,B.minFilter=te,B.magFilter=te);const S={depthTexture:l?B:null,type:Ie},y=new Re(i,s,S),R=new ie({transparent:l,defines:Object.assign({},jt.ReflectorShader.defines,{useDepthTexture:l}),uniforms:he.clone(o.uniforms),fragmentShader:o.fragmentShader,vertexShader:o.vertexShader});R.uniforms.tDiffuse.value=y.texture,R.uniforms.color.value=n.color,R.uniforms.textureMatrix.value=p,l&&(R.uniforms.tDepth.value=y.depthTexture),this.material=R;const I=[new Fr(new P(0,1,0),a)];this.doRender=function(b,O,w){if(R.uniforms.maxDistance.value=n.maxDistance,R.uniforms.color.value=n.color,R.uniforms.opacity.value=n.opacity,u.copy(w.position).normalize(),h.copy(u).reflect(c),R.uniforms.fresnelCoe.value=(u.dot(h)+1)/2,T.setFromMatrixPosition(n.matrixWorld),g.setFromMatrixPosition(w.matrixWorld),d.extractRotation(n.matrixWorld),f.set(0,0,1),f.applyMatrix4(d),v.subVectors(T,g),v.dot(f)>0)return;v.reflect(f).negate(),v.add(T),d.extractRotation(w.matrixWorld),A.set(0,0,-1),A.applyMatrix4(d),A.add(g),m.subVectors(T,A),m.reflect(f).negate(),m.add(T),C.position.copy(v),C.up.set(0,1,0),C.up.applyMatrix4(d),C.up.reflect(f),C.lookAt(m),C.far=w.far,C.updateMatrixWorld(),C.projectionMatrix.copy(w.projectionMatrix),R.uniforms.virtualCameraNear.value=w.near,R.uniforms.virtualCameraFar.value=w.far,R.uniforms.virtualCameraMatrixWorld.value=C.matrixWorld,R.uniforms.virtualCameraProjectionMatrix.value=w.projectionMatrix,R.uniforms.virtualCameraProjectionMatrixInverse.value=w.projectionMatrixInverse,R.uniforms.resolution.value=n.resolution,p.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),p.multiply(C.projectionMatrix),p.multiply(C.matrixWorldInverse),p.multiply(n.matrixWorld);const k=b.getRenderTarget(),U=b.xr.enabled,H=b.shadowMap.autoUpdate,j=b.clippingPlanes;b.xr.enabled=!1,b.shadowMap.autoUpdate=!1,b.clippingPlanes=I,b.setRenderTarget(y),b.state.buffers.depth.setMask(!0),b.autoClear===!1&&b.clear(),b.render(O,C),b.xr.enabled=U,b.shadowMap.autoUpdate=H,b.clippingPlanes=j,b.setRenderTarget(k);const ne=w.viewport;ne!==void 0&&b.state.viewport(ne)},this.getRenderTarget=function(){return y}}};let qc=jt;x(qc,"ReflectorShader",{defines:{DISTANCE_ATTENUATION:!0,FRESNEL:!0},uniforms:{color:{value:null},tDiffuse:{value:null},tDepth:{value:null},textureMatrix:{value:new se},maxDistance:{value:180},opacity:{value:.5},fresnelCoe:{value:null},virtualCameraNear:{value:null},virtualCameraFar:{value:null},virtualCameraProjectionMatrix:{value:new se},virtualCameraMatrixWorld:{value:new se},virtualCameraProjectionMatrixInverse:{value:new se},resolution:{value:new K}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		uniform sampler2D tDepth;
		uniform float maxDistance;
		uniform float opacity;
		uniform float fresnelCoe;
		uniform float virtualCameraNear;
		uniform float virtualCameraFar;
		uniform mat4 virtualCameraProjectionMatrix;
		uniform mat4 virtualCameraProjectionMatrixInverse;
		uniform mat4 virtualCameraMatrixWorld;
		uniform vec2 resolution;
		varying vec4 vUv;
		#include <packing>
		float blendOverlay( float base, float blend ) {
			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );
		}
		vec3 blendOverlay( vec3 base, vec3 blend ) {
			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			return perspectiveDepthToViewZ( depth, virtualCameraNear, virtualCameraFar );
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( virtualCameraProjectionMatrixInverse * clipPosition ).xyz;//view
		}
		void main() {
			vec4 base = texture2DProj( tDiffuse, vUv );
			#ifdef useDepthTexture
				vec2 uv=(gl_FragCoord.xy-.5)/resolution.xy;
				uv.x=1.-uv.x;
				float depth = texture2DProj( tDepth, vUv ).r;
				float viewZ = getViewZ( depth );
				float clipW = virtualCameraProjectionMatrix[2][3] * viewZ+virtualCameraProjectionMatrix[3][3];
				vec3 viewPosition=getViewPosition( uv, depth, clipW );
				vec3 worldPosition=(virtualCameraMatrixWorld*vec4(viewPosition,1)).xyz;
				if(worldPosition.y>maxDistance) discard;
				float op=opacity;
				#ifdef DISTANCE_ATTENUATION
					float ratio=1.-(worldPosition.y/maxDistance);
					float attenuation=ratio*ratio;
					op=opacity*attenuation;
				#endif
				#ifdef FRESNEL
					op*=fresnelCoe;
				#endif
				gl_FragColor = vec4( blendOverlay( base.rgb, color ), op );
			#else
				gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );
			#endif
		}
	`});const xr={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new P},up:{value:new P(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${parseInt(rr.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},Fo=new ie({name:"SkyShader",fragmentShader:xr.fragmentShader,vertexShader:xr.vertexShader,uniforms:he.clone(xr.uniforms),side:Tc,depthWrite:!1});class Do extends Ke{constructor(){super(new vc(1,1,1),Fo)}}x(Do,"SkyShader",xr);x(Do,"material",Fo);const No=class extends Ke{constructor(t,e={}){super(t),this.isWater=!0,this.type="Water";const n=this,r=e.color!==void 0?new q(e.color):new q(16777215),i=e.textureWidth||512,s=e.textureHeight||512,a=e.clipBias||0,o=e.flowDirection||new K(1,0),l=e.flowSpeed||.03,c=e.reflectivity||.02,u=e.scale||1,h=e.shader||No.WaterShader,f=e.encoding!==void 0?e.encoding:3e3,T=e.flowMap||void 0,g=e.normalMap0,d=e.normalMap1,A=.15,v=A*.5,m=new se,p=new Kc;if(Vi===void 0){console.error("THREE.Water: Required component Reflector not found.");return}if(Xi===void 0){console.error("THREE.Water: Required component Refractor not found.");return}const C=new Vi(t,{textureWidth:i,textureHeight:s,clipBias:a,encoding:f}),B=new Xi(t,{textureWidth:i,textureHeight:s,clipBias:a,encoding:f});C.matrixAutoUpdate=!1,B.matrixAutoUpdate=!1,this.material=new ie({uniforms:he.merge([Dc.fog,h.uniforms]),vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,transparent:!0,fog:!0}),T!==void 0?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:T}):this.material.uniforms.flowDirection={type:"v2",value:o},g.wrapS=g.wrapT=Zt,d.wrapS=d.wrapT=Zt,this.material.uniforms.tReflectionMap.value=C.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=B.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=g,this.material.uniforms.tNormalMap1.value=d,this.material.uniforms.color.value=r,this.material.uniforms.reflectivity.value=c,this.material.uniforms.textureMatrix.value=m,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=v,this.material.uniforms.config.value.z=v,this.material.uniforms.config.value.w=u;function S(R){m.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),m.multiply(R.projectionMatrix),m.multiply(R.matrixWorldInverse),m.multiply(n.matrixWorld)}function y(){const R=p.getDelta(),M=n.material.uniforms.config;M.value.x+=l*R,M.value.y=M.value.x+v,M.value.x>=A?(M.value.x=0,M.value.y=v):M.value.y>=A&&(M.value.y=M.value.y-A)}this.onBeforeRender=function(R,M,I){S(I),y(),n.visible=!1,C.matrixWorld.copy(n.matrixWorld),B.matrixWorld.copy(n.matrixWorld),C.onBeforeRender(R,M,I),B.onBeforeRender(R,M,I),n.visible=!0}}};let eu=No;x(eu,"WaterShader",{uniforms:{color:{value:null},reflectivity:{value:0},tReflectionMap:{value:null},tRefractionMap:{value:null},tNormalMap0:{value:null},tNormalMap1:{value:null},textureMatrix:{value:null},config:{value:new An}},vertexShader:`

		#include <common>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>

		uniform mat4 textureMatrix;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			vUv = uv;
			vCoord = textureMatrix * vec4( position, 1.0 );

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vToEye = cameraPosition - worldPosition.xyz;

			vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex
			gl_Position = projectionMatrix * mvPosition;

			#include <logdepthbuf_vertex>
			#include <fog_vertex>

		}`,fragmentShader:`

		#include <common>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>

		uniform sampler2D tReflectionMap;
		uniform sampler2D tRefractionMap;
		uniform sampler2D tNormalMap0;
		uniform sampler2D tNormalMap1;

		#ifdef USE_FLOWMAP
			uniform sampler2D tFlowMap;
		#else
			uniform vec2 flowDirection;
		#endif

		uniform vec3 color;
		uniform float reflectivity;
		uniform vec4 config;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			#include <logdepthbuf_fragment>

			float flowMapOffset0 = config.x;
			float flowMapOffset1 = config.y;
			float halfCycle = config.z;
			float scale = config.w;

			vec3 toEye = normalize( vToEye );

			// determine flow direction
			vec2 flow;
			#ifdef USE_FLOWMAP
				flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;
			#else
				flow = flowDirection;
			#endif
			flow.x *= - 1.0;

			// sample normal maps (distort uvs with flowdata)
			vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );
			vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );

			// linear interpolate to get the final normal color
			float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;
			vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );

			// calculate normal vector
			vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );

			// calculate the fresnel term to blend reflection and refraction maps
			float theta = max( dot( toEye, normal ), 0.0 );
			float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );

			// calculate final uv coords
			vec3 coord = vCoord.xyz / vCoord.w;
			vec2 uv = coord.xy + coord.z * normal.xz * 0.05;

			vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );
			vec4 refractColor = texture2D( tRefractionMap, uv );

			// multiply water color with the mix of both textures
			gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );

			#include <tonemapping_fragment>
			#include <${parseInt(rr.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
			#include <fog_fragment>

		}`});const Si={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","#include <packing>","void main() {","	float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );","	gl_FragColor = vec4( vec3( depth ), opacity );","}"].join(`
`)},Vs=(t,e)=>(t%e+e)%e;class yv extends Zl{constructor(e,n){super(),x(this,"object"),x(this,"domElement"),x(this,"enabled",!0),x(this,"target",new P),x(this,"minDistance",0),x(this,"maxDistance",1/0),x(this,"minZoom",0),x(this,"maxZoom",1/0),x(this,"minPolarAngle",0),x(this,"maxPolarAngle",Math.PI),x(this,"minAzimuthAngle",-1/0),x(this,"maxAzimuthAngle",1/0),x(this,"enableDamping",!1),x(this,"dampingFactor",.05),x(this,"enableZoom",!0),x(this,"zoomSpeed",1),x(this,"enableRotate",!0),x(this,"rotateSpeed",1),x(this,"enablePan",!0),x(this,"panSpeed",1),x(this,"screenSpacePanning",!0),x(this,"keyPanSpeed",7),x(this,"autoRotate",!1),x(this,"autoRotateSpeed",2),x(this,"reverseOrbit",!1),x(this,"reverseHorizontalOrbit",!1),x(this,"reverseVerticalOrbit",!1),x(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),x(this,"mouseButtons",{LEFT:hn.ROTATE,MIDDLE:hn.DOLLY,RIGHT:hn.PAN}),x(this,"touches",{ONE:fn.ROTATE,TWO:fn.DOLLY_PAN}),x(this,"target0"),x(this,"position0"),x(this,"zoom0"),x(this,"_domElementKeyEvents",null),x(this,"getPolarAngle"),x(this,"getAzimuthalAngle"),x(this,"setPolarAngle"),x(this,"setAzimuthalAngle"),x(this,"getDistance"),x(this,"listenToKeyEvents"),x(this,"stopListenToKeyEvents"),x(this,"saveState"),x(this,"reset"),x(this,"update"),x(this,"connect"),x(this,"dispose"),this.object=e,this.domElement=n,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=E=>{let _=Vs(E,2*Math.PI),G=u.phi;G<0&&(G+=2*Math.PI),_<0&&(_+=2*Math.PI);let V=Math.abs(_-G);2*Math.PI-V<V&&(_<G?_+=2*Math.PI:G+=2*Math.PI),h.phi=_-G,r.update()},this.setAzimuthalAngle=E=>{let _=Vs(E,2*Math.PI),G=u.theta;G<0&&(G+=2*Math.PI),_<0&&(_+=2*Math.PI);let V=Math.abs(_-G);2*Math.PI-V<V&&(_<G?_+=2*Math.PI:G+=2*Math.PI),h.theta=_-G,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=E=>{E.addEventListener("keydown",Kt),this._domElementKeyEvents=E},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Kt),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(i),r.update(),l=o.NONE},this.update=(()=>{const E=new P,_=new P(0,1,0),G=new Zn().setFromUnitVectors(e.up,_),V=G.clone().invert(),Te=new P,At=new Zn,we=2*Math.PI;return function(){const Mt=r.object.position;G.setFromUnitVectors(e.up,_),V.copy(G).invert(),E.copy(Mt).sub(r.target),E.applyQuaternion(G),u.setFromVector3(E),r.autoRotate&&l===o.NONE&&O(I()),r.enableDamping?(u.theta+=h.theta*r.dampingFactor,u.phi+=h.phi*r.dampingFactor):(u.theta+=h.theta,u.phi+=h.phi);let Se=r.minAzimuthAngle,xe=r.maxAzimuthAngle;return isFinite(Se)&&isFinite(xe)&&(Se<-Math.PI?Se+=we:Se>Math.PI&&(Se-=we),xe<-Math.PI?xe+=we:xe>Math.PI&&(xe-=we),Se<=xe?u.theta=Math.max(Se,Math.min(xe,u.theta)):u.theta=u.theta>(Se+xe)/2?Math.max(Se,u.theta):Math.min(xe,u.theta)),u.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=f,u.radius=Math.max(r.minDistance,Math.min(r.maxDistance,u.radius)),r.enableDamping===!0?r.target.addScaledVector(T,r.dampingFactor):r.target.add(T),E.setFromSpherical(u),E.applyQuaternion(V),Mt.copy(r.target).add(E),r.object.lookAt(r.target),r.enableDamping===!0?(h.theta*=1-r.dampingFactor,h.phi*=1-r.dampingFactor,T.multiplyScalar(1-r.dampingFactor)):(h.set(0,0,0),T.set(0,0,0)),f=1,g||Te.distanceToSquared(r.object.position)>c||8*(1-At.dot(r.object.quaternion))>c?(r.dispatchEvent(i),Te.copy(r.object.position),At.copy(r.object.quaternion),g=!1,!0):!1}})(),this.connect=E=>{E===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),r.domElement=E,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",cn),r.domElement.addEventListener("pointerdown",an),r.domElement.addEventListener("pointercancel",on),r.domElement.addEventListener("wheel",ln)},this.dispose=()=>{var E,_,G,V,Te,At;(E=r.domElement)==null||E.removeEventListener("contextmenu",cn),(_=r.domElement)==null||_.removeEventListener("pointerdown",an),(G=r.domElement)==null||G.removeEventListener("pointercancel",on),(V=r.domElement)==null||V.removeEventListener("wheel",ln),(Te=r.domElement)==null||Te.ownerDocument.removeEventListener("pointermove",Ut),(At=r.domElement)==null||At.ownerDocument.removeEventListener("pointerup",Ht),r._domElementKeyEvents!==null&&r._domElementKeyEvents.removeEventListener("keydown",Kt)};const r=this,i={type:"change"},s={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=o.NONE;const c=1e-6,u=new Us,h=new Us;let f=1;const T=new P;let g=!1;const d=new K,A=new K,v=new K,m=new K,p=new K,C=new K,B=new K,S=new K,y=new K,R=[],M={};function I(){return 2*Math.PI/60/60*r.autoRotateSpeed}function b(){return Math.pow(.95,r.zoomSpeed)}function O(E){r.reverseOrbit||r.reverseHorizontalOrbit?h.theta+=E:h.theta-=E}function w(E){r.reverseOrbit||r.reverseVerticalOrbit?h.phi+=E:h.phi-=E}const k=(()=>{const E=new P;return function(G,V){E.setFromMatrixColumn(V,0),E.multiplyScalar(-G),T.add(E)}})(),U=(()=>{const E=new P;return function(G,V){r.screenSpacePanning===!0?E.setFromMatrixColumn(V,1):(E.setFromMatrixColumn(V,0),E.crossVectors(r.object.up,E)),E.multiplyScalar(G),T.add(E)}})(),H=(()=>{const E=new P;return function(G,V){const Te=r.domElement;if(Te&&r.object instanceof zt&&r.object.isPerspectiveCamera){const At=r.object.position;E.copy(At).sub(r.target);let we=E.length();we*=Math.tan(r.object.fov/2*Math.PI/180),k(2*G*we/Te.clientHeight,r.object.matrix),U(2*V*we/Te.clientHeight,r.object.matrix)}else Te&&r.object instanceof jn&&r.object.isOrthographicCamera?(k(G*(r.object.right-r.object.left)/r.object.zoom/Te.clientWidth,r.object.matrix),U(V*(r.object.top-r.object.bottom)/r.object.zoom/Te.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function j(E){r.object instanceof zt&&r.object.isPerspectiveCamera?f/=E:r.object instanceof jn&&r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*E)),r.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function ne(E){r.object instanceof zt&&r.object.isPerspectiveCamera?f*=E:r.object instanceof jn&&r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/E)),r.object.updateProjectionMatrix(),g=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function Q(E){d.set(E.clientX,E.clientY)}function Y(E){B.set(E.clientX,E.clientY)}function ve(E){m.set(E.clientX,E.clientY)}function ye(E){A.set(E.clientX,E.clientY),v.subVectors(A,d).multiplyScalar(r.rotateSpeed);const _=r.domElement;_&&(O(2*Math.PI*v.x/_.clientHeight),w(2*Math.PI*v.y/_.clientHeight)),d.copy(A),r.update()}function Ne(E){S.set(E.clientX,E.clientY),y.subVectors(S,B),y.y>0?j(b()):y.y<0&&ne(b()),B.copy(S),r.update()}function de(E){p.set(E.clientX,E.clientY),C.subVectors(p,m).multiplyScalar(r.panSpeed),H(C.x,C.y),m.copy(p),r.update()}function tt(E){E.deltaY<0?ne(b()):E.deltaY>0&&j(b()),r.update()}function re(E){let _=!1;switch(E.code){case r.keys.UP:H(0,r.keyPanSpeed),_=!0;break;case r.keys.BOTTOM:H(0,-r.keyPanSpeed),_=!0;break;case r.keys.LEFT:H(r.keyPanSpeed,0),_=!0;break;case r.keys.RIGHT:H(-r.keyPanSpeed,0),_=!0;break}_&&(E.preventDefault(),r.update())}function ce(){if(R.length==1)d.set(R[0].pageX,R[0].pageY);else{const E=.5*(R[0].pageX+R[1].pageX),_=.5*(R[0].pageY+R[1].pageY);d.set(E,_)}}function pe(){if(R.length==1)m.set(R[0].pageX,R[0].pageY);else{const E=.5*(R[0].pageX+R[1].pageX),_=.5*(R[0].pageY+R[1].pageY);m.set(E,_)}}function z(){const E=R[0].pageX-R[1].pageX,_=R[0].pageY-R[1].pageY,G=Math.sqrt(E*E+_*_);B.set(0,G)}function ue(){r.enableZoom&&z(),r.enablePan&&pe()}function fe(){r.enableZoom&&z(),r.enableRotate&&ce()}function Ee(E){if(R.length==1)A.set(E.pageX,E.pageY);else{const G=mt(E),V=.5*(E.pageX+G.x),Te=.5*(E.pageY+G.y);A.set(V,Te)}v.subVectors(A,d).multiplyScalar(r.rotateSpeed);const _=r.domElement;_&&(O(2*Math.PI*v.x/_.clientHeight),w(2*Math.PI*v.y/_.clientHeight)),d.copy(A)}function _e(E){if(R.length==1)p.set(E.pageX,E.pageY);else{const _=mt(E),G=.5*(E.pageX+_.x),V=.5*(E.pageY+_.y);p.set(G,V)}C.subVectors(p,m).multiplyScalar(r.panSpeed),H(C.x,C.y),m.copy(p)}function nt(E){const _=mt(E),G=E.pageX-_.x,V=E.pageY-_.y,Te=Math.sqrt(G*G+V*V);S.set(0,Te),y.set(0,Math.pow(S.y/B.y,r.zoomSpeed)),j(y.y),B.copy(S)}function yt(E){r.enableZoom&&nt(E),r.enablePan&&_e(E)}function Mn(E){r.enableZoom&&nt(E),r.enableRotate&&Ee(E)}function an(E){var _,G;r.enabled!==!1&&(R.length===0&&((_=r.domElement)==null||_.ownerDocument.addEventListener("pointermove",Ut),(G=r.domElement)==null||G.ownerDocument.addEventListener("pointerup",Ht)),wn(E),E.pointerType==="touch"?Pn(E):In(E))}function Ut(E){r.enabled!==!1&&(E.pointerType==="touch"?_n(E):bn(E))}function Ht(E){var _,G,V;St(E),R.length===0&&((_=r.domElement)==null||_.releasePointerCapture(E.pointerId),(G=r.domElement)==null||G.ownerDocument.removeEventListener("pointermove",Ut),(V=r.domElement)==null||V.ownerDocument.removeEventListener("pointerup",Ht)),r.dispatchEvent(a),l=o.NONE}function on(E){St(E)}function In(E){let _;switch(E.button){case 0:_=r.mouseButtons.LEFT;break;case 1:_=r.mouseButtons.MIDDLE;break;case 2:_=r.mouseButtons.RIGHT;break;default:_=-1}switch(_){case hn.DOLLY:if(r.enableZoom===!1)return;Y(E),l=o.DOLLY;break;case hn.ROTATE:if(E.ctrlKey||E.metaKey||E.shiftKey){if(r.enablePan===!1)return;ve(E),l=o.PAN}else{if(r.enableRotate===!1)return;Q(E),l=o.ROTATE}break;case hn.PAN:if(E.ctrlKey||E.metaKey||E.shiftKey){if(r.enableRotate===!1)return;Q(E),l=o.ROTATE}else{if(r.enablePan===!1)return;ve(E),l=o.PAN}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function bn(E){if(r.enabled!==!1)switch(l){case o.ROTATE:if(r.enableRotate===!1)return;ye(E);break;case o.DOLLY:if(r.enableZoom===!1)return;Ne(E);break;case o.PAN:if(r.enablePan===!1)return;de(E);break}}function ln(E){r.enabled===!1||r.enableZoom===!1||l!==o.NONE&&l!==o.ROTATE||(E.preventDefault(),r.dispatchEvent(s),tt(E),r.dispatchEvent(a))}function Kt(E){r.enabled===!1||r.enablePan===!1||re(E)}function Pn(E){switch(xt(E),R.length){case 1:switch(r.touches.ONE){case fn.ROTATE:if(r.enableRotate===!1)return;ce(),l=o.TOUCH_ROTATE;break;case fn.PAN:if(r.enablePan===!1)return;pe(),l=o.TOUCH_PAN;break;default:l=o.NONE}break;case 2:switch(r.touches.TWO){case fn.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;ue(),l=o.TOUCH_DOLLY_PAN;break;case fn.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;fe(),l=o.TOUCH_DOLLY_ROTATE;break;default:l=o.NONE}break;default:l=o.NONE}l!==o.NONE&&r.dispatchEvent(s)}function _n(E){switch(xt(E),l){case o.TOUCH_ROTATE:if(r.enableRotate===!1)return;Ee(E),r.update();break;case o.TOUCH_PAN:if(r.enablePan===!1)return;_e(E),r.update();break;case o.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;yt(E),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Mn(E),r.update();break;default:l=o.NONE}}function cn(E){r.enabled!==!1&&E.preventDefault()}function wn(E){R.push(E)}function St(E){delete M[E.pointerId];for(let _=0;_<R.length;_++)if(R[_].pointerId==E.pointerId){R.splice(_,1);return}}function xt(E){let _=M[E.pointerId];_===void 0&&(_=new K,M[E.pointerId]=_),_.set(E.pageX,E.pageY)}function mt(E){const _=E.pointerId===R[0].pointerId?R[1]:R[0];return M[_.pointerId]}n!==void 0&&this.connect(n),this.update()}}class Zr{constructor(){x(this,"enabled",!0),x(this,"needsSwap",!0),x(this,"clear",!1),x(this,"renderToScreen",!1)}setSize(e,n){}render(e,n,r,i,s){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}class qr{constructor(e){x(this,"camera",new jn(-1,1,1,-1,0,1)),x(this,"geometry",new Nc(2,2)),x(this,"mesh"),this.mesh=new Ke(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}const at={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","	vec4 texel = texture2D( tDiffuse, vUv );","	gl_FragColor = opacity * texel;","}"].join(`
`)},On={defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new K},cameraProjectionMatrix:{value:new se},cameraInverseProjectionMatrix:{value:new se},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tDepth;","uniform sampler2D tNoise;","uniform vec3 kernel[ KERNEL_SIZE ];","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float kernelRadius;","uniform float minDistance;","uniform float maxDistance;","varying vec2 vUv;","#include <packing>","float getDepth( const in vec2 screenPosition ) {","	return texture2D( tDepth, screenPosition ).x;","}","float getLinearDepth( const in vec2 screenPosition ) {","	#if PERSPECTIVE_CAMERA == 1","		float fragCoordZ = texture2D( tDepth, screenPosition ).x;","		float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","		return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","	#else","		return texture2D( tDepth, screenPosition ).x;","	#endif","}","float getViewZ( const in float depth ) {","	#if PERSPECTIVE_CAMERA == 1","		return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","	#else","		return orthographicDepthToViewZ( depth, cameraNear, cameraFar );","	#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","	float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","	vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","	clipPosition *= clipW; // unprojection.","	return ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec2 screenPosition ) {","	return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","}","void main() {","	float depth = getDepth( vUv );","	float viewZ = getViewZ( depth );","	vec3 viewPosition = getViewPosition( vUv, depth, viewZ );","	vec3 viewNormal = getViewNormal( vUv );"," vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );","	vec3 random = texture2D( tNoise, vUv * noiseScale ).xyz;","	vec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );","	vec3 bitangent = cross( viewNormal, tangent );","	mat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );"," float occlusion = 0.0;"," for ( int i = 0; i < KERNEL_SIZE; i ++ ) {","		vec3 sampleVector = kernelMatrix * kernel[ i ];","		vec3 samplePoint = viewPosition + ( sampleVector * kernelRadius );","		vec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 );","		samplePointNDC /= samplePointNDC.w;","		vec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5;","		float realDepth = getLinearDepth( samplePointUv );","		float sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar );","		float delta = sampleDepth - realDepth;","		if ( delta > minDistance && delta < maxDistance ) {","			occlusion += 1.0;","		}","	}","	occlusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );","	gl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );","}"].join(`
`)},Ar={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","varying vec2 vUv;","#include <packing>","float getLinearDepth( const in vec2 screenPosition ) {","	#if PERSPECTIVE_CAMERA == 1","		float fragCoordZ = texture2D( tDepth, screenPosition ).x;","		float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );","		return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );","	#else","		return texture2D( tDepth, screenPosition ).x;","	#endif","}","void main() {","	float depth = getLinearDepth( vUv );","	gl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );","}"].join(`
`)},gr={uniforms:{tDiffuse:{value:null},resolution:{value:new K}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","varying vec2 vUv;","void main() {","	vec2 texelSize = ( 1.0 / resolution );","	float result = 0.0;","	for ( int i = - 2; i <= 2; i ++ ) {","		for ( int j = - 2; j <= 2; j ++ ) {","			vec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;","			result += texture2D( tDiffuse, vUv + offset ).r;","		}","	}","	gl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );","}"].join(`
`)},Wt=class extends Zr{constructor(t,e,n,r){super(),this.width=n!==void 0?n:512,this.height=r!==void 0?r:512,this.clear=!0,this.camera=e,this.scene=t,this.kernelRadius=8,this.kernelSize=32,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(),this.generateRandomKernelRotations();const i=new $r;i.format=Lc,i.type=Gc,this.beautyRenderTarget=new Re(this.width,this.height),this.normalRenderTarget=new Re(this.width,this.height,{minFilter:te,magFilter:te,depthTexture:i}),this.ssaoRenderTarget=new Re(this.width,this.height),this.blurRenderTarget=this.ssaoRenderTarget.clone(),On===void 0&&console.error("THREE.SSAOPass: The pass relies on SSAOShader."),this.ssaoMaterial=new ie({defines:Object.assign({},On.defines),uniforms:he.clone(On.uniforms),vertexShader:On.vertexShader,fragmentShader:On.fragmentShader,blending:X}),this.ssaoMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new ds,this.normalMaterial.blending=X,this.blurMaterial=new ie({defines:Object.assign({},gr.defines),uniforms:he.clone(gr.uniforms),vertexShader:gr.vertexShader,fragmentShader:gr.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new ie({defines:Object.assign({},Ar.defines),uniforms:he.clone(Ar.uniforms),vertexShader:Ar.vertexShader,fragmentShader:Ar.fragmentShader,blending:X}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new ie({uniforms:he.clone(at.uniforms),vertexShader:at.vertexShader,fragmentShader:at.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:go,blendDst:Or,blendEquation:Tn,blendSrcAlpha:To,blendDstAlpha:Or,blendEquationAlpha:Tn}),this.fsQuad=new qr(null),this.originalClearColor=new q}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(t,e){switch(t.capabilities.isWebGL2===!1&&(this.noiseTexture.format=kc),t.setRenderTarget(this.beautyRenderTarget),t.clear(),t.render(this.scene,this.camera),this.overrideVisibility(),this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(t,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(t,this.blurMaterial,this.blurRenderTarget),this.output){case Wt.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=X,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Wt.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=X,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Wt.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=X,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Wt.OUTPUT.Depth:this.renderPass(t,this.depthRenderMaterial,this.renderToScreen?null:e);break;case Wt.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=X,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Wt.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=X,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e),this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=ji,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}}renderPass(t,e,n,r,i){t.getClearColor(this.originalClearColor);const s=t.getClearAlpha(),a=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,r!=null&&(t.setClearColor(r),t.setClearAlpha(i||0),t.clear()),this.fsQuad.material=e,this.fsQuad.render(t),t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}renderOverride(t,e,n,r,i){t.getClearColor(this.originalClearColor);const s=t.getClearAlpha(),a=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,r=e.clearColor||r,i=e.clearAlpha||i,r!=null&&(t.setClearColor(r),t.setClearAlpha(i||0),t.clear()),this.scene.overrideMaterial=e,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}setSize(t,e){this.width=t,this.height=e,this.beautyRenderTarget.setSize(t,e),this.ssaoRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.blurRenderTarget.setSize(t,e),this.ssaoMaterial.uniforms.resolution.value.set(t,e),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(t,e)}generateSampleKernel(){const t=this.kernelSize,e=this.kernel;for(let n=0;n<t;n++){const r=new P;r.x=Math.random()*2-1,r.y=Math.random()*2-1,r.z=Math.random(),r.normalize();let i=n/t;i=Vn.lerp(.1,1,i*i),r.multiplyScalar(i),e.push(r)}}generateRandomKernelRotations(){Yn===void 0&&console.error("THREE.SSAOPass: The pass relies on SimplexNoise.");const n=new Yn,r=4*4,i=new Float32Array(r);for(let s=0;s<r;s++){const a=Math.random()*2-1,o=Math.random()*2-1,l=0;i[s]=n.noise3d(a,o,l)}this.noiseTexture=new Dr(i,4,4,Gn,Qn),this.noiseTexture.wrapS=Zt,this.noiseTexture.wrapT=Zt,this.noiseTexture.needsUpdate=!0}overrideVisibility(){const t=this.scene,e=this._visibilityCache;t.traverse(function(n){e.set(n,n.visible),(n.isPoints||n.isLine)&&(n.visible=!1)})}restoreVisibility(){const t=this.scene,e=this._visibilityCache;t.traverse(function(n){const r=e.get(n);n.visible=r}),e.clear()}};let tu=Wt;x(tu,"OUTPUT",{Default:0,SSAO:1,Blur:2,Beauty:3,Depth:4,Normal:5});const nu={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new q(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","	vec4 texel = texture2D( tDiffuse, vUv );","	vec3 luma = vec3( 0.299, 0.587, 0.114 );","	float v = dot( texel.xyz, luma );","	vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","	float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","	gl_FragColor = mix( outputColor, texel, alpha );","}"].join(`
`)},Yi=class extends Zr{constructor(t,e,n,r){super(),this.strength=e!==void 0?e:1,this.radius=n,this.threshold=r,this.resolution=t!==void 0?new K(t.x,t.y):new K(256,256),this.clearColor=new q(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let i=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);this.renderTargetBright=new Re(i,s,{type:Ie}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let u=0;u<this.nMips;u++){const h=new Re(i,s,{type:Ie});h.texture.name="UnrealBloomPass.h"+u,h.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(h);const f=new Re(i,s,{type:Ie});f.texture.name="UnrealBloomPass.v"+u,f.texture.generateMipmaps=!1,this.renderTargetsVertical.push(f),i=Math.round(i/2),s=Math.round(s/2)}const a=nu;this.highPassUniforms=he.clone(a.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new ie({uniforms:this.highPassUniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:{}}),this.separableBlurMaterials=[];const o=[3,5,7,9,11];i=Math.round(this.resolution.x/2),s=Math.round(this.resolution.y/2);for(let u=0;u<this.nMips;u++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(o[u])),this.separableBlurMaterials[u].uniforms.texSize.value=new K(i,s),i=Math.round(i/2),s=Math.round(s/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=e,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;const l=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=l,this.bloomTintColors=[new P(1,1,1),new P(1,1,1),new P(1,1,1),new P(1,1,1),new P(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const c=at;this.copyUniforms=he.clone(c.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new ie({uniforms:this.copyUniforms,vertexShader:c.vertexShader,fragmentShader:c.fragmentShader,blending:Co,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new q,this.oldClearAlpha=1,this.basic=new Tt,this.fsQuad=new qr(null)}dispose(){for(let t=0;t<this.renderTargetsHorizontal.length;t++)this.renderTargetsHorizontal[t].dispose();for(let t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose();for(let t=0;t<this.separableBlurMaterials.length;t++)this.separableBlurMaterials[t].dispose();this.compositeMaterial.dispose(),this.materialCopy.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(t,e){let n=Math.round(t/2),r=Math.round(e/2);this.renderTargetBright.setSize(n,r);for(let i=0;i<this.nMips;i++)this.renderTargetsHorizontal[i].setSize(n,r),this.renderTargetsVertical[i].setSize(n,r),this.separableBlurMaterials[i].uniforms.texSize.value=new K(n,r),n=Math.round(n/2),r=Math.round(r/2)}render(t,e,n,r,i){t.getClearColor(this._oldClearColor),this.oldClearAlpha=t.getClearAlpha();const s=t.autoClear;t.autoClear=!1,t.setClearColor(this.clearColor,0),i&&t.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,t.setRenderTarget(null),t.clear(),this.fsQuad.render(t)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,t.setRenderTarget(this.renderTargetBright),t.clear(),this.fsQuad.render(t);let a=this.renderTargetBright;for(let o=0;o<this.nMips;o++)this.fsQuad.material=this.separableBlurMaterials[o],this.separableBlurMaterials[o].uniforms.colorTexture.value=a.texture,this.separableBlurMaterials[o].uniforms.direction.value=Yi.BlurDirectionX,t.setRenderTarget(this.renderTargetsHorizontal[o]),t.clear(),this.fsQuad.render(t),this.separableBlurMaterials[o].uniforms.colorTexture.value=this.renderTargetsHorizontal[o].texture,this.separableBlurMaterials[o].uniforms.direction.value=Yi.BlurDirectionY,t.setRenderTarget(this.renderTargetsVertical[o]),t.clear(),this.fsQuad.render(t),a=this.renderTargetsVertical[o];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,t.setRenderTarget(this.renderTargetsHorizontal[0]),t.clear(),this.fsQuad.render(t),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,i&&t.state.buffers.stencil.setTest(!0),this.renderToScreen?(t.setRenderTarget(null),this.fsQuad.render(t)):(t.setRenderTarget(n),this.fsQuad.render(t)),t.setClearColor(this._oldClearColor,this.oldClearAlpha),t.autoClear=s}getSeperableBlurMaterial(t){return new ie({defines:{KERNEL_RADIUS:t,SIGMA:t},uniforms:{colorTexture:{value:null},texSize:{value:new K(.5,.5)},direction:{value:new K(.5,.5)}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}
				void main() {
					vec2 invSize = 1.0 / texSize;
					float fSigma = float(SIGMA);
					float weightSum = gaussianPdf(0.0, fSigma);
					vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianPdf(x, fSigma);
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(t){return new ie({defines:{NUM_MIPS:t},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}};let Lo=Yi;x(Lo,"BlurDirectionX",new K(1,0));x(Lo,"BlurDirectionY",new K(0,1));const Tr={defines:{NUM_SAMPLES:7,NUM_RINGS:4,NORMAL_TEXTURE:0,DIFFUSE_TEXTURE:0,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new K(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new se},cameraInverseProjectionMatrix:{value:new se},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = uv;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["#include <common>","varying vec2 vUv;","#if DIFFUSE_TEXTURE == 1","uniform sampler2D tDiffuse;","#endif","uniform sampler2D tDepth;","#if NORMAL_TEXTURE == 1","uniform sampler2D tNormal;","#endif","uniform float cameraNear;","uniform float cameraFar;","uniform mat4 cameraProjectionMatrix;","uniform mat4 cameraInverseProjectionMatrix;","uniform float scale;","uniform float intensity;","uniform float bias;","uniform float kernelRadius;","uniform float minResolution;","uniform vec2 size;","uniform float randomSeed;","// RGBA depth","#include <packing>","vec4 getDefaultColor( const in vec2 screenPosition ) {","	#if DIFFUSE_TEXTURE == 1","	return texture2D( tDiffuse, vUv );","	#else","	return vec4( 1.0 );","	#endif","}","float getDepth( const in vec2 screenPosition ) {","	#if DEPTH_PACKING == 1","	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","	#else","	return texture2D( tDepth, screenPosition ).x;","	#endif","}","float getViewZ( const in float depth ) {","	#if PERSPECTIVE_CAMERA == 1","	return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","	#else","	return orthographicDepthToViewZ( depth, cameraNear, cameraFar );","	#endif","}","vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {","	float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];","	vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );","	clipPosition *= clipW; // unprojection.","	return ( cameraInverseProjectionMatrix * clipPosition ).xyz;","}","vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {","	#if NORMAL_TEXTURE == 1","	return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );","	#else","	return normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );","	#endif","}","float scaleDividedByCameraFar;","float minResolutionMultipliedByCameraFar;","float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {","	vec3 viewDelta = sampleViewPosition - centerViewPosition;","	float viewDistance = length( viewDelta );","	float scaledScreenDistance = scaleDividedByCameraFar * viewDistance;","	return max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );","}","// moving costly divides into consts","const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );","const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );","float getAmbientOcclusion( const in vec3 centerViewPosition ) {","	// precompute some variables require in getOcclusion.","	scaleDividedByCameraFar = scale / cameraFar;","	minResolutionMultipliedByCameraFar = minResolution * cameraFar;","	vec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );","	// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/","	float angle = rand( vUv + randomSeed ) * PI2;","	vec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;","	vec2 radiusStep = radius;","	float occlusionSum = 0.0;","	float weightSum = 0.0;","	for( int i = 0; i < NUM_SAMPLES; i ++ ) {","		vec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;","		radius += radiusStep;","		angle += ANGLE_STEP;","		float sampleDepth = getDepth( sampleUv );","		if( sampleDepth >= ( 1.0 - EPSILON ) ) {","			continue;","		}","		float sampleViewZ = getViewZ( sampleDepth );","		vec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );","		occlusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );","		weightSum += 1.0;","	}","	if( weightSum == 0.0 ) discard;","	return occlusionSum * ( intensity / weightSum );","}","void main() {","	float centerDepth = getDepth( vUv );","	if( centerDepth >= ( 1.0 - EPSILON ) ) {","		discard;","	}","	float centerViewZ = getViewZ( centerDepth );","	vec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );","	float ambientOcclusion = getAmbientOcclusion( viewPosition );","	gl_FragColor = getDefaultColor( vUv );","	gl_FragColor.xyz *=  1.0 - ambientOcclusion;","}"].join(`
`)},It={defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new K(512,512)},sampleUvOffsets:{value:[new K(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:["#include <common>","uniform vec2 size;","varying vec2 vUv;","varying vec2 vInvSize;","void main() {","	vUv = uv;","	vInvSize = 1.0 / size;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["#include <common>","#include <packing>","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform float cameraNear;","uniform float cameraFar;","uniform float depthCutoff;","uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];","uniform float sampleWeights[ KERNEL_RADIUS + 1 ];","varying vec2 vUv;","varying vec2 vInvSize;","float getDepth( const in vec2 screenPosition ) {","	#if DEPTH_PACKING == 1","	return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );","	#else","	return texture2D( tDepth, screenPosition ).x;","	#endif","}","float getViewZ( const in float depth ) {","	#if PERSPECTIVE_CAMERA == 1","	return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );","	#else","	return orthographicDepthToViewZ( depth, cameraNear, cameraFar );","	#endif","}","void main() {","	float depth = getDepth( vUv );","	if( depth >= ( 1.0 - EPSILON ) ) {","		discard;","	}","	float centerViewZ = -getViewZ( depth );","	bool rBreak = false, lBreak = false;","	float weightSum = sampleWeights[0];","	vec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;","	for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {","		float sampleWeight = sampleWeights[i];","		vec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;","		vec2 sampleUv = vUv + sampleUvOffset;","		float viewZ = -getViewZ( getDepth( sampleUv ) );","		if( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;","		if( ! rBreak ) {","			diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","			weightSum += sampleWeight;","		}","		sampleUv = vUv - sampleUvOffset;","		viewZ = -getViewZ( getDepth( sampleUv ) );","		if( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;","		if( ! lBreak ) {","			diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;","			weightSum += sampleWeight;","		}","	}","	gl_FragColor = diffuseSum / weightSum;","}"].join(`
`)},Lr={createSampleWeights:(t,e)=>{const n=(i,s)=>Math.exp(-(i*i)/(2*(s*s)))/(Math.sqrt(2*Math.PI)*s),r=[];for(let i=0;i<=t;i++)r.push(n(i,e));return r},createSampleOffsets:(t,e)=>{const n=[];for(let r=0;r<=t;r++)n.push(e.clone().multiplyScalar(r));return n},configure:(t,e,n,r)=>{t.defines.KERNEL_RADIUS=e,t.uniforms.sampleUvOffsets.value=Lr.createSampleOffsets(e,r),t.uniforms.sampleWeights.value=Lr.createSampleWeights(e,n),t.needsUpdate=!0}};class ru extends Zr{constructor(e,n,r=!1,i=!1,s=new K(256,256)){super(),this.scene=e,this.camera=n,this.clear=!0,this.needsSwap=!1,this.supportsDepthTextureExtension=r,this.supportsNormalTexture=i,this.originalClearColor=new q,this._oldClearColor=new q,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=new K(s.x,s.y),this.saoRenderTarget=new Re(this.resolution.x,this.resolution.y,{type:Ie}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone(),this.beautyRenderTarget=this.saoRenderTarget.clone(),this.normalRenderTarget=new Re(this.resolution.x,this.resolution.y,{minFilter:te,magFilter:te,type:Ie}),this.depthRenderTarget=this.normalRenderTarget.clone();let a;this.supportsDepthTextureExtension&&(a=new $r,a.type=fs,this.beautyRenderTarget.depthTexture=a,this.beautyRenderTarget.depthBuffer=!0),this.depthMaterial=new Cc,this.depthMaterial.depthPacking=Ec,this.depthMaterial.blending=X,this.normalMaterial=new ds,this.normalMaterial.blending=X,this.saoMaterial=new ie({defines:Object.assign({},Tr.defines),fragmentShader:Tr.fragmentShader,vertexShader:Tr.vertexShader,uniforms:he.clone(Tr.uniforms)}),this.saoMaterial.extensions.derivatives=!0,this.saoMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.saoMaterial.defines.NORMAL_TEXTURE=this.supportsNormalTexture?1:0,this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?a:this.depthRenderTarget.texture,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=X,this.vBlurMaterial=new ie({uniforms:he.clone(It.uniforms),defines:Object.assign({},It.defines),vertexShader:It.vertexShader,fragmentShader:It.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?a:this.depthRenderTarget.texture,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=X,this.hBlurMaterial=new ie({uniforms:he.clone(It.uniforms),defines:Object.assign({},It.defines),vertexShader:It.vertexShader,fragmentShader:It.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=this.supportsDepthTextureExtension?0:1,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=this.supportsDepthTextureExtension?a:this.depthRenderTarget.texture,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=X,this.materialCopy=new ie({uniforms:he.clone(at.uniforms),vertexShader:at.vertexShader,fragmentShader:at.fragmentShader,blending:X}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=ji,this.materialCopy.blendSrc=go,this.materialCopy.blendDst=Or,this.materialCopy.blendEquation=Tn,this.materialCopy.blendSrcAlpha=To,this.materialCopy.blendDstAlpha=Or,this.materialCopy.blendEquationAlpha=Tn,this.depthCopy=new ie({uniforms:he.clone(Si.uniforms),vertexShader:Si.vertexShader,fragmentShader:Si.fragmentShader,blending:X}),this.fsQuad=new qr(null)}render(e,n,r){if(this.renderToScreen&&(this.materialCopy.blending=X,this.materialCopy.uniforms.tDiffuse.value=r.texture,this.materialCopy.needsUpdate=!0,this.renderPass(e,this.materialCopy,null)),this.params.output===1)return;e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();const i=e.autoClear;e.autoClear=!1,e.setRenderTarget(this.depthRenderTarget),e.clear(),this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;const s=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=s,this.hBlurMaterial.uniforms.depthCutoff.value=s,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),(this.prevStdDev!==this.params.saoBlurStdDev||this.prevNumSamples!==this.params.saoBlurRadius)&&(Lr.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new K(0,1)),Lr.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new K(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),e.setClearColor(0),e.setRenderTarget(this.beautyRenderTarget),e.clear(),e.render(this.scene,this.camera),this.supportsDepthTextureExtension||this.renderOverride(e,this.depthMaterial,this.depthRenderTarget,0,1),this.supportsNormalTexture&&this.renderOverride(e,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(e,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(e,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(e,this.hBlurMaterial,this.saoRenderTarget,16777215,1));let a=this.materialCopy;this.params.output===3?this.supportsDepthTextureExtension?(this.materialCopy.uniforms.tDiffuse.value=this.beautyRenderTarget.depthTexture,this.materialCopy.needsUpdate=!0):(this.depthCopy.uniforms.tDiffuse.value=this.depthRenderTarget.texture,this.depthCopy.needsUpdate=!0,a=this.depthCopy):this.params.output===4?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),this.params.output===0?a.blending=ji:a.blending=X,this.renderPass(e,a,this.renderToScreen?null:r),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=i}renderPass(e,n,r,i,s){e.getClearColor(this.originalClearColor);const a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,i!=null&&(e.setClearColor(i),e.setClearAlpha(s||0),e.clear()),this.fsQuad.material=n,this.fsQuad.render(e),e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}renderOverride(e,n,r,i,s){e.getClearColor(this.originalClearColor);const a=e.getClearAlpha(),o=e.autoClear;e.setRenderTarget(r),e.autoClear=!1,i=n.clearColor||i,s=n.clearAlpha||s,i!=null&&(e.setClearColor(i),e.setClearAlpha(s||0),e.clear()),this.scene.overrideMaterial=n,e.render(this.scene,this.camera),this.scene.overrideMaterial=null,e.autoClear=o,e.setClearColor(this.originalClearColor),e.setClearAlpha(a)}setSize(e,n){this.beautyRenderTarget.setSize(e,n),this.saoRenderTarget.setSize(e,n),this.blurIntermediateRenderTarget.setSize(e,n),this.normalRenderTarget.setSize(e,n),this.depthRenderTarget.setSize(e,n),this.saoMaterial.uniforms.size.value.set(e,n),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(e,n),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(e,n),this.hBlurMaterial.needsUpdate=!0}dispose(){this.saoRenderTarget.dispose(),this.blurIntermediateRenderTarget.dispose(),this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.depthRenderTarget.dispose(),this.depthMaterial.dispose(),this.normalMaterial.dispose(),this.saoMaterial.dispose(),this.vBlurMaterial.dispose(),this.hBlurMaterial.dispose(),this.materialCopy.dispose(),this.depthCopy.dispose(),this.fsQuad.dispose()}}x(ru,"OUTPUT",{Beauty:1,Default:0,SAO:2,Depth:3,Normal:4});const rt={defines:{MAX_STEP:0,isPerspectiveCamera:!0,isDistanceAttenuation:!0,isFresnel:!0,isInfiniteThick:!1,isSelective:!1},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tMetalness:{value:null},tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new K},cameraProjectionMatrix:{value:new se},cameraInverseProjectionMatrix:{value:new se},opacity:{value:.5},maxDistance:{value:180},cameraRange:{value:0},surfDist:{value:.007},thickTolerance:{value:.03}},vertexShader:`

    varying vec2 vUv;

    void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }

  `,fragmentShader:`
		// precision highp float;
		precision highp sampler2D;
		varying vec2 vUv;
		uniform sampler2D tDepth;
		uniform sampler2D tNormal;
		uniform sampler2D tMetalness;
		uniform sampler2D tDiffuse;
		uniform float cameraRange;
		uniform vec2 resolution;
		uniform float opacity;
		uniform float cameraNear;
		uniform float cameraFar;
		uniform float maxDistance;
		uniform float surfDist;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;
		uniform float thickTolerance;
		#include <packing>
		float pointToLineDistance(vec3 x0, vec3 x1, vec3 x2) {
			//x0: point, x1: linePointA, x2: linePointB
			//https://mathworld.wolfram.com/Point-LineDistance3-Dimensional.html
			return length(cross(x0-x1,x0-x2))/length(x2-x1);
		}
		float pointPlaneDistance(vec3 point,vec3 planePoint,vec3 planeNormal){
			// https://mathworld.wolfram.com/Point-PlaneDistance.html
			//// https://en.wikipedia.org/wiki/Plane_(geometry)
			//// http://paulbourke.net/geometry/pointlineplane/
			float a=planeNormal.x,b=planeNormal.y,c=planeNormal.z;
			float x0=point.x,y0=point.y,z0=point.z;
			float x=planePoint.x,y=planePoint.y,z=planePoint.z;
			float d=-(a*x+b*y+c*z);
			float distance=(a*x0+b*y0+c*z0+d)/sqrt(a*a+b*b+c*c);
			return distance;
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			#ifdef isPerspectiveCamera
				return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
				return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;//view
		}
		vec3 getViewNormal( const in vec2 uv ) {
			return unpackRGBToNormal( texture2D( tNormal, uv ).xyz );
		}
		vec2 viewPositionToXY(vec3 viewPosition){
			vec2 xy;
			vec4 clip=cameraProjectionMatrix*vec4(viewPosition,1);
			xy=clip.xy;//clip
			float clipW=clip.w;
			xy/=clipW;//NDC
			xy=(xy+1.)/2.;//uv
			xy*=resolution;//screen
			return xy;
		}
		void main(){
			#ifdef isSelective
				float metalness=texture2D(tMetalness,vUv).r;
				if(metalness==0.) return;
			#endif

			float depth = getDepth( vUv );
			float viewZ = getViewZ( depth );
			if(-viewZ>=cameraFar) return;

			float clipW = cameraProjectionMatrix[2][3] * viewZ+cameraProjectionMatrix[3][3];
			vec3 viewPosition=getViewPosition( vUv, depth, clipW );

			vec2 d0=gl_FragCoord.xy;
			vec2 d1;

			vec3 viewNormal=getViewNormal( vUv );

			#ifdef isPerspectiveCamera
				vec3 viewIncidenceDir=normalize(viewPosition);
				vec3 viewReflectDir=reflect(viewIncidenceDir,viewNormal);
			#else
				vec3 viewIncidenceDir=vec3(0,0,-1);
				vec3 viewReflectDir=reflect(viewIncidenceDir,viewNormal);
			#endif

			float maxReflectRayLen=maxDistance/dot(-viewIncidenceDir,viewNormal);
			// dot(a,b)==length(a)*length(b)*cos(theta) // https://www.mathsisfun.com/algebra/vectors-dot-product.html
			// if(a.isNormalized&&b.isNormalized) dot(a,b)==cos(theta)
			// maxDistance/maxReflectRayLen=cos(theta)
			// maxDistance/maxReflectRayLen==dot(a,b)
			// maxReflectRayLen==maxDistance/dot(a,b)

			vec3 d1viewPosition=viewPosition+viewReflectDir*maxReflectRayLen;
			#ifdef isPerspectiveCamera
				if(d1viewPosition.z>-cameraNear){
					//https://tutorial.math.lamar.edu/Classes/CalcIII/EqnsOfLines.aspx
					float t=(-cameraNear-viewPosition.z)/viewReflectDir.z;
					d1viewPosition=viewPosition+viewReflectDir*t;
				}
			#endif
			d1=viewPositionToXY(d1viewPosition);

			float totalLen=length(d1-d0);
			float xLen=d1.x-d0.x;
			float yLen=d1.y-d0.y;
			float totalStep=max(abs(xLen),abs(yLen));
			float xSpan=xLen/totalStep;
			float ySpan=yLen/totalStep;
			for(float i=0.;i<MAX_STEP;i++){
				if(i>=totalStep) break;
				vec2 xy=vec2(d0.x+i*xSpan,d0.y+i*ySpan);
				if(xy.x<0.||xy.x>resolution.x||xy.y<0.||xy.y>resolution.y) break;
				float s=length(xy-d0)/totalLen;
				vec2 uv=xy/resolution;

				float d = getDepth(uv);
				float vZ = getViewZ( d );
				if(-vZ>=cameraFar) continue;
				float cW = cameraProjectionMatrix[2][3] * vZ+cameraProjectionMatrix[3][3];
				vec3 vP=getViewPosition( uv, d, cW );

				#ifdef isPerspectiveCamera
					// https://www.comp.nus.edu.sg/~lowkl/publications/lowk_persp_interp_techrep.pdf
					float recipVPZ=1./viewPosition.z;
					float viewReflectRayZ=1./(recipVPZ+s*(1./d1viewPosition.z-recipVPZ));
					float sD=surfDist*cW;
				#else
					float viewReflectRayZ=viewPosition.z+s*(d1viewPosition.z-viewPosition.z);
					float sD=surfDist;
				#endif
				if(viewReflectRayZ-sD>vZ) continue;

				#ifdef isInfiniteThick
					if(viewReflectRayZ+thickTolerance*clipW<vP.z) break;
				#endif
				float away=pointToLineDistance(vP,viewPosition,d1viewPosition);

				float op=opacity;

				if(away<sD){
					vec3 vN=getViewNormal( uv );
					if(dot(viewReflectDir,vN)>=0.) continue;
					float distance=pointPlaneDistance(vP,viewPosition,viewNormal);
					if(distance>maxDistance) break;
					#ifdef isDistanceAttenuation
						float ratio=1.-(distance/maxDistance);
						float attenuation=ratio*ratio;
						op=opacity*attenuation;
					#endif
					#ifdef isFresnel
						float fresnel=(dot(viewIncidenceDir,viewReflectDir)+1.)/2.;
						op*=fresnel;
					#endif
					vec4 reflectColor=texture2D(tDiffuse,uv);
					gl_FragColor.xyz=reflectColor.xyz;
					gl_FragColor.a=op;
					break;
				}
			}
		}
	`},vr={defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`

    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }

  `,fragmentShader:`

    uniform sampler2D tDepth;

    uniform float cameraNear;
    uniform float cameraFar;

    varying vec2 vUv;

    #include <packing>

		float getLinearDepth( const in vec2 uv ) {

			#if PERSPECTIVE_CAMERA == 1

				float fragCoordZ = texture2D( tDepth, uv ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );

			#else

				return texture2D( tDepth, uv ).x;

			#endif

		}

    void main() {

    	float depth = getLinearDepth( vUv );
			float d = 1.0 - depth;
			// d=(d-.999)*1000.;
    	gl_FragColor = vec4( vec3( d ), 1.0 );

    }

  `},bt={uniforms:{tDiffuse:{value:null},resolution:{value:new K},opacity:{value:.5}},vertexShader:`

    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }

  `,fragmentShader:`

    uniform sampler2D tDiffuse;
    uniform vec2 resolution;
    varying vec2 vUv;
    void main() {
			//reverse engineering from PhotoShop blur filter, then change coefficient

    	vec2 texelSize = ( 1.0 / resolution );

			vec4 c=texture2D(tDiffuse,vUv);

			vec2 offset;

			offset=(vec2(-1,0))*texelSize;
			vec4 cl=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(1,0))*texelSize;
			vec4 cr=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,-1))*texelSize;
			vec4 cb=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,1))*texelSize;
			vec4 ct=texture2D(tDiffuse,vUv+offset);

			// float coeCenter=.5;
			// float coeSide=.125;
			float coeCenter=.2;
			float coeSide=.2;
			float a=c.a*coeCenter+cl.a*coeSide+cr.a*coeSide+cb.a*coeSide+ct.a*coeSide;
			vec3 rgb=(c.rgb*c.a*coeCenter+cl.rgb*cl.a*coeSide+cr.rgb*cr.a*coeSide+cb.rgb*cb.a*coeSide+ct.rgb*ct.a*coeSide)/a;
			gl_FragColor=vec4(rgb,a);

		}
	`},Vt=class extends Zr{constructor({renderer:t,scene:e,camera:n,width:r,height:i,selects:s,bouncing:a=!1,groundReflector:o}){super(),this.width=r!==void 0?r:512,this.height=i!==void 0?i:512,this.clear=!0,this.renderer=t,this.scene=e,this.camera=n,this.groundReflector=o,this.opacity=rt.uniforms.opacity.value,this.output=0,this.maxDistance=rt.uniforms.maxDistance.value,this.thickness=rt.uniforms.thickness.value,this.tempColor=new q,this._selects=s,this.selective=Array.isArray(this._selects),Object.defineProperty(this,"selects",{get(){return this._selects},set(c){this._selects!==c&&(this._selects=c,Array.isArray(c)?(this.selective=!0,this.ssrMaterial.defines.SELECTIVE=!0,this.ssrMaterial.needsUpdate=!0):(this.selective=!1,this.ssrMaterial.defines.SELECTIVE=!1,this.ssrMaterial.needsUpdate=!0))}}),this._bouncing=a,Object.defineProperty(this,"bouncing",{get(){return this._bouncing},set(c){this._bouncing!==c&&(this._bouncing=c,c?this.ssrMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture:this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture)}}),this.blur=!0,this._distanceAttenuation=rt.defines.DISTANCE_ATTENUATION,Object.defineProperty(this,"distanceAttenuation",{get(){return this._distanceAttenuation},set(c){this._distanceAttenuation!==c&&(this._distanceAttenuation=c,this.ssrMaterial.defines.DISTANCE_ATTENUATION=c,this.ssrMaterial.needsUpdate=!0)}}),this._fresnel=rt.defines.FRESNEL,Object.defineProperty(this,"fresnel",{get(){return this._fresnel},set(c){this._fresnel!==c&&(this._fresnel=c,this.ssrMaterial.defines.FRESNEL=c,this.ssrMaterial.needsUpdate=!0)}}),this._infiniteThick=rt.defines.INFINITE_THICK,Object.defineProperty(this,"infiniteThick",{get(){return this._infiniteThick},set(c){this._infiniteThick!==c&&(this._infiniteThick=c,this.ssrMaterial.defines.INFINITE_THICK=c,this.ssrMaterial.needsUpdate=!0)}});const l=new $r;l.type=fs,l.minFilter=te,l.magFilter=te,this.beautyRenderTarget=new Re(this.width,this.height,{minFilter:te,magFilter:te,type:Ie,depthTexture:l,depthBuffer:!0}),this.prevRenderTarget=new Re(this.width,this.height,{minFilter:te,magFilter:te}),this.normalRenderTarget=new Re(this.width,this.height,{minFilter:te,magFilter:te,type:Ie}),this.metalnessRenderTarget=new Re(this.width,this.height,{minFilter:te,magFilter:te,type:Ie}),this.ssrRenderTarget=new Re(this.width,this.height,{minFilter:te,magFilter:te}),this.blurRenderTarget=this.ssrRenderTarget.clone(),this.blurRenderTarget2=this.ssrRenderTarget.clone(),this.ssrMaterial=new ie({defines:Object.assign({},rt.defines,{MAX_STEP:Math.sqrt(this.width*this.width+this.height*this.height)}),uniforms:he.clone(rt.uniforms),vertexShader:rt.vertexShader,fragmentShader:rt.fragmentShader,blending:X}),this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssrMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssrMaterial.defines.SELECTIVE=this.selective,this.ssrMaterial.needsUpdate=!0,this.ssrMaterial.uniforms.tMetalness.value=this.metalnessRenderTarget.texture,this.ssrMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssrMaterial.uniforms.cameraNear.value=this.camera.near,this.ssrMaterial.uniforms.cameraFar.value=this.camera.far,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.ssrMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new ds,this.normalMaterial.blending=X,this.metalnessOnMaterial=new Tt({color:"white"}),this.metalnessOffMaterial=new Tt({color:"black"}),this.blurMaterial=new ie({defines:Object.assign({},bt.defines),uniforms:he.clone(bt.uniforms),vertexShader:bt.vertexShader,fragmentShader:bt.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.blurMaterial2=new ie({defines:Object.assign({},bt.defines),uniforms:he.clone(bt.uniforms),vertexShader:bt.vertexShader,fragmentShader:bt.fragmentShader}),this.blurMaterial2.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.blurMaterial2.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new ie({defines:Object.assign({},vr.defines),uniforms:he.clone(vr.uniforms),vertexShader:vr.vertexShader,fragmentShader:vr.fragmentShader,blending:X}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new ie({uniforms:he.clone(at.uniforms),vertexShader:at.vertexShader,fragmentShader:at.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:Ks,blendDst:Js,blendEquation:Tn,blendSrcAlpha:Ks,blendDstAlpha:Js,blendEquationAlpha:Tn}),this.fsQuad=new qr(null),this.originalClearColor=new q}dispose(){this.beautyRenderTarget.dispose(),this.prevRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.metalnessRenderTarget.dispose(),this.ssrRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.blurRenderTarget2.dispose(),this.normalMaterial.dispose(),this.metalnessOnMaterial.dispose(),this.metalnessOffMaterial.dispose(),this.blurMaterial.dispose(),this.blurMaterial2.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(t,e){switch(t.setRenderTarget(this.beautyRenderTarget),t.clear(),this.groundReflector&&(this.groundReflector.visible=!1,this.groundReflector.doRender(this.renderer,this.scene,this.camera),this.groundReflector.visible=!0),t.render(this.scene,this.camera),this.groundReflector&&(this.groundReflector.visible=!1),this.renderOverride(t,this.normalMaterial,this.normalRenderTarget,0,0),this.selective&&this.renderMetalness(t,this.metalnessOnMaterial,this.metalnessRenderTarget,0,0),this.ssrMaterial.uniforms.opacity.value=this.opacity,this.ssrMaterial.uniforms.maxDistance.value=this.maxDistance,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.renderPass(t,this.ssrMaterial,this.ssrRenderTarget),this.blur&&(this.renderPass(t,this.blurMaterial,this.blurRenderTarget),this.renderPass(t,this.blurMaterial2,this.blurRenderTarget2)),this.output){case Vt.OUTPUT.Default:this.bouncing?(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=X,this.renderPass(t,this.copyMaterial,this.prevRenderTarget),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=yi,this.renderPass(t,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture,this.copyMaterial.blending=X,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e)):(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=X,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=yi,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e));break;case Vt.OUTPUT.SSR:this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=X,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e),this.bouncing&&(this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=X,this.renderPass(t,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=yi,this.renderPass(t,this.copyMaterial,this.prevRenderTarget));break;case Vt.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=X,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Vt.OUTPUT.Depth:this.renderPass(t,this.depthRenderMaterial,this.renderToScreen?null:e);break;case Vt.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=X,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;case Vt.OUTPUT.Metalness:this.copyMaterial.uniforms.tDiffuse.value=this.metalnessRenderTarget.texture,this.copyMaterial.blending=X,this.renderPass(t,this.copyMaterial,this.renderToScreen?null:e);break;default:console.warn("THREE.SSRPass: Unknown output type.")}}renderPass(t,e,n,r,i){this.originalClearColor.copy(t.getClearColor(this.tempColor));const s=t.getClearAlpha(this.tempColor),a=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,r!=null&&(t.setClearColor(r),t.setClearAlpha(i||0),t.clear()),this.fsQuad.material=e,this.fsQuad.render(t),t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}renderOverride(t,e,n,r,i){this.originalClearColor.copy(t.getClearColor(this.tempColor));const s=t.getClearAlpha(this.tempColor),a=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,r=e.clearColor||r,i=e.clearAlpha||i,r!=null&&(t.setClearColor(r),t.setClearAlpha(i||0),t.clear()),this.scene.overrideMaterial=e,t.render(this.scene,this.camera),this.scene.overrideMaterial=null,t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}renderMetalness(t,e,n,r,i){this.originalClearColor.copy(t.getClearColor(this.tempColor));const s=t.getClearAlpha(this.tempColor),a=t.autoClear;t.setRenderTarget(n),t.autoClear=!1,r=e.clearColor||r,i=e.clearAlpha||i,r!=null&&(t.setClearColor(r),t.setClearAlpha(i||0),t.clear()),this.scene.traverseVisible(o=>{o._SSRPassBackupMaterial=o.material,this._selects.includes(o)?o.material=this.metalnessOnMaterial:o.material=this.metalnessOffMaterial}),t.render(this.scene,this.camera),this.scene.traverseVisible(o=>{o.material=o._SSRPassBackupMaterial}),t.autoClear=a,t.setClearColor(this.originalClearColor),t.setClearAlpha(s)}setSize(t,e){this.width=t,this.height=e,this.ssrMaterial.defines.MAX_STEP=Math.sqrt(t*t+e*e),this.ssrMaterial.needsUpdate=!0,this.beautyRenderTarget.setSize(t,e),this.prevRenderTarget.setSize(t,e),this.ssrRenderTarget.setSize(t,e),this.normalRenderTarget.setSize(t,e),this.metalnessRenderTarget.setSize(t,e),this.blurRenderTarget.setSize(t,e),this.blurRenderTarget2.setSize(t,e),this.ssrMaterial.uniforms.resolution.value.set(t,e),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(t,e),this.blurMaterial2.uniforms.resolution.value.set(t,e)}};let iu=Vt;x(iu,"OUTPUT",{Default:0,SSR:1,Beauty:3,Depth:4,Normal:5,Metalness:7});class Sv extends Yr{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new cu(n)}),this.register(function(n){return new gu(n)}),this.register(function(n){return new Tu(n)}),this.register(function(n){return new vu(n)}),this.register(function(n){return new hu(n)}),this.register(function(n){return new fu(n)}),this.register(function(n){return new du(n)}),this.register(function(n){return new pu(n)}),this.register(function(n){return new lu(n)}),this.register(function(n){return new mu(n)}),this.register(function(n){return new uu(n)}),this.register(function(n){return new Au(n)}),this.register(function(n){return new au(n)}),this.register(function(n){return new Cu(n)}),this.register(function(n){return new Eu(n)})}load(e,n,r,i){const s=this;let a;this.resourcePath!==""?a=this.resourcePath:this.path!==""?a=this.path:a=$t.extractUrlBase(e),this.manager.itemStart(e);const o=function(c){i?i(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new st(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,a,function(u){n(u),s.manager.itemEnd(e)},o)}catch(u){o(u)}},r,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,r,i){let s;const a={},o={};if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if($t.decodeText(new Uint8Array(e.slice(0,4)))===Go){try{a[J.KHR_BINARY_GLTF]=new Ru(e)}catch(u){i&&i(u);return}s=JSON.parse(a[J.KHR_BINARY_GLTF].content)}else s=JSON.parse($t.decodeText(new Uint8Array(e)));else s=e;if(s.asset===void 0||s.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new Du(s,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const u=this.pluginCallbacks[c](l);o[u.name]=u,a[u.name]=!0}if(s.extensionsUsed)for(let c=0;c<s.extensionsUsed.length;++c){const u=s.extensionsUsed[c],h=s.extensionsRequired||[];switch(u){case J.KHR_MATERIALS_UNLIT:a[u]=new ou;break;case J.KHR_DRACO_MESH_COMPRESSION:a[u]=new Bu(s,this.dracoLoader);break;case J.KHR_TEXTURE_TRANSFORM:a[u]=new yu;break;case J.KHR_MESH_QUANTIZATION:a[u]=new Su;break;default:h.indexOf(u)>=0&&o[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(a),l.setPlugins(o),l.parse(r,i)}parseAsync(e,n){const r=this;return new Promise(function(i,s){r.parse(e,n,i,s)})}}function su(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const J={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class au{constructor(e){this.parser=e,this.name=J.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let r=0,i=n.length;r<i;r++){const s=n[r];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const n=this.parser,r="light:"+e;let i=n.cache.get(r);if(i)return i;const s=n.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const u=new q(16777215);l.color!==void 0&&u.fromArray(l.color);const h=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new tc(u),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new ec(u),c.distance=h;break;case"spot":c=new ql(u),c.distance=h,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,_t(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=n.createUniqueName(l.name||"light_"+e),i=Promise.resolve(c),n.cache.add(r,i),i}getDependency(e,n){if(e==="light")return this._loadLight(n)}createNodeAttachment(e){const n=this,r=this.parser,s=r.json.nodes[e],o=(s.extensions&&s.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(l){return r._getNodeRef(n.cache,o,l)})}}class ou{constructor(){this.name=J.KHR_MATERIALS_UNLIT}getMaterialType(){return Tt}extendParams(e,n,r){const i=[];e.color=new q(1,1,1),e.opacity=1;const s=n.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const a=s.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}s.baseColorTexture!==void 0&&i.push(r.assignTexture(e,"map",s.baseColorTexture,3001))}return Promise.all(i)}}class lu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,n){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(n.emissiveIntensity=s),Promise.resolve()}}class cu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nt}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];if(a.clearcoatFactor!==void 0&&(n.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&s.push(r.assignTexture(n,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&s.push(r.assignTexture(n,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(s.push(r.assignTexture(n,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new K(o,o)}return Promise.all(s)}}class uu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nt}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.iridescenceFactor!==void 0&&(n.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&s.push(r.assignTexture(n,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(n.iridescenceIOR=a.iridescenceIor),n.iridescenceThicknessRange===void 0&&(n.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(n.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(n.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&s.push(r.assignTexture(n,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(s)}}class hu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_SHEEN}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nt}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];n.sheenColor=new q(0,0,0),n.sheenRoughness=0,n.sheen=1;const a=i.extensions[this.name];return a.sheenColorFactor!==void 0&&n.sheenColor.fromArray(a.sheenColorFactor),a.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&s.push(r.assignTexture(n,"sheenColorMap",a.sheenColorTexture,3001)),a.sheenRoughnessTexture!==void 0&&s.push(r.assignTexture(n,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(s)}}class fu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nt}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.transmissionFactor!==void 0&&(n.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&s.push(r.assignTexture(n,"transmissionMap",a.transmissionTexture)),Promise.all(s)}}class du{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_VOLUME}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nt}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];n.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&s.push(r.assignTexture(n,"thicknessMap",a.thicknessTexture)),n.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return n.attenuationColor=new q(o[0],o[1],o[2]),Promise.all(s)}}class pu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_IOR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nt}extendMaterialParams(e,n){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return n.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class mu{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_SPECULAR}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nt}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];n.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&s.push(r.assignTexture(n,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return n.specularColor=new q(o[0],o[1],o[2]),a.specularColorTexture!==void 0&&s.push(r.assignTexture(n,"specularColorMap",a.specularColorTexture,3001)),Promise.all(s)}}class Au{constructor(e){this.parser=e,this.name=J.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const r=this.parser.json.materials[e];return!r.extensions||!r.extensions[this.name]?null:Nt}extendMaterialParams(e,n){const r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],a=i.extensions[this.name];return a.anisotropyStrength!==void 0&&(n.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(n.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&s.push(r.assignTexture(n,"anisotropyMap",a.anisotropyTexture)),Promise.all(s)}}class gu{constructor(e){this.parser=e,this.name=J.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],a=n.options.ktx2Loader;if(!a){if(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,s.source,a)}}class Tu{constructor(e){this.parser=e,this.name=J.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,r=this.parser,i=r.json,s=i.textures[e];if(!s.extensions||!s.extensions[n])return null;const a=s.extensions[n],o=i.images[a.source];let l=r.textureLoader;if(o.uri){const c=r.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(e,a.source,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class vu{constructor(e){this.parser=e,this.name=J.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const n=this.name,r=this.parser,i=r.json,s=i.textures[e];if(!s.extensions||!s.extensions[n])return null;const a=s.extensions[n],o=i.images[a.source];let l=r.textureLoader;if(o.uri){const c=r.options.manager.getHandler(o.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return r.loadTextureImage(e,a.source,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class Cu{constructor(e){this.name=J.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,r=n.bufferViews[e];if(r.extensions&&r.extensions[this.name]){const i=r.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(o){const l=i.byteOffset||0,c=i.byteLength||0,u=i.count,h=i.byteStride,f=new Uint8Array(o,l,c);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(u,h,f,i.mode,i.filter).then(function(T){return T.buffer}):a.ready.then(function(){const T=new ArrayBuffer(u*h);return a.decodeGltfBuffer(new Uint8Array(T),u,h,f,i.mode,i.filter),T})})}else return null}}class Eu{constructor(e){this.name=J.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const n=this.parser.json,r=n.nodes[e];if(!r.extensions||!r.extensions[this.name]||r.mesh===void 0)return null;const i=n.meshes[r.mesh];for(const c of i.primitives)if(c.mode!==He.TRIANGLES&&c.mode!==He.TRIANGLE_STRIP&&c.mode!==He.TRIANGLE_FAN&&c.mode!==void 0)return null;const a=r.extensions[this.name].attributes,o=[],l={};for(const c in a)o.push(this.parser.getDependency("accessor",a[c]).then(u=>(l[c]=u,l[c])));return o.length<1?null:(o.push(this.parser.createNodeMesh(e)),Promise.all(o).then(c=>{const u=c.pop(),h=u.isGroup?u.children:[u],f=c[0].count,T=[];for(const g of h){const d=new se,A=new P,v=new Zn,m=new P(1,1,1),p=new nc(g.geometry,g.material,f);for(let C=0;C<f;C++)l.TRANSLATION&&A.fromBufferAttribute(l.TRANSLATION,C),l.ROTATION&&v.fromBufferAttribute(l.ROTATION,C),l.SCALE&&m.fromBufferAttribute(l.SCALE,C),p.setMatrixAt(C,d.compose(A,v,m));for(const C in l)C!=="TRANSLATION"&&C!=="ROTATION"&&C!=="SCALE"&&g.geometry.setAttribute(C,l[C]);no.prototype.copy.call(p,g),this.parser.assignFinalMaterial(p),T.push(p)}return u.isGroup?(u.clear(),u.add(...T),u):T[0]}))}}const Go="glTF",Fn=12,Xs={JSON:1313821514,BIN:5130562};class Ru{constructor(e){this.name=J.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,Fn);if(this.header={magic:$t.decodeText(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==Go)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-Fn,i=new DataView(e,Fn);let s=0;for(;s<r;){const a=i.getUint32(s,!0);s+=4;const o=i.getUint32(s,!0);if(s+=4,o===Xs.JSON){const l=new Uint8Array(e,Fn+s,a);this.content=$t.decodeText(l)}else if(o===Xs.BIN){const l=Fn+s;this.body=e.slice(l,l+a)}s+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Bu{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=J.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const r=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},l={},c={};for(const u in a){const h=zi[u]||u.toLowerCase();o[h]=a[u]}for(const u in e.attributes){const h=zi[u]||u.toLowerCase();if(a[u]!==void 0){const f=r.accessors[e.attributes[u]],T=pn[f.componentType];c[h]=T.name,l[h]=f.normalized===!0}}return n.getDependency("bufferView",s).then(function(u){return new Promise(function(h){i.decodeDracoFile(u,function(f){for(const T in f.attributes){const g=f.attributes[T],d=l[T];d!==void 0&&(g.normalized=d)}h(f)},o,c)})})}}class yu{constructor(){this.name=J.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return(n.texCoord===void 0||n.texCoord===e.channel)&&n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.texCoord!==void 0&&(e.channel=n.texCoord),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class Su{constructor(){this.name=J.KHR_MESH_QUANTIZATION}}class ko extends Uc{constructor(e,n,r,i){super(e,n,r,i)}copySampleValue_(e){const n=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let a=0;a!==i;a++)n[a]=r[s+a];return n}interpolate_(e,n,r,i){const s=this.resultBuffer,a=this.sampleValues,o=this.valueSize,l=o*2,c=o*3,u=i-n,h=(r-n)/u,f=h*h,T=f*h,g=e*c,d=g-c,A=-2*T+3*f,v=T-f,m=1-A,p=v-f+h;for(let C=0;C!==o;C++){const B=a[d+C+o],S=a[d+C+l]*u,y=a[g+C+o],R=a[g+C]*u;s[C]=m*B+p*S+A*y+v*R}return s}}const xu=new Zn;class Mu extends ko{interpolate_(e,n,r,i){const s=super.interpolate_(e,n,r,i);return xu.fromArray(s).normalize().toArray(s),s}}const He={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},pn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Qs={9728:te,9729:gn,9984:Rc,9985:Bc,9986:yc,9987:zr},Ys={33071:Qt,33648:Sc,10497:Zt},xi={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},zi={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...rr.replace(/\D+/g,"")>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Pt={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Iu={CUBICSPLINE:void 0,LINEAR:so,STEP:xc},Mi={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function bu(t){return t.DefaultMaterial===void 0&&(t.DefaultMaterial=new ro({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Mc})),t.DefaultMaterial}function Jt(t,e,n){for(const r in n.extensions)t[r]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[r]=n.extensions[r])}function _t(t,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Pu(t,e,n){let r=!1,i=!1,s=!1;for(let c=0,u=e.length;c<u;c++){const h=e[c];if(h.POSITION!==void 0&&(r=!0),h.NORMAL!==void 0&&(i=!0),h.COLOR_0!==void 0&&(s=!0),r&&i&&s)break}if(!r&&!i&&!s)return Promise.resolve(t);const a=[],o=[],l=[];for(let c=0,u=e.length;c<u;c++){const h=e[c];if(r){const f=h.POSITION!==void 0?n.getDependency("accessor",h.POSITION):t.attributes.position;a.push(f)}if(i){const f=h.NORMAL!==void 0?n.getDependency("accessor",h.NORMAL):t.attributes.normal;o.push(f)}if(s){const f=h.COLOR_0!==void 0?n.getDependency("accessor",h.COLOR_0):t.attributes.color;l.push(f)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(l)]).then(function(c){const u=c[0],h=c[1],f=c[2];return r&&(t.morphAttributes.position=u),i&&(t.morphAttributes.normal=h),s&&(t.morphAttributes.color=f),t.morphTargetsRelative=!0,t})}function _u(t,e){if(t.updateMorphTargets(),e.weights!==void 0)for(let n=0,r=e.weights.length;n<r;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let r=0,i=n.length;r<i;r++)t.morphTargetDictionary[n[r]]=r}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function wu(t){let e;const n=t.extensions&&t.extensions[J.KHR_DRACO_MESH_COMPRESSION];if(n?e="draco:"+n.bufferView+":"+n.indices+":"+Ii(n.attributes):e=t.indices+":"+Ii(t.attributes)+":"+t.mode,t.targets!==void 0)for(let r=0,i=t.targets.length;r<i;r++)e+=":"+Ii(t.targets[r]);return e}function Ii(t){let e="";const n=Object.keys(t).sort();for(let r=0,i=n.length;r<i;r++)e+=n[r]+":"+t[n[r]]+";";return e}function $i(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Ou(t){return t.search(/\.jpe?g($|\?)/i)>0||t.search(/^data\:image\/jpeg/)===0?"image/jpeg":t.search(/\.webp($|\?)/i)>0||t.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}const Fu=new se;class Du{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new su,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,i=!1,s=-1;typeof navigator<"u"&&typeof navigator.userAgent<"u"&&(r=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,i=navigator.userAgent.indexOf("Firefox")>-1,s=i?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),typeof createImageBitmap>"u"||r||i&&s<98?this.textureLoader=new rc(this.options.manager):this.textureLoader=new ic(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new st(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const r=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(a){const o={scene:a[0][i.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:i.asset,parser:r,userData:{}};Jt(s,o,i),_t(o,i),Promise.all(r._invokeAll(function(l){return l.afterRoot&&l.afterRoot(o)})).then(function(){e(o)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],r=this.json.meshes||[];for(let i=0,s=n.length;i<s;i++){const a=n[i].joints;for(let o=0,l=a.length;o<l;o++)e[a[o]].isBone=!0}for(let i=0,s=e.length;i<s;i++){const a=e[i];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(r[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,r){if(e.refs[n]<=1)return r;const i=r.clone(),s=(a,o)=>{const l=this.associations.get(a);l!=null&&this.associations.set(o,l);for(const[c,u]of a.children.entries())s(u,o.children[c])};return s(r,i),i.name+="_instance_"+e.uses[n]++,i}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let r=0;r<n.length;r++){const i=e(n[r]);if(i)return i}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const r=[];for(let i=0;i<n.length;i++){const s=e(n[i]);s&&r.push(s)}return r}getDependency(e,n){const r=e+":"+n;let i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(n);break;case"node":i=this._invokeOne(function(s){return s.loadNode&&s.loadNode(n)});break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(n)});break;case"accessor":i=this.loadAccessor(n);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(n)});break;case"buffer":i=this.loadBuffer(n);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(n)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(n)});break;case"skin":i=this.loadSkin(n);break;case"animation":i=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(n)});break;case"camera":i=this.loadCamera(n);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,n)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(r,i)}return i}getDependencies(e){let n=this.cache.get(e);if(!n){const r=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(i.map(function(s,a){return r.getDependency(e,a)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],r=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[J.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(s,a){r.load($t.resolveURL(n.uri,i.path),s,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(r){const i=n.byteLength||0,s=n.byteOffset||0;return r.slice(s,s+i)})}loadAccessor(e){const n=this,r=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const a=xi[i.type],o=pn[i.componentType],l=i.normalized===!0,c=new o(i.count*a);return Promise.resolve(new Wn(c,a,l))}const s=[];return i.bufferView!==void 0?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),i.sparse!==void 0&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(a){const o=a[0],l=xi[i.type],c=pn[i.componentType],u=c.BYTES_PER_ELEMENT,h=u*l,f=i.byteOffset||0,T=i.bufferView!==void 0?r.bufferViews[i.bufferView].byteStride:void 0,g=i.normalized===!0;let d,A;if(T&&T!==h){const v=Math.floor(f/T),m="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+v+":"+i.count;let p=n.cache.get(m);p||(d=new c(o,v*T,i.count*T/u),p=new sc(d,T/u),n.cache.add(m,p)),A=new Ic(p,l,f%T/u,g)}else o===null?d=new c(i.count*l):d=new c(o,f,i.count*l),A=new Wn(d,l,g);if(i.sparse!==void 0){const v=xi.SCALAR,m=pn[i.sparse.indices.componentType],p=i.sparse.indices.byteOffset||0,C=i.sparse.values.byteOffset||0,B=new m(a[1],p,i.sparse.count*v),S=new c(a[2],C,i.sparse.count*l);o!==null&&(A=new Wn(A.array.slice(),A.itemSize,A.normalized));for(let y=0,R=B.length;y<R;y++){const M=B[y];if(A.setX(M,S[y*l]),l>=2&&A.setY(M,S[y*l+1]),l>=3&&A.setZ(M,S[y*l+2]),l>=4&&A.setW(M,S[y*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return A})}loadTexture(e){const n=this.json,r=this.options,s=n.textures[e].source,a=n.images[s];let o=this.textureLoader;if(a.uri){const l=r.manager.getHandler(a.uri);l!==null&&(o=l)}return this.loadTextureImage(e,s,o)}loadTextureImage(e,n,r){const i=this,s=this.json,a=s.textures[e],o=s.images[n],l=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(n,r).then(function(u){u.flipY=!1,u.name=a.name||o.name||"",u.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(u.name=o.uri);const f=(s.samplers||{})[a.sampler]||{};return u.magFilter=Qs[f.magFilter]||gn,u.minFilter=Qs[f.minFilter]||zr,u.wrapS=Ys[f.wrapS]||Zt,u.wrapT=Ys[f.wrapT]||Zt,i.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,n){const r=this,i=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const a=i.images[e],o=self.URL||self.webkitURL;let l=a.uri||"",c=!1;if(a.bufferView!==void 0)l=r.getDependency("bufferView",a.bufferView).then(function(h){c=!0;const f=new Blob([h],{type:a.mimeType});return l=o.createObjectURL(f),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(l).then(function(h){return new Promise(function(f,T){let g=f;n.isImageBitmapLoader===!0&&(g=function(d){const A=new Wi(d);A.needsUpdate=!0,f(A)}),n.load($t.resolveURL(h,s.path),g,void 0,T)})}).then(function(h){return c===!0&&o.revokeObjectURL(l),h.userData.mimeType=a.mimeType||Ou(a.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),h});return this.sourceCache[e]=u,u}assignTexture(e,n,r,i){const s=this;return this.getDependency("texture",r.index).then(function(a){if(!a)return null;if(r.texCoord!==void 0&&r.texCoord>0&&(a=a.clone(),a.channel=r.texCoord),s.extensions[J.KHR_TEXTURE_TRANSFORM]){const o=r.extensions!==void 0?r.extensions[J.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const l=s.associations.get(a);a=s.extensions[J.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),s.associations.set(a,l)}}return i!==void 0&&("colorSpace"in a?a.colorSpace=i===3001?"srgb":"srgb-linear":a.encoding=i),e[n]=a,a})}assignFinalMaterial(e){const n=e.geometry;let r=e.material;const i=n.attributes.tangent===void 0,s=n.attributes.color!==void 0,a=n.attributes.normal===void 0;if(e.isPoints){const o="PointsMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new ac,Ci.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,l.sizeAttenuation=!1,this.cache.add(o,l)),r=l}else if(e.isLine){const o="LineBasicMaterial:"+r.uuid;let l=this.cache.get(o);l||(l=new oc,Ci.prototype.copy.call(l,r),l.color.copy(r.color),l.map=r.map,this.cache.add(o,l)),r=l}if(i||s||a){let o="ClonedMaterial:"+r.uuid+":";i&&(o+="derivative-tangents:"),s&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let l=this.cache.get(o);l||(l=r.clone(),s&&(l.vertexColors=!0),a&&(l.flatShading=!0),i&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(o,l),this.associations.set(l,this.associations.get(r))),r=l}e.material=r}getMaterialType(){return ro}loadMaterial(e){const n=this,r=this.json,i=this.extensions,s=r.materials[e];let a;const o={},l=s.extensions||{},c=[];if(l[J.KHR_MATERIALS_UNLIT]){const h=i[J.KHR_MATERIALS_UNLIT];a=h.getMaterialType(),c.push(h.extendParams(o,s,n))}else{const h=s.pbrMetallicRoughness||{};if(o.color=new q(1,1,1),o.opacity=1,Array.isArray(h.baseColorFactor)){const f=h.baseColorFactor;o.color.fromArray(f),o.opacity=f[3]}h.baseColorTexture!==void 0&&c.push(n.assignTexture(o,"map",h.baseColorTexture,3001)),o.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,o.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(c.push(n.assignTexture(o,"metalnessMap",h.metallicRoughnessTexture)),c.push(n.assignTexture(o,"roughnessMap",h.metallicRoughnessTexture))),a=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,o)})))}s.doubleSided===!0&&(o.side=lc);const u=s.alphaMode||Mi.OPAQUE;if(u===Mi.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,u===Mi.MASK&&(o.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&a!==Tt&&(c.push(n.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new K(1,1),s.normalTexture.scale!==void 0)){const h=s.normalTexture.scale;o.normalScale.set(h,h)}return s.occlusionTexture!==void 0&&a!==Tt&&(c.push(n.assignTexture(o,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&a!==Tt&&(o.emissive=new q().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&a!==Tt&&c.push(n.assignTexture(o,"emissiveMap",s.emissiveTexture,3001)),Promise.all(c).then(function(){const h=new a(o);return s.name&&(h.name=s.name),_t(h,s),n.associations.set(h,{materials:e}),s.extensions&&Jt(i,h,s),h})}createUniqueName(e){const n=cc.sanitizeNodeName(e||"");return n in this.nodeNamesUsed?n+"_"+ ++this.nodeNamesUsed[n]:(this.nodeNamesUsed[n]=0,n)}loadGeometries(e){const n=this,r=this.extensions,i=this.primitiveCache;function s(o){return r[J.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,n).then(function(l){return zs(l,o,n)})}const a=[];for(let o=0,l=e.length;o<l;o++){const c=e[o],u=wu(c),h=i[u];if(h)a.push(h.promise);else{let f;c.extensions&&c.extensions[J.KHR_DRACO_MESH_COMPRESSION]?f=s(c):f=zs(new yn,c,n),i[u]={primitive:c,promise:f},a.push(f)}}return Promise.all(a)}loadMesh(e){const n=this,r=this.json,i=this.extensions,s=r.meshes[e],a=s.primitives,o=[];for(let l=0,c=a.length;l<c;l++){const u=a[l].material===void 0?bu(this.cache):this.getDependency("material",a[l].material);o.push(u)}return o.push(n.loadGeometries(a)),Promise.all(o).then(function(l){const c=l.slice(0,l.length-1),u=l[l.length-1],h=[];for(let T=0,g=u.length;T<g;T++){const d=u[T],A=a[T];let v;const m=c[T];if(A.mode===He.TRIANGLES||A.mode===He.TRIANGLE_STRIP||A.mode===He.TRIANGLE_FAN||A.mode===void 0)v=s.isSkinnedMesh===!0?new uc(d,m):new Ke(d,m),v.isSkinnedMesh===!0&&v.normalizeSkinWeights(),A.mode===He.TRIANGLE_STRIP?v.geometry=Ws(v.geometry,Ao):A.mode===He.TRIANGLE_FAN&&(v.geometry=Ws(v.geometry,Ji));else if(A.mode===He.LINES)v=new hc(d,m);else if(A.mode===He.LINE_STRIP)v=new fc(d,m);else if(A.mode===He.LINE_LOOP)v=new dc(d,m);else if(A.mode===He.POINTS)v=new io(d,m);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+A.mode);Object.keys(v.geometry.morphAttributes).length>0&&_u(v,s),v.name=n.createUniqueName(s.name||"mesh_"+e),_t(v,s),A.extensions&&Jt(i,v,A),n.assignFinalMaterial(v),h.push(v)}for(let T=0,g=h.length;T<g;T++)n.associations.set(h[T],{meshes:e,primitives:T});if(h.length===1)return s.extensions&&Jt(i,h[0],s),h[0];const f=new Ei;s.extensions&&Jt(i,f,s),n.associations.set(f,{meshes:e});for(let T=0,g=h.length;T<g;T++)f.add(h[T]);return f})}loadCamera(e){let n;const r=this.json.cameras[e],i=r[r.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return r.type==="perspective"?n=new zt(Vn.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):r.type==="orthographic"&&(n=new jn(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(n.name=this.createUniqueName(r.name)),_t(n,r),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],r=[];for(let i=0,s=n.joints.length;i<s;i++)r.push(this._loadNodeShallow(n.joints[i]));return n.inverseBindMatrices!==void 0?r.push(this.getDependency("accessor",n.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(i){const s=i.pop(),a=i,o=[],l=[];for(let c=0,u=a.length;c<u;c++){const h=a[c];if(h){o.push(h);const f=new se;s!==null&&f.fromArray(s.array,c*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',n.joints[c])}return new pc(o,l)})}loadAnimation(e){const r=this.json.animations[e],i=r.name?r.name:"animation_"+e,s=[],a=[],o=[],l=[],c=[];for(let u=0,h=r.channels.length;u<h;u++){const f=r.channels[u],T=r.samplers[f.sampler],g=f.target,d=g.node,A=r.parameters!==void 0?r.parameters[T.input]:T.input,v=r.parameters!==void 0?r.parameters[T.output]:T.output;g.node!==void 0&&(s.push(this.getDependency("node",d)),a.push(this.getDependency("accessor",A)),o.push(this.getDependency("accessor",v)),l.push(T),c.push(g))}return Promise.all([Promise.all(s),Promise.all(a),Promise.all(o),Promise.all(l),Promise.all(c)]).then(function(u){const h=u[0],f=u[1],T=u[2],g=u[3],d=u[4],A=[];for(let v=0,m=h.length;v<m;v++){const p=h[v],C=f[v],B=T[v],S=g[v],y=d[v];if(p===void 0)continue;p.updateMatrix();let R;switch(Pt[y.path]){case Pt.weights:R=Pc;break;case Pt.rotation:R=Hs;break;case Pt.position:case Pt.scale:default:R=bc;break}const M=p.name?p.name:p.uuid,I=S.interpolation!==void 0?Iu[S.interpolation]:so,b=[];Pt[y.path]===Pt.weights?p.traverse(function(w){w.morphTargetInfluences&&b.push(w.name?w.name:w.uuid)}):b.push(M);let O=B.array;if(B.normalized){const w=$i(O.constructor),k=new Float32Array(O.length);for(let U=0,H=O.length;U<H;U++)k[U]=O[U]*w;O=k}for(let w=0,k=b.length;w<k;w++){const U=new R(b[w]+"."+Pt[y.path],C.array,O,I);S.interpolation==="CUBICSPLINE"&&(U.createInterpolant=function(j){const ne=this instanceof Hs?Mu:ko;return new ne(this.times,this.values,this.getValueSize()/3,j)},U.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),A.push(U)}}return new mc(i,void 0,A)})}createNodeMesh(e){const n=this.json,r=this,i=n.nodes[e];return i.mesh===void 0?null:r.getDependency("mesh",i.mesh).then(function(s){const a=r._getNodeRef(r.meshCache,i.mesh,s);return i.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let l=0,c=i.weights.length;l<c;l++)o.morphTargetInfluences[l]=i.weights[l]}),a})}loadNode(e){const n=this.json,r=this,i=n.nodes[e],s=r._loadNodeShallow(e),a=[],o=i.children||[];for(let c=0,u=o.length;c<u;c++)a.push(r.getDependency("node",o[c]));const l=i.skin===void 0?Promise.resolve(null):r.getDependency("skin",i.skin);return Promise.all([s,Promise.all(a),l]).then(function(c){const u=c[0],h=c[1],f=c[2];f!==null&&u.traverse(function(T){T.isSkinnedMesh&&T.bind(f,Fu)});for(let T=0,g=h.length;T<g;T++)u.add(h[T]);return u})}_loadNodeShallow(e){const n=this.json,r=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=n.nodes[e],a=s.name?i.createUniqueName(s.name):"",o=[],l=i._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&o.push(l),s.camera!==void 0&&o.push(i.getDependency("camera",s.camera).then(function(c){return i._getNodeRef(i.cameraCache,s.camera,c)})),i._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){o.push(c)}),this.nodeCache[e]=Promise.all(o).then(function(c){let u;if(s.isBone===!0?u=new Ac:c.length>1?u=new Ei:c.length===1?u=c[0]:u=new no,u!==c[0])for(let h=0,f=c.length;h<f;h++)u.add(c[h]);if(s.name&&(u.userData.name=s.name,u.name=a),_t(u,s),s.extensions&&Jt(r,u,s),s.matrix!==void 0){const h=new se;h.fromArray(s.matrix),u.applyMatrix4(h)}else s.translation!==void 0&&u.position.fromArray(s.translation),s.rotation!==void 0&&u.quaternion.fromArray(s.rotation),s.scale!==void 0&&u.scale.fromArray(s.scale);return i.associations.has(u)||i.associations.set(u,{}),i.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const n=this.extensions,r=this.json.scenes[e],i=this,s=new Ei;r.name&&(s.name=i.createUniqueName(r.name)),_t(s,r),r.extensions&&Jt(n,s,r);const a=r.nodes||[],o=[];for(let l=0,c=a.length;l<c;l++)o.push(i.getDependency("node",a[l]));return Promise.all(o).then(function(l){for(let u=0,h=l.length;u<h;u++)s.add(l[u]);const c=u=>{const h=new Map;for(const[f,T]of i.associations)(f instanceof Ci||f instanceof Wi)&&h.set(f,T);return u.traverse(f=>{const T=i.associations.get(f);T!=null&&h.set(f,T)}),h};return i.associations=c(s),s})}}function Nu(t,e,n){const r=e.attributes,i=new _c;if(r.POSITION!==void 0){const o=n.json.accessors[r.POSITION],l=o.min,c=o.max;if(l!==void 0&&c!==void 0){if(i.set(new P(l[0],l[1],l[2]),new P(c[0],c[1],c[2])),o.normalized){const u=$i(pn[o.componentType]);i.min.multiplyScalar(u),i.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const o=new P,l=new P;for(let c=0,u=s.length;c<u;c++){const h=s[c];if(h.POSITION!==void 0){const f=n.json.accessors[h.POSITION],T=f.min,g=f.max;if(T!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(T[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(T[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(T[2]),Math.abs(g[2]))),f.normalized){const d=$i(pn[f.componentType]);l.multiplyScalar(d)}o.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(o)}t.boundingBox=i;const a=new wc;i.getCenter(a.center),a.radius=i.min.distanceTo(i.max)/2,t.boundingSphere=a}function zs(t,e,n){const r=e.attributes,i=[];function s(a,o){return n.getDependency("accessor",a).then(function(l){t.setAttribute(o,l)})}for(const a in r){const o=zi[a]||a.toLowerCase();o in t.attributes||i.push(s(r[a],o))}if(e.indices!==void 0&&!t.index){const a=n.getDependency("accessor",e.indices).then(function(o){t.setIndex(o)});i.push(a)}return _t(t,e),Nu(t,e,n),Promise.all(i).then(function(){return e.targets!==void 0?Pu(t,e.targets,n):t})}const Zi=class{static createButton(t,e={}){const n=document.createElement("button");function r(){let o=null;async function l(u){u.addEventListener("end",c),await t.xr.setSession(u),n.textContent="EXIT VR",o=u}function c(){o.removeEventListener("end",c),n.textContent="ENTER VR",o=null}n.style.display="",n.style.cursor="pointer",n.style.left="calc(50% - 50px)",n.style.width="100px",n.textContent="ENTER VR",n.onmouseenter=()=>{n.style.opacity="1.0"},n.onmouseleave=()=>{n.style.opacity="0.5"},n.onclick=()=>{var u;if(o===null){const h=[e.optionalFeatures,"local-floor","bounded-floor","hand-tracking"].flat().filter(Boolean);(u=navigator.xr)==null||u.requestSession("immersive-vr",{...e,optionalFeatures:h}).then(l)}else o.end()}}function i(){n.style.display="",n.style.cursor="auto",n.style.left="calc(50% - 75px)",n.style.width="150px",n.onmouseenter=null,n.onmouseleave=null,n.onclick=null}function s(){i(),n.textContent="VR NOT SUPPORTED"}function a(o){o.style.position="absolute",o.style.bottom="20px",o.style.padding="12px 6px",o.style.border="1px solid #fff",o.style.borderRadius="4px",o.style.background="rgba(0,0,0,0.1)",o.style.color="#fff",o.style.font="normal 13px sans-serif",o.style.textAlign="center",o.style.opacity="0.5",o.style.outline="none",o.style.zIndex="999"}if("xr"in navigator)return a(n),n.id="VRButton",n.style.display="none",navigator.xr.isSessionSupported("immersive-vr").then(o=>{o?r():s(),o&&Zi.xrSessionIsGranted&&n.click()}),n;{const o=document.createElement("a");return window.isSecureContext===!1?(o.href=document.location.href.replace(/^http:/,"https:"),o.innerHTML="WEBXR NEEDS HTTPS"):(o.href="https://immersiveweb.dev/",o.innerHTML="WEBXR NOT AVAILABLE"),o.style.left="calc(50% - 90px)",o.style.width="180px",o.style.textDecoration="none",a(o),o}}static registerSessionGrantedListener(){"xr"in navigator&&navigator.xr.addEventListener("sessiongranted",()=>{Zi.xrSessionIsGranted=!0})}};let Lu=Zi;x(Lu,"xrSessionIsGranted",!1);class xv extends yn{constructor(e,n,r,i){super();const s=[],a=[],o=[],l=new P,c=new se;c.makeRotationFromEuler(r),c.setPosition(n);const u=new se;u.copy(c).invert(),h(),this.setAttribute("position",new Xn(s,3)),this.setAttribute("normal",new Xn(a,3)),this.setAttribute("uv",new Xn(o,2));function h(){let d,A=[];const v=new P,m=new P;if(e.geometry.isGeometry===!0){console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");return}const p=e.geometry,C=p.attributes.position,B=p.attributes.normal;if(p.index!==null){const S=p.index;for(d=0;d<S.count;d++)v.fromBufferAttribute(C,S.getX(d)),m.fromBufferAttribute(B,S.getX(d)),f(A,v,m)}else for(d=0;d<C.count;d++)v.fromBufferAttribute(C,d),m.fromBufferAttribute(B,d),f(A,v,m);for(A=T(A,l.set(1,0,0)),A=T(A,l.set(-1,0,0)),A=T(A,l.set(0,1,0)),A=T(A,l.set(0,-1,0)),A=T(A,l.set(0,0,1)),A=T(A,l.set(0,0,-1)),d=0;d<A.length;d++){const S=A[d];o.push(.5+S.position.x/i.x,.5+S.position.y/i.y),S.position.applyMatrix4(c),s.push(S.position.x,S.position.y,S.position.z),a.push(S.normal.x,S.normal.y,S.normal.z)}}function f(d,A,v){A.applyMatrix4(e.matrixWorld),A.applyMatrix4(u),v.transformDirection(e.matrixWorld),d.push(new $s(A.clone(),v.clone()))}function T(d,A){const v=[],m=.5*Math.abs(i.dot(A));for(let p=0;p<d.length;p+=3){let C,B,S,y=0,R,M,I,b;const O=d[p+0].position.dot(A)-m,w=d[p+1].position.dot(A)-m,k=d[p+2].position.dot(A)-m;switch(C=O>0,B=w>0,S=k>0,y=(C?1:0)+(B?1:0)+(S?1:0),y){case 0:{v.push(d[p]),v.push(d[p+1]),v.push(d[p+2]);break}case 1:{if(C&&(R=d[p+1],M=d[p+2],I=g(d[p],R,A,m),b=g(d[p],M,A,m)),B){R=d[p],M=d[p+2],I=g(d[p+1],R,A,m),b=g(d[p+1],M,A,m),v.push(I),v.push(M.clone()),v.push(R.clone()),v.push(M.clone()),v.push(I.clone()),v.push(b);break}S&&(R=d[p],M=d[p+1],I=g(d[p+2],R,A,m),b=g(d[p+2],M,A,m)),v.push(R.clone()),v.push(M.clone()),v.push(I),v.push(b),v.push(I.clone()),v.push(M.clone());break}case 2:{C||(R=d[p].clone(),M=g(R,d[p+1],A,m),I=g(R,d[p+2],A,m),v.push(R),v.push(M),v.push(I)),B||(R=d[p+1].clone(),M=g(R,d[p+2],A,m),I=g(R,d[p],A,m),v.push(R),v.push(M),v.push(I)),S||(R=d[p+2].clone(),M=g(R,d[p],A,m),I=g(R,d[p+1],A,m),v.push(R),v.push(M),v.push(I));break}}}return v}function g(d,A,v,m){const p=d.position.dot(v)-m,C=A.position.dot(v)-m,B=p/(p-C);return new $s(new P(d.position.x+B*(A.position.x-d.position.x),d.position.y+B*(A.position.y-d.position.y),d.position.z+B*(A.position.z-d.position.z)),new P(d.normal.x+B*(A.normal.x-d.normal.x),d.normal.y+B*(A.normal.y-d.normal.y),d.normal.z+B*(A.normal.z-d.normal.z)))}}}class $s{constructor(e,n){this.position=e,this.normal=n}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}class Uo{constructor(e){x(this,"data"),this.data=e}generateShapes(e,n=100,r){const i=[],s={letterSpacing:0,lineHeight:1,...r},a=Gu(e,n,this.data,s);for(let o=0,l=a.length;o<l;o++)Array.prototype.push.apply(i,a[o].toShapes(!1));return i}}x(Uo,"isFont");x(Uo,"type");function Gu(t,e,n,r){const i=Array.from(t),s=e/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*s,o=[];let l=0,c=0;for(let u=0;u<i.length;u++){const h=i[u];if(h===`
`)l=0,c-=a*r.lineHeight;else{const f=ku(h,s,l,c,n);f&&(l+=f.offsetX+r.letterSpacing,o.push(f.path))}}return o}function ku(t,e,n,r,i){const s=i.glyphs[t]||i.glyphs["?"];if(!s){console.error('THREE.Font: character "'+t+'" does not exists in font family '+i.familyName+".");return}const a=new Hc;let o,l,c,u,h,f,T,g;if(s.o){const d=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let A=0,v=d.length;A<v;)switch(d[A++]){case"m":o=parseInt(d[A++])*e+n,l=parseInt(d[A++])*e+r,a.moveTo(o,l);break;case"l":o=parseInt(d[A++])*e+n,l=parseInt(d[A++])*e+r,a.lineTo(o,l);break;case"q":c=parseInt(d[A++])*e+n,u=parseInt(d[A++])*e+r,h=parseInt(d[A++])*e+n,f=parseInt(d[A++])*e+r,a.quadraticCurveTo(h,f,c,u);break;case"b":c=parseInt(d[A++])*e+n,u=parseInt(d[A++])*e+r,h=parseInt(d[A++])*e+n,f=parseInt(d[A++])*e+r,T=parseInt(d[A++])*e+n,g=parseInt(d[A++])*e+r,a.bezierCurveTo(h,f,T,g,c,u);break}}return{offsetX:s.ha*e,path:a}}class Uu extends Wi{constructor(e=null,n=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:r,depth:i},this.magFilter=te,this.minFilter=te,this.wrapR=Qt,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}var Hu=typeof global=="object"&&global&&global.Object===Object&&global;const Ho=Hu;var Ku=typeof self=="object"&&self&&self.Object===Object&&self,Ju=Ho||Ku||Function("return this")();const ct=Ju;var ju=ct.Symbol;const We=ju;var Ko=Object.prototype,Wu=Ko.hasOwnProperty,Vu=Ko.toString,Dn=We?We.toStringTag:void 0;function Xu(t){var e=Wu.call(t,Dn),n=t[Dn];try{t[Dn]=void 0;var r=!0}catch{}var i=Vu.call(t);return r&&(e?t[Dn]=n:delete t[Dn]),i}var Qu=Object.prototype,Yu=Qu.toString;function zu(t){return Yu.call(t)}var $u="[object Null]",Zu="[object Undefined]",Zs=We?We.toStringTag:void 0;function Gt(t){return t==null?t===void 0?Zu:$u:Zs&&Zs in Object(t)?Xu(t):zu(t)}function ze(t){return t!=null&&typeof t=="object"}var qu="[object Symbol]";function ei(t){return typeof t=="symbol"||ze(t)&&Gt(t)==qu}function ir(t,e){for(var n=-1,r=t==null?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}var eh=Array.isArray;const W=eh;var th=1/0,qs=We?We.prototype:void 0,ea=qs?qs.toString:void 0;function Jo(t){if(typeof t=="string")return t;if(W(t))return ir(t,Jo)+"";if(ei(t))return ea?ea.call(t):"";var e=t+"";return e=="0"&&1/t==-th?"-0":e}var nh=/\s/;function rh(t){for(var e=t.length;e--&&nh.test(t.charAt(e)););return e}var ih=/^\s+/;function sh(t){return t&&t.slice(0,rh(t)+1).replace(ih,"")}function Ve(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var ta=0/0,ah=/^[-+]0x[0-9a-f]+$/i,oh=/^0b[01]+$/i,lh=/^0o[0-7]+$/i,ch=parseInt;function uh(t){if(typeof t=="number")return t;if(ei(t))return ta;if(Ve(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Ve(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=sh(t);var n=oh.test(t);return n||lh.test(t)?ch(t.slice(2),n?2:8):ah.test(t)?ta:+t}var na=1/0,hh=17976931348623157e292;function fh(t){if(!t)return t===0?t:0;if(t=uh(t),t===na||t===-na){var e=t<0?-1:1;return e*hh}return t===t?t:0}function sr(t){var e=fh(t),n=e%1;return e===e?n?e-n:e:0}function vn(t){return t}var dh="[object AsyncFunction]",ph="[object Function]",mh="[object GeneratorFunction]",Ah="[object Proxy]";function Et(t){if(!Ve(t))return!1;var e=Gt(t);return e==ph||e==mh||e==dh||e==Ah}var gh=ct["__core-js_shared__"];const bi=gh;var ra=function(){var t=/[^.]+$/.exec(bi&&bi.keys&&bi.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Th(t){return!!ra&&ra in t}var vh=Function.prototype,Ch=vh.toString;function nn(t){if(t!=null){try{return Ch.call(t)}catch{}try{return t+""}catch{}}return""}var Eh=/[\\^$.*+?()[\]{}|]/g,Rh=/^\[object .+?Constructor\]$/,Bh=Function.prototype,yh=Object.prototype,Sh=Bh.toString,xh=yh.hasOwnProperty,Mh=RegExp("^"+Sh.call(xh).replace(Eh,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Ih(t){if(!Ve(t)||Th(t))return!1;var e=Et(t)?Mh:Rh;return e.test(nn(t))}function bh(t,e){return t==null?void 0:t[e]}function rn(t,e){var n=bh(t,e);return Ih(n)?n:void 0}var Ph=rn(ct,"WeakMap");const qi=Ph;var ia=Object.create,_h=function(){function t(){}return function(e){if(!Ve(e))return{};if(ia)return ia(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();const wh=_h;function Oh(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function me(){}function Fh(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var Dh=800,Nh=16,Lh=Date.now;function Gh(t){var e=0,n=0;return function(){var r=Lh(),i=Nh-(r-n);if(n=r,i>0){if(++e>=Dh)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}function kh(t){return function(){return t}}var Uh=function(){try{var t=rn(Object,"defineProperty");return t({},"",{}),t}catch{}}();const Gr=Uh;var Hh=Gr?function(t,e){return Gr(t,"toString",{configurable:!0,enumerable:!1,value:kh(e),writable:!0})}:vn;const Kh=Hh;var Jh=Gh(Kh);const jh=Jh;function jo(t,e){for(var n=-1,r=t==null?0:t.length;++n<r&&e(t[n],n,t)!==!1;);return t}function Wo(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}function Wh(t){return t!==t}function Vh(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}function gs(t,e,n){return e===e?Vh(t,e,n):Wo(t,Wh,n)}function Vo(t,e){var n=t==null?0:t.length;return!!n&&gs(t,e,0)>-1}var Xh=9007199254740991,Qh=/^(?:0|[1-9]\d*)$/;function ti(t,e){var n=typeof t;return e=e??Xh,!!e&&(n=="number"||n!="symbol"&&Qh.test(t))&&t>-1&&t%1==0&&t<e}function Ts(t,e,n){e=="__proto__"&&Gr?Gr(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function ar(t,e){return t===e||t!==t&&e!==e}var Yh=Object.prototype,zh=Yh.hasOwnProperty;function ni(t,e,n){var r=t[e];(!(zh.call(t,e)&&ar(r,n))||n===void 0&&!(e in t))&&Ts(t,e,n)}function or(t,e,n,r){var i=!n;n||(n={});for(var s=-1,a=e.length;++s<a;){var o=e[s],l=r?r(n[o],t[o],o,n,t):void 0;l===void 0&&(l=t[o]),i?Ts(n,o,l):ni(n,o,l)}return n}var sa=Math.max;function $h(t,e,n){return e=sa(e===void 0?t.length-1:e,0),function(){for(var r=arguments,i=-1,s=sa(r.length-e,0),a=Array(s);++i<s;)a[i]=r[e+i];i=-1;for(var o=Array(e+1);++i<e;)o[i]=r[i];return o[e]=n(a),Oh(t,this,o)}}function vs(t,e){return jh($h(t,e,vn),t+"")}var Zh=9007199254740991;function Cs(t){return typeof t=="number"&&t>-1&&t%1==0&&t<=Zh}function ut(t){return t!=null&&Cs(t.length)&&!Et(t)}function ri(t,e,n){if(!Ve(n))return!1;var r=typeof e;return(r=="number"?ut(n)&&ti(e,n.length):r=="string"&&e in n)?ar(n[e],t):!1}function qh(t){return vs(function(e,n){var r=-1,i=n.length,s=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(s=t.length>3&&typeof s=="function"?(i--,s):void 0,a&&ri(n[0],n[1],a)&&(s=i<3?void 0:s,i=1),e=Object(e);++r<i;){var o=n[r];o&&t(e,o,r,s)}return e})}var ef=Object.prototype;function lr(t){var e=t&&t.constructor,n=typeof e=="function"&&e.prototype||ef;return t===n}function tf(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}var nf="[object Arguments]";function aa(t){return ze(t)&&Gt(t)==nf}var Xo=Object.prototype,rf=Xo.hasOwnProperty,sf=Xo.propertyIsEnumerable,af=aa(function(){return arguments}())?aa:function(t){return ze(t)&&rf.call(t,"callee")&&!sf.call(t,"callee")};const ii=af;function of(){return!1}var Qo=typeof exports=="object"&&exports&&!exports.nodeType&&exports,oa=Qo&&typeof module=="object"&&module&&!module.nodeType&&module,lf=oa&&oa.exports===Qo,la=lf?ct.Buffer:void 0,cf=la?la.isBuffer:void 0,uf=cf||of;const qn=uf;var hf="[object Arguments]",ff="[object Array]",df="[object Boolean]",pf="[object Date]",mf="[object Error]",Af="[object Function]",gf="[object Map]",Tf="[object Number]",vf="[object Object]",Cf="[object RegExp]",Ef="[object Set]",Rf="[object String]",Bf="[object WeakMap]",yf="[object ArrayBuffer]",Sf="[object DataView]",xf="[object Float32Array]",Mf="[object Float64Array]",If="[object Int8Array]",bf="[object Int16Array]",Pf="[object Int32Array]",_f="[object Uint8Array]",wf="[object Uint8ClampedArray]",Of="[object Uint16Array]",Ff="[object Uint32Array]",ee={};ee[xf]=ee[Mf]=ee[If]=ee[bf]=ee[Pf]=ee[_f]=ee[wf]=ee[Of]=ee[Ff]=!0;ee[hf]=ee[ff]=ee[yf]=ee[df]=ee[Sf]=ee[pf]=ee[mf]=ee[Af]=ee[gf]=ee[Tf]=ee[vf]=ee[Cf]=ee[Ef]=ee[Rf]=ee[Bf]=!1;function Df(t){return ze(t)&&Cs(t.length)&&!!ee[Gt(t)]}function cr(t){return function(e){return t(e)}}var Yo=typeof exports=="object"&&exports&&!exports.nodeType&&exports,zn=Yo&&typeof module=="object"&&module&&!module.nodeType&&module,Nf=zn&&zn.exports===Yo,Pi=Nf&&Ho.process,Lf=function(){try{var t=zn&&zn.require&&zn.require("util").types;return t||Pi&&Pi.binding&&Pi.binding("util")}catch{}}();const Ot=Lf;var ca=Ot&&Ot.isTypedArray,Gf=ca?cr(ca):Df;const Es=Gf;var kf=Object.prototype,Uf=kf.hasOwnProperty;function zo(t,e){var n=W(t),r=!n&&ii(t),i=!n&&!r&&qn(t),s=!n&&!r&&!i&&Es(t),a=n||r||i||s,o=a?tf(t.length,String):[],l=o.length;for(var c in t)(e||Uf.call(t,c))&&!(a&&(c=="length"||i&&(c=="offset"||c=="parent")||s&&(c=="buffer"||c=="byteLength"||c=="byteOffset")||ti(c,l)))&&o.push(c);return o}function $o(t,e){return function(n){return t(e(n))}}var Hf=$o(Object.keys,Object);const Kf=Hf;var Jf=Object.prototype,jf=Jf.hasOwnProperty;function Zo(t){if(!lr(t))return Kf(t);var e=[];for(var n in Object(t))jf.call(t,n)&&n!="constructor"&&e.push(n);return e}function Le(t){return ut(t)?zo(t):Zo(t)}var Wf=Object.prototype,Vf=Wf.hasOwnProperty,Xf=qh(function(t,e){if(lr(e)||ut(e)){or(e,Le(e),t);return}for(var n in e)Vf.call(e,n)&&ni(t,n,e[n])});const Ge=Xf;function Qf(t){var e=[];if(t!=null)for(var n in Object(t))e.push(n);return e}var Yf=Object.prototype,zf=Yf.hasOwnProperty;function $f(t){if(!Ve(t))return Qf(t);var e=lr(t),n=[];for(var r in t)r=="constructor"&&(e||!zf.call(t,r))||n.push(r);return n}function si(t){return ut(t)?zo(t,!0):$f(t)}var Zf=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,qf=/^\w*$/;function Rs(t,e){if(W(t))return!1;var n=typeof t;return n=="number"||n=="symbol"||n=="boolean"||t==null||ei(t)?!0:qf.test(t)||!Zf.test(t)||e!=null&&t in Object(e)}var ed=rn(Object,"create");const er=ed;function td(){this.__data__=er?er(null):{},this.size=0}function nd(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var rd="__lodash_hash_undefined__",id=Object.prototype,sd=id.hasOwnProperty;function ad(t){var e=this.__data__;if(er){var n=e[t];return n===rd?void 0:n}return sd.call(e,t)?e[t]:void 0}var od=Object.prototype,ld=od.hasOwnProperty;function cd(t){var e=this.__data__;return er?e[t]!==void 0:ld.call(e,t)}var ud="__lodash_hash_undefined__";function hd(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=er&&e===void 0?ud:e,this}function qt(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}qt.prototype.clear=td;qt.prototype.delete=nd;qt.prototype.get=ad;qt.prototype.has=cd;qt.prototype.set=hd;function fd(){this.__data__=[],this.size=0}function ai(t,e){for(var n=t.length;n--;)if(ar(t[n][0],e))return n;return-1}var dd=Array.prototype,pd=dd.splice;function md(t){var e=this.__data__,n=ai(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():pd.call(e,n,1),--this.size,!0}function Ad(t){var e=this.__data__,n=ai(e,t);return n<0?void 0:e[n][1]}function gd(t){return ai(this.__data__,t)>-1}function Td(t,e){var n=this.__data__,r=ai(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Rt(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Rt.prototype.clear=fd;Rt.prototype.delete=md;Rt.prototype.get=Ad;Rt.prototype.has=gd;Rt.prototype.set=Td;var vd=rn(ct,"Map");const tr=vd;function Cd(){this.size=0,this.__data__={hash:new qt,map:new(tr||Rt),string:new qt}}function Ed(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function oi(t,e){var n=t.__data__;return Ed(e)?n[typeof e=="string"?"string":"hash"]:n.map}function Rd(t){var e=oi(this,t).delete(t);return this.size-=e?1:0,e}function Bd(t){return oi(this,t).get(t)}function yd(t){return oi(this,t).has(t)}function Sd(t,e){var n=oi(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Bt(t){var e=-1,n=t==null?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Bt.prototype.clear=Cd;Bt.prototype.delete=Rd;Bt.prototype.get=Bd;Bt.prototype.has=yd;Bt.prototype.set=Sd;var xd="Expected a function";function Bs(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(xd);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var a=t.apply(this,r);return n.cache=s.set(i,a)||s,a};return n.cache=new(Bs.Cache||Bt),n}Bs.Cache=Bt;var Md=500;function Id(t){var e=Bs(t,function(r){return n.size===Md&&n.clear(),r}),n=e.cache;return e}var bd=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Pd=/\\(\\)?/g,_d=Id(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(bd,function(n,r,i,s){e.push(i?s.replace(Pd,"$1"):r||n)}),e});const wd=_d;function Od(t){return t==null?"":Jo(t)}function li(t,e){return W(t)?t:Rs(t,e)?[t]:wd(Od(t))}var Fd=1/0;function ur(t){if(typeof t=="string"||ei(t))return t;var e=t+"";return e=="0"&&1/t==-Fd?"-0":e}function ys(t,e){e=li(e,t);for(var n=0,r=e.length;t!=null&&n<r;)t=t[ur(e[n++])];return n&&n==r?t:void 0}function Dd(t,e,n){var r=t==null?void 0:ys(t,e);return r===void 0?n:r}function Ss(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}var ua=We?We.isConcatSpreadable:void 0;function Nd(t){return W(t)||ii(t)||!!(ua&&t&&t[ua])}function ci(t,e,n,r,i){var s=-1,a=t.length;for(n||(n=Nd),i||(i=[]);++s<a;){var o=t[s];e>0&&n(o)?e>1?ci(o,e-1,n,r,i):Ss(i,o):r||(i[i.length]=o)}return i}function Qe(t){var e=t==null?0:t.length;return e?ci(t,1):[]}var Ld=$o(Object.getPrototypeOf,Object);const qo=Ld;function el(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),n=n>i?i:n,n<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=t[r+e];return s}function Gd(t,e,n,r){var i=-1,s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function kd(){this.__data__=new Rt,this.size=0}function Ud(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n}function Hd(t){return this.__data__.get(t)}function Kd(t){return this.__data__.has(t)}var Jd=200;function jd(t,e){var n=this.__data__;if(n instanceof Rt){var r=n.__data__;if(!tr||r.length<Jd-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Bt(r)}return n.set(t,e),this.size=n.size,this}function ot(t){var e=this.__data__=new Rt(t);this.size=e.size}ot.prototype.clear=kd;ot.prototype.delete=Ud;ot.prototype.get=Hd;ot.prototype.has=Kd;ot.prototype.set=jd;function Wd(t,e){return t&&or(e,Le(e),t)}function Vd(t,e){return t&&or(e,si(e),t)}var tl=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ha=tl&&typeof module=="object"&&module&&!module.nodeType&&module,Xd=ha&&ha.exports===tl,fa=Xd?ct.Buffer:void 0,da=fa?fa.allocUnsafe:void 0;function Qd(t,e){if(e)return t.slice();var n=t.length,r=da?da(n):new t.constructor(n);return t.copy(r),r}function xs(t,e){for(var n=-1,r=t==null?0:t.length,i=0,s=[];++n<r;){var a=t[n];e(a,n,t)&&(s[i++]=a)}return s}function nl(){return[]}var Yd=Object.prototype,zd=Yd.propertyIsEnumerable,pa=Object.getOwnPropertySymbols,$d=pa?function(t){return t==null?[]:(t=Object(t),xs(pa(t),function(e){return zd.call(t,e)}))}:nl;const Ms=$d;function Zd(t,e){return or(t,Ms(t),e)}var qd=Object.getOwnPropertySymbols,ep=qd?function(t){for(var e=[];t;)Ss(e,Ms(t)),t=qo(t);return e}:nl;const rl=ep;function tp(t,e){return or(t,rl(t),e)}function il(t,e,n){var r=e(t);return W(t)?r:Ss(r,n(t))}function es(t){return il(t,Le,Ms)}function sl(t){return il(t,si,rl)}var np=rn(ct,"DataView");const ts=np;var rp=rn(ct,"Promise");const ns=rp;var ip=rn(ct,"Set");const mn=ip;var ma="[object Map]",sp="[object Object]",Aa="[object Promise]",ga="[object Set]",Ta="[object WeakMap]",va="[object DataView]",ap=nn(ts),op=nn(tr),lp=nn(ns),cp=nn(mn),up=nn(qi),Xt=Gt;(ts&&Xt(new ts(new ArrayBuffer(1)))!=va||tr&&Xt(new tr)!=ma||ns&&Xt(ns.resolve())!=Aa||mn&&Xt(new mn)!=ga||qi&&Xt(new qi)!=Ta)&&(Xt=function(t){var e=Gt(t),n=e==sp?t.constructor:void 0,r=n?nn(n):"";if(r)switch(r){case ap:return va;case op:return ma;case lp:return Aa;case cp:return ga;case up:return Ta}return e});const Cn=Xt;var hp=Object.prototype,fp=hp.hasOwnProperty;function dp(t){var e=t.length,n=new t.constructor(e);return e&&typeof t[0]=="string"&&fp.call(t,"index")&&(n.index=t.index,n.input=t.input),n}var pp=ct.Uint8Array;const kr=pp;function Is(t){var e=new t.constructor(t.byteLength);return new kr(e).set(new kr(t)),e}function mp(t,e){var n=e?Is(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}var Ap=/\w*$/;function gp(t){var e=new t.constructor(t.source,Ap.exec(t));return e.lastIndex=t.lastIndex,e}var Ca=We?We.prototype:void 0,Ea=Ca?Ca.valueOf:void 0;function Tp(t){return Ea?Object(Ea.call(t)):{}}function vp(t,e){var n=e?Is(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}var Cp="[object Boolean]",Ep="[object Date]",Rp="[object Map]",Bp="[object Number]",yp="[object RegExp]",Sp="[object Set]",xp="[object String]",Mp="[object Symbol]",Ip="[object ArrayBuffer]",bp="[object DataView]",Pp="[object Float32Array]",_p="[object Float64Array]",wp="[object Int8Array]",Op="[object Int16Array]",Fp="[object Int32Array]",Dp="[object Uint8Array]",Np="[object Uint8ClampedArray]",Lp="[object Uint16Array]",Gp="[object Uint32Array]";function kp(t,e,n){var r=t.constructor;switch(e){case Ip:return Is(t);case Cp:case Ep:return new r(+t);case bp:return mp(t,n);case Pp:case _p:case wp:case Op:case Fp:case Dp:case Np:case Lp:case Gp:return vp(t,n);case Rp:return new r;case Bp:case xp:return new r(t);case yp:return gp(t);case Sp:return new r;case Mp:return Tp(t)}}function Up(t){return typeof t.constructor=="function"&&!lr(t)?wh(qo(t)):{}}var Hp="[object Map]";function Kp(t){return ze(t)&&Cn(t)==Hp}var Ra=Ot&&Ot.isMap,Jp=Ra?cr(Ra):Kp;const jp=Jp;var Wp="[object Set]";function Vp(t){return ze(t)&&Cn(t)==Wp}var Ba=Ot&&Ot.isSet,Xp=Ba?cr(Ba):Vp;const Qp=Xp;var Yp=1,zp=2,$p=4,al="[object Arguments]",Zp="[object Array]",qp="[object Boolean]",em="[object Date]",tm="[object Error]",ol="[object Function]",nm="[object GeneratorFunction]",rm="[object Map]",im="[object Number]",ll="[object Object]",sm="[object RegExp]",am="[object Set]",om="[object String]",lm="[object Symbol]",cm="[object WeakMap]",um="[object ArrayBuffer]",hm="[object DataView]",fm="[object Float32Array]",dm="[object Float64Array]",pm="[object Int8Array]",mm="[object Int16Array]",Am="[object Int32Array]",gm="[object Uint8Array]",Tm="[object Uint8ClampedArray]",vm="[object Uint16Array]",Cm="[object Uint32Array]",$={};$[al]=$[Zp]=$[um]=$[hm]=$[qp]=$[em]=$[fm]=$[dm]=$[pm]=$[mm]=$[Am]=$[rm]=$[im]=$[ll]=$[sm]=$[am]=$[om]=$[lm]=$[gm]=$[Tm]=$[vm]=$[Cm]=!0;$[tm]=$[ol]=$[cm]=!1;function Mr(t,e,n,r,i,s){var a,o=e&Yp,l=e&zp,c=e&$p;if(n&&(a=i?n(t,r,i,s):n(t)),a!==void 0)return a;if(!Ve(t))return t;var u=W(t);if(u){if(a=dp(t),!o)return Fh(t,a)}else{var h=Cn(t),f=h==ol||h==nm;if(qn(t))return Qd(t,o);if(h==ll||h==al||f&&!i){if(a=l||f?{}:Up(t),!o)return l?tp(t,Vd(a,t)):Zd(t,Wd(a,t))}else{if(!$[h])return i?t:{};a=kp(t,h,o)}}s||(s=new ot);var T=s.get(t);if(T)return T;s.set(t,a),Qp(t)?t.forEach(function(A){a.add(Mr(A,e,n,A,t,s))}):jp(t)&&t.forEach(function(A,v){a.set(v,Mr(A,e,n,v,t,s))});var g=c?l?sl:es:l?si:Le,d=u?void 0:g(t);return jo(d||t,function(A,v){d&&(v=A,A=t[v]),ni(a,v,Mr(A,e,n,v,t,s))}),a}var Em=4;function Be(t){return Mr(t,Em)}function hr(t){for(var e=-1,n=t==null?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i}var Rm="__lodash_hash_undefined__";function Bm(t){return this.__data__.set(t,Rm),this}function ym(t){return this.__data__.has(t)}function En(t){var e=-1,n=t==null?0:t.length;for(this.__data__=new Bt;++e<n;)this.add(t[e])}En.prototype.add=En.prototype.push=Bm;En.prototype.has=ym;function cl(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function bs(t,e){return t.has(e)}var Sm=1,xm=2;function ul(t,e,n,r,i,s){var a=n&Sm,o=t.length,l=e.length;if(o!=l&&!(a&&l>o))return!1;var c=s.get(t),u=s.get(e);if(c&&u)return c==e&&u==t;var h=-1,f=!0,T=n&xm?new En:void 0;for(s.set(t,e),s.set(e,t);++h<o;){var g=t[h],d=e[h];if(r)var A=a?r(d,g,h,e,t,s):r(g,d,h,t,e,s);if(A!==void 0){if(A)continue;f=!1;break}if(T){if(!cl(e,function(v,m){if(!bs(T,m)&&(g===v||i(g,v,n,r,s)))return T.push(m)})){f=!1;break}}else if(!(g===d||i(g,d,n,r,s))){f=!1;break}}return s.delete(t),s.delete(e),f}function Mm(t){var e=-1,n=Array(t.size);return t.forEach(function(r,i){n[++e]=[i,r]}),n}function Ps(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var Im=1,bm=2,Pm="[object Boolean]",_m="[object Date]",wm="[object Error]",Om="[object Map]",Fm="[object Number]",Dm="[object RegExp]",Nm="[object Set]",Lm="[object String]",Gm="[object Symbol]",km="[object ArrayBuffer]",Um="[object DataView]",ya=We?We.prototype:void 0,_i=ya?ya.valueOf:void 0;function Hm(t,e,n,r,i,s,a){switch(n){case Um:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case km:return!(t.byteLength!=e.byteLength||!s(new kr(t),new kr(e)));case Pm:case _m:case Fm:return ar(+t,+e);case wm:return t.name==e.name&&t.message==e.message;case Dm:case Lm:return t==e+"";case Om:var o=Mm;case Nm:var l=r&Im;if(o||(o=Ps),t.size!=e.size&&!l)return!1;var c=a.get(t);if(c)return c==e;r|=bm,a.set(t,e);var u=ul(o(t),o(e),r,i,s,a);return a.delete(t),u;case Gm:if(_i)return _i.call(t)==_i.call(e)}return!1}var Km=1,Jm=Object.prototype,jm=Jm.hasOwnProperty;function Wm(t,e,n,r,i,s){var a=n&Km,o=es(t),l=o.length,c=es(e),u=c.length;if(l!=u&&!a)return!1;for(var h=l;h--;){var f=o[h];if(!(a?f in e:jm.call(e,f)))return!1}var T=s.get(t),g=s.get(e);if(T&&g)return T==e&&g==t;var d=!0;s.set(t,e),s.set(e,t);for(var A=a;++h<l;){f=o[h];var v=t[f],m=e[f];if(r)var p=a?r(m,v,f,e,t,s):r(v,m,f,t,e,s);if(!(p===void 0?v===m||i(v,m,n,r,s):p)){d=!1;break}A||(A=f=="constructor")}if(d&&!A){var C=t.constructor,B=e.constructor;C!=B&&"constructor"in t&&"constructor"in e&&!(typeof C=="function"&&C instanceof C&&typeof B=="function"&&B instanceof B)&&(d=!1)}return s.delete(t),s.delete(e),d}var Vm=1,Sa="[object Arguments]",xa="[object Array]",Cr="[object Object]",Xm=Object.prototype,Ma=Xm.hasOwnProperty;function Qm(t,e,n,r,i,s){var a=W(t),o=W(e),l=a?xa:Cn(t),c=o?xa:Cn(e);l=l==Sa?Cr:l,c=c==Sa?Cr:c;var u=l==Cr,h=c==Cr,f=l==c;if(f&&qn(t)){if(!qn(e))return!1;a=!0,u=!1}if(f&&!u)return s||(s=new ot),a||Es(t)?ul(t,e,n,r,i,s):Hm(t,e,l,n,r,i,s);if(!(n&Vm)){var T=u&&Ma.call(t,"__wrapped__"),g=h&&Ma.call(e,"__wrapped__");if(T||g){var d=T?t.value():t,A=g?e.value():e;return s||(s=new ot),i(d,A,n,r,s)}}return f?(s||(s=new ot),Wm(t,e,n,r,i,s)):!1}function _s(t,e,n,r,i){return t===e?!0:t==null||e==null||!ze(t)&&!ze(e)?t!==t&&e!==e:Qm(t,e,n,r,_s,i)}var Ym=1,zm=2;function $m(t,e,n,r){var i=n.length,s=i,a=!r;if(t==null)return!s;for(t=Object(t);i--;){var o=n[i];if(a&&o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1}for(;++i<s;){o=n[i];var l=o[0],c=t[l],u=o[1];if(a&&o[2]){if(c===void 0&&!(l in t))return!1}else{var h=new ot;if(r)var f=r(c,u,l,t,e,h);if(!(f===void 0?_s(u,c,Ym|zm,r,h):f))return!1}}return!0}function hl(t){return t===t&&!Ve(t)}function Zm(t){for(var e=Le(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,hl(i)]}return e}function fl(t,e){return function(n){return n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}}function qm(t){var e=Zm(t);return e.length==1&&e[0][2]?fl(e[0][0],e[0][1]):function(n){return n===t||$m(n,t,e)}}function eA(t,e){return t!=null&&e in Object(t)}function dl(t,e,n){e=li(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var a=ur(e[r]);if(!(s=t!=null&&n(t,a)))break;t=t[a]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&Cs(i)&&ti(a,i)&&(W(t)||ii(t)))}function tA(t,e){return t!=null&&dl(t,e,eA)}var nA=1,rA=2;function iA(t,e){return Rs(t)&&hl(e)?fl(ur(t),e):function(n){var r=Dd(n,t);return r===void 0&&r===e?tA(n,t):_s(e,r,nA|rA)}}function sA(t){return function(e){return e==null?void 0:e[t]}}function aA(t){return function(e){return ys(e,t)}}function oA(t){return Rs(t)?sA(ur(t)):aA(t)}function ht(t){return typeof t=="function"?t:t==null?vn:typeof t=="object"?W(t)?iA(t[0],t[1]):qm(t):oA(t)}function lA(t,e,n,r){for(var i=-1,s=t==null?0:t.length;++i<s;){var a=t[i];e(r,a,n(a),t)}return r}function cA(t){return function(e,n,r){for(var i=-1,s=Object(e),a=r(e),o=a.length;o--;){var l=a[t?o:++i];if(n(s[l],l,s)===!1)break}return e}}var uA=cA();const hA=uA;function fA(t,e){return t&&hA(t,e,Le)}function dA(t,e){return function(n,r){if(n==null)return n;if(!ut(n))return t(n,r);for(var i=n.length,s=e?i:-1,a=Object(n);(e?s--:++s<i)&&r(a[s],s,a)!==!1;);return n}}var pA=dA(fA);const sn=pA;function mA(t,e,n,r){return sn(t,function(i,s,a){e(r,i,n(i),a)}),r}function AA(t,e){return function(n,r){var i=W(n)?lA:mA,s=e?e():{};return i(n,t,ht(r),s)}}var pl=Object.prototype,gA=pl.hasOwnProperty,TA=vs(function(t,e){t=Object(t);var n=-1,r=e.length,i=r>2?e[2]:void 0;for(i&&ri(e[0],e[1],i)&&(r=1);++n<r;)for(var s=e[n],a=si(s),o=-1,l=a.length;++o<l;){var c=a[o],u=t[c];(u===void 0||ar(u,pl[c])&&!gA.call(t,c))&&(t[c]=s[c])}return t});const ws=TA;function Ia(t){return ze(t)&&ut(t)}function ml(t,e,n){for(var r=-1,i=t==null?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}var vA=200;function CA(t,e,n,r){var i=-1,s=Vo,a=!0,o=t.length,l=[],c=e.length;if(!o)return l;n&&(e=ir(e,cr(n))),r?(s=ml,a=!1):e.length>=vA&&(s=bs,a=!1,e=new En(e));e:for(;++i<o;){var u=t[i],h=n==null?u:n(u);if(u=r||u!==0?u:0,a&&h===h){for(var f=c;f--;)if(e[f]===h)continue e;l.push(u)}else s(e,h,r)||l.push(u)}return l}var EA=vs(function(t,e){return Ia(t)?CA(t,ci(e,1,Ia,!0)):[]});const ui=EA;function Rn(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}function Ce(t,e,n){var r=t==null?0:t.length;return r?(e=n||e===void 0?1:sr(e),el(t,e<0?0:e,r)):[]}function nr(t,e,n){var r=t==null?0:t.length;return r?(e=n||e===void 0?1:sr(e),e=r-e,el(t,0,e<0?0:e)):[]}function RA(t){return typeof t=="function"?t:vn}function N(t,e){var n=W(t)?jo:sn;return n(t,RA(e))}function BA(t,e){for(var n=-1,r=t==null?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function yA(t,e){var n=!0;return sn(t,function(r,i,s){return n=!!e(r,i,s),n}),n}function Ye(t,e,n){var r=W(t)?BA:yA;return n&&ri(t,e,n)&&(e=void 0),r(t,ht(e))}function Al(t,e){var n=[];return sn(t,function(r,i,s){e(r,i,s)&&n.push(r)}),n}function Xe(t,e){var n=W(t)?xs:Al;return n(t,ht(e))}function SA(t){return function(e,n,r){var i=Object(e);if(!ut(e)){var s=ht(n);e=Le(e),n=function(o){return s(i[o],o,i)}}var a=t(e,n,r);return a>-1?i[s?e[a]:a]:void 0}}var xA=Math.max;function MA(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:sr(n);return i<0&&(i=xA(r+i,0)),Wo(t,ht(e),i)}var IA=SA(MA);const Bn=IA;function $e(t){return t&&t.length?t[0]:void 0}function bA(t,e){var n=-1,r=ut(t)?Array(t.length):[];return sn(t,function(i,s,a){r[++n]=e(i,s,a)}),r}function F(t,e){var n=W(t)?ir:bA;return n(t,ht(e))}function Je(t,e){return ci(F(t,e),1)}var PA=Object.prototype,_A=PA.hasOwnProperty,wA=AA(function(t,e,n){_A.call(t,n)?t[n].push(e):Ts(t,n,[e])});const OA=wA;var FA=Object.prototype,DA=FA.hasOwnProperty;function NA(t,e){return t!=null&&DA.call(t,e)}function D(t,e){return t!=null&&dl(t,e,NA)}var LA="[object String]";function Fe(t){return typeof t=="string"||!W(t)&&ze(t)&&Gt(t)==LA}function GA(t,e){return ir(e,function(n){return t[n]})}function Ae(t){return t==null?[]:GA(t,Le(t))}var kA=Math.max;function Pe(t,e,n,r){t=ut(t)?t:Ae(t),n=n&&!r?sr(n):0;var i=t.length;return n<0&&(n=kA(i+n,0)),Fe(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&gs(t,e,n)>-1}var UA=Math.max;function ba(t,e,n){var r=t==null?0:t.length;if(!r)return-1;var i=n==null?0:sr(n);return i<0&&(i=UA(r+i,0)),gs(t,e,i)}var HA="[object Map]",KA="[object Set]",JA=Object.prototype,jA=JA.hasOwnProperty;function Z(t){if(t==null)return!0;if(ut(t)&&(W(t)||typeof t=="string"||typeof t.splice=="function"||qn(t)||Es(t)||ii(t)))return!t.length;var e=Cn(t);if(e==HA||e==KA)return!t.size;if(lr(t))return!Zo(t).length;for(var n in t)if(jA.call(t,n))return!1;return!0}var WA="[object RegExp]";function VA(t){return ze(t)&&Gt(t)==WA}var Pa=Ot&&Ot.isRegExp,XA=Pa?cr(Pa):VA;const vt=XA;function Ct(t){return t===void 0}var QA="Expected a function";function YA(t){if(typeof t!="function")throw new TypeError(QA);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function zA(t,e,n,r){if(!Ve(t))return t;e=li(e,t);for(var i=-1,s=e.length,a=s-1,o=t;o!=null&&++i<s;){var l=ur(e[i]),c=n;if(l==="__proto__"||l==="constructor"||l==="prototype")return t;if(i!=a){var u=o[l];c=r?r(u,l,o):void 0,c===void 0&&(c=Ve(u)?u:ti(e[i+1])?[]:{})}ni(o,l,c),o=o[l]}return t}function $A(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var a=e[r],o=ys(t,a);n(o,a)&&zA(s,li(a,t),o)}return s}function Ze(t,e){if(t==null)return{};var n=ir(sl(t),function(r){return[r]});return e=ht(e),$A(t,n,function(r,i){return e(r,i[0])})}function ZA(t,e,n,r,i){return i(t,function(s,a,o){n=r?(r=!1,s):e(n,s,a,o)}),n}function ke(t,e,n){var r=W(t)?Gd:ZA,i=arguments.length<3;return r(t,ht(e),n,i,sn)}function hi(t,e){var n=W(t)?xs:Al;return n(t,YA(ht(e)))}function qA(t,e){var n;return sn(t,function(r,i,s){return n=e(r,i,s),!n}),!!n}function gl(t,e,n){var r=W(t)?cl:qA;return n&&ri(t,e,n)&&(e=void 0),r(t,ht(e))}var eg=1/0,tg=mn&&1/Ps(new mn([,-0]))[1]==eg?function(t){return new mn(t)}:me;const ng=tg;var rg=200;function ig(t,e,n){var r=-1,i=Vo,s=t.length,a=!0,o=[],l=o;if(n)a=!1,i=ml;else if(s>=rg){var c=e?null:ng(t);if(c)return Ps(c);a=!1,i=bs,l=new En}else l=e?[]:o;e:for(;++r<s;){var u=t[r],h=e?e(u):u;if(u=n||u!==0?u:0,a&&h===h){for(var f=l.length;f--;)if(l[f]===h)continue e;e&&l.push(h),o.push(u)}else i(l,h,n)||(l!==o&&l.push(h),o.push(u))}return o}function Os(t){return t&&t.length?ig(t):[]}function rs(t){console&&console.error&&console.error(`Error: ${t}`)}function Tl(t){console&&console.warn&&console.warn(`Warning: ${t}`)}function vl(t){const e=new Date().getTime(),n=t();return{time:new Date().getTime()-e,value:n}}function Cl(t){function e(){}e.prototype=t;const n=new e;function r(){return typeof n.bar}return r(),r(),t}function sg(t){return ag(t)?t.LABEL:t.name}function ag(t){return Fe(t.LABEL)&&t.LABEL!==""}class ft{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){this._definition=e}accept(e){e.visit(this),N(this.definition,n=>{n.accept(e)})}}class Ue extends ft{constructor(e){super([]),this.idx=1,Ge(this,Ze(e,n=>n!==void 0))}set definition(e){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(e){e.visit(this)}}class Sn extends ft{constructor(e){super(e.definition),this.orgText="",Ge(this,Ze(e,n=>n!==void 0))}}class De extends ft{constructor(e){super(e.definition),this.ignoreAmbiguities=!1,Ge(this,Ze(e,n=>n!==void 0))}}class Oe extends ft{constructor(e){super(e.definition),this.idx=1,Ge(this,Ze(e,n=>n!==void 0))}}class dt extends ft{constructor(e){super(e.definition),this.idx=1,Ge(this,Ze(e,n=>n!==void 0))}}class pt extends ft{constructor(e){super(e.definition),this.idx=1,Ge(this,Ze(e,n=>n!==void 0))}}class ge extends ft{constructor(e){super(e.definition),this.idx=1,Ge(this,Ze(e,n=>n!==void 0))}}class qe extends ft{constructor(e){super(e.definition),this.idx=1,Ge(this,Ze(e,n=>n!==void 0))}}class et extends ft{get definition(){return this._definition}set definition(e){this._definition=e}constructor(e){super(e.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,Ge(this,Ze(e,n=>n!==void 0))}}class ae{constructor(e){this.idx=1,Ge(this,Ze(e,n=>n!==void 0))}accept(e){e.visit(this)}}function og(t){return F(t,Ir)}function Ir(t){function e(n){return F(n,Ir)}if(t instanceof Ue){const n={type:"NonTerminal",name:t.nonTerminalName,idx:t.idx};return Fe(t.label)&&(n.label=t.label),n}else{if(t instanceof De)return{type:"Alternative",definition:e(t.definition)};if(t instanceof Oe)return{type:"Option",idx:t.idx,definition:e(t.definition)};if(t instanceof dt)return{type:"RepetitionMandatory",idx:t.idx,definition:e(t.definition)};if(t instanceof pt)return{type:"RepetitionMandatoryWithSeparator",idx:t.idx,separator:Ir(new ae({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof qe)return{type:"RepetitionWithSeparator",idx:t.idx,separator:Ir(new ae({terminalType:t.separator})),definition:e(t.definition)};if(t instanceof ge)return{type:"Repetition",idx:t.idx,definition:e(t.definition)};if(t instanceof et)return{type:"Alternation",idx:t.idx,definition:e(t.definition)};if(t instanceof ae){const n={type:"Terminal",name:t.terminalType.name,label:sg(t.terminalType),idx:t.idx};Fe(t.label)&&(n.terminalLabel=t.label);const r=t.terminalType.PATTERN;return t.terminalType.PATTERN&&(n.pattern=vt(r)?r.source:r),n}else{if(t instanceof Sn)return{type:"Rule",name:t.name,orgText:t.orgText,definition:e(t.definition)};throw Error("non exhaustive match")}}}class xn{visit(e){const n=e;switch(n.constructor){case Ue:return this.visitNonTerminal(n);case De:return this.visitAlternative(n);case Oe:return this.visitOption(n);case dt:return this.visitRepetitionMandatory(n);case pt:return this.visitRepetitionMandatoryWithSeparator(n);case qe:return this.visitRepetitionWithSeparator(n);case ge:return this.visitRepetition(n);case et:return this.visitAlternation(n);case ae:return this.visitTerminal(n);case Sn:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(e){}visitAlternative(e){}visitOption(e){}visitRepetition(e){}visitRepetitionMandatory(e){}visitRepetitionMandatoryWithSeparator(e){}visitRepetitionWithSeparator(e){}visitAlternation(e){}visitTerminal(e){}visitRule(e){}}function lg(t){return t instanceof De||t instanceof Oe||t instanceof ge||t instanceof dt||t instanceof pt||t instanceof qe||t instanceof ae||t instanceof Sn}function Ur(t,e=[]){return t instanceof Oe||t instanceof ge||t instanceof qe?!0:t instanceof et?gl(t.definition,r=>Ur(r,e)):t instanceof Ue&&Pe(e,t)?!1:t instanceof ft?(t instanceof Ue&&e.push(t),Ye(t.definition,r=>Ur(r,e))):!1}function cg(t){return t instanceof et}function it(t){if(t instanceof Ue)return"SUBRULE";if(t instanceof Oe)return"OPTION";if(t instanceof et)return"OR";if(t instanceof dt)return"AT_LEAST_ONE";if(t instanceof pt)return"AT_LEAST_ONE_SEP";if(t instanceof qe)return"MANY_SEP";if(t instanceof ge)return"MANY";if(t instanceof ae)return"CONSUME";throw Error("non exhaustive match")}class fi{walk(e,n=[]){N(e.definition,(r,i)=>{const s=Ce(e.definition,i+1);if(r instanceof Ue)this.walkProdRef(r,s,n);else if(r instanceof ae)this.walkTerminal(r,s,n);else if(r instanceof De)this.walkFlat(r,s,n);else if(r instanceof Oe)this.walkOption(r,s,n);else if(r instanceof dt)this.walkAtLeastOne(r,s,n);else if(r instanceof pt)this.walkAtLeastOneSep(r,s,n);else if(r instanceof qe)this.walkManySep(r,s,n);else if(r instanceof ge)this.walkMany(r,s,n);else if(r instanceof et)this.walkOr(r,s,n);else throw Error("non exhaustive match")})}walkTerminal(e,n,r){}walkProdRef(e,n,r){}walkFlat(e,n,r){const i=n.concat(r);this.walk(e,i)}walkOption(e,n,r){const i=n.concat(r);this.walk(e,i)}walkAtLeastOne(e,n,r){const i=[new Oe({definition:e.definition})].concat(n,r);this.walk(e,i)}walkAtLeastOneSep(e,n,r){const i=_a(e,n,r);this.walk(e,i)}walkMany(e,n,r){const i=[new Oe({definition:e.definition})].concat(n,r);this.walk(e,i)}walkManySep(e,n,r){const i=_a(e,n,r);this.walk(e,i)}walkOr(e,n,r){const i=n.concat(r);N(e.definition,s=>{const a=new De({definition:[s]});this.walk(a,i)})}}function _a(t,e,n){return[new Oe({definition:[new ae({terminalType:t.separator})].concat(t.definition)})].concat(e,n)}function fr(t){if(t instanceof Ue)return fr(t.referencedRule);if(t instanceof ae)return fg(t);if(lg(t))return ug(t);if(cg(t))return hg(t);throw Error("non exhaustive match")}function ug(t){let e=[];const n=t.definition;let r=0,i=n.length>r,s,a=!0;for(;i&&a;)s=n[r],a=Ur(s),e=e.concat(fr(s)),r=r+1,i=n.length>r;return Os(e)}function hg(t){const e=F(t.definition,n=>fr(n));return Os(Qe(e))}function fg(t){return[t.terminalType]}const El="_~IN~_";class dg extends fi{constructor(e){super(),this.topProd=e,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(e,n,r){}walkProdRef(e,n,r){const i=mg(e.referencedRule,e.idx)+this.topProd.name,s=n.concat(r),a=new De({definition:s}),o=fr(a);this.follows[i]=o}}function pg(t){const e={};return N(t,n=>{const r=new dg(n).startWalking();Ge(e,r)}),e}function mg(t,e){return t.name+e+El}function L(t){return t.charCodeAt(0)}function wi(t,e){Array.isArray(t)?t.forEach(function(n){e.push(n)}):e.push(t)}function Nn(t,e){if(t[e]===!0)throw"duplicate flag "+e;t[e],t[e]=!0}function dn(t){if(t===void 0)throw Error("Internal Error - Should never get here!");return!0}function Ag(){throw Error("Internal Error - Should never get here!")}function wa(t){return t.type==="Character"}const Hr=[];for(let t=L("0");t<=L("9");t++)Hr.push(t);const Kr=[L("_")].concat(Hr);for(let t=L("a");t<=L("z");t++)Kr.push(t);for(let t=L("A");t<=L("Z");t++)Kr.push(t);const Oa=[L(" "),L("\f"),L(`
`),L("\r"),L("	"),L("\v"),L("	"),L(""),L(""),L(""),L(""),L(""),L(""),L(""),L(""),L(""),L(""),L(""),L(""),L(""),L("\u2028"),L("\u2029"),L(""),L(""),L(""),L("\uFEFF")],gg=/[0-9a-fA-F]/,Er=/[0-9]/,Tg=/[1-9]/;class vg{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const n=this.disjunction();this.consumeChar("/");const r={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Nn(r,"global");break;case"i":Nn(r,"ignoreCase");break;case"m":Nn(r,"multiLine");break;case"u":Nn(r,"unicode");break;case"y":Nn(r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:r,value:n,loc:this.loc(0)}}disjunction(){const e=[],n=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(n)}}alternative(){const e=[],n=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(n)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");let n;switch(this.popChar()){case"=":n="Lookahead";break;case"!":n="NegativeLookahead";break}dn(n);const r=this.disjunction();return this.consumeChar(")"),{type:n,value:r,loc:this.loc(e)}}return Ag()}quantifier(e=!1){let n;const r=this.idx;switch(this.popChar()){case"*":n={atLeast:0,atMost:1/0};break;case"+":n={atLeast:1,atMost:1/0};break;case"?":n={atLeast:0,atMost:1};break;case"{":const i=this.integerIncludingZero();switch(this.popChar()){case"}":n={atLeast:i,atMost:i};break;case",":let s;this.isDigit()?(s=this.integerIncludingZero(),n={atLeast:i,atMost:s}):n={atLeast:i,atMost:1/0},this.consumeChar("}");break}if(e===!0&&n===void 0)return;dn(n);break}if(!(e===!0&&n===void 0)&&dn(n))return this.peekChar(0)==="?"?(this.consumeChar("?"),n.greedy=!1):n.greedy=!0,n.type="Quantifier",n.loc=this.loc(r),n}atom(){let e;const n=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group();break}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),dn(e))return e.loc=this.loc(n),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[L(`
`),L("\r"),L("\u2028"),L("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,n=!1;switch(this.popChar()){case"d":e=Hr;break;case"D":e=Hr,n=!0;break;case"s":e=Oa;break;case"S":e=Oa,n=!0;break;case"w":e=Kr;break;case"W":e=Kr,n=!0;break}if(dn(e))return{type:"Set",value:e,complement:n}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=L("\f");break;case"n":e=L(`
`);break;case"r":e=L("\r");break;case"t":e=L("	");break;case"v":e=L("\v");break}if(dn(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:L("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){const e=this.popChar();return{type:"Character",value:L(e)}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:const e=this.popChar();return{type:"Character",value:L(e)}}}characterClass(){const e=[];let n=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),n=!0);this.isClassAtom();){const r=this.classAtom();if(r.type,wa(r)&&this.isRangeDash()){this.consumeChar("-");const i=this.classAtom();if(i.type,wa(i)){if(i.value<r.value)throw Error("Range out of order in character class");e.push({from:r.value,to:i.value})}else wi(r.value,e),e.push(L("-")),wi(i.value,e)}else wi(r.value,e)}return this.consumeChar("]"),{type:"Set",complement:n,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:L("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),e=!1;break;default:this.groupIdx++;break}const n=this.disjunction();this.consumeChar(")");const r={type:"Group",capturing:e,value:n};return e&&(r.idx=this.groupIdx),r}positiveInteger(){let e=this.popChar();if(Tg.test(e)===!1)throw Error("Expecting a positive integer");for(;Er.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(Er.test(e)===!1)throw Error("Expecting an integer");for(;Er.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:L(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Er.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let n="";for(let i=0;i<e;i++){const s=this.popChar();if(gg.test(s)===!1)throw Error("Expecting a HexDecimal digits");n+=s}return{type:"Character",value:parseInt(n,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}}class Fs{visitChildren(e){for(const n in e){const r=e[n];e.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(e){switch(e.type){case"Pattern":this.visitPattern(e);break;case"Flags":this.visitFlags(e);break;case"Disjunction":this.visitDisjunction(e);break;case"Alternative":this.visitAlternative(e);break;case"StartAnchor":this.visitStartAnchor(e);break;case"EndAnchor":this.visitEndAnchor(e);break;case"WordBoundary":this.visitWordBoundary(e);break;case"NonWordBoundary":this.visitNonWordBoundary(e);break;case"Lookahead":this.visitLookahead(e);break;case"NegativeLookahead":this.visitNegativeLookahead(e);break;case"Character":this.visitCharacter(e);break;case"Set":this.visitSet(e);break;case"Group":this.visitGroup(e);break;case"GroupBackReference":this.visitGroupBackReference(e);break;case"Quantifier":this.visitQuantifier(e);break}this.visitChildren(e)}visitPattern(e){}visitFlags(e){}visitDisjunction(e){}visitAlternative(e){}visitStartAnchor(e){}visitEndAnchor(e){}visitWordBoundary(e){}visitNonWordBoundary(e){}visitLookahead(e){}visitNegativeLookahead(e){}visitCharacter(e){}visitSet(e){}visitGroup(e){}visitGroupBackReference(e){}visitQuantifier(e){}}let br={};const Cg=new vg;function di(t){const e=t.toString();if(br.hasOwnProperty(e))return br[e];{const n=Cg.pattern(e);return br[e]=n,n}}function Eg(){br={}}const Rl="Complement Sets are not supported for first char optimization",Jr=`Unable to use "first char" lexer optimizations:
`;function Rg(t,e=!1){try{const n=di(t);return is(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===Rl)e&&Tl(`${Jr}	Unable to optimize: < ${t.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";e&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),rs(`${Jr}
	Failed parsing: < ${t.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function is(t,e,n){switch(t.type){case"Disjunction":for(let i=0;i<t.value.length;i++)is(t.value[i],e,n);break;case"Alternative":const r=t.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const a=s;switch(a.type){case"Character":Rr(a.value,e,n);break;case"Set":if(a.complement===!0)throw Error(Rl);N(a.value,l=>{if(typeof l=="number")Rr(l,e,n);else{const c=l;if(n===!0)for(let u=c.from;u<=c.to;u++)Rr(u,e,n);else{for(let u=c.from;u<=c.to&&u<Un;u++)Rr(u,e,n);if(c.to>=Un){const u=c.from>=Un?c.from:Un,h=c.to,f=Ft(u),T=Ft(h);for(let g=f;g<=T;g++)e[g]=g}}}});break;case"Group":is(a.value,e,n);break;default:throw Error("Non Exhaustive Match")}const o=a.quantifier!==void 0&&a.quantifier.atLeast===0;if(a.type==="Group"&&ss(a)===!1||a.type!=="Group"&&o===!1)break}break;default:throw Error("non exhaustive match!")}return Ae(e)}function Rr(t,e,n){const r=Ft(t);e[r]=r,n===!0&&Bg(t,e)}function Bg(t,e){const n=String.fromCharCode(t),r=n.toUpperCase();if(r!==n){const i=Ft(r.charCodeAt(0));e[i]=i}else{const i=n.toLowerCase();if(i!==n){const s=Ft(i.charCodeAt(0));e[s]=s}}}function Fa(t,e){return Bn(t.value,n=>{if(typeof n=="number")return Pe(e,n);{const r=n;return Bn(e,i=>r.from<=i&&i<=r.to)!==void 0}})}function ss(t){const e=t.quantifier;return e&&e.atLeast===0?!0:t.value?W(t.value)?Ye(t.value,ss):ss(t.value):!1}class yg extends Fs{constructor(e){super(),this.targetCharCodes=e,this.found=!1}visitChildren(e){if(this.found!==!0){switch(e.type){case"Lookahead":this.visitLookahead(e);return;case"NegativeLookahead":this.visitNegativeLookahead(e);return}super.visitChildren(e)}}visitCharacter(e){Pe(this.targetCharCodes,e.value)&&(this.found=!0)}visitSet(e){e.complement?Fa(e,this.targetCharCodes)===void 0&&(this.found=!0):Fa(e,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Ds(t,e){if(e instanceof RegExp){const n=di(e),r=new yg(t);return r.visit(n),r.found}else return Bn(e,n=>Pe(t,n.charCodeAt(0)))!==void 0}const en="PATTERN",kn="defaultMode",Br="modes";let Bl=typeof new RegExp("(?:)").sticky=="boolean";function Sg(t,e){e=ws(e,{useSticky:Bl,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(m,p)=>p()});const n=e.tracer;n("initCharCodeToOptimizedIndexMap",()=>{Qg()});let r;n("Reject Lexer.NA",()=>{r=hi(t,m=>m[en]===je.NA)});let i=!1,s;n("Transform Patterns",()=>{i=!1,s=F(r,m=>{const p=m[en];if(vt(p)){const C=p.source;return C.length===1&&C!=="^"&&C!=="$"&&C!=="."&&!p.ignoreCase?C:C.length===2&&C[0]==="\\"&&!Pe(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],C[1])?C[1]:e.useSticky?Na(p):Da(p)}else{if(Et(p))return i=!0,{exec:p};if(typeof p=="object")return i=!0,p;if(typeof p=="string"){if(p.length===1)return p;{const C=p.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),B=new RegExp(C);return e.useSticky?Na(B):Da(B)}}else throw Error("non exhaustive match")}})});let a,o,l,c,u;n("misc mapping",()=>{a=F(r,m=>m.tokenTypeIdx),o=F(r,m=>{const p=m.GROUP;if(p!==je.SKIPPED){if(Fe(p))return p;if(Ct(p))return!1;throw Error("non exhaustive match")}}),l=F(r,m=>{const p=m.LONGER_ALT;if(p)return W(p)?F(p,B=>ba(r,B)):[ba(r,p)]}),c=F(r,m=>m.PUSH_MODE),u=F(r,m=>D(m,"POP_MODE"))});let h;n("Line Terminator Handling",()=>{const m=xl(e.lineTerminatorCharacters);h=F(r,p=>!1),e.positionTracking!=="onlyOffset"&&(h=F(r,p=>D(p,"LINE_BREAKS")?!!p.LINE_BREAKS:Sl(p,m)===!1&&Ds(m,p.PATTERN)))});let f,T,g,d;n("Misc Mapping #2",()=>{f=F(r,yl),T=F(s,Wg),g=ke(r,(m,p)=>{const C=p.GROUP;return Fe(C)&&C!==je.SKIPPED&&(m[C]=[]),m},{}),d=F(s,(m,p)=>({pattern:s[p],longerAlt:l[p],canLineTerminator:h[p],isCustom:f[p],short:T[p],group:o[p],push:c[p],pop:u[p],tokenTypeIdx:a[p],tokenType:r[p]}))});let A=!0,v=[];return e.safeMode||n("First Char Optimization",()=>{v=ke(r,(m,p,C)=>{if(typeof p.PATTERN=="string"){const B=p.PATTERN.charCodeAt(0),S=Ft(B);Oi(m,S,d[C])}else if(W(p.START_CHARS_HINT)){let B;N(p.START_CHARS_HINT,S=>{const y=typeof S=="string"?S.charCodeAt(0):S,R=Ft(y);B!==R&&(B=R,Oi(m,R,d[C]))})}else if(vt(p.PATTERN))if(p.PATTERN.unicode)A=!1,e.ensureOptimizations&&rs(`${Jr}	Unable to analyze < ${p.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const B=Rg(p.PATTERN,e.ensureOptimizations);Z(B)&&(A=!1),N(B,S=>{Oi(m,S,d[C])})}else e.ensureOptimizations&&rs(`${Jr}	TokenType: <${p.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),A=!1;return m},[])}),{emptyGroups:g,patternIdxToConfig:d,charCodeToPatternIdxToConfig:v,hasCustom:i,canBeOptimized:A}}function xg(t,e){let n=[];const r=Ig(t);n=n.concat(r.errors);const i=bg(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(Mg(s)),n=n.concat(Lg(s)),n=n.concat(Gg(s,e)),n=n.concat(kg(s)),n}function Mg(t){let e=[];const n=Xe(t,r=>vt(r[en]));return e=e.concat(_g(n)),e=e.concat(Fg(n)),e=e.concat(Dg(n)),e=e.concat(Ng(n)),e=e.concat(wg(n)),e}function Ig(t){const e=Xe(t,i=>!D(i,en)),n=F(e,i=>({message:"Token Type: ->"+i.name+"<- missing static 'PATTERN' property",type:le.MISSING_PATTERN,tokenTypes:[i]})),r=ui(t,e);return{errors:n,valid:r}}function bg(t){const e=Xe(t,i=>{const s=i[en];return!vt(s)&&!Et(s)&&!D(s,"exec")&&!Fe(s)}),n=F(e,i=>({message:"Token Type: ->"+i.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:le.INVALID_PATTERN,tokenTypes:[i]})),r=ui(t,e);return{errors:n,valid:r}}const Pg=/[^\\][$]/;function _g(t){class e extends Fs{constructor(){super(...arguments),this.found=!1}visitEndAnchor(s){this.found=!0}}const n=Xe(t,i=>{const s=i.PATTERN;try{const a=di(s),o=new e;return o.visit(a),o.found}catch{return Pg.test(s.source)}});return F(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:le.EOI_ANCHOR_FOUND,tokenTypes:[i]}))}function wg(t){const e=Xe(t,r=>r.PATTERN.test(""));return F(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' must not match an empty string",type:le.EMPTY_MATCH_PATTERN,tokenTypes:[r]}))}const Og=/[^\\[][\^]|^\^/;function Fg(t){class e extends Fs{constructor(){super(...arguments),this.found=!1}visitStartAnchor(s){this.found=!0}}const n=Xe(t,i=>{const s=i.PATTERN;try{const a=di(s),o=new e;return o.visit(a),o.found}catch{return Og.test(s.source)}});return F(n,i=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+i.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:le.SOI_ANCHOR_FOUND,tokenTypes:[i]}))}function Dg(t){const e=Xe(t,r=>{const i=r[en];return i instanceof RegExp&&(i.multiline||i.global)});return F(e,r=>({message:"Token Type: ->"+r.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:le.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[r]}))}function Ng(t){const e=[];let n=F(t,s=>ke(t,(a,o)=>(s.PATTERN.source===o.PATTERN.source&&!Pe(e,o)&&o.PATTERN!==je.NA&&(e.push(o),a.push(o)),a),[]));n=hr(n);const r=Xe(n,s=>s.length>1);return F(r,s=>{const a=F(s,l=>l.name);return{message:`The same RegExp pattern ->${$e(s).PATTERN}<-has been used in all of the following Token Types: ${a.join(", ")} <-`,type:le.DUPLICATE_PATTERNS_FOUND,tokenTypes:s}})}function Lg(t){const e=Xe(t,r=>{if(!D(r,"GROUP"))return!1;const i=r.GROUP;return i!==je.SKIPPED&&i!==je.NA&&!Fe(i)});return F(e,r=>({message:"Token Type: ->"+r.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:le.INVALID_GROUP_TYPE_FOUND,tokenTypes:[r]}))}function Gg(t,e){const n=Xe(t,i=>i.PUSH_MODE!==void 0&&!Pe(e,i.PUSH_MODE));return F(n,i=>({message:`Token Type: ->${i.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${i.PUSH_MODE}<-which does not exist`,type:le.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[i]}))}function kg(t){const e=[],n=ke(t,(r,i,s)=>{const a=i.PATTERN;return a===je.NA||(Fe(a)?r.push({str:a,idx:s,tokenType:i}):vt(a)&&Hg(a)&&r.push({str:a.source,idx:s,tokenType:i})),r},[]);return N(t,(r,i)=>{N(n,({str:s,idx:a,tokenType:o})=>{if(i<a&&Ug(s,r.PATTERN)){const l=`Token: ->${o.name}<- can never be matched.
Because it appears AFTER the Token Type ->${r.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;e.push({message:l,type:le.UNREACHABLE_PATTERN,tokenTypes:[r,o]})}})}),e}function Ug(t,e){if(vt(e)){const n=e.exec(t);return n!==null&&n.index===0}else{if(Et(e))return e(t,0,[],{});if(D(e,"exec"))return e.exec(t,0,[],{});if(typeof e=="string")return e===t;throw Error("non exhaustive match")}}function Hg(t){return Bn([".","\\","[","]","|","^","$","(",")","?","*","+","{"],n=>t.source.indexOf(n)!==-1)===void 0}function Da(t){const e=t.ignoreCase?"i":"";return new RegExp(`^(?:${t.source})`,e)}function Na(t){const e=t.ignoreCase?"iy":"y";return new RegExp(`${t.source}`,e)}function Kg(t,e,n){const r=[];return D(t,kn)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+kn+`> property in its definition
`,type:le.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),D(t,Br)||r.push({message:"A MultiMode Lexer cannot be initialized without a <"+Br+`> property in its definition
`,type:le.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),D(t,Br)&&D(t,kn)&&!D(t.modes,t.defaultMode)&&r.push({message:`A MultiMode Lexer cannot be initialized with a ${kn}: <${t.defaultMode}>which does not exist
`,type:le.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),D(t,Br)&&N(t.modes,(i,s)=>{N(i,(a,o)=>{if(Ct(a))r.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${s}> at index: <${o}>
`,type:le.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED});else if(D(a,"LONGER_ALT")){const l=W(a.LONGER_ALT)?a.LONGER_ALT:[a.LONGER_ALT];N(l,c=>{!Ct(c)&&!Pe(i,c)&&r.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${c.name}> on token <${a.name}> outside of mode <${s}>
`,type:le.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})}})}),r}function Jg(t,e,n){const r=[];let i=!1;const s=hr(Qe(Ae(t.modes))),a=hi(s,l=>l[en]===je.NA),o=xl(n);return e&&N(a,l=>{const c=Sl(l,o);if(c!==!1){const h={message:Xg(l,c),type:c.issue,tokenType:l};r.push(h)}else D(l,"LINE_BREAKS")?l.LINE_BREAKS===!0&&(i=!0):Ds(o,l.PATTERN)&&(i=!0)}),e&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:le.NO_LINE_BREAKS_FLAGS}),r}function jg(t){const e={},n=Le(t);return N(n,r=>{const i=t[r];if(W(i))e[r]=[];else throw Error("non exhaustive match")}),e}function yl(t){const e=t.PATTERN;if(vt(e))return!1;if(Et(e))return!0;if(D(e,"exec"))return!0;if(Fe(e))return!1;throw Error("non exhaustive match")}function Wg(t){return Fe(t)&&t.length===1?t.charCodeAt(0):!1}const Vg={test:function(t){const e=t.length;for(let n=this.lastIndex;n<e;n++){const r=t.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return t.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function Sl(t,e){if(D(t,"LINE_BREAKS"))return!1;if(vt(t.PATTERN)){try{Ds(e,t.PATTERN)}catch(n){return{issue:le.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}else{if(Fe(t.PATTERN))return!1;if(yl(t))return{issue:le.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function Xg(t,e){if(e.issue===le.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${t.name}> Token Type
	 Root cause: ${e.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(e.issue===le.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${t.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}function xl(t){return F(t,n=>Fe(n)?n.charCodeAt(0):n)}function Oi(t,e,n){t[e]===void 0?t[e]=[n]:t[e].push(n)}const Un=256;let Pr=[];function Ft(t){return t<Un?t:Pr[t]}function Qg(){if(Z(Pr)){Pr=new Array(65536);for(let t=0;t<65536;t++)Pr[t]=t>255?255+~~(t/255):t}}function dr(t,e){const n=t.tokenTypeIdx;return n===e.tokenTypeIdx?!0:e.isParent===!0&&e.categoryMatchesMap[n]===!0}function jr(t,e){return t.tokenTypeIdx===e.tokenTypeIdx}let La=1;const Ml={};function pr(t){const e=Yg(t);zg(e),Zg(e),$g(e),N(e,n=>{n.isParent=n.categoryMatches.length>0})}function Yg(t){let e=Be(t),n=t,r=!0;for(;r;){n=hr(Qe(F(n,s=>s.CATEGORIES)));const i=ui(n,e);e=e.concat(i),Z(i)?r=!1:n=i}return e}function zg(t){N(t,e=>{bl(e)||(Ml[La]=e,e.tokenTypeIdx=La++),Ga(e)&&!W(e.CATEGORIES)&&(e.CATEGORIES=[e.CATEGORIES]),Ga(e)||(e.CATEGORIES=[]),qg(e)||(e.categoryMatches=[]),eT(e)||(e.categoryMatchesMap={})})}function $g(t){N(t,e=>{e.categoryMatches=[],N(e.categoryMatchesMap,(n,r)=>{e.categoryMatches.push(Ml[r].tokenTypeIdx)})})}function Zg(t){N(t,e=>{Il([],e)})}function Il(t,e){N(t,n=>{e.categoryMatchesMap[n.tokenTypeIdx]=!0}),N(e.CATEGORIES,n=>{const r=t.concat(e);Pe(r,n)||Il(r,n)})}function bl(t){return D(t,"tokenTypeIdx")}function Ga(t){return D(t,"CATEGORIES")}function qg(t){return D(t,"categoryMatches")}function eT(t){return D(t,"categoryMatchesMap")}function tT(t){return D(t,"tokenTypeIdx")}const nT={buildUnableToPopLexerModeMessage(t){return`Unable to pop Lexer Mode after encountering Token ->${t.image}<- The Mode Stack is empty`},buildUnexpectedCharactersMessage(t,e,n,r,i){return`unexpected character: ->${t.charAt(e)}<- at offset: ${e}, skipped ${n} characters.`}};var le;(function(t){t[t.MISSING_PATTERN=0]="MISSING_PATTERN",t[t.INVALID_PATTERN=1]="INVALID_PATTERN",t[t.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",t[t.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",t[t.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",t[t.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",t[t.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",t[t.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",t[t.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",t[t.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",t[t.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",t[t.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",t[t.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",t[t.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",t[t.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",t[t.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",t[t.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",t[t.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(le||(le={}));const Hn={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:nT,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(Hn);class je{constructor(e,n=Hn){if(this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const a=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${a}--> <${i}>`);const{time:o,value:l}=vl(s),c=o>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&c(`${a}<-- <${i}> time: ${o}ms`),this.traceInitIndent--,l}else return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=Ge({},Hn,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===Hn.lineTerminatorsPattern)this.config.lineTerminatorsPattern=Vg;else if(this.config.lineTerminatorCharacters===Hn.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),W(e)?i={modes:{defaultMode:Be(e)},defaultMode:kn}:(s=!1,i=Be(e))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(Kg(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(Jg(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},N(i.modes,(o,l)=>{i.modes[l]=hi(o,c=>Ct(c))});const a=Le(i.modes);if(N(i.modes,(o,l)=>{this.TRACE_INIT(`Mode: <${l}> processing`,()=>{if(this.modes.push(l),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(xg(o,a))}),Z(this.lexerDefinitionErrors)){pr(o);let c;this.TRACE_INIT("analyzeTokenTypes",()=>{c=Sg(o,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[l]=c.patternIdxToConfig,this.charCodeToPatternIdxToConfig[l]=c.charCodeToPatternIdxToConfig,this.emptyGroups=Ge({},this.emptyGroups,c.emptyGroups),this.hasCustom=c.hasCustom||this.hasCustom,this.canModeBeOptimized[l]=c.canBeOptimized}})}),this.defaultMode=i.defaultMode,!Z(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const l=F(this.lexerDefinitionErrors,c=>c.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+l)}N(this.lexerDefinitionWarning,o=>{Tl(o.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(Bl?(this.chopInput=vn,this.match=this.matchWithTest):(this.updateLastIndex=me,this.match=this.matchWithExec),s&&(this.handleModes=me),this.trackStartLines===!1&&(this.computeNewColumn=vn),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=me),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const o=ke(this.canModeBeOptimized,(l,c,u)=>(c===!1&&l.push(u),l),[]);if(n.ensureOptimizations&&!Z(o))throw Error(`Lexer Modes: < ${o.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{Eg()}),this.TRACE_INIT("toFastProperties",()=>{Cl(this)})})}tokenize(e,n=this.defaultMode){if(!Z(this.lexerDefinitionErrors)){const i=F(this.lexerDefinitionErrors,s=>s.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+i)}return this.tokenizeInternal(e,n)}tokenizeInternal(e,n){let r,i,s,a,o,l,c,u,h,f,T,g,d,A,v;const m=e,p=m.length;let C=0,B=0;const S=this.hasCustom?0:Math.floor(e.length/10),y=new Array(S),R=[];let M=this.trackStartLines?1:void 0,I=this.trackStartLines?1:void 0;const b=jg(this.emptyGroups),O=this.trackStartLines,w=this.config.lineTerminatorsPattern;let k=0,U=[],H=[];const j=[],ne=[];Object.freeze(ne);let Q;function Y(){return U}function ve(re){const ce=Ft(re),pe=H[ce];return pe===void 0?ne:pe}const ye=re=>{if(j.length===1&&re.tokenType.PUSH_MODE===void 0){const ce=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(re);R.push({offset:re.startOffset,line:re.startLine,column:re.startColumn,length:re.image.length,message:ce})}else{j.pop();const ce=Rn(j);U=this.patternIdxToConfig[ce],H=this.charCodeToPatternIdxToConfig[ce],k=U.length;const pe=this.canModeBeOptimized[ce]&&this.config.safeMode===!1;H&&pe?Q=ve:Q=Y}};function Ne(re){j.push(re),H=this.charCodeToPatternIdxToConfig[re],U=this.patternIdxToConfig[re],k=U.length,k=U.length;const ce=this.canModeBeOptimized[re]&&this.config.safeMode===!1;H&&ce?Q=ve:Q=Y}Ne.call(this,n);let de;const tt=this.config.recoveryEnabled;for(;C<p;){l=null;const re=m.charCodeAt(C),ce=Q(re),pe=ce.length;for(r=0;r<pe;r++){de=ce[r];const z=de.pattern;c=null;const ue=de.short;if(ue!==!1?re===ue&&(l=z):de.isCustom===!0?(v=z.exec(m,C,y,b),v!==null?(l=v[0],v.payload!==void 0&&(c=v.payload)):l=null):(this.updateLastIndex(z,C),l=this.match(z,e,C)),l!==null){if(o=de.longerAlt,o!==void 0){const fe=o.length;for(s=0;s<fe;s++){const Ee=U[o[s]],_e=Ee.pattern;if(u=null,Ee.isCustom===!0?(v=_e.exec(m,C,y,b),v!==null?(a=v[0],v.payload!==void 0&&(u=v.payload)):a=null):(this.updateLastIndex(_e,C),a=this.match(_e,e,C)),a&&a.length>l.length){l=a,c=u,de=Ee;break}}}break}}if(l!==null){if(h=l.length,f=de.group,f!==void 0&&(T=de.tokenTypeIdx,g=this.createTokenInstance(l,C,T,de.tokenType,M,I,h),this.handlePayload(g,c),f===!1?B=this.addToken(y,B,g):b[f].push(g)),e=this.chopInput(e,h),C=C+h,I=this.computeNewColumn(I,h),O===!0&&de.canLineTerminator===!0){let z=0,ue,fe;w.lastIndex=0;do ue=w.test(l),ue===!0&&(fe=w.lastIndex-1,z++);while(ue===!0);z!==0&&(M=M+z,I=h-fe,this.updateTokenEndLineColumnLocation(g,f,fe,z,M,I,h))}this.handleModes(de,ye,Ne,g)}else{const z=C,ue=M,fe=I;let Ee=tt===!1;for(;Ee===!1&&C<p;)for(e=this.chopInput(e,1),C++,i=0;i<k;i++){const _e=U[i],nt=_e.pattern,yt=_e.short;if(yt!==!1?m.charCodeAt(C)===yt&&(Ee=!0):_e.isCustom===!0?Ee=nt.exec(m,C,y,b)!==null:(this.updateLastIndex(nt,C),Ee=nt.exec(e)!==null),Ee===!0)break}if(d=C-z,I=this.computeNewColumn(I,d),A=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(m,z,d,ue,fe),R.push({offset:z,line:ue,column:fe,length:d,message:A}),tt===!1)break}}return this.hasCustom||(y.length=B),{tokens:y,groups:b,errors:R}}handleModes(e,n,r,i){if(e.pop===!0){const s=e.push;n(i),s!==void 0&&r.call(this,s)}else e.push!==void 0&&r.call(this,e.push)}chopInput(e,n){return e.substring(n)}updateLastIndex(e,n){e.lastIndex=n}updateTokenEndLineColumnLocation(e,n,r,i,s,a,o){let l,c;n!==void 0&&(l=r===o-1,c=l?-1:0,i===1&&l===!0||(e.endLine=s+c,e.endColumn=a-1+-c))}computeNewColumn(e,n){return e+n}createOffsetOnlyToken(e,n,r,i){return{image:e,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(e,n,r,i,s,a){return{image:e,startOffset:n,startLine:s,startColumn:a,tokenTypeIdx:r,tokenType:i}}createFullToken(e,n,r,i,s,a,o){return{image:e,startOffset:n,endOffset:n+o-1,startLine:s,endLine:s,startColumn:a,endColumn:a+o-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(e,n,r){return e.push(r),n}addTokenUsingMemberAccess(e,n,r){return e[n]=r,n++,n}handlePayloadNoCustom(e,n){}handlePayloadWithCustom(e,n){n!==null&&(e.payload=n)}matchWithTest(e,n,r){return e.test(n)===!0?n.substring(r,e.lastIndex):null}matchWithExec(e,n){const r=e.exec(n);return r!==null?r[0]:null}}je.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.";je.NA=/NOT_APPLICABLE/;function $n(t){return Pl(t)?t.LABEL:t.name}function Pl(t){return Fe(t.LABEL)&&t.LABEL!==""}const rT="parent",ka="categories",Ua="label",Ha="group",Ka="push_mode",Ja="pop_mode",ja="longer_alt",Wa="line_breaks",Va="start_chars_hint";function _l(t){return iT(t)}function iT(t){const e=t.pattern,n={};if(n.name=t.name,Ct(e)||(n.PATTERN=e),D(t,rT))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return D(t,ka)&&(n.CATEGORIES=t[ka]),pr([n]),D(t,Ua)&&(n.LABEL=t[Ua]),D(t,Ha)&&(n.GROUP=t[Ha]),D(t,Ja)&&(n.POP_MODE=t[Ja]),D(t,Ka)&&(n.PUSH_MODE=t[Ka]),D(t,ja)&&(n.LONGER_ALT=t[ja]),D(t,Wa)&&(n.LINE_BREAKS=t[Wa]),D(t,Va)&&(n.START_CHARS_HINT=t[Va]),n}const tn=_l({name:"EOF",pattern:je.NA});pr([tn]);function Ns(t,e,n,r,i,s,a,o){return{image:e,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:a,endColumn:o,tokenTypeIdx:t.tokenTypeIdx,tokenType:t}}function sT(t,e){return dr(t,e)}const wl={buildMismatchTokenMessage({expected:t,actual:e,previous:n,ruleName:r}){return`Expecting ${Pl(t)?`--> ${$n(t)} <--`:`token of type --> ${t.name} <--`} but found --> '${e.image}' <--`},buildNotAllInputParsedMessage({firstRedundant:t,ruleName:e}){return"Redundant input, expecting EOF but found: "+t.image},buildNoViableAltMessage({expectedPathsPerAlt:t,actual:e,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",o=`
but found: '`+$e(e).image+"'";if(r)return s+r+o;{const l=ke(t,(f,T)=>f.concat(T),[]),c=F(l,f=>`[${F(f,T=>$n(T)).join(", ")}]`),h=`one of these possible Token sequences:
${F(c,(f,T)=>`  ${T+1}. ${f}`).join(`
`)}`;return s+h+o}},buildEarlyExitMessage({expectedIterationPaths:t,actual:e,customUserDescription:n,ruleName:r}){const i="Expecting: ",a=`
but found: '`+$e(e).image+"'";if(n)return i+n+a;{const l=`expecting at least one iteration which starts with one of these possible Token sequences::
  <${F(t,c=>`[${F(c,u=>$n(u)).join(",")}]`).join(" ,")}>`;return i+l+a}}};Object.freeze(wl);const aT={buildRuleNotFoundError(t,e){return"Invalid grammar, reference to a rule which is not defined: ->"+e.nonTerminalName+`<-
inside top level rule: ->`+t.name+"<-"}},Yt={buildDuplicateFoundError(t,e){function n(u){return u instanceof ae?u.terminalType.name:u instanceof Ue?u.nonTerminalName:""}const r=t.name,i=$e(e),s=i.idx,a=it(i),o=n(i),l=s>0;let c=`->${a}${l?s:""}<- ${o?`with argument: ->${o}<-`:""}
                  appears more than once (${e.length} times) in the top level rule: ->${r}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return c=c.replace(/[ \t]+/g," "),c=c.replace(/\s\s+/g,`
`),c},buildNamespaceConflictError(t){return`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${t.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError(t){const e=F(t.prefixPath,i=>$n(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;return`Ambiguous alternatives: <${t.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(t){const e=F(t.prefixPath,i=>$n(i)).join(", "),n=t.alternation.idx===0?"":t.alternation.idx;let r=`Ambiguous Alternatives Detected: <${t.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${t.topLevelRule.name}> Rule,
<${e}> may appears as a prefix path in all these alternatives.
`;return r=r+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(t){let e=it(t.repetition);return t.repetition.idx!==0&&(e+=t.repetition.idx),`The repetition <${e}> within Rule <${t.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError(t){return"deprecated"},buildEmptyAlternationError(t){return`Ambiguous empty alternative: <${t.emptyChoiceIdx+1}> in <OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError(t){return`An Alternation cannot have more than 256 alternatives:
<OR${t.alternation.idx}> inside <${t.topLevelRule.name}> Rule.
 has ${t.alternation.definition.length+1} alternatives.`},buildLeftRecursionError(t){const e=t.topLevelRule.name,n=F(t.leftRecursionPath,s=>s.name),r=`${e} --> ${n.concat([e]).join(" --> ")}`;return`Left Recursion found in grammar.
rule: <${e}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${r}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError(t){return"deprecated"},buildDuplicateRuleNameError(t){let e;return t.topLevelRule instanceof Sn?e=t.topLevelRule.name:e=t.topLevelRule,`Duplicate definition, rule: ->${e}<- is already defined in the grammar: ->${t.grammarName}<-`}};function oT(t,e){const n=new lT(t,e);return n.resolveRefs(),n.errors}class lT extends xn{constructor(e,n){super(),this.nameToTopRule=e,this.errMsgProvider=n,this.errors=[]}resolveRefs(){N(Ae(this.nameToTopRule),e=>{this.currTopLevel=e,e.accept(this)})}visitNonTerminal(e){const n=this.nameToTopRule[e.nonTerminalName];if(n)e.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:be.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}}}class cT extends fi{constructor(e,n){super(),this.topProd=e,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=Be(this.path.ruleStack).reverse(),this.occurrenceStack=Be(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(e,n=[]){this.found||super.walk(e,n)}walkProdRef(e,n,r){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(e.referencedRule,i)}}updateExpectedNext(){Z(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class uT extends cT{constructor(e,n){super(e,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(e,n,r){if(this.isAtEndOfPath&&e.terminalType.name===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new De({definition:i});this.possibleTokTypes=fr(s),this.found=!0}}}class pi extends fi{constructor(e,n){super(),this.topRule=e,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class hT extends pi{walkMany(e,n,r){if(e.idx===this.occurrence){const i=$e(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(e,n,r)}}class Xa extends pi{walkManySep(e,n,r){if(e.idx===this.occurrence){const i=$e(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(e,n,r)}}class fT extends pi{walkAtLeastOne(e,n,r){if(e.idx===this.occurrence){const i=$e(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(e,n,r)}}class Qa extends pi{walkAtLeastOneSep(e,n,r){if(e.idx===this.occurrence){const i=$e(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof ae&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(e,n,r)}}function as(t,e,n=[]){n=Be(n);let r=[],i=0;function s(o){return o.concat(Ce(t,i+1))}function a(o){const l=as(s(o),e,n);return r.concat(l)}for(;n.length<e&&i<t.length;){const o=t[i];if(o instanceof De)return a(o.definition);if(o instanceof Ue)return a(o.definition);if(o instanceof Oe)r=a(o.definition);else if(o instanceof dt){const l=o.definition.concat([new ge({definition:o.definition})]);return a(l)}else if(o instanceof pt){const l=[new De({definition:o.definition}),new ge({definition:[new ae({terminalType:o.separator})].concat(o.definition)})];return a(l)}else if(o instanceof qe){const l=o.definition.concat([new ge({definition:[new ae({terminalType:o.separator})].concat(o.definition)})]);r=a(l)}else if(o instanceof ge){const l=o.definition.concat([new ge({definition:o.definition})]);r=a(l)}else{if(o instanceof et)return N(o.definition,l=>{Z(l.definition)===!1&&(r=a(l.definition))}),r;if(o instanceof ae)n.push(o.terminalType);else throw Error("non exhaustive match")}i++}return r.push({partialPath:n,suffixDef:Ce(t,i)}),r}function Ol(t,e,n,r){const i="EXIT_NONE_TERMINAL",s=[i],a="EXIT_ALTERNATIVE";let o=!1;const l=e.length,c=l-r-1,u=[],h=[];for(h.push({idx:-1,def:t,ruleStack:[],occurrenceStack:[]});!Z(h);){const f=h.pop();if(f===a){o&&Rn(h).idx<=c&&h.pop();continue}const T=f.def,g=f.idx,d=f.ruleStack,A=f.occurrenceStack;if(Z(T))continue;const v=T[0];if(v===i){const m={idx:g,def:Ce(T),ruleStack:nr(d),occurrenceStack:nr(A)};h.push(m)}else if(v instanceof ae)if(g<l-1){const m=g+1,p=e[m];if(n(p,v.terminalType)){const C={idx:m,def:Ce(T),ruleStack:d,occurrenceStack:A};h.push(C)}}else if(g===l-1)u.push({nextTokenType:v.terminalType,nextTokenOccurrence:v.idx,ruleStack:d,occurrenceStack:A}),o=!0;else throw Error("non exhaustive match");else if(v instanceof Ue){const m=Be(d);m.push(v.nonTerminalName);const p=Be(A);p.push(v.idx);const C={idx:g,def:v.definition.concat(s,Ce(T)),ruleStack:m,occurrenceStack:p};h.push(C)}else if(v instanceof Oe){const m={idx:g,def:Ce(T),ruleStack:d,occurrenceStack:A};h.push(m),h.push(a);const p={idx:g,def:v.definition.concat(Ce(T)),ruleStack:d,occurrenceStack:A};h.push(p)}else if(v instanceof dt){const m=new ge({definition:v.definition,idx:v.idx}),p=v.definition.concat([m],Ce(T)),C={idx:g,def:p,ruleStack:d,occurrenceStack:A};h.push(C)}else if(v instanceof pt){const m=new ae({terminalType:v.separator}),p=new ge({definition:[m].concat(v.definition),idx:v.idx}),C=v.definition.concat([p],Ce(T)),B={idx:g,def:C,ruleStack:d,occurrenceStack:A};h.push(B)}else if(v instanceof qe){const m={idx:g,def:Ce(T),ruleStack:d,occurrenceStack:A};h.push(m),h.push(a);const p=new ae({terminalType:v.separator}),C=new ge({definition:[p].concat(v.definition),idx:v.idx}),B=v.definition.concat([C],Ce(T)),S={idx:g,def:B,ruleStack:d,occurrenceStack:A};h.push(S)}else if(v instanceof ge){const m={idx:g,def:Ce(T),ruleStack:d,occurrenceStack:A};h.push(m),h.push(a);const p=new ge({definition:v.definition,idx:v.idx}),C=v.definition.concat([p],Ce(T)),B={idx:g,def:C,ruleStack:d,occurrenceStack:A};h.push(B)}else if(v instanceof et)for(let m=v.definition.length-1;m>=0;m--){const p=v.definition[m],C={idx:g,def:p.definition.concat(Ce(T)),ruleStack:d,occurrenceStack:A};h.push(C),h.push(a)}else if(v instanceof De)h.push({idx:g,def:v.definition.concat(Ce(T)),ruleStack:d,occurrenceStack:A});else if(v instanceof Sn)h.push(dT(v,g,d,A));else throw Error("non exhaustive match")}return u}function dT(t,e,n,r){const i=Be(n);i.push(t.name);const s=Be(r);return s.push(1),{idx:e,def:t.definition,ruleStack:i,occurrenceStack:s}}var oe;(function(t){t[t.OPTION=0]="OPTION",t[t.REPETITION=1]="REPETITION",t[t.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",t[t.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",t[t.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",t[t.ALTERNATION=5]="ALTERNATION"})(oe||(oe={}));function Fl(t){if(t instanceof Oe||t==="Option")return oe.OPTION;if(t instanceof ge||t==="Repetition")return oe.REPETITION;if(t instanceof dt||t==="RepetitionMandatory")return oe.REPETITION_MANDATORY;if(t instanceof pt||t==="RepetitionMandatoryWithSeparator")return oe.REPETITION_MANDATORY_WITH_SEPARATOR;if(t instanceof qe||t==="RepetitionWithSeparator")return oe.REPETITION_WITH_SEPARATOR;if(t instanceof et||t==="Alternation")return oe.ALTERNATION;throw Error("non exhaustive match")}function pT(t,e,n,r,i,s){const a=Ls(t,e,n),o=Ll(a)?jr:dr;return s(a,r,o,i)}function mT(t,e,n,r,i,s){const a=Gs(t,e,i,n),o=Ll(a)?jr:dr;return s(a[0],o,r)}function AT(t,e,n,r){const i=t.length,s=Ye(t,a=>Ye(a,o=>o.length===1));if(e)return function(a){const o=F(a,l=>l.GATE);for(let l=0;l<i;l++){const c=t[l],u=c.length,h=o[l];if(!(h!==void 0&&h.call(this)===!1))e:for(let f=0;f<u;f++){const T=c[f],g=T.length;for(let d=0;d<g;d++){const A=this.LA(d+1);if(n(A,T[d])===!1)continue e}return l}}};if(s&&!r){const a=F(t,l=>Qe(l)),o=ke(a,(l,c,u)=>(N(c,h=>{D(l,h.tokenTypeIdx)||(l[h.tokenTypeIdx]=u),N(h.categoryMatches,f=>{D(l,f)||(l[f]=u)})}),l),{});return function(){const l=this.LA(1);return o[l.tokenTypeIdx]}}else return function(){for(let a=0;a<i;a++){const o=t[a],l=o.length;e:for(let c=0;c<l;c++){const u=o[c],h=u.length;for(let f=0;f<h;f++){const T=this.LA(f+1);if(n(T,u[f])===!1)continue e}return a}}}}function gT(t,e,n){const r=Ye(t,s=>s.length===1),i=t.length;if(r&&!n){const s=Qe(t);if(s.length===1&&Z(s[0].categoryMatches)){const o=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===o}}else{const a=ke(s,(o,l,c)=>(o[l.tokenTypeIdx]=!0,N(l.categoryMatches,u=>{o[u]=!0}),o),[]);return function(){const o=this.LA(1);return a[o.tokenTypeIdx]===!0}}}else return function(){e:for(let s=0;s<i;s++){const a=t[s],o=a.length;for(let l=0;l<o;l++){const c=this.LA(l+1);if(e(c,a[l])===!1)continue e}return!0}return!1}}class TT extends fi{constructor(e,n,r){super(),this.topProd=e,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(e,n,r,i){return e.idx===this.targetOccurrence&&this.targetProdType===n?(this.restDef=r.concat(i),!0):!1}walkOption(e,n,r){this.checkIsTarget(e,oe.OPTION,n,r)||super.walkOption(e,n,r)}walkAtLeastOne(e,n,r){this.checkIsTarget(e,oe.REPETITION_MANDATORY,n,r)||super.walkOption(e,n,r)}walkAtLeastOneSep(e,n,r){this.checkIsTarget(e,oe.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}walkMany(e,n,r){this.checkIsTarget(e,oe.REPETITION,n,r)||super.walkOption(e,n,r)}walkManySep(e,n,r){this.checkIsTarget(e,oe.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(e,n,r)}}class Dl extends xn{constructor(e,n,r){super(),this.targetOccurrence=e,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(e,n){e.idx===this.targetOccurrence&&this.targetProdType===n&&(this.targetRef===void 0||e===this.targetRef)&&(this.result=e.definition)}visitOption(e){this.checkIsTarget(e,oe.OPTION)}visitRepetition(e){this.checkIsTarget(e,oe.REPETITION)}visitRepetitionMandatory(e){this.checkIsTarget(e,oe.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(e){this.checkIsTarget(e,oe.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(e){this.checkIsTarget(e,oe.REPETITION_WITH_SEPARATOR)}visitAlternation(e){this.checkIsTarget(e,oe.ALTERNATION)}}function Ya(t){const e=new Array(t);for(let n=0;n<t;n++)e[n]=[];return e}function Fi(t){let e=[""];for(let n=0;n<t.length;n++){const r=t[n],i=[];for(let s=0;s<e.length;s++){const a=e[s];i.push(a+"_"+r.tokenTypeIdx);for(let o=0;o<r.categoryMatches.length;o++){const l="_"+r.categoryMatches[o];i.push(a+l)}}e=i}return e}function vT(t,e,n){for(let r=0;r<t.length;r++){if(r===n)continue;const i=t[r];for(let s=0;s<e.length;s++){const a=e[s];if(i[a]===!0)return!1}}return!0}function Nl(t,e){const n=F(t,a=>as([a],1)),r=Ya(n.length),i=F(n,a=>{const o={};return N(a,l=>{const c=Fi(l.partialPath);N(c,u=>{o[u]=!0})}),o});let s=n;for(let a=1;a<=e;a++){const o=s;s=Ya(o.length);for(let l=0;l<o.length;l++){const c=o[l];for(let u=0;u<c.length;u++){const h=c[u].partialPath,f=c[u].suffixDef,T=Fi(h);if(vT(i,T,l)||Z(f)||h.length===e){const d=r[l];if(os(d,h)===!1){d.push(h);for(let A=0;A<T.length;A++){const v=T[A];i[l][v]=!0}}}else{const d=as(f,a+1,h);s[l]=s[l].concat(d),N(d,A=>{const v=Fi(A.partialPath);N(v,m=>{i[l][m]=!0})})}}}}return r}function Ls(t,e,n,r){const i=new Dl(t,oe.ALTERNATION,r);return e.accept(i),Nl(i.result,n)}function Gs(t,e,n,r){const i=new Dl(t,n);e.accept(i);const s=i.result,o=new TT(e,t,n).startWalking(),l=new De({definition:s}),c=new De({definition:o});return Nl([l,c],r)}function os(t,e){e:for(let n=0;n<t.length;n++){const r=t[n];if(r.length===e.length){for(let i=0;i<r.length;i++){const s=e[i],a=r[i];if((s===a||a.categoryMatchesMap[s.tokenTypeIdx]!==void 0)===!1)continue e}return!0}}return!1}function CT(t,e){return t.length<e.length&&Ye(t,(n,r)=>{const i=e[r];return n===i||i.categoryMatchesMap[n.tokenTypeIdx]})}function Ll(t){return Ye(t,e=>Ye(e,n=>Ye(n,r=>Z(r.categoryMatches))))}function ET(t){const e=t.lookaheadStrategy.validate({rules:t.rules,tokenTypes:t.tokenTypes,grammarName:t.grammarName});return F(e,n=>Object.assign({type:be.CUSTOM_LOOKAHEAD_VALIDATION},n))}function RT(t,e,n,r){const i=Je(t,l=>BT(l,n)),s=DT(t,e,n),a=Je(t,l=>_T(l,n)),o=Je(t,l=>xT(l,t,r,n));return i.concat(s,a,o)}function BT(t,e){const n=new ST;t.accept(n);const r=n.allProductions,i=OA(r,yT),s=Ze(i,o=>o.length>1);return F(Ae(s),o=>{const l=$e(o),c=e.buildDuplicateFoundError(t,o),u=it(l),h={message:c,type:be.DUPLICATE_PRODUCTIONS,ruleName:t.name,dslName:u,occurrence:l.idx},f=Gl(l);return f&&(h.parameter=f),h})}function yT(t){return`${it(t)}_#_${t.idx}_#_${Gl(t)}`}function Gl(t){return t instanceof ae?t.terminalType.name:t instanceof Ue?t.nonTerminalName:""}class ST extends xn{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(e){this.allProductions.push(e)}visitOption(e){this.allProductions.push(e)}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}visitAlternation(e){this.allProductions.push(e)}visitTerminal(e){this.allProductions.push(e)}}function xT(t,e,n,r){const i=[];if(ke(e,(a,o)=>o.name===t.name?a+1:a,0)>1){const a=r.buildDuplicateRuleNameError({topLevelRule:t,grammarName:n});i.push({message:a,type:be.DUPLICATE_RULE_NAME,ruleName:t.name})}return i}function MT(t,e,n){const r=[];let i;return Pe(e,t)||(i=`Invalid rule override, rule: ->${t}<- cannot be overridden in the grammar: ->${n}<-as it is not defined in any of the super grammars `,r.push({message:i,type:be.INVALID_RULE_OVERRIDE,ruleName:t})),r}function kl(t,e,n,r=[]){const i=[],s=_r(e.definition);if(Z(s))return[];{const a=t.name;Pe(s,t)&&i.push({message:n.buildLeftRecursionError({topLevelRule:t,leftRecursionPath:r}),type:be.LEFT_RECURSION,ruleName:a});const l=ui(s,r.concat([t])),c=Je(l,u=>{const h=Be(r);return h.push(u),kl(t,u,n,h)});return i.concat(c)}}function _r(t){let e=[];if(Z(t))return e;const n=$e(t);if(n instanceof Ue)e.push(n.referencedRule);else if(n instanceof De||n instanceof Oe||n instanceof dt||n instanceof pt||n instanceof qe||n instanceof ge)e=e.concat(_r(n.definition));else if(n instanceof et)e=Qe(F(n.definition,s=>_r(s.definition)));else if(!(n instanceof ae))throw Error("non exhaustive match");const r=Ur(n),i=t.length>1;if(r&&i){const s=Ce(t);return e.concat(_r(s))}else return e}class ks extends xn{constructor(){super(...arguments),this.alternations=[]}visitAlternation(e){this.alternations.push(e)}}function IT(t,e){const n=new ks;t.accept(n);const r=n.alternations;return Je(r,s=>{const a=nr(s.definition);return Je(a,(o,l)=>{const c=Ol([o],[],dr,1);return Z(c)?[{message:e.buildEmptyAlternationError({topLevelRule:t,alternation:s,emptyChoiceIdx:l}),type:be.NONE_LAST_EMPTY_ALT,ruleName:t.name,occurrence:s.idx,alternative:l+1}]:[]})})}function bT(t,e,n){const r=new ks;t.accept(r);let i=r.alternations;return i=hi(i,a=>a.ignoreAmbiguities===!0),Je(i,a=>{const o=a.idx,l=a.maxLookahead||e,c=Ls(o,t,l,a),u=OT(c,a,t,n),h=FT(c,a,t,n);return u.concat(h)})}class PT extends xn{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(e){this.allProductions.push(e)}visitRepetitionMandatory(e){this.allProductions.push(e)}visitRepetitionMandatoryWithSeparator(e){this.allProductions.push(e)}visitRepetition(e){this.allProductions.push(e)}}function _T(t,e){const n=new ks;t.accept(n);const r=n.alternations;return Je(r,s=>s.definition.length>255?[{message:e.buildTooManyAlternativesError({topLevelRule:t,alternation:s}),type:be.TOO_MANY_ALTS,ruleName:t.name,occurrence:s.idx}]:[])}function wT(t,e,n){const r=[];return N(t,i=>{const s=new PT;i.accept(s);const a=s.allProductions;N(a,o=>{const l=Fl(o),c=o.maxLookahead||e,u=o.idx,f=Gs(u,i,l,c)[0];if(Z(Qe(f))){const T=n.buildEmptyRepetitionError({topLevelRule:i,repetition:o});r.push({message:T,type:be.NO_NON_EMPTY_LOOKAHEAD,ruleName:i.name})}})}),r}function OT(t,e,n,r){const i=[],s=ke(t,(o,l,c)=>(e.definition[c].ignoreAmbiguities===!0||N(l,u=>{const h=[c];N(t,(f,T)=>{c!==T&&os(f,u)&&e.definition[T].ignoreAmbiguities!==!0&&h.push(T)}),h.length>1&&!os(i,u)&&(i.push(u),o.push({alts:h,path:u}))}),o),[]);return F(s,o=>{const l=F(o.alts,u=>u+1);return{message:r.buildAlternationAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:l,prefixPath:o.path}),type:be.AMBIGUOUS_ALTS,ruleName:n.name,occurrence:e.idx,alternatives:o.alts}})}function FT(t,e,n,r){const i=ke(t,(a,o,l)=>{const c=F(o,u=>({idx:l,path:u}));return a.concat(c)},[]);return hr(Je(i,a=>{if(e.definition[a.idx].ignoreAmbiguities===!0)return[];const l=a.idx,c=a.path,u=Xe(i,f=>e.definition[f.idx].ignoreAmbiguities!==!0&&f.idx<l&&CT(f.path,c));return F(u,f=>{const T=[f.idx+1,l+1],g=e.idx===0?"":e.idx;return{message:r.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:e,ambiguityIndices:T,prefixPath:f.path}),type:be.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:g,alternatives:T}})}))}function DT(t,e,n){const r=[],i=F(e,s=>s.name);return N(t,s=>{const a=s.name;if(Pe(i,a)){const o=n.buildNamespaceConflictError(s);r.push({message:o,type:be.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:a})}}),r}function NT(t){const e=ws(t,{errMsgProvider:aT}),n={};return N(t.rules,r=>{n[r.name]=r}),oT(n,e.errMsgProvider)}function LT(t){return t=ws(t,{errMsgProvider:Yt}),RT(t.rules,t.tokenTypes,t.errMsgProvider,t.grammarName)}const Ul="MismatchedTokenException",Hl="NoViableAltException",Kl="EarlyExitException",Jl="NotAllInputParsedException",jl=[Ul,Hl,Kl,Jl];Object.freeze(jl);function Wr(t){return Pe(jl,t.name)}class mi extends Error{constructor(e,n){super(e),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class Wl extends mi{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Ul}}class GT extends mi{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Hl}}class kT extends mi{constructor(e,n){super(e,n),this.name=Jl}}class UT extends mi{constructor(e,n,r){super(e,n),this.previousToken=r,this.name=Kl}}const Di={},Vl="InRuleRecoveryException";class HT extends Error{constructor(e){super(e),this.name=Vl}}class KT{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=D(e,"recoveryEnabled")?e.recoveryEnabled:Dt.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=JT)}getTokenToInsert(e){const n=Ns(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,n,r,i){const s=this.findReSyncTokenType(),a=this.exportLexerState(),o=[];let l=!1;const c=this.LA(1);let u=this.LA(1);const h=()=>{const f=this.LA(0),T=this.errorMessageProvider.buildMismatchTokenMessage({expected:i,actual:c,previous:f,ruleName:this.getCurrRuleFullName()}),g=new Wl(T,c,this.LA(0));g.resyncedTokens=nr(o),this.SAVE_ERROR(g)};for(;!l;)if(this.tokenMatcher(u,i)){h();return}else if(r.call(this)){h(),e.apply(this,n);return}else this.tokenMatcher(u,s)?l=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,o));this.importLexerState(a)}shouldInRepetitionRecoveryBeTried(e,n,r){return!(r===!1||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,n)))}getFollowsForInRuleRecovery(e,n){const r=this.getCurrentGrammarPath(e,n);return this.getNextPossibleTokenTypes(r)}tryInRuleRecovery(e,n){if(this.canRecoverWithSingleTokenInsertion(e,n))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const r=this.SKIP_TOKEN();return this.consumeToken(),r}throw new HT("sad sad panda")}canPerformInRuleRecovery(e,n){return this.canRecoverWithSingleTokenInsertion(e,n)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,n){if(!this.canTokenTypeBeInsertedInRecovery(e)||Z(n))return!1;const r=this.LA(1);return Bn(n,s=>this.tokenMatcher(r,s))!==void 0}canRecoverWithSingleTokenDeletion(e){return this.canTokenTypeBeDeletedInRecovery(e)?this.tokenMatcher(this.LA(2),e):!1}isInCurrentRuleReSyncSet(e){const n=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(n);return Pe(r,e)}findReSyncTokenType(){const e=this.flattenFollowSet();let n=this.LA(1),r=2;for(;;){const i=Bn(e,s=>sT(n,s));if(i!==void 0)return i;n=this.LA(r),r++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Di;const e=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,n=this.RULE_OCCURRENCE_STACK;return F(e,(r,i)=>i===0?Di:{ruleName:this.shortRuleNameToFullName(r),idxInCallingRule:n[i],inRule:this.shortRuleNameToFullName(e[i-1])})}flattenFollowSet(){const e=F(this.buildFullFollowKeyStack(),n=>this.getFollowSetFromFollowKey(n));return Qe(e)}getFollowSetFromFollowKey(e){if(e===Di)return[tn];const n=e.ruleName+e.idxInCallingRule+El+e.inRule;return this.resyncFollows[n]}addToResyncTokens(e,n){return this.tokenMatcher(e,tn)||n.push(e),n}reSyncTo(e){const n=[];let r=this.LA(1);for(;this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,n);return nr(n)}attemptInRepetitionRecovery(e,n,r,i,s,a,o){}getCurrentGrammarPath(e,n){const r=this.getHumanReadableRuleStack(),i=Be(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:n}}getHumanReadableRuleStack(){return F(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}}function JT(t,e,n,r,i,s,a){const o=this.getKeyForAutomaticLookahead(r,i);let l=this.firstAfterRepMap[o];if(l===void 0){const f=this.getCurrRuleFullName(),T=this.getGAstProductions()[f];l=new s(T,i).startWalking(),this.firstAfterRepMap[o]=l}let c=l.token,u=l.occurrence;const h=l.isEndOfRule;this.RULE_STACK.length===1&&h&&c===void 0&&(c=tn,u=1),!(c===void 0||u===void 0)&&this.shouldInRepetitionRecoveryBeTried(c,u,a)&&this.tryInRepetitionRecovery(t,e,n,c)}const jT=4,kt=8,Xl=1<<kt,Ql=2<<kt,ls=3<<kt,cs=4<<kt,us=5<<kt,wr=6<<kt;function Ni(t,e,n){return n|e|t}class WT{constructor(e){var n;this.maxLookahead=(n=e==null?void 0:e.maxLookahead)!==null&&n!==void 0?n:Dt.maxLookahead}validate(e){const n=this.validateNoLeftRecursion(e.rules);if(Z(n)){const r=this.validateEmptyOrAlternatives(e.rules),i=this.validateAmbiguousAlternationAlternatives(e.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(e.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(e){return Je(e,n=>kl(n,n,Yt))}validateEmptyOrAlternatives(e){return Je(e,n=>IT(n,Yt))}validateAmbiguousAlternationAlternatives(e,n){return Je(e,r=>bT(r,n,Yt))}validateSomeNonEmptyLookaheadPath(e,n){return wT(e,n,Yt)}buildLookaheadForAlternation(e){return pT(e.prodOccurrence,e.rule,e.maxLookahead,e.hasPredicates,e.dynamicTokensEnabled,AT)}buildLookaheadForOptional(e){return mT(e.prodOccurrence,e.rule,e.maxLookahead,e.dynamicTokensEnabled,Fl(e.prodType),gT)}}class VT{initLooksAhead(e){this.dynamicTokensEnabled=D(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Dt.dynamicTokensEnabled,this.maxLookahead=D(e,"maxLookahead")?e.maxLookahead:Dt.maxLookahead,this.lookaheadStrategy=D(e,"lookaheadStrategy")?e.lookaheadStrategy:new WT({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){N(e,n=>{this.TRACE_INIT(`${n.name} Rule Lookahead`,()=>{const{alternation:r,repetition:i,option:s,repetitionMandatory:a,repetitionMandatoryWithSeparator:o,repetitionWithSeparator:l}=QT(n);N(r,c=>{const u=c.idx===0?"":c.idx;this.TRACE_INIT(`${it(c)}${u}`,()=>{const h=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:c.idx,rule:n,maxLookahead:c.maxLookahead||this.maxLookahead,hasPredicates:c.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=Ni(this.fullRuleNameToShort[n.name],Xl,c.idx);this.setLaFuncCache(f,h)})}),N(i,c=>{this.computeLookaheadFunc(n,c.idx,ls,"Repetition",c.maxLookahead,it(c))}),N(s,c=>{this.computeLookaheadFunc(n,c.idx,Ql,"Option",c.maxLookahead,it(c))}),N(a,c=>{this.computeLookaheadFunc(n,c.idx,cs,"RepetitionMandatory",c.maxLookahead,it(c))}),N(o,c=>{this.computeLookaheadFunc(n,c.idx,wr,"RepetitionMandatoryWithSeparator",c.maxLookahead,it(c))}),N(l,c=>{this.computeLookaheadFunc(n,c.idx,us,"RepetitionWithSeparator",c.maxLookahead,it(c))})})})}computeLookaheadFunc(e,n,r,i,s,a){this.TRACE_INIT(`${a}${n===0?"":n}`,()=>{const o=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:n,rule:e,maxLookahead:s||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:i}),l=Ni(this.fullRuleNameToShort[e.name],r,n);this.setLaFuncCache(l,o)})}getKeyForAutomaticLookahead(e,n){const r=this.getLastExplicitRuleShortName();return Ni(r,e,n)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,n){this.lookAheadFuncsCache.set(e,n)}}class XT extends xn{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}}const yr=new XT;function QT(t){yr.reset(),t.accept(yr);const e=yr.dslMethods;return yr.reset(),e}function za(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.endOffset=e.endOffset):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset)}function $a(t,e){isNaN(t.startOffset)===!0?(t.startOffset=e.startOffset,t.startColumn=e.startColumn,t.startLine=e.startLine,t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine):t.endOffset<e.endOffset&&(t.endOffset=e.endOffset,t.endColumn=e.endColumn,t.endLine=e.endLine)}function YT(t,e,n){t.children[n]===void 0?t.children[n]=[e]:t.children[n].push(e)}function zT(t,e,n){t.children[e]===void 0?t.children[e]=[n]:t.children[e].push(n)}const $T="name";function Yl(t,e){Object.defineProperty(t,$T,{enumerable:!1,configurable:!0,writable:!1,value:e})}function ZT(t,e){const n=Le(t),r=n.length;for(let i=0;i<r;i++){const s=n[i],a=t[s],o=a.length;for(let l=0;l<o;l++){const c=a[l];c.tokenTypeIdx===void 0&&this[c.name](c.children,e)}}}function qT(t,e){const n=function(){};Yl(n,t+"BaseSemantics");const r={visit:function(i,s){if(W(i)&&(i=i[0]),!Ct(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=tv(this,e);if(!Z(i)){const s=F(i,a=>a.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return n.prototype=r,n.prototype.constructor=n,n._RULE_NAMES=e,n}function ev(t,e,n){const r=function(){};Yl(r,t+"BaseSemanticsWithDefaults");const i=Object.create(n.prototype);return N(e,s=>{i[s]=ZT}),r.prototype=i,r.prototype.constructor=r,r}var hs;(function(t){t[t.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",t[t.MISSING_METHOD=1]="MISSING_METHOD"})(hs||(hs={}));function tv(t,e){return nv(t,e)}function nv(t,e){const n=Xe(e,i=>Et(t[i])===!1),r=F(n,i=>({msg:`Missing visitor method: <${i}> on ${t.constructor.name} CST Visitor.`,type:hs.MISSING_METHOD,methodName:i}));return hr(r)}class rv{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=D(e,"nodeLocationTracking")?e.nodeLocationTracking:Dt.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=me,this.cstFinallyStateUpdate=me,this.cstPostTerminal=me,this.cstPostNonTerminal=me,this.cstPostRule=me;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=$a,this.setNodeLocationFromNode=$a,this.cstPostRule=me,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=me,this.setNodeLocationFromNode=me,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=za,this.setNodeLocationFromNode=za,this.cstPostRule=me,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=me,this.setNodeLocationFromNode=me,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=me,this.setNodeLocationFromNode=me,this.cstPostRule=me,this.setInitialNodeLocation=me;else throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`)}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const n=this.LA(1);e.location={startOffset:n.startOffset,startLine:n.startLine,startColumn:n.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const n={name:e,children:Object.create(null)};this.setInitialNodeLocation(n),this.CST_STACK.push(n)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?(r.endOffset=n.endOffset,r.endLine=n.endLine,r.endColumn=n.endColumn):(r.startOffset=NaN,r.startLine=NaN,r.startColumn=NaN)}cstPostRuleOnlyOffset(e){const n=this.LA(0),r=e.location;r.startOffset<=n.startOffset?r.endOffset=n.endOffset:r.startOffset=NaN}cstPostTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];YT(r,n,e),this.setNodeLocationFromToken(r.location,n)}cstPostNonTerminal(e,n){const r=this.CST_STACK[this.CST_STACK.length-1];zT(r,n,e),this.setNodeLocationFromNode(r.location,e.location)}getBaseCstVisitorConstructor(){if(Ct(this.baseCstVisitorConstructor)){const e=qT(this.className,Le(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(Ct(this.baseCstVisitorWithDefaultsConstructor)){const e=ev(this.className,Le(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}}class iv{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):Xr}LA(e){const n=this.currIdx+e;return n<0||this.tokVectorLength<=n?Xr:this.tokVector[n]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}}class sv{ACTION(e){return e.call(this)}consume(e,n,r){return this.consumeInternal(n,e,r)}subrule(e,n,r){return this.subruleInternal(n,e,r)}option(e,n){return this.optionInternal(n,e)}or(e,n){return this.orInternal(n,e)}many(e,n){return this.manyInternal(e,n)}atLeastOne(e,n){return this.atLeastOneInternal(e,n)}CONSUME(e,n){return this.consumeInternal(e,0,n)}CONSUME1(e,n){return this.consumeInternal(e,1,n)}CONSUME2(e,n){return this.consumeInternal(e,2,n)}CONSUME3(e,n){return this.consumeInternal(e,3,n)}CONSUME4(e,n){return this.consumeInternal(e,4,n)}CONSUME5(e,n){return this.consumeInternal(e,5,n)}CONSUME6(e,n){return this.consumeInternal(e,6,n)}CONSUME7(e,n){return this.consumeInternal(e,7,n)}CONSUME8(e,n){return this.consumeInternal(e,8,n)}CONSUME9(e,n){return this.consumeInternal(e,9,n)}SUBRULE(e,n){return this.subruleInternal(e,0,n)}SUBRULE1(e,n){return this.subruleInternal(e,1,n)}SUBRULE2(e,n){return this.subruleInternal(e,2,n)}SUBRULE3(e,n){return this.subruleInternal(e,3,n)}SUBRULE4(e,n){return this.subruleInternal(e,4,n)}SUBRULE5(e,n){return this.subruleInternal(e,5,n)}SUBRULE6(e,n){return this.subruleInternal(e,6,n)}SUBRULE7(e,n){return this.subruleInternal(e,7,n)}SUBRULE8(e,n){return this.subruleInternal(e,8,n)}SUBRULE9(e,n){return this.subruleInternal(e,9,n)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,n,r=Qr){if(Pe(this.definedRulesNames,e)){const a={message:Yt.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:be.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(a)}this.definedRulesNames.push(e);const i=this.defineRule(e,n,r);return this[e]=i,i}OVERRIDE_RULE(e,n,r=Qr){const i=MT(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(i);const s=this.defineRule(e,n,r);return this[e]=s,s}BACKTRACK(e,n){return function(){this.isBackTrackingStack.push(1);const r=this.saveRecogState();try{return e.apply(this,n),!0}catch(i){if(Wr(i))return!1;throw i}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return og(Ae(this.gastProductionsCache))}}class av{initRecognizerEngine(e,n){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=jr,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},D(n,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(W(e)){if(Z(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(W(e))this.tokensMap=ke(e,(s,a)=>(s[a.name]=a,s),{});else if(D(e,"modes")&&Ye(Qe(Ae(e.modes)),tT)){const s=Qe(Ae(e.modes)),a=Os(s);this.tokensMap=ke(a,(o,l)=>(o[l.name]=l,o),{})}else if(Ve(e))this.tokensMap=Be(e);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=tn;const r=D(e,"modes")?Qe(Ae(e.modes)):Ae(e),i=Ye(r,s=>Z(s.categoryMatches));this.tokenMatcher=i?jr:dr,pr(Ae(this.tokensMap))}defineRule(e,n,r){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const i=D(r,"resyncEnabled")?r.resyncEnabled:Qr.resyncEnabled,s=D(r,"recoveryValueFunc")?r.recoveryValueFunc:Qr.recoveryValueFunc,a=this.ruleShortNameIdx<<jT+kt;this.ruleShortNameIdx++,this.shortRuleNameToFull[a]=e,this.fullRuleNameToShort[e]=a;let o;return this.outputCst===!0?o=function(...u){try{this.ruleInvocationStateUpdate(a,e,this.subruleIdx),n.apply(this,u);const h=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(h),h}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}}:o=function(...u){try{return this.ruleInvocationStateUpdate(a,e,this.subruleIdx),n.apply(this,u)}catch(h){return this.invokeRuleCatch(h,i,s)}finally{this.ruleFinallyStateUpdate()}},Object.assign(o,{ruleName:e,originalGrammarAction:n})}invokeRuleCatch(e,n,r){const i=this.RULE_STACK.length===1,s=n&&!this.isBackTracking()&&this.recoveryEnabled;if(Wr(e)){const a=e;if(s){const o=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(o))if(a.resyncedTokens=this.reSyncTo(o),this.outputCst){const l=this.CST_STACK[this.CST_STACK.length-1];return l.recoveredNode=!0,l}else return r(e);else{if(this.outputCst){const l=this.CST_STACK[this.CST_STACK.length-1];l.recoveredNode=!0,a.partialCstResult=l}throw a}}else{if(i)return this.moveToTerminatedState(),r(e);throw a}}else throw e}optionInternal(e,n){const r=this.getKeyForAutomaticLookahead(Ql,n);return this.optionInternalLogic(e,n,r)}optionInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof e!="function"){s=e.DEF;const a=e.GATE;if(a!==void 0){const o=i;i=()=>a.call(this)&&o.call(this)}}else s=e;if(i.call(this)===!0)return s.call(this)}atLeastOneInternal(e,n){const r=this.getKeyForAutomaticLookahead(cs,e);return this.atLeastOneInternalLogic(e,n,r)}atLeastOneInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const a=n.GATE;if(a!==void 0){const o=i;i=()=>a.call(this)&&o.call(this)}}else s=n;if(i.call(this)===!0){let a=this.doSingleRepetition(s);for(;i.call(this)===!0&&a===!0;)a=this.doSingleRepetition(s)}else throw this.raiseEarlyExitException(e,oe.REPETITION_MANDATORY,n.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,n],i,cs,e,fT)}atLeastOneSepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(wr,e);this.atLeastOneSepFirstInternalLogic(e,n,r)}atLeastOneSepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const o=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,o,i,Qa],o,wr,e,Qa)}else throw this.raiseEarlyExitException(e,oe.REPETITION_MANDATORY_WITH_SEPARATOR,n.ERR_MSG)}manyInternal(e,n){const r=this.getKeyForAutomaticLookahead(ls,e);return this.manyInternalLogic(e,n,r)}manyInternalLogic(e,n,r){let i=this.getLaFuncFromCache(r),s;if(typeof n!="function"){s=n.DEF;const o=n.GATE;if(o!==void 0){const l=i;i=()=>o.call(this)&&l.call(this)}}else s=n;let a=!0;for(;i.call(this)===!0&&a===!0;)a=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,n],i,ls,e,hT,a)}manySepFirstInternal(e,n){const r=this.getKeyForAutomaticLookahead(us,e);this.manySepFirstInternalLogic(e,n,r)}manySepFirstInternalLogic(e,n,r){const i=n.DEF,s=n.SEP;if(this.getLaFuncFromCache(r).call(this)===!0){i.call(this);const o=()=>this.tokenMatcher(this.LA(1),s);for(;this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,o,i,Xa],o,us,e,Xa)}}repetitionSepSecondInternal(e,n,r,i,s){for(;r();)this.CONSUME(n),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,n,r,i,s],r,wr,e,s)}doSingleRepetition(e){const n=this.getLexerPosition();return e.call(this),this.getLexerPosition()>n}orInternal(e,n){const r=this.getKeyForAutomaticLookahead(Xl,n),i=W(e)?e:e.DEF,a=this.getLaFuncFromCache(r).call(this,i);if(a!==void 0)return i[a].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),n=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new kT(n,e))}}subruleInternal(e,n,r){let i;try{const s=r!==void 0?r.ARGS:void 0;return this.subruleIdx=n,i=e.apply(this,s),this.cstPostNonTerminal(i,r!==void 0&&r.LABEL!==void 0?r.LABEL:e.ruleName),i}catch(s){throw this.subruleInternalError(s,r,e.ruleName)}}subruleInternalError(e,n,r){throw Wr(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:r),delete e.partialCstResult),e}consumeInternal(e,n,r){let i;try{const s=this.LA(1);this.tokenMatcher(s,e)===!0?(this.consumeToken(),i=s):this.consumeInternalError(e,s,r)}catch(s){i=this.consumeInternalRecovery(e,n,s)}return this.cstPostTerminal(r!==void 0&&r.LABEL!==void 0?r.LABEL:e.name,i),i}consumeInternalError(e,n,r){let i;const s=this.LA(0);throw r!==void 0&&r.ERR_MSG?i=r.ERR_MSG:i=this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:n,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new Wl(i,n,s))}consumeInternalRecovery(e,n,r){if(this.recoveryEnabled&&r.name==="MismatchedTokenException"&&!this.isBackTracking()){const i=this.getFollowsForInRuleRecovery(e,n);try{return this.tryInRuleRecovery(e,i)}catch(s){throw s.name===Vl?r:s}}else throw r}saveRecogState(){const e=this.errors,n=Be(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,n,r){this.RULE_OCCURRENCE_STACK.push(r),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(n)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),tn)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}}class ov{initErrorHandler(e){this._errors=[],this.errorMessageProvider=D(e,"errorMessageProvider")?e.errorMessageProvider:Dt.errorMessageProvider}SAVE_ERROR(e){if(Wr(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:Be(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return Be(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,n,r){const i=this.getCurrRuleFullName(),s=this.getGAstProductions()[i],o=Gs(e,s,n,this.maxLookahead)[0],l=[];for(let u=1;u<=this.maxLookahead;u++)l.push(this.LA(u));const c=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:o,actual:l,previous:this.LA(0),customUserDescription:r,ruleName:i});throw this.SAVE_ERROR(new UT(c,this.LA(1),this.LA(0)))}raiseNoAltException(e,n){const r=this.getCurrRuleFullName(),i=this.getGAstProductions()[r],s=Ls(e,i,this.maxLookahead),a=[];for(let c=1;c<=this.maxLookahead;c++)a.push(this.LA(c));const o=this.LA(0),l=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:s,actual:a,previous:o,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new GT(l,this.LA(1),o))}}class lv{initContentAssist(){}computeContentAssist(e,n){const r=this.gastProductionsCache[e];if(Ct(r))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return Ol([r],n,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const n=$e(e.ruleStack),i=this.getGAstProductions()[n];return new uT(i,e).startWalking()}}const Ai={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Ai);const Za=!0,qa=Math.pow(2,kt)-1,zl=_l({name:"RECORDING_PHASE_TOKEN",pattern:je.NA});pr([zl]);const $l=Ns(zl,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze($l);const cv={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};class uv{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const n=e>0?e:"";this[`CONSUME${n}`]=function(r,i){return this.consumeInternalRecord(r,e,i)},this[`SUBRULE${n}`]=function(r,i){return this.subruleInternalRecord(r,e,i)},this[`OPTION${n}`]=function(r){return this.optionInternalRecord(r,e)},this[`OR${n}`]=function(r){return this.orInternalRecord(r,e)},this[`MANY${n}`]=function(r){this.manyInternalRecord(e,r)},this[`MANY_SEP${n}`]=function(r){this.manySepFirstInternalRecord(e,r)},this[`AT_LEAST_ONE${n}`]=function(r){this.atLeastOneInternalRecord(e,r)},this[`AT_LEAST_ONE_SEP${n}`]=function(r){this.atLeastOneSepFirstInternalRecord(e,r)}}this.consume=function(e,n,r){return this.consumeInternalRecord(n,e,r)},this.subrule=function(e,n,r){return this.subruleInternalRecord(n,e,r)},this.option=function(e,n){return this.optionInternalRecord(n,e)},this.or=function(e,n){return this.orInternalRecord(n,e)},this.many=function(e,n){this.manyInternalRecord(e,n)},this.atLeastOne=function(e,n){this.atLeastOneInternalRecord(e,n)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let n=0;n<10;n++){const r=n>0?n:"";delete e[`CONSUME${r}`],delete e[`SUBRULE${r}`],delete e[`OPTION${r}`],delete e[`OR${r}`],delete e[`MANY${r}`],delete e[`MANY_SEP${r}`],delete e[`AT_LEAST_ONE${r}`],delete e[`AT_LEAST_ONE_SEP${r}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,n){return()=>!0}LA_RECORD(e){return Xr}topLevelRuleRecord(e,n){try{const r=new Sn({definition:[],name:e});return r.name=e,this.recordingProdStack.push(r),n.call(this),this.recordingProdStack.pop(),r}catch(r){if(r.KNOWN_RECORDER_ERROR!==!0)try{r.message=r.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw r}throw r}}optionInternalRecord(e,n){return Ln.call(this,Oe,e,n)}atLeastOneInternalRecord(e,n){Ln.call(this,dt,n,e)}atLeastOneSepFirstInternalRecord(e,n){Ln.call(this,pt,n,e,Za)}manyInternalRecord(e,n){Ln.call(this,ge,n,e)}manySepFirstInternalRecord(e,n){Ln.call(this,qe,n,e,Za)}orInternalRecord(e,n){return hv.call(this,e,n)}subruleInternalRecord(e,n,r){if(Vr(n),!e||D(e,"ruleName")===!1){const o=new Error(`<SUBRULE${eo(n)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const i=Rn(this.recordingProdStack),s=e.ruleName,a=new Ue({idx:n,nonTerminalName:s,label:r==null?void 0:r.LABEL,referencedRule:void 0});return i.definition.push(a),this.outputCst?cv:Ai}consumeInternalRecord(e,n,r){if(Vr(n),!bl(e)){const a=new Error(`<CONSUME${eo(n)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw a.KNOWN_RECORDER_ERROR=!0,a}const i=Rn(this.recordingProdStack),s=new ae({idx:n,terminalType:e,label:r==null?void 0:r.LABEL});return i.definition.push(s),$l}}function Ln(t,e,n,r=!1){Vr(n);const i=Rn(this.recordingProdStack),s=Et(e)?e:e.DEF,a=new t({definition:[],idx:n});return r&&(a.separator=e.SEP),D(e,"MAX_LOOKAHEAD")&&(a.maxLookahead=e.MAX_LOOKAHEAD),this.recordingProdStack.push(a),s.call(this),i.definition.push(a),this.recordingProdStack.pop(),Ai}function hv(t,e){Vr(e);const n=Rn(this.recordingProdStack),r=W(t)===!1,i=r===!1?t:t.DEF,s=new et({definition:[],idx:e,ignoreAmbiguities:r&&t.IGNORE_AMBIGUITIES===!0});D(t,"MAX_LOOKAHEAD")&&(s.maxLookahead=t.MAX_LOOKAHEAD);const a=gl(i,o=>Et(o.GATE));return s.hasPredicates=a,n.definition.push(s),N(i,o=>{const l=new De({definition:[]});s.definition.push(l),D(o,"IGNORE_AMBIGUITIES")?l.ignoreAmbiguities=o.IGNORE_AMBIGUITIES:D(o,"GATE")&&(l.ignoreAmbiguities=!0),this.recordingProdStack.push(l),o.ALT.call(this),this.recordingProdStack.pop()}),Ai}function eo(t){return t===0?"":`${t}`}function Vr(t){if(t<0||t>qa){const e=new Error(`Invalid DSL Method idx value: <${t}>
	Idx value must be a none negative value smaller than ${qa+1}`);throw e.KNOWN_RECORDER_ERROR=!0,e}}class fv{initPerformanceTracer(e){if(D(e,"traceInitPerf")){const n=e.traceInitPerf,r=typeof n=="number";this.traceInitMaxIdent=r?n:1/0,this.traceInitPerf=r?n>0:n}else this.traceInitMaxIdent=0,this.traceInitPerf=Dt.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,n){if(this.traceInitPerf===!0){this.traceInitIndent++;const r=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${r}--> <${e}>`);const{time:i,value:s}=vl(n),a=i>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&a(`${r}<-- <${e}> time: ${i}ms`),this.traceInitIndent--,s}else return n()}}function dv(t,e){e.forEach(n=>{const r=n.prototype;Object.getOwnPropertyNames(r).forEach(i=>{if(i==="constructor")return;const s=Object.getOwnPropertyDescriptor(r,i);s&&(s.get||s.set)?Object.defineProperty(t.prototype,i,s):t.prototype[i]=n.prototype[i]})})}const Xr=Ns(tn,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(Xr);const Dt=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:wl,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),Qr=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var be;(function(t){t[t.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",t[t.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",t[t.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",t[t.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",t[t.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",t[t.LEFT_RECURSION=5]="LEFT_RECURSION",t[t.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",t[t.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",t[t.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",t[t.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",t[t.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",t[t.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",t[t.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",t[t.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(be||(be={}));class gi{static performSelfAnalysis(e){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let e;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{Cl(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),N(this.definedRulesNames,i=>{const a=this[i].originalGrammarAction;let o;this.TRACE_INIT(`${i} Rule`,()=>{o=this.topLevelRuleRecord(i,a)}),this.gastProductionsCache[i]=o})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=NT({rules:Ae(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(Z(r)&&this.skipValidations===!1){const i=LT({rules:Ae(this.gastProductionsCache),tokenTypes:Ae(this.tokensMap),errMsgProvider:Yt,grammarName:n}),s=ET({lookaheadStrategy:this.lookaheadStrategy,rules:Ae(this.gastProductionsCache),tokenTypes:Ae(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(i,s)}}),Z(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=pg(Ae(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Ae(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Ae(this.gastProductionsCache))})),!gi.DEFER_DEFINITION_ERRORS_HANDLING&&!Z(this.definitionErrors))throw e=F(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${e.join(`
-------------------------------
`)}`)})}constructor(e,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(e,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),D(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=D(n,"skipValidations")?n.skipValidations:Dt.skipValidations}}gi.DEFER_DEFINITION_ERRORS_HANDLING=!1;dv(gi,[KT,VT,rv,iv,av,sv,ov,lv,uv,fv]);class pv{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const n=this.workerCreator();n.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=n}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,n){const r=this.workersResolve[e];if(r&&r(n),this.queue.length){const{resolve:i,msg:s,transfer:a}=this.queue.shift();this.workersResolve[e]=i,this.workers[e].postMessage(s,a)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,n){return new Promise(r=>{const i=this._getIdleWorker();i!==-1?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=r,this.workers[i].postMessage(e,n)):this.queue.push({resolve:r,msg:e,transfer:n})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class mv extends Nr{constructor(e,n,r,i,s,a){super(e,n,r,s,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=Qt}}const Li=new WeakMap;let Gi=0,ki;const Kn=class extends Yr{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new pv,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}detectSupport(t){return this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},t.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const t=new st(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const e=t.loadAsync("basis_transcoder.js"),n=new st(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const r=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([e,r]).then(([i,s])=>{const a=Kn.BasisWorker.toString(),o=["/* constants */","let _EngineFormat = "+JSON.stringify(Kn.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Kn.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Kn.BasisFormat),"/* basis_transcoder.js */",i,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o])),this.transcoderBinary=s,this.workerPool.setWorkerCreator(()=>{const l=new Worker(this.workerSourceURL),c=this.transcoderBinary.slice(0);return l.postMessage({type:"init",config:this.workerConfig,transcoderBinary:c},[c]),l})}),Gi>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Gi++}return this.transcoderPending}load(t,e,n,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const i=new st(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials),i.load(t,s=>{if(Li.has(s))return Li.get(s).promise.then(e).catch(r);this._createTexture(s).then(a=>e?e(a):null).catch(r)},n,r)}_createTextureFrom(t,e){const{mipmaps:n,width:r,height:i,format:s,type:a,error:o,dfdTransferFn:l,dfdFlags:c}=t;if(a==="error")return Promise.reject(o);const u=e.layerCount>1?new mv(n,r,i,e.layerCount,s,gt):new Nr(n,r,i,s,gt);return u.minFilter=n.length===1?gn:zr,u.magFilter=gn,u.generateMipmaps=!1,u.needsUpdate=!0,"colorSpace"in u?u.colorSpace=l===js?"srgb":"srgb-linear":u.encoding=l===js?3001:3e3,u.premultiplyAlpha=!!(c&Jc),u}async _createTexture(t,e={}){const n=jc(new Uint8Array(t));if(n.vkFormat!==Wc)return gv(n);const r=e,i=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:r},[t])).then(s=>this._createTextureFrom(s.data,n));return Li.set(t,{promise:i}),i}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Gi--,this}};let Ti=Kn;x(Ti,"BasisFormat",{ETC1S:0,UASTC_4x4:1});x(Ti,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16});x(Ti,"EngineFormat",{RGBAFormat:wt,RGBA_ASTC_4x4_Format:ao,RGBA_BPTC_Format:oo,RGBA_ETC2_EAC_Format:lo,RGBA_PVRTC_4BPPV1_Format:co,RGBA_S3TC_DXT5_Format:uo,RGB_ETC1_Format:ho,RGB_ETC2_Format:fo,RGB_PVRTC_4BPPV1_Format:po,RGB_S3TC_DXT1_Format:mo});x(Ti,"BasisWorker",function(){let t,e,n;const r=_EngineFormat,i=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",function(g){const d=g.data;switch(d.type){case"init":t=d.config,a(d.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:A,height:v,hasAlpha:m,mipmaps:p,format:C,dfdTransferFn:B,dfdFlags:S}=o(d.buffer),y=[];for(let R=0;R<p.length;++R)y.push(p[R].data.buffer);self.postMessage({type:"transcode",id:d.id,width:A,height:v,hasAlpha:m,mipmaps:p,format:C,dfdTransferFn:B,dfdFlags:S},y)}catch(A){console.error(A),self.postMessage({type:"error",id:d.id,error:A.message})}});break}});function a(g){e=new Promise(d=>{n={wasmBinary:g,onRuntimeInitialized:d},BASIS(n)}).then(()=>{n.initializeBasis(),n.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function o(g){const d=new n.KTX2File(new Uint8Array(g));function A(){d.close(),d.delete()}if(!d.isValid())throw A(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const v=d.isUASTC()?s.UASTC_4x4:s.ETC1S,m=d.getWidth(),p=d.getHeight(),C=d.getLayers()||1,B=d.getLevels(),S=d.getHasAlpha(),y=d.getDFDTransferFunc(),R=d.getDFDFlags(),{transcoderFormat:M,engineFormat:I}=h(v,m,p,S);if(!m||!p||!B)throw A(),new Error("THREE.KTX2Loader:	Invalid texture");if(!d.startTranscoding())throw A(),new Error("THREE.KTX2Loader: .startTranscoding failed");const b=[];for(let O=0;O<B;O++){const w=[];let k,U;for(let H=0;H<C;H++){const j=d.getImageLevelInfo(O,H,0);k=j.origWidth<4?j.origWidth:j.width,U=j.origHeight<4?j.origHeight:j.height;const ne=new Uint8Array(d.getImageTranscodedSizeInBytes(O,H,0,M));if(!d.transcodeImage(ne,O,H,0,M,0,-1,-1))throw A(),new Error("THREE.KTX2Loader: .transcodeImage failed.");w.push(ne)}b.push({data:T(w),width:k,height:U})}return A(),{width:m,height:p,hasAlpha:S,mipmaps:b,format:I,dfdTransferFn:y,dfdFlags:R}}const l=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[i.ASTC_4x4,i.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC7_M5,i.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC1,i.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.PVRTC1_4_RGB,i.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],c=l.sort(function(g,d){return g.priorityETC1S-d.priorityETC1S}),u=l.sort(function(g,d){return g.priorityUASTC-d.priorityUASTC});function h(g,d,A,v){let m,p;const C=g===s.ETC1S?c:u;for(let B=0;B<C.length;B++){const S=C[B];if(t[S.if]&&S.basisFormat.includes(g)&&!(v&&S.transcoderFormat.length<2)&&!(S.needsPowerOfTwo&&!(f(d)&&f(A))))return m=S.transcoderFormat[v?1:0],p=S.engineFormat[v?1:0],{transcoderFormat:m,engineFormat:p}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),m=i.RGBA32,p=r.RGBAFormat,{transcoderFormat:m,engineFormat:p}}function f(g){return g<=2?!0:(g&g-1)===0&&g!==0}function T(g){let d=0;for(let m=0;m<g.length;m++){const p=g[m];d+=p.byteLength}const A=new Uint8Array(d);let v=0;for(let m=0;m<g.length;m++){const p=g[m];A.set(p,v),v+=p.byteLength}return A}});const to={[Eo]:wt,[Ro]:wt,[Bo]:wt,[ps]:wt,[yo]:mr,[So]:mr,[xo]:mr,[ms]:mr,[Mo]:Gn,[Io]:Gn,[As]:Gn,[bo]:Gn},Ui={[Eo]:Qn,[Ro]:Ie,[Bo]:gt,[ps]:gt,[yo]:Qn,[So]:Ie,[xo]:gt,[ms]:gt,[Mo]:Qn,[Io]:Ie,[As]:gt,[bo]:gt},Av={[ps]:3001,[ms]:3001,[As]:3001};async function gv(t){const{vkFormat:e,pixelWidth:n,pixelHeight:r,pixelDepth:i}=t;if(to[e]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const s=t.levels[0];let a,o;if(t.supercompressionScheme===Vc)a=s.levelData;else if(t.supercompressionScheme===Xc)ki||(ki=new Promise(async c=>{const u=new Qc;await u.init(),c(u)})),a=(await ki).decode(s.levelData,s.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");Ui[e]===Qn?o=new Float32Array(a.buffer,a.byteOffset,a.byteLength/Float32Array.BYTES_PER_ELEMENT):Ui[e]===Ie?o=new Uint16Array(a.buffer,a.byteOffset,a.byteLength/Uint16Array.BYTES_PER_ELEMENT):o=a;const l=i===0?new Dr(o,n,r):new Uu(o,n,r,i);return l.type=Ui[e],l.format=to[e],l.encoding=Av[e]||3e3,l.needsUpdate=!0,Promise.resolve(l)}const Hi=new WeakMap,Jn=class extends Yr{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig=null}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerLimit=t,this}detectSupport(t){return this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}load(t,e,n,r){const i=new st(this.manager);i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const s=new Nr;return i.load(t,a=>{if(Hi.has(a))return Hi.get(a).promise.then(e).catch(r);this._createTexture([a]).then(function(o){s.copy(o),s.needsUpdate=!0,e&&e(s)}).catch(r)},n,r),s}parseInternalAsync(t){const{levels:e}=t,n=new Set;for(let r=0;r<e.length;r++)n.add(e[r].data.buffer);return this._createTexture(Array.from(n),{...t,lowLevel:!0})}_createTexture(t,e={}){let n,r;const i=e;let s=0;for(let o=0;o<t.length;o++)s+=t[o].byteLength;const a=this._allocateWorker(s).then(o=>(n=o,r=this.workerNextTaskID++,new Promise((l,c)=>{n._callbacks[r]={resolve:l,reject:c},n.postMessage({type:"transcode",id:r,buffers:t,taskConfig:i},t)}))).then(o=>{const{mipmaps:l,width:c,height:u,format:h}=o,f=new Nr(l,c,u,h,gt);return f.minFilter=l.length===1?gn:zr,f.magFilter=gn,f.generateMipmaps=!1,f.needsUpdate=!0,f});return a.catch(()=>!0).then(()=>{n&&r&&(n._taskLoad-=s,delete n._callbacks[r])}),Hi.set(t[0],{promise:a}),a}_initTranscoder(){if(!this.transcoderPending){const t=new st(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const e=new Promise((i,s)=>{t.load("basis_transcoder.js",i,void 0,s)}),n=new st(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const r=new Promise((i,s)=>{n.load("basis_transcoder.wasm",i,void 0,s)});this.transcoderPending=Promise.all([e,r]).then(([i,s])=>{const a=Jn.BasisWorker.toString(),o=["/* constants */","let _EngineFormat = "+JSON.stringify(Jn.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Jn.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Jn.BasisFormat),"/* basis_transcoder.js */",i,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([o])),this.transcoderBinary=s})}return this.transcoderPending}_allocateWorker(t){return this._initTranscoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskLoad=0,n.postMessage({type:"init",config:this.workerConfig,transcoderBinary:this.transcoderBinary}),n.onmessage=function(r){const i=r.data;switch(i.type){case"transcode":n._callbacks[i.id].resolve(i);break;case"error":n._callbacks[i.id].reject(i);break;default:console.error('THREE.BasisTextureLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,r){return n._taskLoad>r._taskLoad?-1:1});const e=this.workerPool[this.workerPool.length-1];return e._taskLoad+=t,e})}dispose(){for(let t=0;t<this.workerPool.length;t++)this.workerPool[t].terminate();return this.workerPool.length=0,this}};let vi=Jn;x(vi,"BasisFormat",{ETC1S:0,UASTC_4x4:1});x(vi,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16});x(vi,"EngineFormat",{RGBAFormat:wt,RGBA_ASTC_4x4_Format:ao,RGBA_BPTC_Format:oo,RGBA_ETC2_EAC_Format:lo,RGBA_PVRTC_4BPPV1_Format:co,RGBA_S3TC_DXT5_Format:uo,RGB_ETC1_Format:ho,RGB_ETC2_Format:fo,RGB_PVRTC_4BPPV1_Format:po,RGB_S3TC_DXT1_Format:mo});x(vi,"BasisWorker",function(){let t,e,n;const r=_EngineFormat,i=_TranscoderFormat,s=_BasisFormat;onmessage=function(m){const p=m.data;switch(p.type){case"init":t=p.config,a(p.transcoderBinary);break;case"transcode":e.then(()=>{try{const{width:C,height:B,hasAlpha:S,mipmaps:y,format:R}=p.taskConfig.lowLevel?o(p.taskConfig):l(p.buffers[0]),M=[];for(let I=0;I<y.length;++I)M.push(y[I].data.buffer);self.postMessage({type:"transcode",id:p.id,width:C,height:B,hasAlpha:S,mipmaps:y,format:R},M)}catch(C){console.error(C),self.postMessage({type:"error",id:p.id,error:C.message})}});break}};function a(m){e=new Promise(p=>{n={wasmBinary:m,onRuntimeInitialized:p},BASIS(n)}).then(()=>{n.initializeBasis()})}function o(m){const{basisFormat:p,width:C,height:B,hasAlpha:S}=m,{transcoderFormat:y,engineFormat:R}=f(p,C,B,S),M=n.getBytesPerBlockOrPixel(y);T(n.isFormatSupported(y),"THREE.BasisTextureLoader: Unsupported format.");const I=[];if(p===s.ETC1S){const b=new n.LowLevelETC1SImageTranscoder,{endpointCount:O,endpointsData:w,selectorCount:k,selectorsData:U,tablesData:H}=m.globalData;try{let j;j=b.decodePalettes(O,w,k,U),T(j,"THREE.BasisTextureLoader: decodePalettes() failed."),j=b.decodeTables(H),T(j,"THREE.BasisTextureLoader: decodeTables() failed.");for(let ne=0;ne<m.levels.length;ne++){const Q=m.levels[ne],Y=m.globalData.imageDescs[ne],ve=A(y,Q.width,Q.height),ye=new Uint8Array(ve);j=b.transcodeImage(y,ye,ve/M,Q.data,g(y,Q.width),d(y,Q.height),Q.width,Q.height,Q.index,Y.rgbSliceByteOffset,Y.rgbSliceByteLength,Y.alphaSliceByteOffset,Y.alphaSliceByteLength,Y.imageFlags,S,!1,0,0),T(j,"THREE.BasisTextureLoader: transcodeImage() failed for level "+Q.index+"."),I.push({data:ye,width:Q.width,height:Q.height})}}finally{b.delete()}}else for(let b=0;b<m.levels.length;b++){const O=m.levels[b],w=A(y,O.width,O.height),k=new Uint8Array(w),U=n.transcodeUASTCImage(y,k,w/M,O.data,g(y,O.width),d(y,O.height),O.width,O.height,O.index,0,O.data.byteLength,0,S,!1,0,0,-1,-1);T(U,"THREE.BasisTextureLoader: transcodeUASTCImage() failed for level "+O.index+"."),I.push({data:k,width:O.width,height:O.height})}return{width:C,height:B,hasAlpha:S,mipmaps:I,format:R}}function l(m){const p=new n.BasisFile(new Uint8Array(m)),C=p.isUASTC()?s.UASTC_4x4:s.ETC1S,B=p.getImageWidth(0,0),S=p.getImageHeight(0,0),y=p.getNumLevels(0),R=p.getHasAlpha();function M(){p.close(),p.delete()}const{transcoderFormat:I,engineFormat:b}=f(C,B,S,R);if(!B||!S||!y)throw M(),new Error("THREE.BasisTextureLoader:	Invalid texture");if(!p.startTranscoding())throw M(),new Error("THREE.BasisTextureLoader: .startTranscoding failed");const O=[];for(let w=0;w<y;w++){const k=p.getImageWidth(0,w),U=p.getImageHeight(0,w),H=new Uint8Array(p.getImageTranscodedSizeInBytes(0,w,I));if(!p.transcodeImage(H,0,w,I,0,R))throw M(),new Error("THREE.BasisTextureLoader: .transcodeImage failed.");O.push({data:H,width:k,height:U})}return M(),{width:B,height:S,hasAlpha:R,mipmaps:O,format:b}}const c=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[i.ASTC_4x4,i.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC7_M5,i.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC1,i.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC1],engineFormat:[r.RGB_ETC1_Format,r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.PVRTC1_4_RGB,i.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],u=c.sort(function(m,p){return m.priorityETC1S-p.priorityETC1S}),h=c.sort(function(m,p){return m.priorityUASTC-p.priorityUASTC});function f(m,p,C,B){let S,y;const R=m===s.ETC1S?u:h;for(let M=0;M<R.length;M++){const I=R[M];if(t[I.if]&&I.basisFormat.includes(m)&&!(I.needsPowerOfTwo&&!(v(p)&&v(C))))return S=I.transcoderFormat[B?1:0],y=I.engineFormat[B?1:0],{transcoderFormat:S,engineFormat:y}}return console.warn("THREE.BasisTextureLoader: No suitable compressed texture format found. Decoding to RGBA32."),S=i.RGBA32,y=r.RGBAFormat,{transcoderFormat:S,engineFormat:y}}function T(m,p){if(!m)throw new Error(p)}function g(m,p){return Math.ceil(p/n.getFormatBlockWidth(m))}function d(m,p){return Math.ceil(p/n.getFormatBlockHeight(m))}function A(m,p,C){const B=n.getBytesPerBlockOrPixel(m);if(n.formatIsUncompressed(m))return p*C*B;if(m===i.PVRTC1_4_RGB||m===i.PVRTC1_4_RGBA){const S=p+3&-4,y=C+3&-4;return(Math.max(8,S)*Math.max(8,y)*4+7)/8}return g(m,p)*d(m,C)*B}function v(m){return m<=2?!0:(m&m-1)===0&&m!==0}});const Ki=new WeakMap;class Mv extends Yr{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,n,r,i){const s=new st(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,a=>{const o={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(a,o).then(n).catch(i)},r,i)}decodeDracoFile(e,n,r,i){const s={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,s).then(n)}decodeGeometry(e,n){for(const l in n.attributeTypes){const c=n.attributeTypes[l];c.BYTES_PER_ELEMENT!==void 0&&(n.attributeTypes[l]=c.name)}const r=JSON.stringify(n);if(Ki.has(e)){const l=Ki.get(e);if(l.key===r)return l.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const s=this.workerNextTaskID++,a=e.byteLength,o=this._getWorker(s,a).then(l=>(i=l,new Promise((c,u)=>{i._callbacks[s]={resolve:c,reject:u},i.postMessage({type:"decode",id:s,taskConfig:n,buffer:e},[e])}))).then(l=>this._createGeometry(l.geometry));return o.catch(()=>!0).then(()=>{i&&s&&this._releaseTask(i,s)}),Ki.set(e,{key:r,promise:o}),o}_createGeometry(e){const n=new yn;e.index&&n.setIndex(new Wn(e.index.array,1));for(let r=0;r<e.attributes.length;r++){const i=e.attributes[r],s=i.name,a=i.array,o=i.itemSize;n.setAttribute(s,new Wn(a,o))}return n}_loadLibrary(e,n){const r=new st(this.manager);return r.setPath(this.decoderPath),r.setResponseType(n),r.setWithCredentials(this.withCredentials),new Promise((i,s)=>{r.load(e,i,void 0,s)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",n=[];return e?n.push(this._loadLibrary("draco_decoder.js","text")):(n.push(this._loadLibrary("draco_wasm_wrapper.js","text")),n.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(n).then(r=>{const i=r[0];e||(this.decoderConfig.wasmBinary=r[1]);const s=Tv.toString(),a=["/* draco decoder */",i,"","/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(e,n){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const i=new Worker(this.workerSourceURL);i._callbacks={},i._taskCosts={},i._taskLoad=0,i.postMessage({type:"init",decoderConfig:this.decoderConfig}),i.onmessage=function(s){const a=s.data;switch(a.type){case"decode":i._callbacks[a.id].resolve(a);break;case"error":i._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(i)}else this.workerPool.sort(function(i,s){return i._taskLoad>s._taskLoad?-1:1});const r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=n,r._taskLoad+=n,r})}_releaseTask(e,n){e._taskLoad-=e._taskCosts[n],delete e._callbacks[n],delete e._taskCosts[n]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function Tv(){let t,e;onmessage=function(a){const o=a.data;switch(o.type){case"init":t=o.decoderConfig,e=new Promise(function(u){t.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(t)});break;case"decode":const l=o.buffer,c=o.taskConfig;e.then(u=>{const h=u.draco,f=new h.Decoder,T=new h.DecoderBuffer;T.Init(new Int8Array(l),l.byteLength);try{const g=n(h,f,T,c),d=g.attributes.map(A=>A.array.buffer);g.index&&d.push(g.index.array.buffer),self.postMessage({type:"decode",id:o.id,geometry:g},d)}catch(g){console.error(g),self.postMessage({type:"error",id:o.id,error:g.message})}finally{h.destroy(T),h.destroy(f)}});break}};function n(a,o,l,c){const u=c.attributeIDs,h=c.attributeTypes;let f,T;const g=o.GetEncodedGeometryType(l);if(g===a.TRIANGULAR_MESH)f=new a.Mesh,T=o.DecodeBufferToMesh(l,f);else if(g===a.POINT_CLOUD)f=new a.PointCloud,T=o.DecodeBufferToPointCloud(l,f);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!T.ok()||f.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+T.error_msg());const d={index:null,attributes:[]};for(const A in u){const v=self[h[A]];let m,p;if(c.useUniqueIDs)p=u[A],m=o.GetAttributeByUniqueId(f,p);else{if(p=o.GetAttributeId(f,a[u[A]]),p===-1)continue;m=o.GetAttribute(f,p)}d.attributes.push(i(a,o,f,A,v,m))}return g===a.TRIANGULAR_MESH&&(d.index=r(a,o,f)),a.destroy(f),d}function r(a,o,l){const u=l.num_faces()*3,h=u*4,f=a._malloc(h);o.GetTrianglesUInt32Array(l,h,f);const T=new Uint32Array(a.HEAPF32.buffer,f,u).slice();return a._free(f),{array:T,itemSize:1}}function i(a,o,l,c,u,h){const f=h.num_components(),g=l.num_points()*f,d=g*u.BYTES_PER_ELEMENT,A=s(a,u),v=a._malloc(d);o.GetAttributeDataArrayForAllPoints(l,h,A,d,v);const m=new u(a.HEAPF32.buffer,v,g).slice();return a._free(v),{name:c,array:m,itemSize:f}}function s(a,o){switch(o){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}let Sr;const Iv=()=>{if(Sr)return Sr;const t="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",e="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",n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if(typeof WebAssembly!="object")return{supported:!1};let i=t;WebAssembly.validate(n)&&(i=e);let s;const a=WebAssembly.instantiate(o(i),{}).then(h=>{s=h.instance,s.exports.__wasm_call_ctors()});function o(h){const f=new Uint8Array(h.length);for(let g=0;g<h.length;++g){const d=h.charCodeAt(g);f[g]=d>96?d-71:d>64?d-65:d>47?d+4:d>46?63:62}let T=0;for(let g=0;g<h.length;++g)f[T++]=f[g]<60?r[f[g]]:(f[g]-60)*64+f[++g];return f.buffer.slice(0,T)}function l(h,f,T,g,d,A){const v=s.exports.sbrk,m=T+3&-4,p=v(m*g),C=v(d.length),B=new Uint8Array(s.exports.memory.buffer);B.set(d,C);const S=h(p,T,g,C,d.length);if(S===0&&A&&A(p,m,g),f.set(B.subarray(p,p+T*g)),v(p-v(0)),S!==0)throw new Error(`Malformed buffer data: ${S}`)}const c={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},u={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return Sr={ready:a,supported:!0,decodeVertexBuffer(h,f,T,g,d){l(s.exports.meshopt_decodeVertexBuffer,h,f,T,g,s.exports[c[d]])},decodeIndexBuffer(h,f,T,g){l(s.exports.meshopt_decodeIndexBuffer,h,f,T,g)},decodeIndexSequence(h,f,T,g){l(s.exports.meshopt_decodeIndexSequence,h,f,T,g)},decodeGltfBuffer(h,f,T,g,d,A){l(s.exports[u[d]],h,f,T,g,s.exports[c[A]])}},Sr};export{xv as D,Sv as G,Iv as M,yv as O,Mv as a};
