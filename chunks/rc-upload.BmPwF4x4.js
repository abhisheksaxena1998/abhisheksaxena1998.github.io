import{r as e,s as t,f as n,h as r,i as a,a as o,b as i,j as s,_ as u,k as c,g as l,e as p,d as f}from"./@babel.BGkJ1U9u.js";import{a as d,r as h}from"./react.DlfX74Oz.js";import{c as v}from"./classnames.BmZ8OyLm.js";import{b as m,p as b}from"./rc-util.DIscDwjl.js";const y=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(","),r=e.name||"",a=e.type||"",o=a.replace(/\/.*$/,"");return n.some((function(e){var t=e.trim();if(/^\*(\/\*)?$/.test(e))return!0;if("."===t.charAt(0)){var n=r.toLowerCase(),i=t.toLowerCase(),s=[i];return".jpg"!==i&&".jpeg"!==i||(s=[".jpg",".jpeg"]),s.some((function(e){return n.endsWith(e)}))}return/\/\*$/.test(t)?o===t.replace(/\/.*$/,""):a===t||!!/^\w+$/.test(t)&&(m(!1,"Upload takes an invalidate 'accept' type '".concat(t,"'.Skip for check.")),!0)}))}return!0};function k(e){var t=e.responseText||e.response;if(!t)return t;try{return JSON.parse(t)}catch(n){return t}}function w(e){var t=new XMLHttpRequest;e.onProgress&&t.upload&&(t.upload.onprogress=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),e.onProgress(t)});var n=new FormData;e.data&&Object.keys(e.data).forEach((function(t){var r=e.data[t];Array.isArray(r)?r.forEach((function(e){n.append("".concat(t,"[]"),e)})):n.append(t,r)})),e.file instanceof Blob?n.append(e.filename,e.file,e.file.name):n.append(e.filename,e.file),t.onerror=function(t){e.onError(t)},t.onload=function(){return t.status<200||t.status>=300?e.onError(function(e,t){var n="cannot ".concat(e.method," ").concat(e.action," ").concat(t.status,"'"),r=new Error(n);return r.status=t.status,r.method=e.method,r.url=e.action,r}(e,t),k(t)):e.onSuccess(k(t),t)},t.open(e.method,e.action,!0),e.withCredentials&&"withCredentials"in t&&(t.withCredentials=!0);var r=e.headers||{};return null!==r["X-Requested-With"]&&t.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(r).forEach((function(e){null!==r[e]&&t.setRequestHeader(e,r[e])})),t.send(n),{abort:function(){t.abort()}}}var x=function(){var r=e(t().mark((function r(a,o){var i,s,u,c,l,p,f,d;return t().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:p=function(){return(p=e(t().mark((function e(n){return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n.file((function(t){o(t)?(n.fullPath&&!t.webkitRelativePath&&(Object.defineProperties(t,{webkitRelativePath:{writable:!0}}),t.webkitRelativePath=n.fullPath.replace(/^\//,""),Object.defineProperties(t,{webkitRelativePath:{writable:!1}})),e(t)):e(null)}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)},l=function(e){return p.apply(this,arguments)},c=function(){return(c=e(t().mark((function e(n){var r,a,o,i,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.createReader(),a=[];case 2:return e.next=5,new Promise((function(e){r.readEntries(e,(function(){return e([])}))}));case 5:if(o=e.sent,i=o.length){e.next=9;break}return e.abrupt("break",12);case 9:for(s=0;s<i;s++)a.push(o[s]);e.next=2;break;case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)},u=function(e){return c.apply(this,arguments)},i=[],s=[],a.forEach((function(e){return s.push(e.webkitGetAsEntry())})),f=function(){var r=e(t().mark((function e(r,a){var o,c;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:if(r.path=a||"",!r.isFile){e.next=10;break}return e.next=6,l(r);case 6:(o=e.sent)&&i.push(o),e.next=15;break;case 10:if(!r.isDirectory){e.next=15;break}return e.next=13,u(r);case 13:c=e.sent,s.push.apply(s,n(c));case 15:case"end":return e.stop()}}),e)})));return function(e,t){return r.apply(this,arguments)}}(),d=0;case 9:if(!(d<s.length)){r.next=15;break}return r.next=12,f(s[d]);case 12:d++,r.next=9;break;case 15:return r.abrupt("return",i);case 16:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}(),g=+new Date,C=0;function F(){return"rc-upload-".concat(g,"-").concat(++C)}var E=["component","prefixCls","className","classNames","disabled","id","name","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],P=function(h){r(k,h);var m=a(k);function k(){var r;o(this,k);for(var a=arguments.length,u=new Array(a),c=0;c<a;c++)u[c]=arguments[c];return r=m.call.apply(m,[this].concat(u)),i(s(r),"state",{uid:F()}),i(s(r),"reqs",{}),i(s(r),"fileInput",void 0),i(s(r),"_isMounted",void 0),i(s(r),"onChange",(function(e){var t=r.props,a=t.accept,o=t.directory,i=e.target.files,s=n(i).filter((function(e){return!o||y(e,a)}));r.uploadFiles(s),r.reset()})),i(s(r),"onClick",(function(e){var t=r.fileInput;if(t){var n=e.target,a=r.props.onClick;if(n&&"BUTTON"===n.tagName)t.parentNode.focus(),n.blur();t.click(),a&&a(e)}})),i(s(r),"onKeyDown",(function(e){"Enter"===e.key&&r.onClick(e)})),i(s(r),"onFileDrop",function(){var a=e(t().mark((function e(a){var o,i,s;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.props.multiple,a.preventDefault(),"dragover"!==a.type){e.next=4;break}return e.abrupt("return");case 4:if(!r.props.directory){e.next=11;break}return e.next=7,x(Array.prototype.slice.call(a.dataTransfer.items),(function(e){return y(e,r.props.accept)}));case 7:i=e.sent,r.uploadFiles(i),e.next=14;break;case 11:s=n(a.dataTransfer.files).filter((function(e){return y(e,r.props.accept)})),!1===o&&(s=s.slice(0,1)),r.uploadFiles(s);case 14:case"end":return e.stop()}}),e)})));return function(e){return a.apply(this,arguments)}}()),i(s(r),"uploadFiles",(function(e){var t=n(e),a=t.map((function(e){return e.uid=F(),r.processFile(e,t)}));Promise.all(a).then((function(e){var t=r.props.onBatchStart;null==t||t(e.map((function(e){return{file:e.origin,parsedFile:e.parsedFile}}))),e.filter((function(e){return null!==e.parsedFile})).forEach((function(e){r.post(e)}))}))})),i(s(r),"processFile",function(){var n=e(t().mark((function e(n,a){var o,i,s,u,c,l,p,d,h;return t().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.props.beforeUpload,i=n,!o){e.next=14;break}return e.prev=3,e.next=6,o(n,a);case 6:i=e.sent,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),i=!1;case 12:if(!1!==i){e.next=14;break}return e.abrupt("return",{origin:n,parsedFile:null,action:null,data:null});case 14:if("function"!=typeof(s=r.props.action)){e.next=21;break}return e.next=18,s(n);case 18:u=e.sent,e.next=22;break;case 21:u=s;case 22:if("function"!=typeof(c=r.props.data)){e.next=29;break}return e.next=26,c(n);case 26:l=e.sent,e.next=30;break;case 29:l=c;case 30:return p="object"!==f(i)&&"string"!=typeof i||!i?n:i,d=p instanceof File?p:new File([p],n.name,{type:n.type}),(h=d).uid=n.uid,e.abrupt("return",{origin:n,data:l,parsedFile:h,action:u});case 35:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(e,t){return n.apply(this,arguments)}}()),i(s(r),"saveFileInput",(function(e){r.fileInput=e})),r}return u(k,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"post",value:function(e){var t=this,n=e.data,r=e.origin,a=e.action,o=e.parsedFile;if(this._isMounted){var i=this.props,s=i.onStart,u=i.customRequest,c=i.name,l=i.headers,p=i.withCredentials,f=i.method,d=r.uid,h=u||w,v={action:a,filename:c,data:n,file:o,headers:l,withCredentials:p,method:f||"post",onProgress:function(e){var n=t.props.onProgress;null==n||n(e,o)},onSuccess:function(e,n){var r=t.props.onSuccess;null==r||r(e,o,n),delete t.reqs[d]},onError:function(e,n){var r=t.props.onError;null==r||r(e,n,o),delete t.reqs[d]}};s(r),this.reqs[d]=h(v)}}},{key:"reset",value:function(){this.setState({uid:F()})}},{key:"abort",value:function(e){var t=this.reqs;if(e){var n=e.uid?e.uid:e;t[n]&&t[n].abort&&t[n].abort(),delete t[n]}else Object.keys(t).forEach((function(e){t[e]&&t[e].abort&&t[e].abort(),delete t[e]}))}},{key:"render",value:function(){var e=this.props,t=e.component,n=e.prefixCls,r=e.className,a=e.classNames,o=void 0===a?{}:a,s=e.disabled,u=e.id,f=e.name,h=e.style,m=e.styles,y=void 0===m?{}:m,k=e.multiple,w=e.accept,x=e.capture,g=e.children,C=e.directory,F=e.openFileDialogOnClick,P=e.onMouseEnter,D=e.onMouseLeave,j=e.hasControlInside,q=c(e,E),M=v(i(i(i({},n,!0),"".concat(n,"-disabled"),s),r,r)),R=C?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},O=s?{}:{onClick:F?this.onClick:function(){},onKeyDown:F?this.onKeyDown:function(){},onMouseEnter:P,onMouseLeave:D,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:j?void 0:"0"};return d.createElement(t,l({},O,{className:M,role:j?void 0:"button",style:h}),d.createElement("input",l({},b(q,{aria:!0,data:!0}),{id:u,name:f,disabled:s,type:"file",ref:this.saveFileInput,onClick:function(e){return e.stopPropagation()},key:this.state.uid,style:p({display:"none"},y.input),className:o.input,accept:w},R,{multiple:k,onChange:this.onChange},null!=x?{capture:x}:{})),g)}}]),k}(h.Component);function D(){}var j=function(e){r(n,e);var t=a(n);function n(){var e;o(this,n);for(var r=arguments.length,a=new Array(r),u=0;u<r;u++)a[u]=arguments[u];return e=t.call.apply(t,[this].concat(a)),i(s(e),"uploader",void 0),i(s(e),"saveUploader",(function(t){e.uploader=t})),e}return u(n,[{key:"abort",value:function(e){this.uploader.abort(e)}},{key:"render",value:function(){return d.createElement(P,l({},this.props,{ref:this.saveUploader}))}}]),n}(h.Component);i(j,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:D,onError:D,onSuccess:D,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});export{j as U};
