import{b as e,e as n,c as o,k as t,g as r,f as a,d as i}from"./@babel.BGkJ1U9u.js";import{c}from"./classnames.BmZ8OyLm.js";import{K as l,o as s,q as u,I as f,J as m,e as d,L as v}from"./rc-util.DIscDwjl.js";import{r as p,a as g}from"./react.DlfX74Oz.js";import{D as h}from"./rc-dialog.D0dITa0k.js";import{P as C}from"./@rc-component.CaAxqRoJ.js";import{C as b}from"./rc-motion.BpKOU8X5.js";var y=p.createContext(null),w=function(o){var t=o.visible,r=o.maskTransitionName,a=o.getContainer,i=o.prefixCls,s=o.rootClassName,u=o.icons,f=o.countRender,m=o.showSwitch,d=o.showProgress,v=o.current,g=o.transform,h=o.count,w=o.scale,x=o.minScale,k=o.maxScale,R=o.closeIcon,E=o.onActive,S=o.onClose,N=o.onZoomIn,I=o.onZoomOut,T=o.onRotateRight,Y=o.onRotateLeft,P=o.onFlipX,X=o.onFlipY,M=o.onReset,z=o.toolbarRender,L=o.zIndex,Z=o.image,j=p.useContext(y),D=u.rotateLeft,F=u.rotateRight,O=u.zoomIn,W=u.zoomOut,H=u.close,V=u.left,A=u.right,B=u.flipX,G=u.flipY,q="".concat(i,"-operations-operation");p.useEffect((function(){var e=function(e){e.keyCode===l.ESC&&S()};return t&&window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[t]);var J=function(e,n){e.preventDefault(),e.stopPropagation(),E(n)},K=p.useCallback((function(n){var o=n.type,t=n.disabled,r=n.onClick,a=n.icon;return p.createElement("div",{key:o,className:c(q,"".concat(i,"-operations-operation-").concat(o),e({},"".concat(i,"-operations-operation-disabled"),!!t)),onClick:r},a)}),[q,i]),U=m?K({icon:V,onClick:function(e){return J(e,-1)},type:"prev",disabled:0===v}):void 0,Q=m?K({icon:A,onClick:function(e){return J(e,1)},type:"next",disabled:v===h-1}):void 0,$=K({icon:G,onClick:X,type:"flipY"}),_=K({icon:B,onClick:P,type:"flipX"}),ee=K({icon:D,onClick:Y,type:"rotateLeft"}),ne=K({icon:F,onClick:T,type:"rotateRight"}),oe=K({icon:W,onClick:I,type:"zoomOut",disabled:w<=x}),te=K({icon:O,onClick:N,type:"zoomIn",disabled:w===k}),re=p.createElement("div",{className:"".concat(i,"-operations")},$,_,ee,ne,oe,te);return p.createElement(b,{visible:t,motionName:r},(function(o){var t=o.className,r=o.style;return p.createElement(C,{open:!0,getContainer:null!=a?a:document.body},p.createElement("div",{className:c("".concat(i,"-operations-wrapper"),t,s),style:n(n({},r),{},{zIndex:L})},null===R?null:p.createElement("button",{className:"".concat(i,"-close"),onClick:S},R||H),m&&p.createElement(p.Fragment,null,p.createElement("div",{className:c("".concat(i,"-switch-left"),e({},"".concat(i,"-switch-left-disabled"),0===v)),onClick:function(e){return J(e,-1)}},V),p.createElement("div",{className:c("".concat(i,"-switch-right"),e({},"".concat(i,"-switch-right-disabled"),v===h-1)),onClick:function(e){return J(e,1)}},A)),p.createElement("div",{className:"".concat(i,"-footer")},d&&p.createElement("div",{className:"".concat(i,"-progress")},f?f(v+1,h):"".concat(v+1," / ").concat(h)),z?z(re,n(n({icons:{prevIcon:U,nextIcon:Q,flipYIcon:$,flipXIcon:_,rotateLeftIcon:ee,rotateRightIcon:ne,zoomOutIcon:oe,zoomInIcon:te},actions:{onActive:E,onFlipY:X,onFlipX:P,onRotateLeft:Y,onRotateRight:T,onZoomOut:I,onZoomIn:N,onReset:M,onClose:S},transform:g},j?{current:v,total:h}:{}),{},{image:Z})):re)))}))},x={x:0,y:0,rotate:0,scale:1,flipX:!1,flipY:!1};function k(n,o,t,r){var a=o+t,i=(t-r)/2;if(t>r){if(o>0)return e({},n,i);if(o<0&&a<r)return e({},n,-i)}else if(o<0||a>r)return e({},n,o<0?i:-i);return{}}function R(e,o,t,r){var a=f(),i=a.width,c=a.height,l=null;return e<=i&&o<=c?l={x:0,y:0}:(e>i||o>c)&&(l=n(n({},k("x",t,e,i)),k("y",r,o,c))),l}function E(e){var n=e.src,t=e.isCustomPlaceholder,r=e.fallback,a=p.useState(t?"loading":"normal"),i=o(a,2),c=i[0],l=i[1],s=p.useRef(!1),u="error"===c;p.useEffect((function(){var e=!0;return function(e){return new Promise((function(n){var o=document.createElement("img");o.onerror=function(){return n(!1)},o.onload=function(){return n(!0)},o.src=e}))}(n).then((function(n){!n&&e&&l("error")})),function(){e=!1}}),[n]),p.useEffect((function(){t&&!s.current?l("loading"):u&&l("normal")}),[n]);var f=function(){l("normal")};return[function(e){s.current=!1,"loading"===c&&null!=e&&e.complete&&(e.naturalWidth||e.naturalHeight)&&(s.current=!0,f())},u&&r?{src:r}:{onLoad:f,src:n},c]}function S(e,n){var o=e.x-n.x,t=e.y-n.y;return Math.hypot(o,t)}function N(e,t,r,a,i,c,l){var s=i.rotate,u=i.scale,f=i.x,d=i.y,v=p.useState(!1),g=o(v,2),h=g[0],C=g[1],b=p.useRef({point1:{x:0,y:0},point2:{x:0,y:0},eventType:"none"}),y=function(e){b.current=n(n({},b.current),e)};return p.useEffect((function(){var e;return r&&t&&(e=m(window,"touchmove",(function(e){return e.preventDefault()}),{passive:!1})),function(){var n;null===(n=e)||void 0===n||n.remove()}}),[r,t]),{isTouching:h,onTouchStart:function(e){if(t){e.stopPropagation(),C(!0);var n=e.touches,o=void 0===n?[]:n;o.length>1?y({point1:{x:o[0].clientX,y:o[0].clientY},point2:{x:o[1].clientX,y:o[1].clientY},eventType:"touchZoom"}):y({point1:{x:o[0].clientX-f,y:o[0].clientY-d},eventType:"move"})}},onTouchMove:function(e){var n=e.touches,t=void 0===n?[]:n,r=b.current,a=r.point1,i=r.point2,s=r.eventType;if(t.length>1&&"touchZoom"===s){var u={x:t[0].clientX,y:t[0].clientY},f={x:t[1].clientX,y:t[1].clientY},m=function(e,n,o,t){var r=S(e,o),a=S(n,t);if(0===r&&0===a)return[e.x,e.y];var i=r/(r+a);return[e.x+i*(n.x-e.x),e.y+i*(n.y-e.y)]}(a,i,u,f),d=o(m,2),v=d[0],p=d[1],g=S(u,f)/S(a,i);l(g,"touchZoom",v,p,!0),y({point1:u,point2:f,eventType:"touchZoom"})}else"move"===s&&(c({x:t[0].clientX-a.x,y:t[0].clientY-a.y},"move"),y({eventType:"move"}))},onTouchEnd:function(){if(r){if(h&&C(!1),y({eventType:"none"}),a>u)return c({x:0,y:0,scale:a},"touchZoom");var o=e.current.offsetWidth*u,t=e.current.offsetHeight*u,i=e.current.getBoundingClientRect(),l=i.left,f=i.top,m=s%180!=0,d=R(m?t:o,m?o:t,l,f);d&&c(n({},d),"dragRebound")}}}}var I=["fallback","src","imgRef"],T=["prefixCls","src","alt","imageInfo","fallback","movable","onClose","visible","icons","rootClassName","closeIcon","getContainer","current","count","countRender","scaleStep","minScale","maxScale","transitionName","maskTransitionName","imageRender","imgCommonProps","toolbarRender","onTransform","onChange"],Y=function(e){var n=e.fallback,a=e.src,i=e.imgRef,c=t(e,I),l=E({src:a,fallback:n}),s=o(l,2),u=s[0],f=s[1];return g.createElement("img",r({ref:function(e){i.current=e,u(e)}},c,f))},P=function(a){var i=a.prefixCls,d=a.src,v=a.alt,C=a.imageInfo,b=a.fallback,k=a.movable,E=void 0===k||k,S=a.onClose,I=a.visible,P=a.icons,X=void 0===P?{}:P,M=a.rootClassName,z=a.closeIcon,L=a.getContainer,Z=a.current,j=void 0===Z?0:Z,D=a.count,F=void 0===D?1:D,O=a.countRender,W=a.scaleStep,H=void 0===W?.5:W,V=a.minScale,A=void 0===V?1:V,B=a.maxScale,G=void 0===B?50:B,q=a.transitionName,J=void 0===q?"zoom":q,K=a.maskTransitionName,U=void 0===K?"fade":K,Q=a.imageRender,$=a.imgCommonProps,_=a.toolbarRender,ee=a.onTransform,ne=a.onChange,oe=t(a,T),te=p.useRef(),re=p.useContext(y),ae=re&&F>1,ie=re&&F>=1,ce=p.useState(!0),le=o(ce,2),se=le[0],ue=le[1],fe=function(e,t,r,a){var i=p.useRef(null),c=p.useRef([]),l=p.useState(x),m=o(l,2),d=m[0],v=m[1],g=function(e,o){null===i.current&&(c.current=[],i.current=u((function(){v((function(e){var t=e;return c.current.forEach((function(e){t=n(n({},t),e)})),i.current=null,null==a||a({transform:t,action:o}),t}))}))),c.current.push(n(n({},d),e))};return{transform:d,resetTransform:function(e){v(x),s(x,d)||null==a||a({transform:x,action:e})},updateTransform:g,dispatchZoomChange:function(n,o,a,i,c){var l=e.current,s=l.width,u=l.height,m=l.offsetWidth,v=l.offsetHeight,p=l.offsetLeft,h=l.offsetTop,C=n,b=d.scale*n;b>r?(b=r,C=r/d.scale):b<t&&(C=(b=c?b:t)/d.scale);var y=null!=a?a:innerWidth/2,w=null!=i?i:innerHeight/2,x=C-1,k=x*s*.5,R=x*u*.5,E=x*(y-d.x-p),S=x*(w-d.y-h),N=d.x-(E-k),I=d.y-(S-R);if(n<1&&1===b){var T=m*b,Y=v*b,P=f(),X=P.width,M=P.height;T<=X&&Y<=M&&(N=0,I=0)}g({x:N,y:I,scale:b},o)}}}(te,A,G,ee),me=fe.transform,de=fe.resetTransform,ve=fe.updateTransform,pe=fe.dispatchZoomChange,ge=function(e,t,r,a,i,c,l){var s=i.rotate,u=i.scale,f=i.x,d=i.y,v=p.useState(!1),g=o(v,2),h=g[0],C=g[1],b=p.useRef({diffX:0,diffY:0,transformX:0,transformY:0}),y=function(e){r&&h&&c({x:e.pageX-b.current.diffX,y:e.pageY-b.current.diffY},"move")},w=function(){if(r&&h){C(!1);var o=b.current,t=o.transformX,a=o.transformY;if(f===t||d===a)return;var i=e.current.offsetWidth*u,l=e.current.offsetHeight*u,m=e.current.getBoundingClientRect(),v=m.left,p=m.top,g=s%180!=0,y=R(g?l:i,g?i:l,v,p);y&&c(n({},y),"dragRebound")}};return p.useEffect((function(){var e,n,o,r;if(t){o=m(window,"mouseup",w,!1),r=m(window,"mousemove",y,!1);try{window.top!==window.self&&(e=m(window.top,"mouseup",w,!1),n=m(window.top,"mousemove",y,!1))}catch(a){}}return function(){var t,a,i,c;null===(t=o)||void 0===t||t.remove(),null===(a=r)||void 0===a||a.remove(),null===(i=e)||void 0===i||i.remove(),null===(c=n)||void 0===c||c.remove()}}),[r,h,f,d,s,t]),{isMoving:h,onMouseDown:function(e){t&&0===e.button&&(e.preventDefault(),e.stopPropagation(),b.current={diffX:e.pageX-f,diffY:e.pageY-d,transformX:f,transformY:d},C(!0))},onMouseMove:y,onMouseUp:w,onWheel:function(e){if(r&&0!=e.deltaY){var n=Math.abs(e.deltaY/100),o=1+Math.min(n,1)*a;e.deltaY>0&&(o=1/o),l(o,"wheel",e.clientX,e.clientY)}}}}(te,E,I,H,me,ve,pe),he=ge.isMoving,Ce=ge.onMouseDown,be=ge.onWheel,ye=N(te,E,I,A,me,ve,pe),we=ye.isTouching,xe=ye.onTouchStart,ke=ye.onTouchMove,Re=ye.onTouchEnd,Ee=me.rotate,Se=me.scale,Ne=c(e({},"".concat(i,"-moving"),he));p.useEffect((function(){se||ue(!0)}),[se]);var Ie=function(e){var n=j+e;!Number.isInteger(n)||n<0||n>F-1||(ue(!1),de(e<0?"prev":"next"),null==ne||ne(n,j))},Te=function(e){I&&ae&&(e.keyCode===l.LEFT?Ie(-1):e.keyCode===l.RIGHT&&Ie(1))};p.useEffect((function(){var e=m(window,"keydown",Te,!1);return function(){e.remove()}}),[I,ae,j]);var Ye=g.createElement(Y,r({},$,{width:a.width,height:a.height,imgRef:te,className:"".concat(i,"-img"),alt:v,style:{transform:"translate3d(".concat(me.x,"px, ").concat(me.y,"px, 0) scale3d(").concat(me.flipX?"-":"").concat(Se,", ").concat(me.flipY?"-":"").concat(Se,", 1) rotate(").concat(Ee,"deg)"),transitionDuration:(!se||we)&&"0s"},fallback:b,src:d,onWheel:be,onMouseDown:Ce,onDoubleClick:function(e){I&&(1!==Se?ve({x:0,y:0,scale:1},"doubleClick"):pe(1+H,"doubleClick",e.clientX,e.clientY))},onTouchStart:xe,onTouchMove:ke,onTouchEnd:Re,onTouchCancel:Re})),Pe=n({url:d,alt:v},C);return g.createElement(g.Fragment,null,g.createElement(h,r({transitionName:J,maskTransitionName:U,closable:!1,keyboard:!0,prefixCls:i,onClose:S,visible:I,classNames:{wrapper:Ne},rootClassName:M,getContainer:L},oe,{afterClose:function(){de("close")}}),g.createElement("div",{className:"".concat(i,"-img-wrapper")},Q?Q(Ye,n({transform:me,image:Pe},re?{current:j}:{})):Ye)),g.createElement(w,{visible:I,transform:me,maskTransitionName:U,closeIcon:z,getContainer:L,prefixCls:i,rootClassName:M,icons:X,countRender:O,showSwitch:ae,showProgress:ie,current:j,count:F,scale:Se,minScale:A,maxScale:G,toolbarRender:_,onActive:Ie,onZoomIn:function(){pe(1+H,"zoomIn")},onZoomOut:function(){pe(1/(1+H),"zoomOut")},onRotateRight:function(){ve({rotate:Ee+90},"rotateRight")},onRotateLeft:function(){ve({rotate:Ee-90},"rotateLeft")},onFlipX:function(){ve({flipX:!me.flipX},"flipX")},onFlipY:function(){ve({flipY:!me.flipY},"flipY")},onClose:S,onReset:function(){de("reset")},zIndex:void 0!==oe.zIndex?oe.zIndex+1:void 0,image:Pe}))},X=["crossOrigin","decoding","draggable","loading","referrerPolicy","sizes","srcSet","useMap","alt"];var M=["visible","onVisibleChange","getContainer","current","movable","minScale","maxScale","countRender","closeIcon","onChange","onTransform","toolbarRender","imageRender"],z=["src"],L=0;var Z=["src","alt","onPreviewClose","prefixCls","previewPrefixCls","placeholder","fallback","width","height","style","preview","className","onClick","onError","wrapperClassName","wrapperStyle","rootClassName"],j=["src","visible","onVisibleChange","getContainer","mask","maskClassName","movable","icons","scaleStep","minScale","maxScale","imageRender","toolbarRender"],D=function(a){var l=a.src,s=a.alt,u=a.onPreviewClose,f=a.prefixCls,m=void 0===f?"rc-image":f,g=a.previewPrefixCls,h=void 0===g?"".concat(m,"-preview"):g,C=a.placeholder,b=a.fallback,w=a.width,x=a.height,k=a.style,R=a.preview,S=void 0===R||R,N=a.className,I=a.onClick,T=a.onError,Y=a.wrapperClassName,M=a.wrapperStyle,z=a.rootClassName,D=t(a,Z),F=C&&!0!==C,O="object"===i(S)?S:{},W=O.src,H=O.visible,V=void 0===H?void 0:H,A=O.onVisibleChange,B=void 0===A?u:A,G=O.getContainer,q=void 0===G?void 0:G,J=O.mask,K=O.maskClassName,U=O.movable,Q=O.icons,$=O.scaleStep,_=O.minScale,ee=O.maxScale,ne=O.imageRender,oe=O.toolbarRender,te=t(O,j),re=null!=W?W:l,ae=d(!!V,{value:V,onChange:B}),ie=o(ae,2),ce=ie[0],le=ie[1],se=E({src:l,isCustomPlaceholder:F,fallback:b}),ue=o(se,3),fe=ue[0],me=ue[1],de=ue[2],ve=p.useState(null),pe=o(ve,2),ge=pe[0],he=pe[1],Ce=p.useContext(y),be=!!S,ye=c(m,Y,z,e({},"".concat(m,"-error"),"error"===de)),we=p.useMemo((function(){var e={};return X.forEach((function(n){void 0!==a[n]&&(e[n]=a[n])})),e}),X.map((function(e){return a[e]}))),xe=function(e,n){var t=p.useState((function(){return String(L+=1)})),r=o(t,1)[0],a=p.useContext(y),i={data:n,canPreview:e};return p.useEffect((function(){if(a)return a.register(r,i)}),[]),p.useEffect((function(){a&&a.register(r,i)}),[e,n]),r}(be,p.useMemo((function(){return n(n({},we),{},{src:re})}),[re,we]));return p.createElement(p.Fragment,null,p.createElement("div",r({},D,{className:ye,onClick:be?function(e){var n=v(e.target),o=n.left,t=n.top;Ce?Ce.onPreview(xe,re,o,t):(he({x:o,y:t}),le(!0)),null==I||I(e)}:I,style:n({width:w,height:x},M)}),p.createElement("img",r({},we,{className:c("".concat(m,"-img"),e({},"".concat(m,"-img-placeholder"),!0===C),N),style:n({height:x},k),ref:fe},me,{width:w,height:x,onError:T})),"loading"===de&&p.createElement("div",{"aria-hidden":"true",className:"".concat(m,"-placeholder")},C),J&&be&&p.createElement("div",{className:c("".concat(m,"-mask"),K),style:{display:"none"===(null==k?void 0:k.display)?"none":void 0}},J)),!Ce&&be&&p.createElement(P,r({"aria-hidden":!ce,visible:ce,prefixCls:h,onClose:function(){le(!1),he(null)},mousePosition:ge,src:re,alt:s,imageInfo:{width:w,height:x},fallback:b,getContainer:q,icons:Q,movable:U,scaleStep:$,minScale:_,maxScale:ee,rootClassName:z,imageRender:ne,imgCommonProps:we,toolbarRender:oe},te)))};D.PreviewGroup=function(c){var l,s=c.previewPrefixCls,u=void 0===s?"rc-image-preview":s,f=c.children,m=c.icons,v=void 0===m?{}:m,g=c.items,h=c.preview,C=c.fallback,b="object"===i(h)?h:{},w=b.visible,x=b.onVisibleChange,k=b.getContainer,R=b.current,E=b.movable,S=b.minScale,N=b.maxScale,I=b.countRender,T=b.closeIcon,Y=b.onChange,L=b.onTransform,Z=b.toolbarRender,j=b.imageRender,D=t(b,M),F=function(t){var r=p.useState({}),i=o(r,2),c=i[0],l=i[1],s=p.useCallback((function(o,t){return l((function(r){return n(n({},r),{},e({},o,t))})),function(){l((function(e){var t=n({},e);return delete t[o],t}))}}),[]);return[p.useMemo((function(){return t?t.map((function(e){if("string"==typeof e)return{data:{src:e}};var n={};return Object.keys(e).forEach((function(o){["src"].concat(a(X)).includes(o)&&(n[o]=e[o])})),{data:n}})):Object.keys(c).reduce((function(e,n){var o=c[n],t=o.canPreview,r=o.data;return t&&e.push({data:r,id:n}),e}),[])}),[t,c]),s,!!t]}(g),O=o(F,3),W=O[0],H=O[1],V=O[2],A=d(0,{value:R}),B=o(A,2),G=B[0],q=B[1],J=p.useState(!1),K=o(J,2),U=K[0],Q=K[1],$=(null===(l=W[G])||void 0===l?void 0:l.data)||{},_=$.src,ee=t($,z),ne=d(!!w,{value:w,onChange:function(e,n){null==x||x(e,n,G)}}),oe=o(ne,2),te=oe[0],re=oe[1],ae=p.useState(null),ie=o(ae,2),ce=ie[0],le=ie[1],se=p.useCallback((function(e,n,o,t){var r=V?W.findIndex((function(e){return e.data.src===n})):W.findIndex((function(n){return n.id===e}));q(r<0?0:r),re(!0),le({x:o,y:t}),Q(!0)}),[W,V]);p.useEffect((function(){te?U||q(0):Q(!1)}),[te]);var ue=p.useMemo((function(){return{register:H,onPreview:se}}),[H,se]);return p.createElement(y.Provider,{value:ue},f,p.createElement(P,r({"aria-hidden":!te,movable:E,visible:te,prefixCls:u,closeIcon:T,onClose:function(){re(!1),le(null)},mousePosition:ce,imgCommonProps:ee,src:_,fallback:C,icons:v,minScale:S,maxScale:N,getContainer:k,current:G,count:W.length,countRender:I,onTransform:L,toolbarRender:Z,imageRender:j,onChange:function(e,n){q(e),null==Y||Y(e,n)}},D)))};export{D as I};
