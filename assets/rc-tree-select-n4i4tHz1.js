import{A as Tr,b as $e,q as _r,K as le,p as ur}from"./rc-util-I-T2_Oqq.js";import{e as T,f as j,h as sr,b as Vr,c as U,g as fr,d as Mr}from"./@babel-DbNJHz-F.js";import{u as Nr,b as Or,B as Pr}from"./rc-select-h5Y_1pil.js";import{r as t}from"./react-gY946ZKh.js";import{a as Je,c as Ar,T as Hr}from"./rc-tree-bpH-H4R1.js";import"./classnames-uKr76nPM.js";const $r=function(e){var r=t.useRef({valueLabels:new Map});return t.useMemo(function(){var n=r.current.valueLabels,u=new Map,l=e.map(function(o){var a,c=o.value,i=(a=o.label)!==null&&a!==void 0?a:n.get(c);return u.set(c,i),T(T({},o),{},{label:i})});return r.current.valueLabels=u,[l]},[e])},Rr=function(e,r,n,u){return t.useMemo(function(){var l=e.map(function(i){var s=i.value;return s}),o=r.map(function(i){var s=i.value;return s}),a=l.filter(function(i){return!u[i]});if(n){var c=Je(l,!0,u);l=c.checkedKeys,o=c.halfCheckedKeys}return[Array.from(new Set([].concat(j(a),j(l)))),o]},[e,r,n,u])};function Fr(e){return Array.isArray(e)?e:e!==void 0?[e]:[]}function Wr(e){var r=e||{},n=r.label,u=r.value,l=r.children,o=u||"value";return{_title:n?[n]:["title","label"],value:o,key:o,children:l||"children"}}function Ye(e){return!e||e.disabled||e.disableCheckbox||e.checkable===!1}function jr(e,r){var n=[];function u(l){l.forEach(function(o){var a=o[r.children];a&&(n.push(o[r.value]),u(a))})}return u(e),n}function or(e){return e==null}const Ur=function(e,r){return t.useMemo(function(){var n=Ar(e,{fieldNames:r,initWrapper:function(l){return T(T({},l),{},{valueEntities:new Map})},processEntity:function(l,o){var a=l.node[r.value];o.valueEntities.set(a,l)}});return n},[e,r])};var vr=function(){return null},Br=["children","value"];function hr(e){return Tr(e).map(function(r){if(!t.isValidElement(r)||!r.type)return null;var n=r,u=n.key,l=n.props,o=l.children,a=l.value,c=sr(l,Br),i=T({key:u,value:a},c),s=hr(o);return s.length&&(i.children=s),i}).filter(function(r){return r})}function ze(e){if(!e)return e;var r=T({},e);return"props"in r||Object.defineProperty(r,"props",{get:function(){return $e(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),r}}),r}function Gr(e,r,n,u,l,o){var a=null,c=null;function i(){function s(f){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"0",E=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return f.map(function(S,P){var D="".concat(I,"-").concat(P),_=S[o.value],H=n.includes(_),B=s(S[o.children]||[],D,H),$=t.createElement(vr,S,B.map(function(L){return L.node}));if(r===_&&(a=$),H){var C={pos:D,node:$,children:B};return E||c.push(C),C}return null}).filter(function(S){return S})}c||(c=[],s(u),c.sort(function(f,I){var E=f.node.props.value,S=I.node.props.value,P=n.indexOf(E),D=n.indexOf(S);return P-D}))}Object.defineProperty(e,"triggerNode",{get:function(){return $e(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),i(),a}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return $e(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),i(),l?c:c.map(function(f){var I=f.node;return I})}})}const qr=function(e,r,n){var u=n.treeNodeFilterProp,l=n.filterTreeNode,o=n.fieldNames,a=o.children;return t.useMemo(function(){if(!r||l===!1)return e;var c;if(typeof l=="function")c=l;else{var i=r.toUpperCase();c=function(I,E){var S=E[u];return String(S).toUpperCase().includes(i)}}function s(f){var I=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return f.reduce(function(E,S){var P=S[a],D=I||c(r,ze(S)),_=s(P||[],D);return(D||_.length)&&E.push(T(T({},S),{},Vr({isLeaf:void 0},a,_))),E},[])}return s(e)},[e,r,a,u,l])};function cr(e){var r=t.useRef();r.current=e;var n=t.useCallback(function(){return r.current.apply(r,arguments)},[]);return n}function Jr(e,r){var n=r.id,u=r.pId,l=r.rootPId,o={},a=[],c=e.map(function(i){var s=T({},i),f=s[n];return o[f]=s,s.key=s.key||f,s});return c.forEach(function(i){var s=i[u],f=o[s];f&&(f.children=f.children||[],f.children.push(i)),(s===l||!f&&l===null)&&a.push(i)}),a}function Yr(e,r,n){return t.useMemo(function(){return e?n?Jr(e,T({id:"id",pId:"pId",rootPId:null},n!==!0?n:{})):e:hr(r)},[r,n,e])}var pr=t.createContext(null),mr=t.createContext(null),zr={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},Qr=function(r,n){var u=Nr(),l=u.prefixCls,o=u.multiple,a=u.searchValue,c=u.toggleOpen,i=u.open,s=u.notFoundContent,f=t.useContext(mr),I=f.virtual,E=f.listHeight,S=f.listItemHeight,P=f.listItemScrollOffset,D=f.treeData,_=f.fieldNames,H=f.onSelect,B=f.dropdownMatchSelectWidth,$=f.treeExpandAction,C=t.useContext(pr),L=C.checkable,x=C.checkedKeys,Se=C.halfCheckedKeys,Q=C.treeExpandedKeys,Fe=C.treeDefaultExpandAll,We=C.treeDefaultExpandedKeys,be=C.onTreeExpand,ke=C.treeIcon,Ee=C.showTreeIcon,xe=C.switcherIcon,De=C.treeLine,we=C.treeNodeFilterProp,Ie=C.loadData,ie=C.treeLoadedKeys,Le=C.treeMotion,Ke=C.onTreeLoad,Te=C.keyEntities,G=t.useRef(),ue=_r(function(){return D},[i,D],function(b,h){return h[0]&&b[1]!==h[1]}),_e=t.useState(null),oe=U(_e,2),X=oe[0],Z=oe[1],A=Te[X],ce=t.useMemo(function(){return L?{checked:x,halfChecked:Se}:null},[L,x,Se]);t.useEffect(function(){if(i&&!o&&x.length){var b;(b=G.current)===null||b===void 0||b.scrollTo({key:x[0]}),Z(x[0])}},[i]);var de=String(a).toLowerCase(),Ve=function(h){return de?String(h[we]).toLowerCase().includes(de):!1},Me=t.useState(We),se=U(Me,2),fe=se[0],je=se[1],Ue=t.useState(null),q=U(Ue,2),J=q[0],ve=q[1],M=t.useMemo(function(){return Q?j(Q):a?J:fe},[fe,J,Q,a]);t.useEffect(function(){a&&ve(jr(D,_))},[a]);var Be=function(h){je(h),ve(h),be&&be(h)},he=function(h){h.preventDefault()},R=function(h,ee){var N=ee.node;L&&Ye(N)||(H(N.key,{selected:!x.includes(N.key)}),o||c(!1))};if(t.useImperativeHandle(n,function(){var b;return{scrollTo:(b=G.current)===null||b===void 0?void 0:b.scrollTo,onKeyDown:function(ee){var N,Ne=ee.which;switch(Ne){case le.UP:case le.DOWN:case le.LEFT:case le.RIGHT:(N=G.current)===null||N===void 0||N.onKeyDown(ee);break;case le.ENTER:{if(A){var me=(A==null?void 0:A.node)||{},Ge=me.selectable,re=me.value;Ge!==!1&&R(null,{node:{key:X},selected:!x.includes(re)})}break}case le.ESC:c(!1)}},onKeyUp:function(){}}}),ue.length===0)return t.createElement("div",{role:"listbox",className:"".concat(l,"-empty"),onMouseDown:he},s);var pe={fieldNames:_};return ie&&(pe.loadedKeys=ie),M&&(pe.expandedKeys=M),t.createElement("div",{onMouseDown:he},A&&i&&t.createElement("span",{style:zr,"aria-live":"assertive"},A.node.value),t.createElement(Hr,fr({ref:G,focusable:!1,prefixCls:"".concat(l,"-tree"),treeData:ue,height:E,itemHeight:S,itemScrollOffset:P,virtual:I!==!1&&B!==!1,multiple:o,icon:ke,showIcon:Ee,switcherIcon:xe,showLine:De,loadData:a?null:Ie,motion:Le,activeKey:X,checkable:L,checkStrictly:!0,checkedKeys:ce,selectedKeys:L?[]:x,defaultExpandAll:Fe},pe,{onActiveChange:Z,onSelect:R,onCheck:R,onExpand:Be,onLoad:Ke,filterTreeNode:Ve,expandAction:$})))},gr=t.forwardRef(Qr);gr.displayName="OptionList";var yr="SHOW_ALL",Cr="SHOW_PARENT",Qe="SHOW_CHILD";function dr(e,r,n,u){var l=new Set(e);return r===Qe?e.filter(function(o){var a=n[o];return!(a&&a.children&&a.children.some(function(c){var i=c.node;return l.has(i[u.value])})&&a.children.every(function(c){var i=c.node;return Ye(i)||l.has(i[u.value])}))}):r===Cr?e.filter(function(o){var a=n[o],c=a?a.parent:null;return!(c&&!Ye(c.node)&&l.has(c.key))}):e}var Xr=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","listItemScrollOffset","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion"];function Zr(e){return!e||Mr(e)!=="object"}var et=t.forwardRef(function(e,r){var n=e.id,u=e.prefixCls,l=u===void 0?"rc-tree-select":u,o=e.value,a=e.defaultValue,c=e.onChange,i=e.onSelect,s=e.onDeselect,f=e.searchValue,I=e.inputValue,E=e.onSearch,S=e.autoClearSearchValue,P=S===void 0?!0:S,D=e.filterTreeNode,_=e.treeNodeFilterProp,H=_===void 0?"value":_,B=e.showCheckedStrategy,$=e.treeNodeLabelProp,C=e.multiple,L=e.treeCheckable,x=e.treeCheckStrictly,Se=e.labelInValue,Q=e.fieldNames,Fe=e.treeDataSimpleMode,We=e.treeData,be=e.children,ke=e.loadData,Ee=e.treeLoadedKeys,xe=e.onTreeLoad,De=e.treeDefaultExpandAll,we=e.treeExpandedKeys,Ie=e.treeDefaultExpandedKeys,ie=e.onTreeExpand,Le=e.treeExpandAction,Ke=e.virtual,Te=e.listHeight,G=Te===void 0?200:Te,ue=e.listItemHeight,_e=ue===void 0?20:ue,oe=e.listItemScrollOffset,X=oe===void 0?0:oe,Z=e.onDropdownVisibleChange,A=e.dropdownMatchSelectWidth,ce=A===void 0?!0:A,de=e.treeLine,Ve=e.treeIcon,Me=e.showTreeIcon,se=e.switcherIcon,fe=e.treeMotion,je=sr(e,Xr),Ue=Or(n),q=L&&!x,J=L||x,ve=x||Se,M=J||C,Be=ur(a,{value:o}),he=U(Be,2),R=he[0],pe=he[1],b=t.useMemo(function(){return L?B||Qe:yr},[B,L]),h=t.useMemo(function(){return Wr(Q)},[JSON.stringify(Q)]),ee=ur("",{value:f!==void 0?f:I,postState:function(d){return d||""}}),N=U(ee,2),Ne=N[0],me=N[1],Ge=function(d){me(d),E==null||E(d)},re=Yr(We,be,Fe),Xe=Ur(re,h),K=Xe.keyEntities,Y=Xe.valueEntities,Ze=t.useCallback(function(v){var d=[],p=[];return v.forEach(function(m){Y.has(m)?p.push(m):d.push(m)}),{missingRawValues:d,existRawValues:p}},[Y]),er=qr(re,Ne,{fieldNames:h,treeNodeFilterProp:H,filterTreeNode:D}),rr=t.useCallback(function(v){if(v){if($)return v[$];for(var d=h._title,p=0;p<d.length;p+=1){var m=v[d[p]];if(m!==void 0)return m}}},[h,$]),ge=t.useCallback(function(v){var d=Fr(v);return d.map(function(p){return Zr(p)?{value:p}:p})},[]),Oe=t.useCallback(function(v){var d=ge(v);return d.map(function(p){var m=p.label,w=p.value,k=p.halfChecked,g,y=Y.get(w);if(y){var V;m=(V=m)!==null&&V!==void 0?V:rr(y.node),g=y.node.disabled}else if(m===void 0){var F=ge(R).find(function(ye){return ye.value===w});m=F.label}return{label:m,value:w,halfChecked:k,disabled:g}})},[Y,rr,ge,R]),tr=t.useMemo(function(){return ge(R)},[ge,R]),Sr=t.useMemo(function(){var v=[],d=[];return tr.forEach(function(p){p.halfChecked?d.push(p):v.push(p)}),[v,d]},[tr]),nr=U(Sr,2),te=nr[0],ar=nr[1],lr=t.useMemo(function(){return te.map(function(v){return v.value})},[te]),br=Rr(te,ar,q,K),ir=U(br,2),ne=ir[0],Pe=ir[1],kr=t.useMemo(function(){var v=dr(ne,b,K,h),d=v.map(function(k){var g,y;return(g=(y=K[k])===null||y===void 0||(y=y.node)===null||y===void 0?void 0:y[h.value])!==null&&g!==void 0?g:k}),p=d.map(function(k){var g=te.find(function(y){return y.value===k});return{value:k,label:g==null?void 0:g.label}}),m=Oe(p),w=m[0];return!M&&w&&or(w.value)&&or(w.label)?[]:m.map(function(k){var g;return T(T({},k),{},{label:(g=k.label)!==null&&g!==void 0?g:k.value})})},[h,M,ne,te,Oe,b,K]),Er=$r(kr),xr=U(Er,1),Dr=xr[0],Ae=cr(function(v,d,p){var m=Oe(v);if(pe(m),P&&me(""),c){var w=v;if(q){var k=dr(v,b,K,h);w=k.map(function(O){var W=Y.get(O);return W?W.node[h.value]:O})}var g=d||{triggerValue:void 0,selected:void 0},y=g.triggerValue,V=g.selected,F=w;if(x){var ye=ar.filter(function(O){return!w.includes(O.value)});F=[].concat(j(F),j(ye))}var Ce=Oe(F),z={preValue:te,triggerValue:y},ae=!0;(x||p==="selection"&&!V)&&(ae=!1),Gr(z,y,v,re,ae,h),J?z.checked=V:z.selected=V;var He=ve?Ce:Ce.map(function(O){return O.value});c(M?He:He[0],ve?null:Ce.map(function(O){return O.label}),z)}}),qe=t.useCallback(function(v,d){var p,m=d.selected,w=d.source,k=K[v],g=k==null?void 0:k.node,y=(p=g==null?void 0:g[h.value])!==null&&p!==void 0?p:v;if(!M)Ae([y],{selected:!0,triggerValue:y},"option");else{var V=m?[].concat(j(lr),[y]):ne.filter(function(W){return W!==y});if(q){var F=Ze(V),ye=F.missingRawValues,Ce=F.existRawValues,z=Ce.map(function(W){return Y.get(W).key}),ae;if(m){var He=Je(z,!0,K);ae=He.checkedKeys}else{var O=Je(z,{checked:!1,halfCheckedKeys:Pe},K);ae=O.checkedKeys}V=[].concat(j(ye),j(ae.map(function(W){return K[W].node[h.value]})))}Ae(V,{selected:m,triggerValue:y},w||"option")}m||!M?i==null||i(y,ze(g)):s==null||s(y,ze(g))},[Ze,Y,K,h,M,lr,Ae,q,i,s,ne,Pe]),wr=t.useCallback(function(v){if(Z){var d={};Object.defineProperty(d,"documentClickClose",{get:function(){return $e(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),Z(v,d)}},[Z]),Ir=cr(function(v,d){var p=v.map(function(m){return m.value});if(d.type==="clear"){Ae(p,{},"selection");return}d.values.length&&qe(d.values[0].value,{selected:!1,source:"selection"})}),Lr=t.useMemo(function(){return{virtual:Ke,dropdownMatchSelectWidth:ce,listHeight:G,listItemHeight:_e,listItemScrollOffset:X,treeData:er,fieldNames:h,onSelect:qe,treeExpandAction:Le}},[Ke,ce,G,_e,X,er,h,qe,Le]),Kr=t.useMemo(function(){return{checkable:J,loadData:ke,treeLoadedKeys:Ee,onTreeLoad:xe,checkedKeys:ne,halfCheckedKeys:Pe,treeDefaultExpandAll:De,treeExpandedKeys:we,treeDefaultExpandedKeys:Ie,onTreeExpand:ie,treeIcon:Ve,treeMotion:fe,showTreeIcon:Me,switcherIcon:se,treeLine:de,treeNodeFilterProp:H,keyEntities:K}},[J,ke,Ee,xe,ne,Pe,De,we,Ie,ie,Ve,fe,Me,se,de,H,K]);return t.createElement(mr.Provider,{value:Lr},t.createElement(pr.Provider,{value:Kr},t.createElement(Pr,fr({ref:r},je,{id:Ue,prefixCls:l,mode:M?"multiple":void 0,displayValues:Dr,onDisplayValuesChange:Ir,searchValue:Ne,onSearch:Ge,OptionList:gr,emptyOptions:!re.length,onDropdownVisibleChange:wr,dropdownMatchSelectWidth:ce}))))}),Re=et;Re.TreeNode=vr;Re.SHOW_ALL=yr;Re.SHOW_PARENT=Cr;Re.SHOW_CHILD=Qe;export{Re as G,yr as S,vr as T,Cr as a,Qe as b};
