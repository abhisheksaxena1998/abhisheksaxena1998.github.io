import{c as e,k as n,e as t,g as o}from"./@babel.BGkJ1U9u.js";import{c as r}from"./classnames.BmZ8OyLm.js";import{B as a}from"./rc-input.BpL5EsdD.js";import{e as l,A as i,K as u}from"./rc-util.DIscDwjl.js";import{r as s,a as c}from"./react.DlfX74Oz.js";import{T as f}from"./rc-textarea.CVJTn6p_.js";import"./rc-resize-observer.onB48-vm.js";import{d as v}from"./@rc-component.CaAxqRoJ.js";import{E as d,M as p}from"./rc-menu.B5pMDCa9.js";var m=s.createContext(null);function C(e){var n=s.useContext(m),t=n.notFoundContent,o=n.activeIndex,r=n.setActiveIndex,a=n.selectOption,l=n.onFocus,i=n.onBlur,u=e.prefixCls,c=e.options,f=c[o]||{};return s.createElement(d,{prefixCls:"".concat(u,"-menu"),activeKey:f.key,onSelect:function(e){var n=e.key,t=c.find((function(e){return e.key===n}));a(t)},onFocus:l,onBlur:i},c.map((function(e,n){var t=e.key,o=e.disabled,a=e.className,l=e.style,i=e.label;return s.createElement(p,{key:t,disabled:o,className:a,style:l,onMouseEnter:function(){r(n)}},i)})),!c.length&&s.createElement(p,{disabled:!0},t))}var x={bottomRight:{points:["tl","br"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},bottomLeft:{points:["tr","bl"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},topRight:{points:["bl","tr"],offset:[0,-4],overflow:{adjustX:1,adjustY:1}},topLeft:{points:["br","tl"],offset:[0,-4],overflow:{adjustX:1,adjustY:1}}},h=function(e){var n=e.prefixCls,t=e.options,o=e.children,r=e.visible,a=e.transitionName,l=e.getPopupContainer,i=e.dropdownClassName,u=e.direction,c=e.placement,f="".concat(n,"-dropdown"),d=s.createElement(C,{prefixCls:f,options:t}),p=s.useMemo((function(){return"rtl"===u?"top"===c?"topLeft":"bottomLeft":"top"===c?"topRight":"bottomRight"}),[u,c]);return s.createElement(v,{prefixCls:f,popupVisible:r,popup:d,popupPlacement:p,popupTransitionName:a,builtinPlacements:x,getPopupContainer:l,popupClassName:i},o)};function g(e){return(e||"").toLowerCase()}function b(e,n){var t=n.measureLocation,o=n.prefix,r=n.targetText,a=n.selectionStart,l=n.split,i=e.slice(0,t);i[i.length-l.length]===l&&(i=i.slice(0,i.length-l.length)),i&&(i="".concat(i).concat(l));var u=function(e,n,t){var o=e[0];if(!o||o===t)return e;for(var r=e,a=n.length,l=0;l<a;l+=1){if(g(r[l])!==g(n[l])){r=r.slice(l);break}l===a-1&&(r=r.slice(a))}return r}(e.slice(a),r.slice(a-t-o.length),l);u.slice(0,l.length)===l&&(u=u.slice(l.length));var s="".concat(i).concat(o).concat(r).concat(l);return{text:"".concat(s).concat(u),selectionLocation:s.length}}function w(e,n){return!n||-1===e.indexOf(n)}function E(e,n){var t=n.value,o=void 0===t?"":t,r=e.toLowerCase();return-1!==o.toLowerCase().indexOf(r)}var N=["prefixCls","className","style","prefix","split","notFoundContent","value","defaultValue","children","options","open","allowClear","silent","validateSearch","filterOption","onChange","onKeyDown","onKeyUp","onPressEnter","onSearch","onSelect","onFocus","onBlur","transitionName","placement","direction","getPopupContainer","dropdownClassName","rows","visible"],y=["suffix","prefixCls","defaultValue","value","allowClear","onChange","classNames","className","disabled","onClear"],S=s.forwardRef((function(a,v){var d=a.prefixCls,p=a.className,C=a.style,x=a.prefix,g=void 0===x?"@":x,y=a.split,S=void 0===y?" ":y,j=a.notFoundContent,k=void 0===j?"Not Found":j,R=a.value,P=a.defaultValue,O=a.children,T=a.options,F=a.open;a.allowClear;var L=a.silent,A=a.validateSearch,I=void 0===A?w:A,K=a.filterOption,B=void 0===K?E:K,D=a.onChange,M=a.onKeyDown,V=a.onKeyUp,U=a.onPressEnter,X=a.onSearch,Y=a.onSelect,z=a.onFocus,H=a.onBlur,W=a.transitionName,J=a.placement,Q=a.direction,q=a.getPopupContainer,G=a.dropdownClassName,Z=a.rows,$=void 0===Z?1:Z;a.visible;var _=n(a,N),ee=s.useMemo((function(){return Array.isArray(g)?g:[g]}),[g]),ne=s.useRef(null),te=s.useRef(null),oe=s.useRef(null),re=function(){var e;return null===(e=te.current)||void 0===e||null===(e=e.resizableTextArea)||void 0===e?void 0:e.textArea};c.useImperativeHandle(v,(function(){var e;return{focus:function(){var e;return null===(e=te.current)||void 0===e?void 0:e.focus()},blur:function(){var e;return null===(e=te.current)||void 0===e?void 0:e.blur()},textarea:null===(e=te.current)||void 0===e||null===(e=e.resizableTextArea)||void 0===e?void 0:e.textArea,nativeElement:ne.current}}));var ae=s.useState(!1),le=e(ae,2),ie=le[0],ue=le[1],se=s.useState(""),ce=e(se,2),fe=ce[0],ve=ce[1],de=s.useState(""),pe=e(de,2),me=pe[0],Ce=pe[1],xe=s.useState(0),he=e(xe,2),ge=he[0],be=he[1],we=s.useState(0),Ee=e(we,2),Ne=Ee[0],ye=Ee[1],Se=s.useState(!1),je=e(Se,2),ke=je[0],Re=je[1],Pe=l("",{defaultValue:P,value:R}),Oe=e(Pe,2),Te=Oe[0],Fe=Oe[1];s.useEffect((function(){ie&&oe.current&&(oe.current.scrollTop=re().scrollTop)}),[ie]);var Le=c.useMemo((function(){if(F)for(var e=0;e<ee.length;e+=1){var n=ee[e],t=Te.lastIndexOf(n);if(t>=0)return[!0,"",n,t]}return[ie,fe,me,ge]}),[F,ie,ee,Te,fe,me,ge]),Ae=e(Le,4),Ie=Ae[0],Ke=Ae[1],Be=Ae[2],De=Ae[3],Me=c.useCallback((function(e){return(T&&T.length>0?T.map((function(e){var n;return t(t({},e),{},{key:null!==(n=null==e?void 0:e.key)&&void 0!==n?n:e.value})})):i(O).map((function(e){var n=e.props,o=e.key;return t(t({},n),{},{label:n.children,key:o||n.value})}))).filter((function(n){return!1===B||B(e,n)}))}),[O,T,B]),Ve=c.useMemo((function(){return Me(Ke)}),[Me,Ke]),Ue=function(){var n=s.useState({id:0,callback:null}),t=e(n,2),o=t[0],r=t[1],a=s.useCallback((function(e){r((function(n){return{id:n.id+1,callback:e}}))}),[]);return s.useEffect((function(){var e;null===(e=o.callback)||void 0===e||e.call(o)}),[o]),a}(),Xe=function(e){ue(!1),be(0),ve(""),Ue(e)},Ye=function(e){Fe(e),null==D||D(e)},ze=function(e){var n,t=e.value,o=b(Te,{measureLocation:De,targetText:void 0===t?"":t,prefix:Be,selectionStart:null===(n=re())||void 0===n?void 0:n.selectionStart,split:S}),r=o.text,a=o.selectionLocation;Ye(r),Xe((function(){var e,n;e=re(),n=a,e.setSelectionRange(n,n),e.blur(),e.focus()})),null==Y||Y(e,Be)},He=s.useRef(),We=function(e){window.clearTimeout(He.current),!ke&&e&&z&&z(e),Re(!0)},Je=function(e){He.current=window.setTimeout((function(){Re(!1),Xe(),null==H||H(e)}),0)};return c.createElement("div",{className:r(d,p),style:C,ref:ne},c.createElement(f,o({ref:te,value:Te},_,{rows:$,onChange:function(e){var n=e.target.value;Ye(n)},onKeyDown:function(e){var n=e.which;if(null==M||M(e),Ie)if(n===u.UP||n===u.DOWN){var t=Ve.length,o=n===u.UP?-1:1;ye((Ne+o+t)%t),e.preventDefault()}else if(n===u.ESC)Xe();else if(n===u.ENTER){if(e.preventDefault(),L)return;if(!Ve.length)return void Xe();var r=Ve[Ne];ze(r)}},onKeyUp:function(e){var n,t,o=e.key,r=e.which,a=e.target,l=(t=(n=a).selectionStart,n.value.slice(0,t)),i=function(e,n){return n.reduce((function(n,t){var o=e.lastIndexOf(t);return o>n.location?{location:o,prefix:t}:n}),{location:-1,prefix:""})}(l,ee),s=i.location,c=i.prefix;if(null==V||V(e),-1===[u.ESC,u.UP,u.DOWN,u.ENTER].indexOf(r))if(-1!==s){var f=l.slice(s+c.length),v=I(f,S),d=!!Me(f).length;v?(o===c||"Shift"===o||Ie||f!==Ke&&d)&&function(e,n,t){ue(!0),ve(e),Ce(n),be(t),ye(0)}(f,c,s):Ie&&Xe(),X&&v&&X(f,c)}else Ie&&Xe()},onPressEnter:function(e){!Ie&&U&&U(e)},onFocus:We,onBlur:Je})),Ie&&c.createElement("div",{ref:oe,className:"".concat(d,"-measure")},Te.slice(0,De),c.createElement(m.Provider,{value:{notFoundContent:k,activeIndex:Ne,setActiveIndex:ye,selectOption:ze,onFocus:function(){We()},onBlur:function(){Je()}}},c.createElement(h,{prefixCls:d,transitionName:W,placement:J,direction:Q,options:Ve,visible:!0,getPopupContainer:q,dropdownClassName:G},c.createElement("span",null,Be))),Te.slice(De+Be.length)))})),j=s.forwardRef((function(r,i){var u=r.suffix,f=r.prefixCls,v=void 0===f?"rc-mentions":f,d=r.defaultValue,p=r.value,m=r.allowClear,C=r.onChange,x=r.classNames,h=r.className,g=r.disabled,b=r.onClear,w=n(r,y),E=s.useRef(null),N=s.useRef(null);s.useImperativeHandle(i,(function(){var e,n;return t(t({},N.current),{},{nativeElement:(null===(e=E.current)||void 0===e?void 0:e.nativeElement)||(null===(n=N.current)||void 0===n?void 0:n.nativeElement)})}));var j=l("",{defaultValue:d,value:p}),k=e(j,2),R=k[0],P=k[1],O=function(e){P(e),null==C||C(e)};return c.createElement(a,{suffix:u,prefixCls:v,value:R,allowClear:m,handleReset:function(){O("")},className:h,classNames:x,disabled:g,ref:E,onClear:b},c.createElement(S,o({className:null==x?void 0:x.mentions,prefixCls:v,ref:N,onChange:O,disabled:g},w)))}));j.Option=function(){return null};export{j as M};
