import{g as q}from"./@babel-Xj_bk_MP.js";import{r as d}from"./react-gY946ZKh.js";import{L as Se,T as Ht,R as Bt,U as Nt,a as Ut,O as Ne,P as Ue,S as et,b as Re,N as Gt,A as qt,B as Vt,M as Xt,C as Yt,V as B,c as Zt,W as Kt,d as Jt,e as Qt,f as er,g as tr,h as rr,i as nr,D as or,j as we,k as Ge,l as ir,m as sr,E as mt,n as ar,o as cr,p as lr,q as ae,r as ur,s as fr,t as dr}from"./three-eA2GTmlT.js";import{u as pr}from"./react-use-measure-UU-HAmmI.js";import{F as mr,u as vr}from"./its-fine-M-AykjuR.js";import{R as hr,c as se}from"./react-reconciler-5eZyO6cF.js";import{s as tt}from"./scheduler-iwWdm5Ml.js";import{c as gr}from"./react-dom-Wc9rTDnX.js";import{c as vt}from"./zustand-eEH7vIQH.js";import"./maath-Gdth3wcG.js";import{D as yr,G as qe,a as br,M as Oe,O as wr}from"./three-stdlib-lW7bH2DV.js";import{m as Ve}from"./react-merge-refs-hAbx5P3g.js";import{s as Er,p as _r,c as Pr}from"./suspend-react-7rE_FwbT.js";const Mr="modulepreload",xr=function(e){return"/"+e},rt={},Mn=function(t,r,i){let s=Promise.resolve();if(r&&r.length>0){const c=document.getElementsByTagName("link");s=Promise.all(r.map(p=>{if(p=xr(p),p in rt)return;rt[p]=!0;const h=p.endsWith(".css"),a=h?'[rel="stylesheet"]':"";if(!!i)for(let o=c.length-1;o>=0;o--){const m=c[o];if(m.href===p&&(!h||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${a}`))return;const n=document.createElement("link");if(n.rel=h?"stylesheet":Mr,h||(n.as="script",n.crossOrigin=""),n.href=p,document.head.appendChild(n),h)return new Promise((o,m)=>{n.addEventListener("load",o),n.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${p}`)))})}))}return s.then(()=>t()).catch(c=>{const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=c,window.dispatchEvent(p),!p.defaultPrevented)throw c})},Xe={},Cr=e=>void Object.assign(Xe,e);function Sr(e,t){function r(n,{args:o=[],attach:m,...f},v){let P=`${n[0].toUpperCase()}${n.slice(1)}`,g;if(n==="primitive"){if(f.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=f.object;g=oe(l,{type:n,root:v,attach:m,primitive:!0})}else{const l=Xe[P];if(!l)throw new Error(`R3F: ${P} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");g=oe(new l(...o),{type:n,root:v,attach:m,memoizedProps:{args:o}})}return g.__r3f.attach===void 0&&(g instanceof Vt?g.__r3f.attach="geometry":g instanceof Xt&&(g.__r3f.attach="material")),P!=="inject"&&je(g,f),g}function i(n,o){let m=!1;if(o){var f,v;(f=o.__r3f)!=null&&f.attach?Te(n,o,o.__r3f.attach):o.isObject3D&&n.isObject3D&&(n.add(o),m=!0),m||(v=n.__r3f)==null||v.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=n,He(o),ie(o)}}function s(n,o,m){let f=!1;if(o){var v,P;if((v=o.__r3f)!=null&&v.attach)Te(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){o.parent=n,o.dispatchEvent({type:"added"});const g=n.children.filter(u=>u!==o),l=g.indexOf(m);n.children=[...g.slice(0,l),o,...g.slice(l)],f=!0}f||(P=n.__r3f)==null||P.objects.push(o),o.__r3f||oe(o,{}),o.__r3f.parent=n,He(o),ie(o)}}function c(n,o,m=!1){n&&[...n].forEach(f=>p(o,f,m))}function p(n,o,m){if(o){var f,v,P;if(o.__r3f&&(o.__r3f.parent=null),(f=n.__r3f)!=null&&f.objects&&(n.__r3f.objects=n.__r3f.objects.filter(M=>M!==o)),(v=o.__r3f)!=null&&v.attach)at(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){var g;n.remove(o),(g=o.__r3f)!=null&&g.root&&Fr(Me(o),o)}const u=(P=o.__r3f)==null?void 0:P.primitive,b=!u&&(m===void 0?o.dispose!==null:m);if(!u){var l;c((l=o.__r3f)==null?void 0:l.objects,o,b),c(o.children,o,b)}if(delete o.__r3f,b&&o.dispose&&o.type!=="Scene"){const M=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?tt.unstable_scheduleCallback(tt.unstable_IdlePriority,M):M()}ie(n)}}function h(n,o,m,f){var v;const P=(v=n.__r3f)==null?void 0:v.parent;if(!P)return;const g=r(o,m,n.__r3f.root);if(n.children){for(const l of n.children)l.__r3f&&i(g,l);n.children=n.children.filter(l=>!l.__r3f)}n.__r3f.objects.forEach(l=>i(g,l)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||p(P,n),g.parent&&(g.__r3f.autoRemovedBeforeAppend=!0),i(P,g),g.raycast&&g.__r3f.eventCount&&Me(g).getState().internal.interaction.push(g),[f,f.alternate].forEach(l=>{l!==null&&(l.stateNode=g,l.ref&&(typeof l.ref=="function"?l.ref(g):l.ref.current=g))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:hr({createInstance:r,removeChild:p,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,o)=>{if(!o)return;const m=n.getState().scene;m.__r3f&&(m.__r3f.root=n,i(m,o))},removeChildFromContainer:(n,o)=>{o&&p(n.getState().scene,o)},insertInContainerBefore:(n,o,m)=>{if(!o||!m)return;const f=n.getState().scene;f.__r3f&&s(f,o,m)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var o;return!!((o=n==null?void 0:n.__r3f)!=null?o:{}).handlers},prepareUpdate(n,o,m,f){var v;if(((v=n==null?void 0:n.__r3f)!=null?v:{}).primitive&&f.object&&f.object!==n)return[!0];{const{args:g=[],children:l,...u}=f,{args:b=[],children:M,..._}=m;if(!Array.isArray(g))throw new Error("R3F: the args prop must be an array!");if(g.some((C,R)=>C!==b[R]))return[!0];const E=_t(n,u,_,!0);return E.changes.length?[!1,E]:null}},commitUpdate(n,[o,m],f,v,P,g){o?h(n,f,P,g):je(n,m)},commitMount(n,o,m,f){var v;const P=(v=n.__r3f)!=null?v:{};n.raycast&&P.handlers&&P.eventCount&&Me(n).getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>oe(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var o;const{attach:m,parent:f}=(o=n.__r3f)!=null?o:{};m&&f&&at(f,n,m),n.isObject3D&&(n.visible=!1),ie(n)},unhideInstance(n,o){var m;const{attach:f,parent:v}=(m=n.__r3f)!=null?m:{};f&&v&&Te(v,n,f),(n.isObject3D&&o.visible==null||o.visible)&&(n.visible=!0),ie(n)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>t?t():se.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&j.fun(performance.now)?performance.now:j.fun(Date.now)?Date.now:()=>0,scheduleTimeout:j.fun(setTimeout)?setTimeout:void 0,cancelTimeout:j.fun(clearTimeout)?clearTimeout:void 0}),applyProps:je}}var nt,ot;const Ae=e=>"colorSpace"in e||"outputColorSpace"in e,ht=()=>{var e;return(e=Xe.ColorManagement)!=null?e:null},gt=e=>e&&e.isOrthographicCamera,Rr=e=>e&&e.hasOwnProperty("current"),me=typeof window<"u"&&((nt=window.document)!=null&&nt.createElement||((ot=window.navigator)==null?void 0:ot.product)==="ReactNative")?d.useLayoutEffect:d.useEffect;function yt(e){const t=d.useRef(e);return me(()=>void(t.current=e),[e]),t}function Or({set:e}){return me(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class bt extends d.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}bt.getDerivedStateFromError=()=>({error:!0});const wt="__default",it=new Map,Ar=e=>e&&!!e.memoized&&!!e.changes;function Et(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const ue=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function Me(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const j={obj:e=>e===Object(e)&&!j.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(j.str(e)||j.num(e))return e===t;const c=j.obj(e);if(c&&i==="reference")return e===t;const p=j.arr(e);if(p&&r==="reference")return e===t;if((p||c)&&e===t)return!0;let h;for(h in e)if(!(h in t))return!1;if(c&&r==="shallow"&&i==="shallow"){for(h in s?t:e)if(!j.equ(e[h],t[h],{strict:s,objects:"reference"}))return!1}else for(h in s?t:e)if(e[h]!==t[h])return!1;if(j.und(h)){if(p&&e.length===0&&t.length===0||c&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Tr(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function jr(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function oe(e,t){const r=e;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function $e(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return r=i.reduce((c,p)=>c[p],e),{target:r,key:s}}else return{target:r,key:t}}const st=/-\d+$/;function Te(e,t,r){if(j.str(r)){if(st.test(r)){const c=r.replace(st,""),{target:p,key:h}=$e(e,c);Array.isArray(p[h])||(p[h]=[])}const{target:i,key:s}=$e(e,r);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=r(e,t)}function at(e,t,r){var i,s;if(j.str(r)){const{target:c,key:p}=$e(e,r),h=t.__r3f.previousAttach;h===void 0?delete c[p]:c[p]=h}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function _t(e,{children:t,key:r,ref:i,...s},{children:c,key:p,ref:h,...a}={},y=!1){var n;const o=(n=e==null?void 0:e.__r3f)!=null?n:{},m=Object.entries(s),f=[];if(y){const P=Object.keys(a);for(let g=0;g<P.length;g++)s.hasOwnProperty(P[g])||m.unshift([P[g],wt+"remove"])}m.forEach(([P,g])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&P==="object"||j.equ(g,a[P]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(P))return f.push([P,g,!0,[]]);let u=[];P.includes("-")&&(u=P.split("-")),f.push([P,g,!1,u]);for(const b in s){const M=s[b];b.startsWith(`${P}-`)&&f.push([b,M,!1,b.split("-")])}});const v={...s};return o.memoizedProps&&o.memoizedProps.args&&(v.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(v.attach=o.memoizedProps.attach),{memoized:v,changes:f}}const Dr=typeof process<"u"&&!1;function je(e,t){var r,i,s;const c=(r=e.__r3f)!=null?r:{},p=c.root,h=(i=p==null||p.getState==null?void 0:p.getState())!=null?i:{},{memoized:a,changes:y}=Ar(t)?t:_t(e,t),n=c.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let m=0;m<y.length;m++){let[f,v,P,g]=y[m];if(Ae(e)){const M="srgb",_="srgb-linear";f==="encoding"?(f="colorSpace",v=v===3001?M:_):f==="outputEncoding"&&(f="outputColorSpace",v=v===3001?M:_)}let l=e,u=l[f];if(g.length&&(u=g.reduce((b,M)=>b[M],e),!(u&&u.set))){const[b,...M]=g.reverse();l=M.reverse().reduce((_,E)=>_[E],e),f=b}if(v===wt+"remove")if(l.constructor){let b=it.get(l.constructor);b||(b=new l.constructor,it.set(l.constructor,b)),v=b[f]}else v=0;if(P)v?c.handlers[f]=v:delete c.handlers[f],c.eventCount=Object.keys(c.handlers).length;else if(u&&u.set&&(u.copy||u instanceof Se)){if(Array.isArray(v))u.fromArray?u.fromArray(v):u.set(...v);else if(u.copy&&v&&v.constructor&&(Dr?u.constructor.name===v.constructor.name:u.constructor===v.constructor))u.copy(v);else if(v!==void 0){const b=u instanceof Yt;!b&&u.setScalar?u.setScalar(v):u instanceof Se&&v instanceof Se?u.mask=v.mask:u.set(v),!ht()&&!h.linear&&b&&u.convertSRGBToLinear()}}else if(l[f]=v,l[f]instanceof Ht&&l[f].format===Bt&&l[f].type===Nt){const b=l[f];Ae(b)&&Ae(h.gl)?b.colorSpace=h.gl.outputColorSpace:b.encoding=h.gl.outputEncoding}ie(e)}if(c.parent&&e.raycast&&n!==c.eventCount){const m=Me(e).getState().internal,f=m.interaction.indexOf(e);f>-1&&m.interaction.splice(f,1),c.eventCount&&m.interaction.push(e)}return!(y.length===1&&y[0][0]==="onUpdate")&&y.length&&(s=e.__r3f)!=null&&s.parent&&He(e),e}function ie(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function He(e){e.onUpdate==null||e.onUpdate(e)}function Lr(e,t){e.manual||(gt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function Ee(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function kr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return se.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return se.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return se.ContinuousEventPriority;default:return se.DefaultEventPriority}}function Pt(e,t,r,i){const s=r.get(t);s&&(r.delete(t),r.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function Fr(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(s)}),r.capturedMap.forEach((i,s)=>{Pt(r.capturedMap,t,i,s)})}function zr(e){function t(a){const{internal:y}=e.getState(),n=a.offsetX-y.initialClick[0],o=a.offsetY-y.initialClick[1];return Math.round(Math.sqrt(n*n+o*o))}function r(a){return a.filter(y=>["Move","Over","Enter","Out","Leave"].some(n=>{var o;return(o=y.__r3f)==null?void 0:o.handlers["onPointer"+n]}))}function i(a,y){const n=e.getState(),o=new Set,m=[],f=y?y(n.internal.interaction):n.internal.interaction;for(let l=0;l<f.length;l++){const u=ue(f[l]);u&&(u.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(a,n);function v(l){const u=ue(l);if(!u||!u.events.enabled||u.raycaster.camera===null)return[];if(u.raycaster.camera===void 0){var b;u.events.compute==null||u.events.compute(a,u,(b=u.previousRoot)==null?void 0:b.getState()),u.raycaster.camera===void 0&&(u.raycaster.camera=null)}return u.raycaster.camera?u.raycaster.intersectObject(l,!0):[]}let P=f.flatMap(v).sort((l,u)=>{const b=ue(l.object),M=ue(u.object);return!b||!M?l.distance-u.distance:M.events.priority-b.events.priority||l.distance-u.distance}).filter(l=>{const u=Ee(l);return o.has(u)?!1:(o.add(u),!0)});n.events.filter&&(P=n.events.filter(P,n));for(const l of P){let u=l.object;for(;u;){var g;(g=u.__r3f)!=null&&g.eventCount&&m.push({...l,eventObject:u}),u=u.parent}}if("pointerId"in a&&n.internal.capturedMap.has(a.pointerId))for(let l of n.internal.capturedMap.get(a.pointerId).values())o.has(Ee(l.intersection))||m.push(l.intersection);return m}function s(a,y,n,o){const m=e.getState();if(a.length){const f={stopped:!1};for(const v of a){const P=ue(v.object)||m,{raycaster:g,pointer:l,camera:u,internal:b}=P,M=new B(l.x,l.y,0).unproject(u),_=O=>{var w,A;return(w=(A=b.capturedMap.get(O))==null?void 0:A.has(v.eventObject))!=null?w:!1},E=O=>{const w={intersection:v,target:y.target};b.capturedMap.has(O)?b.capturedMap.get(O).set(v.eventObject,w):b.capturedMap.set(O,new Map([[v.eventObject,w]])),y.target.setPointerCapture(O)},C=O=>{const w=b.capturedMap.get(O);w&&Pt(b.capturedMap,v.eventObject,w,O)};let R={};for(let O in y){let w=y[O];typeof w!="function"&&(R[O]=w)}let x={...v,...R,pointer:l,intersections:a,stopped:f.stopped,delta:n,unprojectedPoint:M,ray:g.ray,camera:u,stopPropagation(){const O="pointerId"in y&&b.capturedMap.get(y.pointerId);if((!O||O.has(v.eventObject))&&(x.stopped=f.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(w=>w.eventObject===v.eventObject))){const w=a.slice(0,a.indexOf(v));c([...w,v])}},target:{hasPointerCapture:_,setPointerCapture:E,releasePointerCapture:C},currentTarget:{hasPointerCapture:_,setPointerCapture:E,releasePointerCapture:C},nativeEvent:y};if(o(x),f.stopped===!0)break}}return a}function c(a){const{internal:y}=e.getState();for(const n of y.hovered.values())if(!a.length||!a.find(o=>o.object===n.object&&o.index===n.index&&o.instanceId===n.instanceId)){const m=n.eventObject.__r3f,f=m==null?void 0:m.handlers;if(y.hovered.delete(Ee(n)),m!=null&&m.eventCount){const v={...n,intersections:a};f.onPointerOut==null||f.onPointerOut(v),f.onPointerLeave==null||f.onPointerLeave(v)}}}function p(a,y){for(let n=0;n<y.length;n++){const o=y[n].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(a)}}function h(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>c([]);case"onLostPointerCapture":return y=>{const{internal:n}=e.getState();"pointerId"in y&&n.capturedMap.has(y.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(y.pointerId)&&(n.capturedMap.delete(y.pointerId),c([]))})}}return function(n){const{onPointerMissed:o,internal:m}=e.getState();m.lastEvent.current=n;const f=a==="onPointerMove",v=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",g=i(n,f?r:void 0),l=v?t(n):0;a==="onPointerDown"&&(m.initialClick=[n.offsetX,n.offsetY],m.initialHits=g.map(b=>b.eventObject)),v&&!g.length&&l<=2&&(p(n,m.interaction),o&&o(n)),f&&c(g);function u(b){const M=b.eventObject,_=M.__r3f,E=_==null?void 0:_.handlers;if(_!=null&&_.eventCount)if(f){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const C=Ee(b),R=m.hovered.get(C);R?R.stopped&&b.stopPropagation():(m.hovered.set(C,b),E.onPointerOver==null||E.onPointerOver(b),E.onPointerEnter==null||E.onPointerEnter(b))}E.onPointerMove==null||E.onPointerMove(b)}else{const C=E[a];C?(!v||m.initialHits.includes(M))&&(p(n,m.interaction.filter(R=>!m.initialHits.includes(R))),C(b)):v&&m.initialHits.includes(M)&&p(n,m.interaction.filter(R=>!m.initialHits.includes(R)))}}s(g,n,l,u)}}return{handlePointer:h}}const Mt=e=>!!(e!=null&&e.render),xt=d.createContext(null),Wr=(e,t)=>{const r=vt((h,a)=>{const y=new B,n=new B,o=new B;function m(l=a().camera,u=n,b=a().size){const{width:M,height:_,top:E,left:C}=b,R=M/_;u instanceof B?o.copy(u):o.set(...u);const x=l.getWorldPosition(y).distanceTo(o);if(gt(l))return{width:M/l.zoom,height:_/l.zoom,top:E,left:C,factor:1,distance:x,aspect:R};{const O=l.fov*Math.PI/180,w=2*Math.tan(O/2)*x,A=w*(M/_);return{width:A,height:w,top:E,left:C,factor:M/A,distance:x,aspect:R}}}let f;const v=l=>h(u=>({performance:{...u.performance,current:l}})),P=new Zt;return{set:h,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(l=1)=>e(a(),l),advance:(l,u)=>t(l,u,a()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new rr,pointer:P,mouse:P,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=a();f&&clearTimeout(f),l.performance.current!==l.performance.min&&v(l.performance.min),f=setTimeout(()=>v(a().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:m},setEvents:l=>h(u=>({...u,events:{...u.events,...l}})),setSize:(l,u,b,M,_)=>{const E=a().camera,C={width:l,height:u,top:M||0,left:_||0,updateStyle:b};h(R=>({size:C,viewport:{...R.viewport,...m(E,n,C)}}))},setDpr:l=>h(u=>{const b=Et(l);return{viewport:{...u.viewport,dpr:b,initialDpr:u.viewport.initialDpr||b}}}),setFrameloop:(l="always")=>{const u=a().clock;u.stop(),u.elapsedTime=0,l!=="never"&&(u.start(),u.elapsedTime=0),h(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:d.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,u,b)=>{const M=a().internal;return M.priority=M.priority+(u>0?1:0),M.subscribers.push({ref:l,priority:u,store:b}),M.subscribers=M.subscribers.sort((_,E)=>_.priority-E.priority),()=>{const _=a().internal;_!=null&&_.subscribers&&(_.priority=_.priority-(u>0?1:0),_.subscribers=_.subscribers.filter(E=>E.ref!==l))}}}}}),i=r.getState();let s=i.size,c=i.viewport.dpr,p=i.camera;return r.subscribe(()=>{const{camera:h,size:a,viewport:y,gl:n,set:o}=r.getState();if(a.width!==s.width||a.height!==s.height||y.dpr!==c){var m;s=a,c=y.dpr,Lr(h,a),n.setPixelRatio(y.dpr);const f=(m=a.updateStyle)!=null?m:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(a.width,a.height,f)}h!==p&&(p=h,o(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(h)}})))}),r.subscribe(h=>e(h)),r};let _e,Ir=new Set,$r=new Set,Hr=new Set;function De(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function fe(e,t){switch(e){case"before":return De(Ir,t);case"after":return De($r,t);case"tail":return De(Hr,t)}}let Le,ke;function Fe(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Le=t.internal.subscribers,_e=0;_e<Le.length;_e++)ke=Le[_e],ke.ref.current(ke.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Br(e){let t=!1,r,i,s;function c(a){i=requestAnimationFrame(c),t=!0,r=0,fe("before",a);for(const n of e.values()){var y;s=n.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((y=s.gl.xr)!=null&&y.isPresenting)&&(r+=Fe(a,s))}if(fe("after",a),r===0)return fe("tail",a),t=!1,cancelAnimationFrame(i)}function p(a,y=1){var n;if(!a)return e.forEach(o=>p(o.store.getState()),y);(n=a.gl.xr)!=null&&n.isPresenting||!a.internal.active||a.frameloop==="never"||(a.internal.frames=Math.min(60,a.internal.frames+y),t||(t=!0,requestAnimationFrame(c)))}function h(a,y=!0,n,o){if(y&&fe("before",a),n)Fe(a,n,o);else for(const m of e.values())Fe(a,m.store.getState());y&&fe("after",a)}return{loop:c,invalidate:p,advance:h}}function Ct(){const e=d.useContext(xt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function H(e=r=>r,t){return Ct()(e,t)}function ve(e,t=0){const r=Ct(),i=r.getState().internal.subscribe,s=yt(e);return me(()=>i(s,t,r),[t,i,r]),null}const ct=new WeakMap;function St(e,t){return function(r,...i){let s=ct.get(r);return s||(s=new r,ct.set(r,s)),e&&e(s),Promise.all(i.map(c=>new Promise((p,h)=>s.load(c,a=>{a.scene&&Object.assign(a,Tr(a.scene)),p(a)},t,a=>h(new Error(`Could not load ${c}: ${a==null?void 0:a.message}`)))))).finally(()=>s.dispose==null?void 0:s.dispose())}}function Y(e,t,r,i){const s=Array.isArray(t)?t:[t],c=Er(St(r,i),[e,...s],{equal:j.equ});return Array.isArray(t)?c:c[0]}Y.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return _r(St(r),[e,...i])};Y.clear=function(e,t){const r=Array.isArray(t)?t:[t];return Pr([e,...r])};const ce=new Map,{invalidate:lt,advance:ut}=Br(ce),{reconciler:xe,applyProps:G}=Sr(ce,kr),ne={objects:"shallow",strict:!1},Nr=(e,t)=>{const r=typeof e=="function"?e(t):e;return Mt(r)?r:new Kt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Ur(e,t){const r=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:s,top:c,left:p,updateStyle:h=r}=t;return{width:i,height:s,top:c,left:p,updateStyle:h}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:s,top:c,left:p}=e.parentElement.getBoundingClientRect();return{width:i,height:s,top:c,left:p,updateStyle:r}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:r};return{width:0,height:0,top:0,left:0}}function Gr(e){const t=ce.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,c=i||Wr(lt,ut),p=r||xe.createContainer(c,se.ConcurrentRoot,null,!1,null,"",s,null);t||ce.set(e,{fiber:p,store:c});let h,a=!1,y;return{configure(n={}){let{gl:o,size:m,scene:f,events:v,onCreated:P,shadows:g=!1,linear:l=!1,flat:u=!1,legacy:b=!1,orthographic:M=!1,frameloop:_="always",dpr:E=[1,2],performance:C,raycaster:R,camera:x,onPointerMissed:O}=n,w=c.getState(),A=w.gl;w.gl||w.set({gl:A=Nr(o,e)});let W=w.raycaster;W||w.set({raycaster:W=new Ut});const{params:Z,...k}=R||{};if(j.equ(k,W,ne)||G(W,{...k}),j.equ(Z,W.params,ne)||G(W,{params:{...W.params,...Z}}),!w.camera||w.camera===y&&!j.equ(y,x,ne)){y=x;const D=x instanceof Jt,S=D?x:M?new Ne(0,0,0,0,.1,1e3):new Ue(75,0,.1,1e3);D||(S.position.z=5,x&&G(S,x),!w.camera&&!(x!=null&&x.rotation)&&S.lookAt(0,0,0)),w.set({camera:S}),W.camera=S}if(!w.scene){let D;f instanceof et?D=f:(D=new et,f&&G(D,f)),w.set({scene:oe(D)})}if(!w.xr){var V;const D=(L,ge)=>{const ye=c.getState();ye.frameloop!=="never"&&ut(L,!0,ye,ge)},S=()=>{const L=c.getState();L.gl.xr.enabled=L.gl.xr.isPresenting,L.gl.xr.setAnimationLoop(L.gl.xr.isPresenting?D:null),L.gl.xr.isPresenting||lt(L)},U={connect(){const L=c.getState().gl;L.xr.addEventListener("sessionstart",S),L.xr.addEventListener("sessionend",S)},disconnect(){const L=c.getState().gl;L.xr.removeEventListener("sessionstart",S),L.xr.removeEventListener("sessionend",S)}};typeof((V=A.xr)==null?void 0:V.addEventListener)=="function"&&U.connect(),w.set({xr:U})}if(A.shadowMap){const D=A.shadowMap.enabled,S=A.shadowMap.type;if(A.shadowMap.enabled=!!g,j.boo(g))A.shadowMap.type=Re;else if(j.str(g)){var F;const U={basic:Qt,percentage:er,soft:Re,variance:tr};A.shadowMap.type=(F=U[g])!=null?F:Re}else j.obj(g)&&Object.assign(A.shadowMap,g);(D!==A.shadowMap.enabled||S!==A.shadowMap.type)&&(A.shadowMap.needsUpdate=!0)}const I=ht();I&&("enabled"in I?I.enabled=!b:"legacyMode"in I&&(I.legacyMode=b)),G(A,{outputEncoding:l?3e3:3001,toneMapping:u?Gt:qt}),w.legacy!==b&&w.set(()=>({legacy:b})),w.linear!==l&&w.set(()=>({linear:l})),w.flat!==u&&w.set(()=>({flat:u})),o&&!j.fun(o)&&!Mt(o)&&!j.equ(o,A,ne)&&G(A,o),v&&!w.events.handlers&&w.set({events:v(c)});const z=Ur(e,m);return j.equ(z,w.size,ne)||w.setSize(z.width,z.height,z.updateStyle,z.top,z.left),E&&w.viewport.dpr!==Et(E)&&w.setDpr(E),w.frameloop!==_&&w.setFrameloop(_),w.onPointerMissed||w.set({onPointerMissed:O}),C&&!j.equ(C,w.performance,ne)&&w.set(D=>({performance:{...D.performance,...C}})),h=P,a=!0,this},render(n){return a||this.configure(),xe.updateContainer(d.createElement(qr,{store:c,children:n,onCreated:h,rootElement:e}),p,null,()=>{}),c},unmount(){Rt(e)}}}function qr({store:e,children:t,onCreated:r,rootElement:i}){return me(()=>{const s=e.getState();s.set(c=>({internal:{...c.internal,active:!0}})),r&&r(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),d.createElement(xt.Provider,{value:e},t)}function Rt(e,t){const r=ce.get(e),i=r==null?void 0:r.fiber;if(i){const s=r==null?void 0:r.store.getState();s&&(s.internal.active=!1),xe.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var c,p,h,a;s.events.disconnect==null||s.events.disconnect(),(c=s.gl)==null||(p=c.renderLists)==null||p.dispose==null||p.dispose(),(h=s.gl)==null||h.forceContextLoss==null||h.forceContextLoss(),(a=s.gl)!=null&&a.xr&&s.xr.disconnect(),jr(s),ce.delete(e),t&&t(e)}catch{}},500)})}}xe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:d.version});const ze={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Vr(e){const{handlePointer:t}=zr(e);return{priority:1,enabled:!0,compute(r,i,s){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(ze).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:s}=e.getState();(r=s.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:r=>{var i;const{set:s,events:c}=e.getState();c.disconnect==null||c.disconnect(),s(p=>({events:{...p.events,connected:r}})),Object.entries((i=c.handlers)!=null?i:[]).forEach(([p,h])=>{const[a,y]=ze[p];r.addEventListener(a,h,{passive:y})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([c,p])=>{if(i&&i.connected instanceof HTMLElement){const[h]=ze[c];i.connected.removeEventListener(h,p)}}),r(c=>({events:{...c.events,connected:void 0}}))}}}}const Xr=d.forwardRef(function({children:t,fallback:r,resize:i,style:s,gl:c,events:p=Vr,eventSource:h,eventPrefix:a,shadows:y,linear:n,flat:o,legacy:m,orthographic:f,frameloop:v,dpr:P,performance:g,raycaster:l,camera:u,scene:b,onPointerMissed:M,onCreated:_,...E},C){d.useMemo(()=>Cr(nr),[]);const R=vr(),[x,O]=pr({scroll:!0,debounce:{scroll:50,resize:0},...i}),w=d.useRef(null),A=d.useRef(null);d.useImperativeHandle(C,()=>w.current);const W=yt(M),[Z,k]=d.useState(!1),[V,F]=d.useState(!1);if(Z)throw Z;if(V)throw V;const I=d.useRef(null);me(()=>{const N=w.current;O.width>0&&O.height>0&&N&&(I.current||(I.current=Gr(N)),I.current.configure({gl:c,events:p,shadows:y,linear:n,flat:o,legacy:m,orthographic:f,frameloop:v,dpr:P,performance:g,raycaster:l,camera:u,scene:b,size:O,onPointerMissed:(...z)=>W.current==null?void 0:W.current(...z),onCreated:z=>{z.events.connect==null||z.events.connect(h?Rr(h)?h.current:h:A.current),a&&z.setEvents({compute:(D,S)=>{const U=D[a+"X"],L=D[a+"Y"];S.pointer.set(U/S.size.width*2-1,-(L/S.size.height)*2+1),S.raycaster.setFromCamera(S.pointer,S.camera)}}),_==null||_(z)}}),I.current.render(d.createElement(R,null,d.createElement(bt,{set:F},d.createElement(d.Suspense,{fallback:d.createElement(Or,{set:k})},t)))))}),d.useEffect(()=>{const N=w.current;if(N)return()=>Rt(N)},[]);const K=h?"none":"auto";return d.createElement("div",q({ref:A,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:K,...s}},E),d.createElement("div",{ref:x,style:{width:"100%",height:"100%"}},d.createElement("canvas",{ref:w,style:{display:"block"}},r)))}),xn=d.forwardRef(function(t,r){return d.createElement(mr,null,d.createElement(Xr,q({},t,{ref:r})))}),he=new B,Ye=new B,Yr=new B;function Zr(e,t,r){const i=he.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=r.width/2,c=r.height/2;return[i.x*s+s,-(i.y*c)+c]}function Kr(e,t){const r=he.setFromMatrixPosition(e.matrixWorld),i=Ye.setFromMatrixPosition(t.matrixWorld),s=r.sub(i),c=t.getWorldDirection(Yr);return s.angleTo(c)>Math.PI/2}function Jr(e,t,r,i){const s=he.setFromMatrixPosition(e.matrixWorld),c=s.clone();c.project(t),r.setFromCamera(c,t);const p=r.intersectObjects(i,!0);if(p.length){const h=p[0].distance;return s.distanceTo(r.ray.origin)<h}return!0}function Qr(e,t){if(t instanceof Ne)return t.zoom;if(t instanceof Ue){const r=he.setFromMatrixPosition(e.matrixWorld),i=Ye.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,c=r.distanceTo(i);return 1/(2*Math.tan(s/2)*c)}else return 1}function en(e,t,r){if(t instanceof Ue||t instanceof Ne){const i=he.setFromMatrixPosition(e.matrixWorld),s=Ye.setFromMatrixPosition(t.matrixWorld),c=i.distanceTo(s),p=(r[1]-r[0])/(t.far-t.near),h=r[1]-p*t.far;return Math.round(p*c+h)}}const Be=e=>Math.abs(e)<1e-10?0:e;function Ot(e,t,r=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=Be(t[s]*e.elements[s])+(s!==15?",":")");return r+i}const tn=(e=>t=>Ot(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),rn=(e=>(t,r)=>Ot(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function nn(e){return e&&typeof e=="object"&&"current"in e}const Cn=d.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:s,center:c,fullscreen:p,portal:h,distanceFactor:a,sprite:y=!1,transform:n=!1,occlude:o,onOcclude:m,castShadow:f,receiveShadow:v,material:P,geometry:g,zIndexRange:l=[16777271,0],calculatePosition:u=Zr,as:b="div",wrapperClass:M,pointerEvents:_="auto",...E},C)=>{const{gl:R,camera:x,scene:O,size:w,raycaster:A,events:W,viewport:Z}=H(),[k]=d.useState(()=>document.createElement(b)),V=d.useRef(),F=d.useRef(null),I=d.useRef(0),K=d.useRef([0,0]),N=d.useRef(null),z=d.useRef(null),D=(h==null?void 0:h.current)||W.connected||R.domElement.parentNode,S=d.useRef(null),U=d.useRef(!1),L=d.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&nn(o[0]),[o]);d.useLayoutEffect(()=>{const $=R.domElement;o&&o==="blending"?($.style.zIndex=`${Math.floor(l[0]/2)}`,$.style.position="absolute",$.style.pointerEvents="none"):($.style.zIndex=null,$.style.position=null,$.style.pointerEvents=null)},[o]),d.useLayoutEffect(()=>{if(F.current){const $=V.current=gr(k);if(O.updateMatrixWorld(),n)k.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const T=u(F.current,x,w);k.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${T[0]}px,${T[1]}px,0);transform-origin:0 0;`}return D&&(s?D.prepend(k):D.appendChild(k)),()=>{D&&D.removeChild(k),$.unmount()}}},[D,n]),d.useLayoutEffect(()=>{M&&(k.className=M)},[M]);const ge=d.useMemo(()=>n?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:c?"translate3d(-50%,-50%,0)":"none",...p&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...r},[r,c,p,w,n]),ye=d.useMemo(()=>({position:"absolute",pointerEvents:_}),[_]);d.useLayoutEffect(()=>{if(U.current=!1,n){var $;($=V.current)==null||$.render(d.createElement("div",{ref:N,style:ge},d.createElement("div",{ref:z,style:ye},d.createElement("div",{ref:C,className:i,style:r,children:e}))))}else{var T;(T=V.current)==null||T.render(d.createElement("div",{ref:C,style:ge,className:i,children:e}))}});const re=d.useRef(!0);ve($=>{if(F.current){x.updateMatrixWorld(),F.current.updateWorldMatrix(!0,!1);const T=n?K.current:u(F.current,x,w);if(n||Math.abs(I.current-x.zoom)>t||Math.abs(K.current[0]-T[0])>t||Math.abs(K.current[1]-T[1])>t){const J=Kr(F.current,x);let X=!1;L&&(Array.isArray(o)?X=o.map(Q=>Q.current):o!=="blending"&&(X=[O]));const le=re.current;if(X){const Q=Jr(F.current,x,A,X);re.current=Q&&!J}else re.current=!J;le!==re.current&&(m?m(!re.current):k.style.display=re.current?"block":"none");const be=Math.floor(l[0]/2),Lt=o?L?[l[0],be]:[be-1,0]:l;if(k.style.zIndex=`${en(F.current,x,Lt)}`,n){const[Q,Je]=[w.width/2,w.height/2],Ce=x.projectionMatrix.elements[5]*Je,{isOrthographicCamera:Qe,top:kt,left:Ft,bottom:zt,right:Wt}=x,It=tn(x.matrixWorldInverse),$t=Qe?`scale(${Ce})translate(${Be(-(Wt+Ft)/2)}px,${Be((kt+zt)/2)}px)`:`translateZ(${Ce}px)`;let ee=F.current.matrixWorld;y&&(ee=x.matrixWorldInverse.clone().transpose().copyPosition(ee).scale(F.current.scale),ee.elements[3]=ee.elements[7]=ee.elements[11]=0,ee.elements[15]=1),k.style.width=w.width+"px",k.style.height=w.height+"px",k.style.perspective=Qe?"":`${Ce}px`,N.current&&z.current&&(N.current.style.transform=`${$t}${It}translate(${Q}px,${Je}px)`,z.current.style.transform=rn(ee,1/((a||10)/400)))}else{const Q=a===void 0?1:Qr(F.current,x)*a;k.style.transform=`translate3d(${T[0]}px,${T[1]}px,0) scale(${Q})`}K.current=T,I.current=x.zoom}}if(!L&&S.current&&!U.current)if(n){if(N.current){const T=N.current.children[0];if(T!=null&&T.clientWidth&&T!=null&&T.clientHeight){const{isOrthographicCamera:J}=x;if(J||g)E.scale&&(Array.isArray(E.scale)?E.scale instanceof B?S.current.scale.copy(E.scale.clone().divideScalar(1)):S.current.scale.set(1/E.scale[0],1/E.scale[1],1/E.scale[2]):S.current.scale.setScalar(1/E.scale));else{const X=(a||10)/400,le=T.clientWidth*X,be=T.clientHeight*X;S.current.scale.set(le,be,1)}U.current=!0}}}else{const T=k.children[0];if(T!=null&&T.clientWidth&&T!=null&&T.clientHeight){const J=1/Z.factor,X=T.clientWidth*J,le=T.clientHeight*J;S.current.scale.set(X,le,1),U.current=!0}S.current.lookAt($.camera.position)}});const Ke=d.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return d.createElement("group",q({},E,{ref:F}),o&&!L&&d.createElement("mesh",{castShadow:f,receiveShadow:v,ref:S},g||d.createElement("planeGeometry",null),P||d.createElement("shaderMaterial",{side:or,vertexShader:Ke.vertexShader,fragmentShader:Ke.fragmentShader})))});let de=0;const Sn=vt(e=>(we.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-de)/(i-de)*100})},we.onLoad=()=>{e({active:!1})},we.onError=t=>e(r=>({errors:[...r.errors,t]})),we.onProgress=(t,r,i)=>{r===i&&(de=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-de)/(i-de)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),ft=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function At(e,t){const r=H(s=>s.gl),i=Y(Ge,ft(e)?Object.values(e):e);if(d.useLayoutEffect(()=>{t==null||t(i)},[t]),d.useEffect(()=>{"initTexture"in r&&(Array.isArray(i)?i:[i]).forEach(r.initTexture)},[r,i]),ft(e)){const s={};let c=0;for(const p in e)s[p]=i[c++];return s}else return i}At.preload=e=>Y.preload(Ge,e);At.clear=e=>Y.clear(Ge,e);const on=()=>parseInt(ir.replace(/\D+/g,"")),Tt=on();function sn(e){return Array.isArray(e)}function We(e=[0,0,0]){return sn(e)?e:e instanceof B||e instanceof mt?[e.x,e.y,e.z]:[e,e,e]}const Rn=d.forwardRef(function({debug:t,depthTest:r=!1,polygonOffsetFactor:i=-10,map:s,mesh:c,children:p,position:h,rotation:a,scale:y,...n},o){const m=d.useRef(null);d.useImperativeHandle(o,()=>m.current);const f=d.useRef(null);return d.useLayoutEffect(()=>{const v=(c==null?void 0:c.current)||m.current.parent,P=m.current;if(!(v instanceof sr))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const g={position:new B,rotation:new mt,scale:new B(1,1,1)};if(v){G(g,{position:h,scale:y});const l=v.matrixWorld.clone();if(v.matrixWorld.identity(),!a||typeof a=="number"){const u=new ar;u.position.copy(g.position),u.lookAt(v.position),typeof a=="number"&&u.rotateZ(a),G(g,{rotation:u.rotation})}else G(g,{rotation:a});return P.geometry=new yr(v,g.position,g.rotation,g.scale),f.current&&(G(f.current,g),f.current.traverse(u=>u.raycast=()=>null)),v.matrixWorld=l,()=>{P.geometry.dispose()}}},[c,...We(h),...We(y),...We(a)]),d.createElement("mesh",q({ref:m,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":r,"material-map":s},n),p,t&&d.createElement("mesh",{ref:f},d.createElement("boxGeometry",null),d.createElement("meshNormalMaterial",{wireframe:!0}),d.createElement("axesHelper",null)))});let Pe=null,jt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function Dt(e,t,r){return i=>{r&&r(i),e&&(Pe||(Pe=new br),Pe.setDecoderPath(typeof e=="string"?e:jt),i.setDRACOLoader(Pe)),t&&i.setMeshoptDecoder(typeof Oe=="function"?Oe():Oe)}}function Ze(e,t=!0,r=!0,i){return Y(qe,e,Dt(t,r,i))}Ze.preload=(e,t=!0,r=!0,i)=>Y.preload(qe,e,Dt(t,r,i));Ze.clear=e=>Y.clear(qe,e);Ze.setDecoderPath=e=>{jt=e};const On=d.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:s=!0,keyEvents:c=!1,onChange:p,onStart:h,onEnd:a,...y},n)=>{const o=H(E=>E.invalidate),m=H(E=>E.camera),f=H(E=>E.gl),v=H(E=>E.events),P=H(E=>E.setEvents),g=H(E=>E.set),l=H(E=>E.get),u=H(E=>E.performance),b=t||m,M=i||v.connected||f.domElement,_=d.useMemo(()=>new wr(b),[b]);return ve(()=>{_.enabled&&_.update()},-1),d.useEffect(()=>(c&&_.connect(c===!0?M:c),_.connect(M),()=>void _.dispose()),[c,M,r,_,o]),d.useEffect(()=>{const E=x=>{o(),r&&u.regress(),p&&p(x)},C=x=>{h&&h(x)},R=x=>{a&&a(x)};return _.addEventListener("change",E),_.addEventListener("start",C),_.addEventListener("end",R),()=>{_.removeEventListener("start",C),_.removeEventListener("end",R),_.removeEventListener("change",E)}},[p,h,a,_,o,P]),d.useEffect(()=>{if(e){const E=l().controls;return g({controls:_}),()=>g({controls:E})}},[e,_]),d.createElement("primitive",q({ref:n,object:_,enableDamping:s},y))}),Ie=Tt>=154?"opaque_fragment":"output_fragment";class an extends cr{constructor(t){super(t),this.onBeforeCompile=(r,i)=>{const{isWebGL2:s}=i.capabilities;r.fragmentShader=r.fragmentShader.replace(`#include <${Ie}>`,`
        ${s?`#include <${Ie}>`:`#extension GL_OES_standard_derivatives : enable
#include <${Ie}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${Tt>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const An=d.forwardRef((e,t)=>{const[r]=d.useState(()=>new an(null));return d.createElement("primitive",q({},e,{object:r,ref:t,attach:"material"}))}),Tn=d.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:i=1,floatIntensity:s=1,floatingRange:c=[-.1,.1],...p},h)=>{const a=d.useRef(null),y=d.useRef(Math.random()*1e4);return ve(n=>{var o,m;if(!t||r===0)return;const f=y.current+n.clock.getElapsedTime();a.current.rotation.x=Math.cos(f/4*r)/8*i,a.current.rotation.y=Math.sin(f/4*r)/8*i,a.current.rotation.z=Math.sin(f/4*r)/20*i;let v=Math.sin(f/4*r)/10;v=lr.mapLinear(v,-.1,.1,(o=c==null?void 0:c[0])!==null&&o!==void 0?o:-.1,(m=c==null?void 0:c[1])!==null&&m!==void 0?m:.1),a.current.position.y=v*s,a.current.updateMatrix()}),d.createElement("group",p,d.createElement("group",{ref:Ve([a,h]),matrixAutoUpdate:!1},e))});let te,pe;const cn=d.createContext(null),dt=new ur,pt=new B,ln=d.forwardRef(({children:e,range:t,limit:r=1e3,...i},s)=>{const c=d.useRef(null),[p,h]=d.useState([]),[[a,y,n]]=d.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);d.useEffect(()=>{c.current.geometry.attributes.position.needsUpdate=!0}),ve(()=>{for(c.current.updateMatrix(),c.current.updateMatrixWorld(),dt.copy(c.current.matrixWorld).invert(),c.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,p.length),te=0;te<p.length;te++)pe=p[te].current,pe.getWorldPosition(pt).applyMatrix4(dt),pt.toArray(a,te*3),c.current.geometry.attributes.position.needsUpdate=!0,pe.matrixWorldNeedsUpdate=!0,pe.color.toArray(y,te*3),c.current.geometry.attributes.color.needsUpdate=!0,n.set([pe.size],te),c.current.geometry.attributes.size.needsUpdate=!0});const o=d.useMemo(()=>({getParent:()=>c,subscribe:m=>(h(f=>[...f,m]),()=>h(f=>f.filter(v=>v.current!==m.current)))}),[]);return d.createElement("points",q({userData:{instances:p},matrixAutoUpdate:!1,ref:Ve([s,c]),raycast:()=>null},i),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:a.length/3,array:a,itemSize:3,usage:ae}),d.createElement("bufferAttribute",{attach:"attributes-color",count:y.length/3,array:y,itemSize:3,usage:ae}),d.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:ae})),d.createElement(cn.Provider,{value:o},e))}),un=d.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:s=3,...c},p)=>{const h=d.useRef(null);return ve(()=>{const a=h.current.geometry.attributes;a.position.needsUpdate=!0,r&&(a.color.needsUpdate=!0),i&&(a.size.needsUpdate=!0)}),d.createElement("points",q({ref:Ve([p,h])},c),d.createElement("bufferGeometry",null,d.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/s,array:t,itemSize:s,usage:ae}),r&&d.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/s,array:r,itemSize:3,usage:ae}),i&&d.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/s,array:i,itemSize:1,usage:ae})),e)}),jn=d.forwardRef((e,t)=>e.positions instanceof Float32Array?d.createElement(un,q({},e,{ref:t})):d.createElement(ln,q({},e,{ref:t})));function Dn({all:e,scene:t,camera:r}){const i=H(({gl:p})=>p),s=H(({camera:p})=>p),c=H(({scene:p})=>p);return d.useLayoutEffect(()=>{const p=[];e&&(t||c).traverse(y=>{y.visible===!1&&(p.push(y),y.visible=!0)}),i.compile(t||c,r||s);const h=new fr(128);new dr(.01,1e5,h).update(i,t||c),h.dispose(),p.forEach(y=>y.visible=!1)},[]),null}export{xn as C,Rn as D,Tn as F,Cn as H,On as O,Dn as P,Mn as _,ve as a,jn as b,An as c,Ze as d,Sn as e,At as u};
