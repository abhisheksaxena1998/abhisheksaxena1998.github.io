import{r as $,s as D,f as R,h as U,i as I,a as T,b as C,j as E,_ as L,k as z,g as A,e as J,d as Q}from"./@babel.CqxtU2kl.js";import{a as N,r as W}from"./react.DPZx3FLm.js";import{c as V}from"./classnames.CIPFGIzL.js";import{b as Y,p as Z}from"./rc-util.9PQy9ck0.js";const M=function(o,i){if(o&&i){var d=Array.isArray(i)?i:i.split(","),e=o.name||"",r=o.type||"",t=r.replace(/\/.*$/,"");return d.some(function(c){var n=c.trim();if(/^\*(\/\*)?$/.test(c))return!0;if(n.charAt(0)==="."){var f=e.toLowerCase(),s=n.toLowerCase(),u=[s];return(s===".jpg"||s===".jpeg")&&(u=[".jpg",".jpeg"]),u.some(function(h){return f.endsWith(h)})}return/\/\*$/.test(n)?t===n.replace(/\/.*$/,""):r===n?!0:/^\w+$/.test(n)?(Y(!1,"Upload takes an invalidate 'accept' type '".concat(n,"'.Skip for check.")),!0):!1})}return!0};function x(o,i){var d="cannot ".concat(o.method," ").concat(o.action," ").concat(i.status,"'"),e=new Error(d);return e.status=i.status,e.method=o.method,e.url=o.action,e}function O(o){var i=o.responseText||o.response;if(!i)return i;try{return JSON.parse(i)}catch{return i}}function _(o){var i=new XMLHttpRequest;o.onProgress&&i.upload&&(i.upload.onprogress=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),o.onProgress(t)});var d=new FormData;o.data&&Object.keys(o.data).forEach(function(r){var t=o.data[r];if(Array.isArray(t)){t.forEach(function(c){d.append("".concat(r,"[]"),c)});return}d.append(r,t)}),o.file instanceof Blob?d.append(o.filename,o.file,o.file.name):d.append(o.filename,o.file),i.onerror=function(t){o.onError(t)},i.onload=function(){return i.status<200||i.status>=300?o.onError(x(o,i),O(i)):o.onSuccess(O(i),i)},i.open(o.method,o.action,!0),o.withCredentials&&"withCredentials"in i&&(i.withCredentials=!0);var e=o.headers||{};return e["X-Requested-With"]!==null&&i.setRequestHeader("X-Requested-With","XMLHttpRequest"),Object.keys(e).forEach(function(r){e[r]!==null&&i.setRequestHeader(r,e[r])}),i.send(d),{abort:function(){i.abort()}}}var ee=function(){var o=$(D().mark(function i(d,e){var r,t,c,n,f,s,u,h;return D().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:s=function(){return s=$(D().mark(function m(b){return D().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",new Promise(function(w){b.file(function(F){e(F)?(b.fullPath&&!F.webkitRelativePath&&(Object.defineProperties(F,{webkitRelativePath:{writable:!0}}),F.webkitRelativePath=b.fullPath.replace(/^\//,""),Object.defineProperties(F,{webkitRelativePath:{writable:!1}})),w(F)):w(null)})}));case 1:case"end":return y.stop()}},m)})),s.apply(this,arguments)},f=function(m){return s.apply(this,arguments)},n=function(){return n=$(D().mark(function m(b){var k,y,w,F,a;return D().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:k=b.createReader(),y=[];case 2:return g.next=5,new Promise(function(q){k.readEntries(q,function(){return q([])})});case 5:if(w=g.sent,F=w.length,F){g.next=9;break}return g.abrupt("break",12);case 9:for(a=0;a<F;a++)y.push(w[a]);g.next=2;break;case 12:return g.abrupt("return",y);case 13:case"end":return g.stop()}},m)})),n.apply(this,arguments)},c=function(m){return n.apply(this,arguments)},r=[],t=[],d.forEach(function(l){return t.push(l.webkitGetAsEntry())}),u=function(){var l=$(D().mark(function m(b,k){var y,w;return D().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(b){a.next=2;break}return a.abrupt("return");case 2:if(b.path=k||"",!b.isFile){a.next=10;break}return a.next=6,f(b);case 6:y=a.sent,y&&r.push(y),a.next=15;break;case 10:if(!b.isDirectory){a.next=15;break}return a.next=13,c(b);case 13:w=a.sent,t.push.apply(t,R(w));case 15:case"end":return a.stop()}},m)}));return function(b,k){return l.apply(this,arguments)}}(),h=0;case 9:if(!(h<t.length)){v.next=15;break}return v.next=12,u(t[h]);case 12:h++,v.next=9;break;case 15:return v.abrupt("return",r);case 16:case"end":return v.stop()}},i)}));return function(d,e){return o.apply(this,arguments)}}(),re=+new Date,ae=0;function S(){return"rc-upload-".concat(re,"-").concat(++ae)}var te=["component","prefixCls","className","classNames","disabled","id","name","style","styles","multiple","accept","capture","children","directory","openFileDialogOnClick","onMouseEnter","onMouseLeave","hasControlInside"],ne=function(o){U(d,o);var i=I(d);function d(){var e;T(this,d);for(var r=arguments.length,t=new Array(r),c=0;c<r;c++)t[c]=arguments[c];return e=i.call.apply(i,[this].concat(t)),C(E(e),"state",{uid:S()}),C(E(e),"reqs",{}),C(E(e),"fileInput",void 0),C(E(e),"_isMounted",void 0),C(E(e),"onChange",function(n){var f=e.props,s=f.accept,u=f.directory,h=n.target.files,p=R(h).filter(function(v){return!u||M(v,s)});e.uploadFiles(p),e.reset()}),C(E(e),"onClick",function(n){var f=e.fileInput;if(f){var s=n.target,u=e.props.onClick;if(s&&s.tagName==="BUTTON"){var h=f.parentNode;h.focus(),s.blur()}f.click(),u&&u(n)}}),C(E(e),"onKeyDown",function(n){n.key==="Enter"&&e.onClick(n)}),C(E(e),"onFileDrop",function(){var n=$(D().mark(function f(s){var u,h,p;return D().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(u=e.props.multiple,s.preventDefault(),s.type!=="dragover"){l.next=4;break}return l.abrupt("return");case 4:if(!e.props.directory){l.next=11;break}return l.next=7,ee(Array.prototype.slice.call(s.dataTransfer.items),function(m){return M(m,e.props.accept)});case 7:h=l.sent,e.uploadFiles(h),l.next=14;break;case 11:p=R(s.dataTransfer.files).filter(function(m){return M(m,e.props.accept)}),u===!1&&(p=p.slice(0,1)),e.uploadFiles(p);case 14:case"end":return l.stop()}},f)}));return function(f){return n.apply(this,arguments)}}()),C(E(e),"uploadFiles",function(n){var f=R(n),s=f.map(function(u){return u.uid=S(),e.processFile(u,f)});Promise.all(s).then(function(u){var h=e.props.onBatchStart;h==null||h(u.map(function(p){var v=p.origin,l=p.parsedFile;return{file:v,parsedFile:l}})),u.filter(function(p){return p.parsedFile!==null}).forEach(function(p){e.post(p)})})}),C(E(e),"processFile",function(){var n=$(D().mark(function f(s,u){var h,p,v,l,m,b,k,y,w;return D().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(h=e.props.beforeUpload,p=s,!h){a.next=14;break}return a.prev=3,a.next=6,h(s,u);case 6:p=a.sent,a.next=12;break;case 9:a.prev=9,a.t0=a.catch(3),p=!1;case 12:if(p!==!1){a.next=14;break}return a.abrupt("return",{origin:s,parsedFile:null,action:null,data:null});case 14:if(v=e.props.action,typeof v!="function"){a.next=21;break}return a.next=18,v(s);case 18:l=a.sent,a.next=22;break;case 21:l=v;case 22:if(m=e.props.data,typeof m!="function"){a.next=29;break}return a.next=26,m(s);case 26:b=a.sent,a.next=30;break;case 29:b=m;case 30:return k=(Q(p)==="object"||typeof p=="string")&&p?p:s,k instanceof File?y=k:y=new File([k],s.name,{type:s.type}),w=y,w.uid=s.uid,a.abrupt("return",{origin:s,data:b,parsedFile:w,action:l});case 35:case"end":return a.stop()}},f,null,[[3,9]])}));return function(f,s){return n.apply(this,arguments)}}()),C(E(e),"saveFileInput",function(n){e.fileInput=n}),e}return L(d,[{key:"componentDidMount",value:function(){this._isMounted=!0}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.abort()}},{key:"post",value:function(r){var t=this,c=r.data,n=r.origin,f=r.action,s=r.parsedFile;if(this._isMounted){var u=this.props,h=u.onStart,p=u.customRequest,v=u.name,l=u.headers,m=u.withCredentials,b=u.method,k=n.uid,y=p||_,w={action:f,filename:v,data:c,file:s,headers:l,withCredentials:m,method:b||"post",onProgress:function(a){var P=t.props.onProgress;P==null||P(a,s)},onSuccess:function(a,P){var g=t.props.onSuccess;g==null||g(a,s,P),delete t.reqs[k]},onError:function(a,P){var g=t.props.onError;g==null||g(a,P,s),delete t.reqs[k]}};h(n),this.reqs[k]=y(w)}}},{key:"reset",value:function(){this.setState({uid:S()})}},{key:"abort",value:function(r){var t=this.reqs;if(r){var c=r.uid?r.uid:r;t[c]&&t[c].abort&&t[c].abort(),delete t[c]}else Object.keys(t).forEach(function(n){t[n]&&t[n].abort&&t[n].abort(),delete t[n]})}},{key:"render",value:function(){var r=this.props,t=r.component,c=r.prefixCls,n=r.className,f=r.classNames,s=f===void 0?{}:f,u=r.disabled,h=r.id,p=r.name,v=r.style,l=r.styles,m=l===void 0?{}:l,b=r.multiple,k=r.accept,y=r.capture,w=r.children,F=r.directory,a=r.openFileDialogOnClick,P=r.onMouseEnter,g=r.onMouseLeave,q=r.hasControlInside,B=z(r,te),H=V(C(C(C({},c,!0),"".concat(c,"-disabled"),u),n,n)),X=F?{directory:"directory",webkitdirectory:"webkitdirectory"}:{},K=u?{}:{onClick:a?this.onClick:function(){},onKeyDown:a?this.onKeyDown:function(){},onMouseEnter:P,onMouseLeave:g,onDrop:this.onFileDrop,onDragOver:this.onFileDrop,tabIndex:q?void 0:"0"};return N.createElement(t,A({},K,{className:H,role:q?void 0:"button",style:v}),N.createElement("input",A({},Z(B,{aria:!0,data:!0}),{id:h,name:p,disabled:u,type:"file",ref:this.saveFileInput,onClick:function(G){return G.stopPropagation()},key:this.state.uid,style:J({display:"none"},m.input),className:s.input,accept:k},X,{multiple:b,onChange:this.onChange},y!=null?{capture:y}:{})),w)}}]),d}(W.Component);function j(){}var se=function(o){U(d,o);var i=I(d);function d(){var e;T(this,d);for(var r=arguments.length,t=new Array(r),c=0;c<r;c++)t[c]=arguments[c];return e=i.call.apply(i,[this].concat(t)),C(E(e),"uploader",void 0),C(E(e),"saveUploader",function(n){e.uploader=n}),e}return L(d,[{key:"abort",value:function(r){this.uploader.abort(r)}},{key:"render",value:function(){return N.createElement(ne,A({},this.props,{ref:this.saveUploader}))}}]),d}(W.Component);C(se,"defaultProps",{component:"span",prefixCls:"rc-upload",data:{},headers:{},name:"file",multipart:!1,onStart:j,onError:j,onSuccess:j,multiple:!1,beforeUpload:null,customRequest:null,withCredentials:!1,openFileDialogOnClick:!0,hasControlInside:!1});export{se as U};
