import{b as ie,e as T,c as A,k as Se,g as Ce,f as je,d as Ae}from"./@babel.CqxtU2kl.js";import{c as de}from"./classnames.CIPFGIzL.js";import{K as Me,o as Ue,q as Ge,I as Ze,J as we,e as Le,L as qe}from"./rc-util.9PQy9ck0.js";import{r as n,a as he}from"./react.DPZx3FLm.js";import{D as Be}from"./rc-dialog.D4sx8ryF.js";import{P as Je}from"./@rc-component.icrtlwR4.js";import{C as Qe}from"./rc-motion.cq0Hvde5.js";var xe=n.createContext(null),en=function(e){var o=e.visible,s=e.maskTransitionName,c=e.getContainer,t=e.prefixCls,m=e.rootClassName,r=e.icons,l=e.countRender,v=e.showSwitch,C=e.showProgress,u=e.current,_=e.transform,h=e.count,w=e.scale,y=e.minScale,k=e.maxScale,p=e.closeIcon,M=e.onActive,I=e.onClose,b=e.onZoomIn,a=e.onZoomOut,S=e.onRotateRight,d=e.onRotateLeft,f=e.onFlipX,x=e.onFlipY,R=e.onReset,g=e.toolbarRender,E=e.zIndex,$=e.image,P=n.useContext(xe),Z=r.rotateLeft,V=r.rotateRight,H=r.zoomIn,K=r.zoomOut,B=r.close,W=r.left,j=r.right,J=r.flipX,U=r.flipY,ae="".concat(t,"-operations-operation");n.useEffect(function(){var L=function(O){O.keyCode===Me.ESC&&I()};return o&&window.addEventListener("keydown",L),function(){window.removeEventListener("keydown",L)}},[o]);var Q=function(Y,O){Y.preventDefault(),Y.stopPropagation(),M(O)},X=n.useCallback(function(L){var Y=L.type,O=L.disabled,F=L.onClick,D=L.icon;return n.createElement("div",{key:Y,className:de(ae,"".concat(t,"-operations-operation-").concat(Y),ie({},"".concat(t,"-operations-operation-disabled"),!!O)),onClick:F},D)},[ae,t]),re=v?X({icon:W,onClick:function(Y){return Q(Y,-1)},type:"prev",disabled:u===0}):void 0,ee=v?X({icon:j,onClick:function(Y){return Q(Y,1)},type:"next",disabled:u===h-1}):void 0,G=X({icon:U,onClick:x,type:"flipY"}),N=X({icon:J,onClick:f,type:"flipX"}),te=X({icon:Z,onClick:d,type:"rotateLeft"}),z=X({icon:V,onClick:S,type:"rotateRight"}),q=X({icon:K,onClick:a,type:"zoomOut",disabled:w<=y}),oe=X({icon:H,onClick:b,type:"zoomIn",disabled:w===k}),ce=n.createElement("div",{className:"".concat(t,"-operations")},G,N,te,z,q,oe);return n.createElement(Qe,{visible:o,motionName:s},function(L){var Y=L.className,O=L.style;return n.createElement(Je,{open:!0,getContainer:c??document.body},n.createElement("div",{className:de("".concat(t,"-operations-wrapper"),Y,m),style:T(T({},O),{},{zIndex:E})},p===null?null:n.createElement("button",{className:"".concat(t,"-close"),onClick:I},p||B),v&&n.createElement(n.Fragment,null,n.createElement("div",{className:de("".concat(t,"-switch-left"),ie({},"".concat(t,"-switch-left-disabled"),u===0)),onClick:function(D){return Q(D,-1)}},W),n.createElement("div",{className:de("".concat(t,"-switch-right"),ie({},"".concat(t,"-switch-right-disabled"),u===h-1)),onClick:function(D){return Q(D,1)}},j)),n.createElement("div",{className:"".concat(t,"-footer")},C&&n.createElement("div",{className:"".concat(t,"-progress")},l?l(u+1,h):"".concat(u+1," / ").concat(h)),g?g(ce,T(T({icons:{prevIcon:re,nextIcon:ee,flipYIcon:G,flipXIcon:N,rotateLeftIcon:te,rotateRightIcon:z,zoomOutIcon:q,zoomInIcon:oe},actions:{onActive:M,onFlipY:x,onFlipX:f,onRotateLeft:d,onRotateRight:S,onZoomOut:a,onZoomIn:b,onReset:R,onClose:I},transform:_},P?{current:u,total:h}:{}),{},{image:$})):ce)))})},Te={x:0,y:0,rotate:0,scale:1,flipX:!1,flipY:!1};function nn(i,e,o,s){var c=n.useRef(null),t=n.useRef([]),m=n.useState(Te),r=A(m,2),l=r[0],v=r[1],C=function(w){v(Te),Ue(Te,l)||s==null||s({transform:Te,action:w})},u=function(w,y){c.current===null&&(t.current=[],c.current=Ge(function(){v(function(k){var p=k;return t.current.forEach(function(M){p=T(T({},p),M)}),c.current=null,s==null||s({transform:p,action:y}),p})})),t.current.push(T(T({},l),w))},_=function(w,y,k,p,M){var I=i.current,b=I.width,a=I.height,S=I.offsetWidth,d=I.offsetHeight,f=I.offsetLeft,x=I.offsetTop,R=w,g=l.scale*w;g>o?(g=o,R=o/l.scale):g<e&&(g=M?g:e,R=g/l.scale);var E=k??innerWidth/2,$=p??innerHeight/2,P=R-1,Z=P*b*.5,V=P*a*.5,H=P*(E-l.x-f),K=P*($-l.y-x),B=l.x-(H-Z),W=l.y-(K-V);if(w<1&&g===1){var j=S*g,J=d*g,U=Ze(),ae=U.width,Q=U.height;j<=ae&&J<=Q&&(B=0,W=0)}u({x:B,y:W,scale:g},y)};return{transform:l,resetTransform:C,updateTransform:u,dispatchZoomChange:_}}function $e(i,e,o,s){var c=e+o,t=(o-s)/2;if(o>s){if(e>0)return ie({},i,t);if(e<0&&c<s)return ie({},i,-t)}else if(e<0||c>s)return ie({},i,e<0?t:-t);return{}}function ze(i,e,o,s){var c=Ze(),t=c.width,m=c.height,r=null;return i<=t&&e<=m?r={x:0,y:0}:(i>t||e>m)&&(r=T(T({},$e("x",o,i,t)),$e("y",s,e,m))),r}var pe=1,tn=1;function on(i,e,o,s,c,t,m){var r=c.rotate,l=c.scale,v=c.x,C=c.y,u=n.useState(!1),_=A(u,2),h=_[0],w=_[1],y=n.useRef({diffX:0,diffY:0,transformX:0,transformY:0}),k=function(a){!e||a.button!==0||(a.preventDefault(),a.stopPropagation(),y.current={diffX:a.pageX-v,diffY:a.pageY-C,transformX:v,transformY:C},w(!0))},p=function(a){o&&h&&t({x:a.pageX-y.current.diffX,y:a.pageY-y.current.diffY},"move")},M=function(){if(o&&h){w(!1);var a=y.current,S=a.transformX,d=a.transformY,f=v!==S&&C!==d;if(!f)return;var x=i.current.offsetWidth*l,R=i.current.offsetHeight*l,g=i.current.getBoundingClientRect(),E=g.left,$=g.top,P=r%180!==0,Z=ze(P?R:x,P?x:R,E,$);Z&&t(T({},Z),"dragRebound")}},I=function(a){if(!(!o||a.deltaY==0)){var S=Math.abs(a.deltaY/100),d=Math.min(S,tn),f=pe+d*s;a.deltaY>0&&(f=pe/f),m(f,"wheel",a.clientX,a.clientY)}};return n.useEffect(function(){var b,a,S,d;if(e){S=we(window,"mouseup",M,!1),d=we(window,"mousemove",p,!1);try{window.top!==window.self&&(b=we(window.top,"mouseup",M,!1),a=we(window.top,"mousemove",p,!1))}catch{}}return function(){var f,x,R,g;(f=S)===null||f===void 0||f.remove(),(x=d)===null||x===void 0||x.remove(),(R=b)===null||R===void 0||R.remove(),(g=a)===null||g===void 0||g.remove()}},[o,h,v,C,r,e]),{isMoving:h,onMouseDown:k,onMouseMove:p,onMouseUp:M,onWheel:I}}function an(i){return new Promise(function(e){var o=document.createElement("img");o.onerror=function(){return e(!1)},o.onload=function(){return e(!0)},o.src=i})}function Fe(i){var e=i.src,o=i.isCustomPlaceholder,s=i.fallback,c=n.useState(o?"loading":"normal"),t=A(c,2),m=t[0],r=t[1],l=n.useRef(!1),v=m==="error";n.useEffect(function(){var h=!0;return an(e).then(function(w){!w&&h&&r("error")}),function(){h=!1}},[e]),n.useEffect(function(){o&&!l.current?r("loading"):v&&r("normal")},[e]);var C=function(){r("normal")},u=function(w){l.current=!1,m==="loading"&&w!==null&&w!==void 0&&w.complete&&(w.naturalWidth||w.naturalHeight)&&(l.current=!0,C())},_=v&&s?{src:s}:{onLoad:C,src:e};return[u,_,m]}function ke(i,e){var o=i.x-e.x,s=i.y-e.y;return Math.hypot(o,s)}function rn(i,e,o,s){var c=ke(i,o),t=ke(e,s);if(c===0&&t===0)return[i.x,i.y];var m=c/(c+t),r=i.x+m*(e.x-i.x),l=i.y+m*(e.y-i.y);return[r,l]}function cn(i,e,o,s,c,t,m){var r=c.rotate,l=c.scale,v=c.x,C=c.y,u=n.useState(!1),_=A(u,2),h=_[0],w=_[1],y=n.useRef({point1:{x:0,y:0},point2:{x:0,y:0},eventType:"none"}),k=function(a){y.current=T(T({},y.current),a)},p=function(a){if(e){a.stopPropagation(),w(!0);var S=a.touches,d=S===void 0?[]:S;d.length>1?k({point1:{x:d[0].clientX,y:d[0].clientY},point2:{x:d[1].clientX,y:d[1].clientY},eventType:"touchZoom"}):k({point1:{x:d[0].clientX-v,y:d[0].clientY-C},eventType:"move"})}},M=function(a){var S=a.touches,d=S===void 0?[]:S,f=y.current,x=f.point1,R=f.point2,g=f.eventType;if(d.length>1&&g==="touchZoom"){var E={x:d[0].clientX,y:d[0].clientY},$={x:d[1].clientX,y:d[1].clientY},P=rn(x,R,E,$),Z=A(P,2),V=Z[0],H=Z[1],K=ke(E,$)/ke(x,R);m(K,"touchZoom",V,H,!0),k({point1:E,point2:$,eventType:"touchZoom"})}else g==="move"&&(t({x:d[0].clientX-x.x,y:d[0].clientY-x.y},"move"),k({eventType:"move"}))},I=function(){if(o){if(h&&w(!1),k({eventType:"none"}),s>l)return t({x:0,y:0,scale:s},"touchZoom");var a=i.current.offsetWidth*l,S=i.current.offsetHeight*l,d=i.current.getBoundingClientRect(),f=d.left,x=d.top,R=r%180!==0,g=ze(R?S:a,R?a:S,f,x);g&&t(T({},g),"dragRebound")}};return n.useEffect(function(){var b;return o&&e&&(b=we(window,"touchmove",function(a){return a.preventDefault()},{passive:!1})),function(){var a;(a=b)===null||a===void 0||a.remove()}},[o,e]),{isTouching:h,onTouchStart:p,onTouchMove:M,onTouchEnd:I}}var sn=["fallback","src","imgRef"],ln=["prefixCls","src","alt","imageInfo","fallback","movable","onClose","visible","icons","rootClassName","closeIcon","getContainer","current","count","countRender","scaleStep","minScale","maxScale","transitionName","maskTransitionName","imageRender","imgCommonProps","toolbarRender","onTransform","onChange"],un=function(e){var o=e.fallback,s=e.src,c=e.imgRef,t=Se(e,sn),m=Fe({src:s,fallback:o}),r=A(m,2),l=r[0],v=r[1];return he.createElement("img",Ce({ref:function(u){c.current=u,l(u)}},t,v))},We=function(e){var o=e.prefixCls,s=e.src,c=e.alt,t=e.imageInfo,m=e.fallback,r=e.movable,l=r===void 0?!0:r,v=e.onClose,C=e.visible,u=e.icons,_=u===void 0?{}:u,h=e.rootClassName,w=e.closeIcon,y=e.getContainer,k=e.current,p=k===void 0?0:k,M=e.count,I=M===void 0?1:M,b=e.countRender,a=e.scaleStep,S=a===void 0?.5:a,d=e.minScale,f=d===void 0?1:d,x=e.maxScale,R=x===void 0?50:x,g=e.transitionName,E=g===void 0?"zoom":g,$=e.maskTransitionName,P=$===void 0?"fade":$,Z=e.imageRender,V=e.imgCommonProps,H=e.toolbarRender,K=e.onTransform,B=e.onChange,W=Se(e,ln),j=n.useRef(),J=n.useContext(xe),U=J&&I>1,ae=J&&I>=1,Q=n.useState(!0),X=A(Q,2),re=X[0],ee=X[1],G=nn(j,f,R,K),N=G.transform,te=G.resetTransform,z=G.updateTransform,q=G.dispatchZoomChange,oe=on(j,l,C,S,N,z,q),ce=oe.isMoving,L=oe.onMouseDown,Y=oe.onWheel,O=cn(j,l,C,f,N,z,q),F=O.isTouching,D=O.onTouchStart,ue=O.onTouchMove,ge=O.onTouchEnd,se=N.rotate,le=N.scale,_e=de(ie({},"".concat(o,"-moving"),ce));n.useEffect(function(){re||ee(!0)},[re]);var Ee=function(){te("close")},Pe=function(){q(pe+S,"zoomIn")},fe=function(){q(pe/(pe+S),"zoomOut")},ve=function(){z({rotate:se+90},"rotateRight")},Re=function(){z({rotate:se-90},"rotateLeft")},be=function(){z({flipX:!N.flipX},"flipX")},ye=function(){z({flipY:!N.flipY},"flipY")},Ve=function(){te("reset")},Ne=function(me){var Ie=p+me;!Number.isInteger(Ie)||Ie<0||Ie>I-1||(ee(!1),te(me<0?"prev":"next"),B==null||B(Ie,p))},He=function(me){!C||!U||(me.keyCode===Me.LEFT?Ne(-1):me.keyCode===Me.RIGHT&&Ne(1))},Ke=function(me){C&&(le!==1?z({x:0,y:0,scale:1},"doubleClick"):q(pe+S,"doubleClick",me.clientX,me.clientY))};n.useEffect(function(){var ne=we(window,"keydown",He,!1);return function(){ne.remove()}},[C,U,p]);var Oe=he.createElement(un,Ce({},V,{width:e.width,height:e.height,imgRef:j,className:"".concat(o,"-img"),alt:c,style:{transform:"translate3d(".concat(N.x,"px, ").concat(N.y,"px, 0) scale3d(").concat(N.flipX?"-":"").concat(le,", ").concat(N.flipY?"-":"").concat(le,", 1) rotate(").concat(se,"deg)"),transitionDuration:(!re||F)&&"0s"},fallback:m,src:s,onWheel:Y,onMouseDown:L,onDoubleClick:Ke,onTouchStart:D,onTouchMove:ue,onTouchEnd:ge,onTouchCancel:ge})),Xe=T({url:s,alt:c},t);return he.createElement(he.Fragment,null,he.createElement(Be,Ce({transitionName:E,maskTransitionName:P,closable:!1,keyboard:!0,prefixCls:o,onClose:v,visible:C,classNames:{wrapper:_e},rootClassName:h,getContainer:y},W,{afterClose:Ee}),he.createElement("div",{className:"".concat(o,"-img-wrapper")},Z?Z(Oe,T({transform:N,image:Xe},J?{current:p}:{})):Oe)),he.createElement(en,{visible:C,transform:N,maskTransitionName:P,closeIcon:w,getContainer:y,prefixCls:o,rootClassName:h,icons:_,countRender:b,showSwitch:U,showProgress:ae,current:p,count:I,scale:le,minScale:f,maxScale:R,toolbarRender:H,onActive:Ne,onZoomIn:Pe,onZoomOut:fe,onRotateRight:ve,onRotateLeft:Re,onFlipX:be,onFlipY:ye,onClose:v,onReset:Ve,zIndex:W.zIndex!==void 0?W.zIndex+1:void 0,image:Xe}))},Ye=["crossOrigin","decoding","draggable","loading","referrerPolicy","sizes","srcSet","useMap","alt"];function fn(i){var e=n.useState({}),o=A(e,2),s=o[0],c=o[1],t=n.useCallback(function(r,l){return c(function(v){return T(T({},v),{},ie({},r,l))}),function(){c(function(v){var C=T({},v);return delete C[r],C})}},[]),m=n.useMemo(function(){return i?i.map(function(r){if(typeof r=="string")return{data:{src:r}};var l={};return Object.keys(r).forEach(function(v){["src"].concat(je(Ye)).includes(v)&&(l[v]=r[v])}),{data:l}}):Object.keys(s).reduce(function(r,l){var v=s[l],C=v.canPreview,u=v.data;return C&&r.push({data:u,id:l}),r},[])},[i,s]);return[m,t,!!i]}var vn=["visible","onVisibleChange","getContainer","current","movable","minScale","maxScale","countRender","closeIcon","onChange","onTransform","toolbarRender","imageRender"],mn=["src"],dn=function(e){var o,s=e.previewPrefixCls,c=s===void 0?"rc-image-preview":s,t=e.children,m=e.icons,r=m===void 0?{}:m,l=e.items,v=e.preview,C=e.fallback,u=Ae(v)==="object"?v:{},_=u.visible,h=u.onVisibleChange,w=u.getContainer,y=u.current,k=u.movable,p=u.minScale,M=u.maxScale,I=u.countRender,b=u.closeIcon,a=u.onChange,S=u.onTransform,d=u.toolbarRender,f=u.imageRender,x=Se(u,vn),R=fn(l),g=A(R,3),E=g[0],$=g[1],P=g[2],Z=Le(0,{value:y}),V=A(Z,2),H=V[0],K=V[1],B=n.useState(!1),W=A(B,2),j=W[0],J=W[1],U=((o=E[H])===null||o===void 0?void 0:o.data)||{},ae=U.src,Q=Se(U,mn),X=Le(!!_,{value:_,onChange:function(F,D){h==null||h(F,D,H)}}),re=A(X,2),ee=re[0],G=re[1],N=n.useState(null),te=A(N,2),z=te[0],q=te[1],oe=n.useCallback(function(O,F,D,ue){var ge=P?E.findIndex(function(se){return se.data.src===F}):E.findIndex(function(se){return se.id===O});K(ge<0?0:ge),G(!0),q({x:D,y:ue}),J(!0)},[E,P]);n.useEffect(function(){ee?j||K(0):J(!1)},[ee]);var ce=function(F,D){K(F),a==null||a(F,D)},L=function(){G(!1),q(null)},Y=n.useMemo(function(){return{register:$,onPreview:oe}},[$,oe]);return n.createElement(xe.Provider,{value:Y},t,n.createElement(We,Ce({"aria-hidden":!ee,movable:k,visible:ee,prefixCls:c,closeIcon:b,onClose:L,mousePosition:z,imgCommonProps:Q,src:ae,fallback:C,icons:r,minScale:p,maxScale:M,getContainer:w,current:H,count:E.length,countRender:I,onTransform:S,toolbarRender:d,imageRender:f,onChange:ce},x)))},De=0;function gn(i,e){var o=n.useState(function(){return De+=1,String(De)}),s=A(o,1),c=s[0],t=n.useContext(xe),m={data:e,canPreview:i};return n.useEffect(function(){if(t)return t.register(c,m)},[]),n.useEffect(function(){t&&t.register(c,m)},[i,e]),c}var hn=["src","alt","onPreviewClose","prefixCls","previewPrefixCls","placeholder","fallback","width","height","style","preview","className","onClick","onError","wrapperClassName","wrapperStyle","rootClassName"],Cn=["src","visible","onVisibleChange","getContainer","mask","maskClassName","movable","icons","scaleStep","minScale","maxScale","imageRender","toolbarRender"],wn=function(e){var o=e.src,s=e.alt,c=e.onPreviewClose,t=e.prefixCls,m=t===void 0?"rc-image":t,r=e.previewPrefixCls,l=r===void 0?"".concat(m,"-preview"):r,v=e.placeholder,C=e.fallback,u=e.width,_=e.height,h=e.style,w=e.preview,y=w===void 0?!0:w,k=e.className,p=e.onClick,M=e.onError,I=e.wrapperClassName,b=e.wrapperStyle,a=e.rootClassName,S=Se(e,hn),d=v&&v!==!0,f=Ae(y)==="object"?y:{},x=f.src,R=f.visible,g=R===void 0?void 0:R,E=f.onVisibleChange,$=E===void 0?c:E,P=f.getContainer,Z=P===void 0?void 0:P,V=f.mask,H=f.maskClassName,K=f.movable,B=f.icons,W=f.scaleStep,j=f.minScale,J=f.maxScale,U=f.imageRender,ae=f.toolbarRender,Q=Se(f,Cn),X=x??o,re=Le(!!g,{value:g,onChange:$}),ee=A(re,2),G=ee[0],N=ee[1],te=Fe({src:o,isCustomPlaceholder:d,fallback:C}),z=A(te,3),q=z[0],oe=z[1],ce=z[2],L=n.useState(null),Y=A(L,2),O=Y[0],F=Y[1],D=n.useContext(xe),ue=!!y,ge=function(){N(!1),F(null)},se=de(m,I,a,ie({},"".concat(m,"-error"),ce==="error")),le=n.useMemo(function(){var fe={};return Ye.forEach(function(ve){e[ve]!==void 0&&(fe[ve]=e[ve])}),fe},Ye.map(function(fe){return e[fe]})),_e=n.useMemo(function(){return T(T({},le),{},{src:X})},[X,le]),Ee=gn(ue,_e),Pe=function(ve){var Re=qe(ve.target),be=Re.left,ye=Re.top;D?D.onPreview(Ee,X,be,ye):(F({x:be,y:ye}),N(!0)),p==null||p(ve)};return n.createElement(n.Fragment,null,n.createElement("div",Ce({},S,{className:se,onClick:ue?Pe:p,style:T({width:u,height:_},b)}),n.createElement("img",Ce({},le,{className:de("".concat(m,"-img"),ie({},"".concat(m,"-img-placeholder"),v===!0),k),style:T({height:_},h),ref:q},oe,{width:u,height:_,onError:M})),ce==="loading"&&n.createElement("div",{"aria-hidden":"true",className:"".concat(m,"-placeholder")},v),V&&ue&&n.createElement("div",{className:de("".concat(m,"-mask"),H),style:{display:(h==null?void 0:h.display)==="none"?"none":void 0}},V)),!D&&ue&&n.createElement(We,Ce({"aria-hidden":!G,visible:G,prefixCls:l,onClose:ge,mousePosition:O,src:X,alt:s,imageInfo:{width:u,height:_},fallback:C,getContainer:Z,icons:B,movable:K,scaleStep:W,minScale:j,maxScale:J,rootClassName:a,imageRender:U,imgCommonProps:le,toolbarRender:ae},Q)))};wn.PreviewGroup=dn;export{wn as I};
