import{r as y}from"./react-d998b26c.js";import{e as R,l as re,m as D,f as N,b as c,d as Z,i as Ie,j as Ae,a as ge,k as $,_ as he,h as me,g as Re,c as ee}from"./@babel-28107d12.js";import{b as z,t as X,F as K,G as _,o as Le,A as xe}from"./rc-util-cfa393e8.js";import{S as Ue}from"./async-validator-dee29e8b.js";var q="RC_FORM_INTERNAL_HOOKS",T=function(){z(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},B=y.createContext({getFieldValue:T,getFieldsValue:T,getFieldError:T,getFieldWarning:T,getFieldsError:T,isFieldsTouched:T,isFieldTouched:T,isFieldValidating:T,isFieldsValidating:T,resetFields:T,setFields:T,setFieldValue:T,setFieldsValue:T,validateFields:T,submit:T,getInternalHooks:function(){return T(),{dispatch:T,initEntityValue:T,registerField:T,useSubscribe:T,setInitialValues:T,destroyForm:T,setCallbacks:T,registerWatch:T,getFields:T,setValidateMessages:T,setPreserve:T,getInitialValue:T}}}),ae=y.createContext(null);function le(o){return o==null?[]:Array.isArray(o)?o:[o]}function We(o){return o&&!!o._init}var U="'${name}' is not a valid ${type}",Ne={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:U,method:U,array:U,object:U,number:U,date:U,boolean:U,integer:U,float:U,regexp:U,email:U,url:U,hex:U},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}},Pe=Ue;function je(o,l){return o.replace(/\$\{\w+\}/g,function(r){var t=r.slice(2,-1);return l[t]})}var Ce="CODE_LOGIC_ERROR";function oe(o,l,r,t,e){return ce.apply(this,arguments)}function ce(){return ce=re(D().mark(function o(l,r,t,e,n){var a,d,s,u,i,f,v,w,V;return D().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return a=R({},t),delete a.ruleIndex,Pe.warning=function(){},a.validator&&(d=a.validator,a.validator=function(){try{return d.apply(void 0,arguments)}catch(p){return console.error(p),Promise.reject(Ce)}}),s=null,a&&a.type==="array"&&a.defaultField&&(s=a.defaultField,delete a.defaultField),u=new Pe(c({},l,[a])),i=X(Ne,e.validateMessages),u.messages(i),f=[],g.prev=10,g.next=13,Promise.resolve(u.validate(c({},l,r),R({},e)));case 13:g.next=18;break;case 15:g.prev=15,g.t0=g.catch(10),g.t0.errors&&(f=g.t0.errors.map(function(p,h){var F=p.message,M=F===Ce?i.default:F;return y.isValidElement(M)?y.cloneElement(M,{key:"error_".concat(h)}):M}));case 18:if(!(!f.length&&s)){g.next=23;break}return g.next=21,Promise.all(r.map(function(p,h){return oe("".concat(l,".").concat(h),p,s,e,n)}));case 21:return v=g.sent,g.abrupt("return",v.reduce(function(p,h){return[].concat(N(p),N(h))},[]));case 23:return w=R(R({},t),{},{name:l,enum:(t.enum||[]).join(", ")},n),V=f.map(function(p){return typeof p=="string"?je(p,w):p}),g.abrupt("return",V);case 26:case"end":return g.stop()}},o,null,[[10,15]])})),ce.apply(this,arguments)}function He(o,l,r,t,e,n){var a=o.join("."),d=r.map(function(i,f){var v=i.validator,w=R(R({},i),{},{ruleIndex:f});return v&&(w.validator=function(V,m,g){var p=!1,h=function(){for(var b=arguments.length,E=new Array(b),k=0;k<b;k++)E[k]=arguments[k];Promise.resolve().then(function(){z(!p,"Your validator function has already return a promise. `callback` will be ignored."),p||g.apply(void 0,E)})},F=v(V,m,h);p=F&&typeof F.then=="function"&&typeof F.catch=="function",z(p,"`callback` is deprecated. Please return a promise instead."),p&&F.then(function(){g()}).catch(function(M){g(M||" ")})}),w}).sort(function(i,f){var v=i.warningOnly,w=i.ruleIndex,V=f.warningOnly,m=f.ruleIndex;return!!v==!!V?w-m:v?1:-1}),s;if(e===!0)s=new Promise(function(){var i=re(D().mark(function f(v,w){var V,m,g;return D().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:V=0;case 1:if(!(V<d.length)){h.next=12;break}return m=d[V],h.next=5,oe(a,l,m,t,n);case 5:if(g=h.sent,!g.length){h.next=9;break}return w([{errors:g,rule:m}]),h.abrupt("return");case 9:V+=1,h.next=1;break;case 12:v([]);case 13:case"end":return h.stop()}},f)}));return function(f,v){return i.apply(this,arguments)}}());else{var u=d.map(function(i){return oe(a,l,i,t,n).then(function(f){return{errors:f,rule:i}})});s=(e?_e(u):De(u)).then(function(i){return Promise.reject(i)})}return s.catch(function(i){return i}),s}function De(o){return de.apply(this,arguments)}function de(){return de=re(D().mark(function o(l){return D().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.all(l).then(function(e){var n,a=(n=[]).concat.apply(n,N(e));return a}));case 1:case"end":return t.stop()}},o)})),de.apply(this,arguments)}function _e(o){return fe.apply(this,arguments)}function fe(){return fe=re(D().mark(function o(l){var r;return D().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=0,e.abrupt("return",new Promise(function(n){l.forEach(function(a){a.then(function(d){d.errors.length&&n([d]),r+=1,r===l.length&&n([])})})}));case 2:case"end":return e.stop()}},o)})),fe.apply(this,arguments)}function I(o){return le(o)}function we(o,l){var r={};return l.forEach(function(t){var e=K(o,t);r=_(r,t,e)}),r}function Y(o,l){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return o&&o.some(function(t){return $e(l,t,r)})}function $e(o,l){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;return!o||!l||!r&&o.length!==l.length?!1:l.every(function(t,e){return o[e]===t})}function Ke(o,l){if(o===l)return!0;if(!o&&l||o&&!l||!o||!l||Z(o)!=="object"||Z(l)!=="object")return!1;var r=Object.keys(o),t=Object.keys(l),e=new Set([].concat(r,t));return N(e).every(function(n){var a=o[n],d=l[n];return typeof a=="function"&&typeof d=="function"?!0:a===d})}function ze(o){var l=arguments.length<=1?void 0:arguments[1];return l&&l.target&&Z(l.target)==="object"&&o in l.target?l.target[o]:l}function Ee(o,l,r){var t=o.length;if(l<0||l>=t||r<0||r>=t)return o;var e=o[l],n=l-r;return n>0?[].concat(N(o.slice(0,r)),[e],N(o.slice(r,l)),N(o.slice(l+1,t))):n<0?[].concat(N(o.slice(0,l)),N(o.slice(l+1,r+1)),[e],N(o.slice(r+1,t))):o}var Ge=["name"],W=[];function be(o,l,r,t,e,n){return typeof o=="function"?o(l,r,"source"in n?{source:n.source}:{}):t!==e}var pe=function(o){Ie(r,o);var l=Ae(r);function r(t){var e;if(ge(this,r),e=l.call(this,t),c($(e),"state",{resetCount:0}),c($(e),"cancelRegisterFunc",null),c($(e),"mounted",!1),c($(e),"touched",!1),c($(e),"dirty",!1),c($(e),"validatePromise",void 0),c($(e),"prevValidating",void 0),c($(e),"errors",W),c($(e),"warnings",W),c($(e),"cancelRegister",function(){var s=e.props,u=s.preserve,i=s.isListField,f=s.name;e.cancelRegisterFunc&&e.cancelRegisterFunc(i,u,I(f)),e.cancelRegisterFunc=null}),c($(e),"getNamePath",function(){var s=e.props,u=s.name,i=s.fieldContext,f=i.prefixName,v=f===void 0?[]:f;return u!==void 0?[].concat(N(v),N(u)):[]}),c($(e),"getRules",function(){var s=e.props,u=s.rules,i=u===void 0?[]:u,f=s.fieldContext;return i.map(function(v){return typeof v=="function"?v(f):v})}),c($(e),"refresh",function(){e.mounted&&e.setState(function(s){var u=s.resetCount;return{resetCount:u+1}})}),c($(e),"metaCache",null),c($(e),"triggerMetaEvent",function(s){var u=e.props.onMetaChange;if(u){var i=R(R({},e.getMeta()),{},{destroy:s});Le(e.metaCache,i)||u(i),e.metaCache=i}else e.metaCache=null}),c($(e),"onStoreChange",function(s,u,i){var f=e.props,v=f.shouldUpdate,w=f.dependencies,V=w===void 0?[]:w,m=f.onReset,g=i.store,p=e.getNamePath(),h=e.getValue(s),F=e.getValue(g),M=u&&Y(u,p);switch(i.type==="valueUpdate"&&i.source==="external"&&h!==F&&(e.touched=!0,e.dirty=!0,e.validatePromise=null,e.errors=W,e.warnings=W,e.triggerMetaEvent()),i.type){case"reset":if(!u||M){e.touched=!1,e.dirty=!1,e.validatePromise=void 0,e.errors=W,e.warnings=W,e.triggerMetaEvent(),m==null||m(),e.refresh();return}break;case"remove":{if(v){e.reRender();return}break}case"setField":{var b=i.data;if(M){"touched"in b&&(e.touched=b.touched),"validating"in b&&!("originRCField"in b)&&(e.validatePromise=b.validating?Promise.resolve([]):null),"errors"in b&&(e.errors=b.errors||W),"warnings"in b&&(e.warnings=b.warnings||W),e.dirty=!0,e.triggerMetaEvent(),e.reRender();return}else if("value"in b&&Y(u,p,!0)){e.reRender();return}if(v&&!p.length&&be(v,s,g,h,F,i)){e.reRender();return}break}case"dependenciesUpdate":{var E=V.map(I);if(E.some(function(k){return Y(i.relatedFields,k)})){e.reRender();return}break}default:if(M||(!V.length||p.length||v)&&be(v,s,g,h,F,i)){e.reRender();return}break}v===!0&&e.reRender()}),c($(e),"validateRules",function(s){var u=e.getNamePath(),i=e.getValue(),f=s||{},v=f.triggerName,w=f.validateOnly,V=w===void 0?!1:w,m=Promise.resolve().then(re(D().mark(function g(){var p,h,F,M,b,E,k;return D().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(e.mounted){P.next=2;break}return P.abrupt("return",[]);case 2:if(p=e.props,h=p.validateFirst,F=h===void 0?!1:h,M=p.messageVariables,b=p.validateDebounce,E=e.getRules(),v&&(E=E.filter(function(C){return C}).filter(function(C){var S=C.validateTrigger;if(!S)return!0;var O=le(S);return O.includes(v)})),!(b&&v)){P.next=10;break}return P.next=8,new Promise(function(C){setTimeout(C,b)});case 8:if(e.validatePromise===m){P.next=10;break}return P.abrupt("return",[]);case 10:return k=He(u,i,E,s,F,M),k.catch(function(C){return C}).then(function(){var C=arguments.length>0&&arguments[0]!==void 0?arguments[0]:W;if(e.validatePromise===m){var S;e.validatePromise=null;var O=[],A=[];(S=C.forEach)===null||S===void 0||S.call(C,function(x){var H=x.rule.warningOnly,Q=x.errors,ne=Q===void 0?W:Q;H?A.push.apply(A,N(ne)):O.push.apply(O,N(ne))}),e.errors=O,e.warnings=A,e.triggerMetaEvent(),e.reRender()}}),P.abrupt("return",k);case 13:case"end":return P.stop()}},g)})));return V||(e.validatePromise=m,e.dirty=!0,e.errors=W,e.warnings=W,e.triggerMetaEvent(),e.reRender()),m}),c($(e),"isFieldValidating",function(){return!!e.validatePromise}),c($(e),"isFieldTouched",function(){return e.touched}),c($(e),"isFieldDirty",function(){if(e.dirty||e.props.initialValue!==void 0)return!0;var s=e.props.fieldContext,u=s.getInternalHooks(q),i=u.getInitialValue;return i(e.getNamePath())!==void 0}),c($(e),"getErrors",function(){return e.errors}),c($(e),"getWarnings",function(){return e.warnings}),c($(e),"isListField",function(){return e.props.isListField}),c($(e),"isList",function(){return e.props.isList}),c($(e),"isPreserve",function(){return e.props.preserve}),c($(e),"getMeta",function(){e.prevValidating=e.isFieldValidating();var s={touched:e.isFieldTouched(),validating:e.prevValidating,errors:e.errors,warnings:e.warnings,name:e.getNamePath(),validated:e.validatePromise===null};return s}),c($(e),"getOnlyChild",function(s){if(typeof s=="function"){var u=e.getMeta();return R(R({},e.getOnlyChild(s(e.getControlled(),u,e.props.fieldContext))),{},{isFunction:!0})}var i=xe(s);return i.length!==1||!y.isValidElement(i[0])?{child:i,isFunction:!1}:{child:i[0],isFunction:!1}}),c($(e),"getValue",function(s){var u=e.props.fieldContext.getFieldsValue,i=e.getNamePath();return K(s||u(!0),i)}),c($(e),"getControlled",function(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},u=e.props,i=u.trigger,f=u.validateTrigger,v=u.getValueFromEvent,w=u.normalize,V=u.valuePropName,m=u.getValueProps,g=u.fieldContext,p=f!==void 0?f:g.validateTrigger,h=e.getNamePath(),F=g.getInternalHooks,M=g.getFieldsValue,b=F(q),E=b.dispatch,k=e.getValue(),L=m||function(O){return c({},V,O)},P=s[i],C=R(R({},s),L(k));C[i]=function(){e.touched=!0,e.dirty=!0,e.triggerMetaEvent();for(var O,A=arguments.length,x=new Array(A),H=0;H<A;H++)x[H]=arguments[H];v?O=v.apply(void 0,x):O=ze.apply(void 0,[V].concat(x)),w&&(O=w(O,k,M(!0))),E({type:"updateValue",namePath:h,value:O}),P&&P.apply(void 0,x)};var S=le(p||[]);return S.forEach(function(O){var A=C[O];C[O]=function(){A&&A.apply(void 0,arguments);var x=e.props.rules;x&&x.length&&E({type:"validateField",namePath:h,triggerName:O})}}),C}),t.fieldContext){var n=t.fieldContext.getInternalHooks,a=n(q),d=a.initEntityValue;d($(e))}return e}return he(r,[{key:"componentDidMount",value:function(){var e=this.props,n=e.shouldUpdate,a=e.fieldContext;if(this.mounted=!0,a){var d=a.getInternalHooks,s=d(q),u=s.registerField;this.cancelRegisterFunc=u(this)}n===!0&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var e=this.state.resetCount,n=this.props.children,a=this.getOnlyChild(n),d=a.child,s=a.isFunction,u;return s?u=d:y.isValidElement(d)?u=y.cloneElement(d,this.getControlled(d.props)):(z(!d,"`children` of Field is not validate ReactElement."),u=d),y.createElement(y.Fragment,{key:e},u)}}]),r}(y.Component);c(pe,"contextType",B);c(pe,"defaultProps",{trigger:"onChange",valuePropName:"value"});function Me(o){var l=o.name,r=me(o,Ge),t=y.useContext(B),e=y.useContext(ae),n=l!==void 0?I(l):void 0,a="keep";return r.isListField||(a="_".concat((n||[]).join("_"))),y.createElement(pe,Re({key:a,name:n,isListField:!!e},r,{fieldContext:t}))}function qe(o){var l=o.name,r=o.initialValue,t=o.children,e=o.rules,n=o.validateTrigger,a=o.isListField,d=y.useContext(B),s=y.useContext(ae),u=y.useRef({keys:[],id:0}),i=u.current,f=y.useMemo(function(){var m=I(d.prefixName)||[];return[].concat(N(m),N(I(l)))},[d.prefixName,l]),v=y.useMemo(function(){return R(R({},d),{},{prefixName:f})},[d,f]),w=y.useMemo(function(){return{getKey:function(g){var p=f.length,h=g[p];return[i.keys[h],g.slice(p+1)]}}},[f]);if(typeof t!="function")return z(!1,"Form.List only accepts function as children."),null;var V=function(g,p,h){var F=h.source;return F==="internal"?!1:g!==p};return y.createElement(ae.Provider,{value:w},y.createElement(B.Provider,{value:v},y.createElement(Me,{name:[],shouldUpdate:V,rules:e,validateTrigger:n,initialValue:r,isList:!0,isListField:a??!!s},function(m,g){var p=m.value,h=p===void 0?[]:p,F=m.onChange,M=d.getFieldValue,b=function(){var P=M(f||[]);return P||[]},E={add:function(P,C){var S=b();C>=0&&C<=S.length?(i.keys=[].concat(N(i.keys.slice(0,C)),[i.id],N(i.keys.slice(C))),F([].concat(N(S.slice(0,C)),[P],N(S.slice(C))))):(i.keys=[].concat(N(i.keys),[i.id]),F([].concat(N(S),[P]))),i.id+=1},remove:function(P){var C=b(),S=new Set(Array.isArray(P)?P:[P]);S.size<=0||(i.keys=i.keys.filter(function(O,A){return!S.has(A)}),F(C.filter(function(O,A){return!S.has(A)})))},move:function(P,C){if(P!==C){var S=b();P<0||P>=S.length||C<0||C>=S.length||(i.keys=Ee(i.keys,P,C),F(Ee(S,P,C)))}}},k=h||[];return Array.isArray(k)||(k=[]),t(k.map(function(L,P){var C=i.keys[P];return C===void 0&&(i.keys[P]=i.id,C=i.keys[P],i.id+=1),{name:P,key:C,isListField:!0}}),E,g)})))}function Je(o){var l=!1,r=o.length,t=[];return o.length?new Promise(function(e,n){o.forEach(function(a,d){a.catch(function(s){return l=!0,s}).then(function(s){r-=1,t[d]=s,!(r>0)&&(l&&n(t),e(t))})})}):Promise.resolve([])}var Se="__@field_split__";function ue(o){return o.map(function(l){return"".concat(Z(l),":").concat(l)}).join(Se)}var J=function(){function o(){ge(this,o),c(this,"kvs",new Map)}return he(o,[{key:"set",value:function(r,t){this.kvs.set(ue(r),t)}},{key:"get",value:function(r){return this.kvs.get(ue(r))}},{key:"update",value:function(r,t){var e=this.get(r),n=t(e);n?this.set(r,n):this.delete(r)}},{key:"delete",value:function(r){this.kvs.delete(ue(r))}},{key:"map",value:function(r){return N(this.kvs.entries()).map(function(t){var e=ee(t,2),n=e[0],a=e[1],d=n.split(Se);return r({key:d.map(function(s){var u=s.match(/^([^:]*):(.*)$/),i=ee(u,3),f=i[1],v=i[2];return f==="number"?Number(v):v}),value:a})})}},{key:"toJSON",value:function(){var r={};return this.map(function(t){var e=t.key,n=t.value;return r[e.join(".")]=n,null}),r}}]),o}(),Ye=["name"],Be=he(function o(l){var r=this;ge(this,o),c(this,"formHooked",!1),c(this,"forceRootUpdate",void 0),c(this,"subscribable",!0),c(this,"store",{}),c(this,"fieldEntities",[]),c(this,"initialValues",{}),c(this,"callbacks",{}),c(this,"validateMessages",null),c(this,"preserve",null),c(this,"lastValidatePromise",null),c(this,"getForm",function(){return{getFieldValue:r.getFieldValue,getFieldsValue:r.getFieldsValue,getFieldError:r.getFieldError,getFieldWarning:r.getFieldWarning,getFieldsError:r.getFieldsError,isFieldsTouched:r.isFieldsTouched,isFieldTouched:r.isFieldTouched,isFieldValidating:r.isFieldValidating,isFieldsValidating:r.isFieldsValidating,resetFields:r.resetFields,setFields:r.setFields,setFieldValue:r.setFieldValue,setFieldsValue:r.setFieldsValue,validateFields:r.validateFields,submit:r.submit,_init:!0,getInternalHooks:r.getInternalHooks}}),c(this,"getInternalHooks",function(t){return t===q?(r.formHooked=!0,{dispatch:r.dispatch,initEntityValue:r.initEntityValue,registerField:r.registerField,useSubscribe:r.useSubscribe,setInitialValues:r.setInitialValues,destroyForm:r.destroyForm,setCallbacks:r.setCallbacks,setValidateMessages:r.setValidateMessages,getFields:r.getFields,setPreserve:r.setPreserve,getInitialValue:r.getInitialValue,registerWatch:r.registerWatch}):(z(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)}),c(this,"useSubscribe",function(t){r.subscribable=t}),c(this,"prevWithoutPreserves",null),c(this,"setInitialValues",function(t,e){if(r.initialValues=t||{},e){var n,a=X(t,r.store);(n=r.prevWithoutPreserves)===null||n===void 0||n.map(function(d){var s=d.key;a=_(a,s,K(t,s))}),r.prevWithoutPreserves=null,r.updateStore(a)}}),c(this,"destroyForm",function(){var t=new J;r.getFieldEntities(!0).forEach(function(e){r.isMergedPreserve(e.isPreserve())||t.set(e.getNamePath(),!0)}),r.prevWithoutPreserves=t}),c(this,"getInitialValue",function(t){var e=K(r.initialValues,t);return t.length?X(e):e}),c(this,"setCallbacks",function(t){r.callbacks=t}),c(this,"setValidateMessages",function(t){r.validateMessages=t}),c(this,"setPreserve",function(t){r.preserve=t}),c(this,"watchList",[]),c(this,"registerWatch",function(t){return r.watchList.push(t),function(){r.watchList=r.watchList.filter(function(e){return e!==t})}}),c(this,"notifyWatch",function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];if(r.watchList.length){var e=r.getFieldsValue(),n=r.getFieldsValue(!0);r.watchList.forEach(function(a){a(e,n,t)})}}),c(this,"timeoutId",null),c(this,"warningUnhooked",function(){}),c(this,"updateStore",function(t){r.store=t}),c(this,"getFieldEntities",function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return t?r.fieldEntities.filter(function(e){return e.getNamePath().length}):r.fieldEntities}),c(this,"getFieldsMap",function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e=new J;return r.getFieldEntities(t).forEach(function(n){var a=n.getNamePath();e.set(a,n)}),e}),c(this,"getFieldEntitiesForNamePathList",function(t){if(!t)return r.getFieldEntities(!0);var e=r.getFieldsMap(!0);return t.map(function(n){var a=I(n);return e.get(a)||{INVALIDATE_NAME_PATH:I(n)}})}),c(this,"getFieldsValue",function(t,e){r.warningUnhooked();var n,a,d;if(t===!0||Array.isArray(t)?(n=t,a=e):t&&Z(t)==="object"&&(d=t.strict,a=t.filter),n===!0&&!a)return r.store;var s=r.getFieldEntitiesForNamePathList(Array.isArray(n)?n:null),u=[];return s.forEach(function(i){var f,v,w="INVALIDATE_NAME_PATH"in i?i.INVALIDATE_NAME_PATH:i.getNamePath();if(d){var V,m;if((V=(m=i).isList)!==null&&V!==void 0&&V.call(m))return}else if(!n&&(f=(v=i).isListField)!==null&&f!==void 0&&f.call(v))return;if(!a)u.push(w);else{var g="getMeta"in i?i.getMeta():null;a(g)&&u.push(w)}}),we(r.store,u.map(I))}),c(this,"getFieldValue",function(t){r.warningUnhooked();var e=I(t);return K(r.store,e)}),c(this,"getFieldsError",function(t){r.warningUnhooked();var e=r.getFieldEntitiesForNamePathList(t);return e.map(function(n,a){return n&&!("INVALIDATE_NAME_PATH"in n)?{name:n.getNamePath(),errors:n.getErrors(),warnings:n.getWarnings()}:{name:I(t[a]),errors:[],warnings:[]}})}),c(this,"getFieldError",function(t){r.warningUnhooked();var e=I(t),n=r.getFieldsError([e])[0];return n.errors}),c(this,"getFieldWarning",function(t){r.warningUnhooked();var e=I(t),n=r.getFieldsError([e])[0];return n.warnings}),c(this,"isFieldsTouched",function(){r.warningUnhooked();for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var a=e[0],d=e[1],s,u=!1;e.length===0?s=null:e.length===1?Array.isArray(a)?(s=a.map(I),u=!1):(s=null,u=a):(s=a.map(I),u=d);var i=r.getFieldEntities(!0),f=function(g){return g.isFieldTouched()};if(!s)return u?i.every(f):i.some(f);var v=new J;s.forEach(function(m){v.set(m,[])}),i.forEach(function(m){var g=m.getNamePath();s.forEach(function(p){p.every(function(h,F){return g[F]===h})&&v.update(p,function(h){return[].concat(N(h),[m])})})});var w=function(g){return g.some(f)},V=v.map(function(m){var g=m.value;return g});return u?V.every(w):V.some(w)}),c(this,"isFieldTouched",function(t){return r.warningUnhooked(),r.isFieldsTouched([t])}),c(this,"isFieldsValidating",function(t){r.warningUnhooked();var e=r.getFieldEntities();if(!t)return e.some(function(a){return a.isFieldValidating()});var n=t.map(I);return e.some(function(a){var d=a.getNamePath();return Y(n,d)&&a.isFieldValidating()})}),c(this,"isFieldValidating",function(t){return r.warningUnhooked(),r.isFieldsValidating([t])}),c(this,"resetWithFieldInitialValue",function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=new J,n=r.getFieldEntities(!0);n.forEach(function(s){var u=s.props.initialValue,i=s.getNamePath();if(u!==void 0){var f=e.get(i)||new Set;f.add({entity:s,value:u}),e.set(i,f)}});var a=function(u){u.forEach(function(i){var f=i.props.initialValue;if(f!==void 0){var v=i.getNamePath(),w=r.getInitialValue(v);if(w!==void 0)z(!1,"Form already set 'initialValues' with path '".concat(v.join("."),"'. Field can not overwrite it."));else{var V=e.get(v);if(V&&V.size>1)z(!1,"Multiple Field with path '".concat(v.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(V){var m=r.getFieldValue(v),g=i.isListField();!g&&(!t.skipExist||m===void 0)&&r.updateStore(_(r.store,v,N(V)[0].value))}}}})},d;t.entities?d=t.entities:t.namePathList?(d=[],t.namePathList.forEach(function(s){var u=e.get(s);if(u){var i;(i=d).push.apply(i,N(N(u).map(function(f){return f.entity})))}})):d=n,a(d)}),c(this,"resetFields",function(t){r.warningUnhooked();var e=r.store;if(!t){r.updateStore(X(r.initialValues)),r.resetWithFieldInitialValue(),r.notifyObservers(e,null,{type:"reset"}),r.notifyWatch();return}var n=t.map(I);n.forEach(function(a){var d=r.getInitialValue(a);r.updateStore(_(r.store,a,d))}),r.resetWithFieldInitialValue({namePathList:n}),r.notifyObservers(e,n,{type:"reset"}),r.notifyWatch(n)}),c(this,"setFields",function(t){r.warningUnhooked();var e=r.store,n=[];t.forEach(function(a){var d=a.name,s=me(a,Ye),u=I(d);n.push(u),"value"in s&&r.updateStore(_(r.store,u,s.value)),r.notifyObservers(e,[u],{type:"setField",data:a})}),r.notifyWatch(n)}),c(this,"getFields",function(){var t=r.getFieldEntities(!0),e=t.map(function(n){var a=n.getNamePath(),d=n.getMeta(),s=R(R({},d),{},{name:a,value:r.getFieldValue(a)});return Object.defineProperty(s,"originRCField",{value:!0}),s});return e}),c(this,"initEntityValue",function(t){var e=t.props.initialValue;if(e!==void 0){var n=t.getNamePath(),a=K(r.store,n);a===void 0&&r.updateStore(_(r.store,n,e))}}),c(this,"isMergedPreserve",function(t){var e=t!==void 0?t:r.preserve;return e??!0}),c(this,"registerField",function(t){r.fieldEntities.push(t);var e=t.getNamePath();if(r.notifyWatch([e]),t.props.initialValue!==void 0){var n=r.store;r.resetWithFieldInitialValue({entities:[t],skipExist:!0}),r.notifyObservers(n,[t.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(a,d){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[];if(r.fieldEntities=r.fieldEntities.filter(function(f){return f!==t}),!r.isMergedPreserve(d)&&(!a||s.length>1)){var u=a?void 0:r.getInitialValue(e);if(e.length&&r.getFieldValue(e)!==u&&r.fieldEntities.every(function(f){return!$e(f.getNamePath(),e)})){var i=r.store;r.updateStore(_(i,e,u,!0)),r.notifyObservers(i,[e],{type:"remove"}),r.triggerDependenciesUpdate(i,e)}}r.notifyWatch([e])}}),c(this,"dispatch",function(t){switch(t.type){case"updateValue":{var e=t.namePath,n=t.value;r.updateValue(e,n);break}case"validateField":{var a=t.namePath,d=t.triggerName;r.validateFields([a],{triggerName:d});break}}}),c(this,"notifyObservers",function(t,e,n){if(r.subscribable){var a=R(R({},n),{},{store:r.getFieldsValue(!0)});r.getFieldEntities().forEach(function(d){var s=d.onStoreChange;s(t,e,a)})}else r.forceRootUpdate()}),c(this,"triggerDependenciesUpdate",function(t,e){var n=r.getDependencyChildrenFields(e);return n.length&&r.validateFields(n),r.notifyObservers(t,n,{type:"dependenciesUpdate",relatedFields:[e].concat(N(n))}),n}),c(this,"updateValue",function(t,e){var n=I(t),a=r.store;r.updateStore(_(r.store,n,e)),r.notifyObservers(a,[n],{type:"valueUpdate",source:"internal"}),r.notifyWatch([n]);var d=r.triggerDependenciesUpdate(a,n),s=r.callbacks.onValuesChange;if(s){var u=we(r.store,[n]);s(u,r.getFieldsValue())}r.triggerOnFieldsChange([n].concat(N(d)))}),c(this,"setFieldsValue",function(t){r.warningUnhooked();var e=r.store;if(t){var n=X(r.store,t);r.updateStore(n)}r.notifyObservers(e,null,{type:"valueUpdate",source:"external"}),r.notifyWatch()}),c(this,"setFieldValue",function(t,e){r.setFields([{name:t,value:e}])}),c(this,"getDependencyChildrenFields",function(t){var e=new Set,n=[],a=new J;r.getFieldEntities().forEach(function(s){var u=s.props.dependencies;(u||[]).forEach(function(i){var f=I(i);a.update(f,function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:new Set;return v.add(s),v})})});var d=function s(u){var i=a.get(u)||new Set;i.forEach(function(f){if(!e.has(f)){e.add(f);var v=f.getNamePath();f.isFieldDirty()&&v.length&&(n.push(v),s(v))}})};return d(t),n}),c(this,"triggerOnFieldsChange",function(t,e){var n=r.callbacks.onFieldsChange;if(n){var a=r.getFields();if(e){var d=new J;e.forEach(function(u){var i=u.name,f=u.errors;d.set(i,f)}),a.forEach(function(u){u.errors=d.get(u.name)||u.errors})}var s=a.filter(function(u){var i=u.name;return Y(t,i)});s.length&&n(s,a)}}),c(this,"validateFields",function(t,e){r.warningUnhooked();var n,a;Array.isArray(t)||typeof t=="string"||typeof e=="string"?(n=t,a=e):a=t;var d=!!n,s=d?n.map(I):[],u=[],i=String(Date.now()),f=new Set,v=a||{},w=v.recursive,V=v.dirty;r.getFieldEntities(!0).forEach(function(h){if(d||s.push(h.getNamePath()),!(!h.props.rules||!h.props.rules.length)&&!(V&&!h.isFieldDirty())){var F=h.getNamePath();if(f.add(F.join(i)),!d||Y(s,F,w)){var M=h.validateRules(R({validateMessages:R(R({},Ne),r.validateMessages)},a));u.push(M.then(function(){return{name:F,errors:[],warnings:[]}}).catch(function(b){var E,k=[],L=[];return(E=b.forEach)===null||E===void 0||E.call(b,function(P){var C=P.rule.warningOnly,S=P.errors;C?L.push.apply(L,N(S)):k.push.apply(k,N(S))}),k.length?Promise.reject({name:F,errors:k,warnings:L}):{name:F,errors:k,warnings:L}}))}}});var m=Je(u);r.lastValidatePromise=m,m.catch(function(h){return h}).then(function(h){var F=h.map(function(M){var b=M.name;return b});r.notifyObservers(r.store,F,{type:"validateFinish"}),r.triggerOnFieldsChange(F,h)});var g=m.then(function(){return r.lastValidatePromise===m?Promise.resolve(r.getFieldsValue(s)):Promise.reject([])}).catch(function(h){var F=h.filter(function(M){return M&&M.errors.length});return Promise.reject({values:r.getFieldsValue(s),errorFields:F,outOfDate:r.lastValidatePromise!==m})});g.catch(function(h){return h});var p=s.filter(function(h){return f.has(h.join(i))});return r.triggerOnFieldsChange(p),g}),c(this,"submit",function(){r.warningUnhooked(),r.validateFields().then(function(t){var e=r.callbacks.onFinish;if(e)try{e(t)}catch(n){console.error(n)}}).catch(function(t){var e=r.callbacks.onFinishFailed;e&&e(t)})}),this.forceRootUpdate=l});function Te(o){var l=y.useRef(),r=y.useState({}),t=ee(r,2),e=t[1];if(!l.current)if(o)l.current=o;else{var n=function(){e({})},a=new Be(n);l.current=a.getForm()}return[l.current]}var ve=y.createContext({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}}),Qe=function(l){var r=l.validateMessages,t=l.onFormChange,e=l.onFormFinish,n=l.children,a=y.useContext(ve),d=y.useRef({});return y.createElement(ve.Provider,{value:R(R({},a),{},{validateMessages:R(R({},a.validateMessages),r),triggerFormChange:function(u,i){t&&t(u,{changedFields:i,forms:d.current}),a.triggerFormChange(u,i)},triggerFormFinish:function(u,i){e&&e(u,{values:i,forms:d.current}),a.triggerFormFinish(u,i)},registerForm:function(u,i){u&&(d.current=R(R({},d.current),{},c({},u,i))),a.registerForm(u,i)},unregisterForm:function(u){var i=R({},d.current);delete i[u],d.current=i,a.unregisterForm(u)}})},n)},Xe=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed"],Ze=function(l,r){var t=l.name,e=l.initialValues,n=l.fields,a=l.form,d=l.preserve,s=l.children,u=l.component,i=u===void 0?"form":u,f=l.validateMessages,v=l.validateTrigger,w=v===void 0?"onChange":v,V=l.onValuesChange,m=l.onFieldsChange,g=l.onFinish,p=l.onFinishFailed,h=me(l,Xe),F=y.useContext(ve),M=Te(a),b=ee(M,1),E=b[0],k=E.getInternalHooks(q),L=k.useSubscribe,P=k.setInitialValues,C=k.setCallbacks,S=k.setValidateMessages,O=k.setPreserve,A=k.destroyForm;y.useImperativeHandle(r,function(){return E}),y.useEffect(function(){return F.registerForm(t,E),function(){F.unregisterForm(t)}},[F,E,t]),S(R(R({},F.validateMessages),f)),C({onValuesChange:V,onFieldsChange:function(j){if(F.triggerFormChange(t,j),m){for(var G=arguments.length,Ve=new Array(G>1?G-1:0),ie=1;ie<G;ie++)Ve[ie-1]=arguments[ie];m.apply(void 0,[j].concat(Ve))}},onFinish:function(j){F.triggerFormFinish(t,j),g&&g(j)},onFinishFailed:p}),O(d);var x=y.useRef(null);P(e,!x.current),x.current||(x.current=!0),y.useEffect(function(){return A},[]);var H,Q=typeof s=="function";if(Q){var ne=E.getFieldsValue(!0);H=s(ne,E)}else H=s;L(!Q);var Fe=y.useRef();y.useEffect(function(){Ke(Fe.current||[],n||[])||E.setFields(n||[]),Fe.current=n},[n,E]);var Oe=y.useMemo(function(){return R(R({},E),{},{validateTrigger:w})},[E,w]),ye=y.createElement(ae.Provider,{value:null},y.createElement(B.Provider,{value:Oe},H));return i===!1?ye:y.createElement(i,Re({},h,{onSubmit:function(j){j.preventDefault(),j.stopPropagation(),E.submit()},onReset:function(j){var G;j.preventDefault(),E.resetFields(),(G=h.onReset)===null||G===void 0||G.call(h,j)}}),ye)};function ke(o){try{return JSON.stringify(o)}catch{return Math.random()}}function er(){for(var o=arguments.length,l=new Array(o),r=0;r<o;r++)l[r]=arguments[r];var t=l[0],e=t===void 0?[]:t,n=l[1],a=n===void 0?{}:n,d=We(a)?{form:a}:a,s=d.form,u=y.useState(),i=ee(u,2),f=i[0],v=i[1],w=y.useMemo(function(){return ke(f)},[f]),V=y.useRef(w);V.current=w;var m=y.useContext(B),g=s||m,p=g&&g._init,h=I(e),F=y.useRef(h);return F.current=h,y.useEffect(function(){if(p){var M=g.getFieldsValue,b=g.getInternalHooks,E=b(q),k=E.registerWatch,L=k(function(C,S){var O=K(d.preserve?S:C,F.current),A=ke(O);V.current!==A&&(V.current=A,v(O))}),P=K(d.preserve?M(!0):M(),F.current);return f!==P&&v(P),L}},[p]),f}var rr=y.forwardRef(Ze),te=rr;te.FormProvider=Qe;te.Field=Me;te.List=qe;te.useForm=Te;te.useWatch=er;export{B as C,Qe as F,ae as L,te as R,Me as W,qe as a,er as b,Te as u};
