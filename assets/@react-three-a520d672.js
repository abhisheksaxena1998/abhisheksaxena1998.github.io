import{e as N}from"./@babel-d329d0e8.js";import{r as f}from"./react-e38afb93.js";import{L as Pe,T as kt,R as Ft,U as zt,a as Wt,O as Ie,P as $e,S as Ze,b as Ce,N as Ht,A as It,B as $t,M as Bt,C as Gt,V as $,c as Ut,W as Nt,d as qt,e as Vt,f as Xt,g as Yt,h as Zt,i as Kt,D as Jt,j as be,k as Be,l as Qt,E as ct,m as er,n as tr,o as rr,p as se,q as nr,r as or,s as ir}from"./three-032c3317.js";import{u as sr}from"./react-use-measure-cf2030b3.js";import{F as ar,u as cr}from"./its-fine-d813af8c.js";import{R as lr,c as ie}from"./react-reconciler-8b14d213.js";import{s as Ke}from"./scheduler-765c72db.js";import{c as ur}from"./react-dom-8ddcb964.js";import{c as lt}from"./zustand-47653c63.js";import{D as fr,G as Ge,a as dr,M as Se,O as pr}from"./three-stdlib-0b5b799d.js";import{m as Ue}from"./react-merge-refs-239dbb3c.js";import{s as mr,p as vr,c as hr}from"./suspend-react-4f9dedb1.js";const Ne={},gr=e=>void Object.assign(Ne,e);function yr(e,t){function r(n,{args:o=[],attach:m,...d},p){let _=`${n[0].toUpperCase()}${n.slice(1)}`,g;if(n==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=d.object;g=ne(l,{type:n,root:p,attach:m,primitive:!0})}else{const l=Ne[_];if(!l)throw new Error(`R3F: ${_} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");g=ne(new l(...o),{type:n,root:p,attach:m,memoizedProps:{args:o}})}return g.__r3f.attach===void 0&&(g instanceof $t?g.__r3f.attach="geometry":g instanceof Bt&&(g.__r3f.attach="material")),_!=="inject"&&Ae(g,d),g}function i(n,o){let m=!1;if(o){var d,p;(d=o.__r3f)!=null&&d.attach?Oe(n,o,o.__r3f.attach):o.isObject3D&&n.isObject3D&&(n.add(o),m=!0),m||(p=n.__r3f)==null||p.objects.push(o),o.__r3f||ne(o,{}),o.__r3f.parent=n,We(o),oe(o)}}function a(n,o,m){let d=!1;if(o){var p,_;if((p=o.__r3f)!=null&&p.attach)Oe(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){o.parent=n,o.dispatchEvent({type:"added"});const g=n.children.filter(u=>u!==o),l=g.indexOf(m);n.children=[...g.slice(0,l),o,...g.slice(l)],d=!0}d||(_=n.__r3f)==null||_.objects.push(o),o.__r3f||ne(o,{}),o.__r3f.parent=n,We(o),oe(o)}}function c(n,o,m=!1){n&&[...n].forEach(d=>h(o,d,m))}function h(n,o,m){if(o){var d,p,_;if(o.__r3f&&(o.__r3f.parent=null),(d=n.__r3f)!=null&&d.objects&&(n.__r3f.objects=n.__r3f.objects.filter(M=>M!==o)),(p=o.__r3f)!=null&&p.attach)rt(n,o,o.__r3f.attach);else if(o.isObject3D&&n.isObject3D){var g;n.remove(o),(g=o.__r3f)!=null&&g.root&&Cr(o.__r3f.root,o)}const u=(_=o.__r3f)==null?void 0:_.primitive,b=m===void 0?o.dispose!==null&&!u:m;if(!u){var l;c((l=o.__r3f)==null?void 0:l.objects,o,b),c(o.children,o,b)}delete o.__r3f,b&&o.dispose&&o.type!=="Scene"&&Ke.unstable_scheduleCallback(Ke.unstable_IdlePriority,()=>{try{o.dispose()}catch{}}),oe(n)}}function v(n,o,m,d){var p;const _=(p=n.__r3f)==null?void 0:p.parent;if(!_)return;const g=r(o,m,n.__r3f.root);if(n.children){for(const l of n.children)l.__r3f&&i(g,l);n.children=n.children.filter(l=>!l.__r3f)}n.__r3f.objects.forEach(l=>i(g,l)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||h(_,n),g.parent&&(g.__r3f.autoRemovedBeforeAppend=!0),i(_,g),g.raycast&&g.__r3f.eventCount&&g.__r3f.root.getState().internal.interaction.push(g),[d,d.alternate].forEach(l=>{l!==null&&(l.stateNode=g,l.ref&&(typeof l.ref=="function"?l.ref(g):l.ref.current=g))})}const s=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:lr({createInstance:r,removeChild:h,appendChild:i,appendInitialChild:i,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,o)=>{if(!o)return;const m=n.getState().scene;m.__r3f&&(m.__r3f.root=n,i(m,o))},removeChildFromContainer:(n,o)=>{o&&h(n.getState().scene,o)},insertInContainerBefore:(n,o,m)=>{if(!o||!m)return;const d=n.getState().scene;d.__r3f&&a(d,o,m)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var o;return!!((o=n==null?void 0:n.__r3f)!=null?o:{}).handlers},prepareUpdate(n,o,m,d){var p;if(((p=n==null?void 0:n.__r3f)!=null?p:{}).primitive&&d.object&&d.object!==n)return[!0];{const{args:g=[],children:l,...u}=d,{args:b=[],children:M,...x}=m;if(!Array.isArray(g))throw new Error("R3F: the args prop must be an array!");if(g.some((C,R)=>C!==b[R]))return[!0];const E=ht(n,u,x,!0);return E.changes.length?[!1,E]:null}},commitUpdate(n,[o,m],d,p,_,g){o?v(n,d,_,g):Ae(n,m)},commitMount(n,o,m,d){var p;const _=(p=n.__r3f)!=null?p:{};n.raycast&&_.handlers&&_.eventCount&&n.__r3f.root.getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>ne(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var o;const{attach:m,parent:d}=(o=n.__r3f)!=null?o:{};m&&d&&rt(d,n,m),n.isObject3D&&(n.visible=!1),oe(n)},unhideInstance(n,o){var m;const{attach:d,parent:p}=(m=n.__r3f)!=null?m:{};d&&p&&Oe(p,n,d),(n.isObject3D&&o.visible==null||o.visible)&&(n.visible=!0),oe(n)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():ie.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&T.fun(performance.now)?performance.now:T.fun(Date.now)?Date.now:()=>0,scheduleTimeout:T.fun(setTimeout)?setTimeout:void 0,cancelTimeout:T.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ae}}var Je,Qe;const Re=e=>"colorSpace"in e||"outputColorSpace"in e,ut=()=>{var e;return(e=Ne.ColorManagement)!=null?e:null},ft=e=>e&&e.isOrthographicCamera,br=e=>e&&e.hasOwnProperty("current"),ve=typeof window<"u"&&((Je=window.document)!=null&&Je.createElement||((Qe=window.navigator)==null?void 0:Qe.product)==="ReactNative")?f.useLayoutEffect:f.useEffect;function dt(e){const t=f.useRef(e);return ve(()=>void(t.current=e),[e]),t}function wr({set:e}){return ve(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class pt extends f.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}pt.getDerivedStateFromError=()=>({error:!0});const mt="__default",et=new Map,Er=e=>e&&!!e.memoized&&!!e.changes;function vt(e){var t;const r=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],r),e[1]):e}const fe=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()},T={obj:e=>e===Object(e)&&!T.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:r="shallow",objects:i="reference",strict:a=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(T.str(e)||T.num(e))return e===t;const c=T.obj(e);if(c&&i==="reference")return e===t;const h=T.arr(e);if(h&&r==="reference")return e===t;if((h||c)&&e===t)return!0;let v;for(v in e)if(!(v in t))return!1;if(c&&r==="shallow"&&i==="shallow"){for(v in a?t:e)if(!T.equ(e[v],t[v],{strict:a,objects:"reference"}))return!1}else for(v in a?t:e)if(e[v]!==t[v])return!1;if(T.und(v)){if(h&&e.length===0&&t.length===0||c&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function _r(e){const t={nodes:{},materials:{}};return e&&e.traverse(r=>{r.name&&(t.nodes[r.name]=r),r.material&&!t.materials[r.material.name]&&(t.materials[r.material.name]=r.material)}),t}function xr(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ne(e,t){const r=e;return r.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function ze(e,t){let r=e;if(t.includes("-")){const i=t.split("-"),a=i.pop();return r=i.reduce((c,h)=>c[h],e),{target:r,key:a}}else return{target:r,key:t}}const tt=/-\d+$/;function Oe(e,t,r){if(T.str(r)){if(tt.test(r)){const c=r.replace(tt,""),{target:h,key:v}=ze(e,c);Array.isArray(h[v])||(h[v]=[])}const{target:i,key:a}=ze(e,r);t.__r3f.previousAttach=i[a],i[a]=t}else t.__r3f.previousAttach=r(e,t)}function rt(e,t,r){var i,a;if(T.str(r)){const{target:c,key:h}=ze(e,r),v=t.__r3f.previousAttach;v===void 0?delete c[h]:c[h]=v}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(a=t.__r3f)==null||delete a.previousAttach}function ht(e,{children:t,key:r,ref:i,...a},{children:c,key:h,ref:v,...s}={},y=!1){var n;const o=(n=e==null?void 0:e.__r3f)!=null?n:{},m=Object.entries(a),d=[];if(y){const _=Object.keys(s);for(let g=0;g<_.length;g++)a.hasOwnProperty(_[g])||m.unshift([_[g],mt+"remove"])}m.forEach(([_,g])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&_==="object"||T.equ(g,s[_]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(_))return d.push([_,g,!0,[]]);let u=[];_.includes("-")&&(u=_.split("-")),d.push([_,g,!1,u]);for(const b in a){const M=a[b];b.startsWith(`${_}-`)&&d.push([b,M,!1,b.split("-")])}});const p={...a};return o.memoizedProps&&o.memoizedProps.args&&(p.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(p.attach=o.memoizedProps.attach),{memoized:p,changes:d}}function Ae(e,t){var r,i,a;const c=(r=e.__r3f)!=null?r:{},h=c.root,v=(i=h==null||h.getState==null?void 0:h.getState())!=null?i:{},{memoized:s,changes:y}=Er(t)?t:ht(e,t),n=c.eventCount;e.__r3f&&(e.__r3f.memoizedProps=s);for(let m=0;m<y.length;m++){let[d,p,_,g]=y[m];if(Re(e)){const M="srgb",x="srgb-linear";d==="encoding"?(d="colorSpace",p=p===3001?M:x):d==="outputEncoding"&&(d="outputColorSpace",p=p===3001?M:x)}let l=e,u=l[d];if(g.length&&(u=g.reduce((b,M)=>b[M],e),!(u&&u.set))){const[b,...M]=g.reverse();l=M.reverse().reduce((x,E)=>x[E],e),d=b}if(p===mt+"remove")if(l.constructor){let b=et.get(l.constructor);b||(b=new l.constructor,et.set(l.constructor,b)),p=b[d]}else p=0;if(_)p?c.handlers[d]=p:delete c.handlers[d],c.eventCount=Object.keys(c.handlers).length;else if(u&&u.set&&(u.copy||u instanceof Pe)){if(Array.isArray(p))u.fromArray?u.fromArray(p):u.set(...p);else if(u.copy&&p&&p.constructor&&u.constructor===p.constructor)u.copy(p);else if(p!==void 0){const b=u instanceof Gt;!b&&u.setScalar?u.setScalar(p):u instanceof Pe&&p instanceof Pe?u.mask=p.mask:u.set(p),!ut()&&!v.linear&&b&&u.convertSRGBToLinear()}}else if(l[d]=p,l[d]instanceof kt&&l[d].format===Ft&&l[d].type===zt){const b=l[d];Re(b)&&Re(v.gl)?b.colorSpace=v.gl.outputColorSpace:b.encoding=v.gl.outputEncoding}oe(e)}if(c.parent&&v.internal&&e.raycast&&n!==c.eventCount){const m=v.internal.interaction.indexOf(e);m>-1&&v.internal.interaction.splice(m,1),c.eventCount&&v.internal.interaction.push(e)}return!(y.length===1&&y[0][0]==="onUpdate")&&y.length&&(a=e.__r3f)!=null&&a.parent&&We(e),e}function oe(e){var t,r;const i=(t=e.__r3f)==null||(r=t.root)==null||r.getState==null?void 0:r.getState();i&&i.internal.frames===0&&i.invalidate()}function We(e){e.onUpdate==null||e.onUpdate(e)}function Mr(e,t){e.manual||(ft(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function we(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Pr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return ie.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return ie.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return ie.ContinuousEventPriority;default:return ie.DefaultEventPriority}}function gt(e,t,r,i){const a=r.get(t);a&&(r.delete(t),r.size===0&&(e.delete(i),a.target.releasePointerCapture(i)))}function Cr(e,t){const{internal:r}=e.getState();r.interaction=r.interaction.filter(i=>i!==t),r.initialHits=r.initialHits.filter(i=>i!==t),r.hovered.forEach((i,a)=>{(i.eventObject===t||i.object===t)&&r.hovered.delete(a)}),r.capturedMap.forEach((i,a)=>{gt(r.capturedMap,t,i,a)})}function Sr(e){function t(s){const{internal:y}=e.getState(),n=s.offsetX-y.initialClick[0],o=s.offsetY-y.initialClick[1];return Math.round(Math.sqrt(n*n+o*o))}function r(s){return s.filter(y=>["Move","Over","Enter","Out","Leave"].some(n=>{var o;return(o=y.__r3f)==null?void 0:o.handlers["onPointer"+n]}))}function i(s,y){const n=e.getState(),o=new Set,m=[],d=y?y(n.internal.interaction):n.internal.interaction;for(let l=0;l<d.length;l++){const u=fe(d[l]);u&&(u.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(s,n);function p(l){const u=fe(l);if(!u||!u.events.enabled||u.raycaster.camera===null)return[];if(u.raycaster.camera===void 0){var b;u.events.compute==null||u.events.compute(s,u,(b=u.previousRoot)==null?void 0:b.getState()),u.raycaster.camera===void 0&&(u.raycaster.camera=null)}return u.raycaster.camera?u.raycaster.intersectObject(l,!0):[]}let _=d.flatMap(p).sort((l,u)=>{const b=fe(l.object),M=fe(u.object);return!b||!M?l.distance-u.distance:M.events.priority-b.events.priority||l.distance-u.distance}).filter(l=>{const u=we(l);return o.has(u)?!1:(o.add(u),!0)});n.events.filter&&(_=n.events.filter(_,n));for(const l of _){let u=l.object;for(;u;){var g;(g=u.__r3f)!=null&&g.eventCount&&m.push({...l,eventObject:u}),u=u.parent}}if("pointerId"in s&&n.internal.capturedMap.has(s.pointerId))for(let l of n.internal.capturedMap.get(s.pointerId).values())o.has(we(l.intersection))||m.push(l.intersection);return m}function a(s,y,n,o){const m=e.getState();if(s.length){const d={stopped:!1};for(const p of s){const _=fe(p.object)||m,{raycaster:g,pointer:l,camera:u,internal:b}=_,M=new $(l.x,l.y,0).unproject(u),x=S=>{var w,O;return(w=(O=b.capturedMap.get(S))==null?void 0:O.has(p.eventObject))!=null?w:!1},E=S=>{const w={intersection:p,target:y.target};b.capturedMap.has(S)?b.capturedMap.get(S).set(p.eventObject,w):b.capturedMap.set(S,new Map([[p.eventObject,w]])),y.target.setPointerCapture(S)},C=S=>{const w=b.capturedMap.get(S);w&&gt(b.capturedMap,p.eventObject,w,S)};let R={};for(let S in y){let w=y[S];typeof w!="function"&&(R[S]=w)}let P={...p,...R,pointer:l,intersections:s,stopped:d.stopped,delta:n,unprojectedPoint:M,ray:g.ray,camera:u,stopPropagation(){const S="pointerId"in y&&b.capturedMap.get(y.pointerId);if((!S||S.has(p.eventObject))&&(P.stopped=d.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(w=>w.eventObject===p.eventObject))){const w=s.slice(0,s.indexOf(p));c([...w,p])}},target:{hasPointerCapture:x,setPointerCapture:E,releasePointerCapture:C},currentTarget:{hasPointerCapture:x,setPointerCapture:E,releasePointerCapture:C},nativeEvent:y};if(o(P),d.stopped===!0)break}}return s}function c(s){const{internal:y}=e.getState();for(const n of y.hovered.values())if(!s.length||!s.find(o=>o.object===n.object&&o.index===n.index&&o.instanceId===n.instanceId)){const m=n.eventObject.__r3f,d=m==null?void 0:m.handlers;if(y.hovered.delete(we(n)),m!=null&&m.eventCount){const p={...n,intersections:s};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function h(s,y){for(let n=0;n<y.length;n++){const o=y[n].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(s)}}function v(s){switch(s){case"onPointerLeave":case"onPointerCancel":return()=>c([]);case"onLostPointerCapture":return y=>{const{internal:n}=e.getState();"pointerId"in y&&n.capturedMap.has(y.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(y.pointerId)&&(n.capturedMap.delete(y.pointerId),c([]))})}}return function(n){const{onPointerMissed:o,internal:m}=e.getState();m.lastEvent.current=n;const d=s==="onPointerMove",p=s==="onClick"||s==="onContextMenu"||s==="onDoubleClick",g=i(n,d?r:void 0),l=p?t(n):0;s==="onPointerDown"&&(m.initialClick=[n.offsetX,n.offsetY],m.initialHits=g.map(b=>b.eventObject)),p&&!g.length&&l<=2&&(h(n,m.interaction),o&&o(n)),d&&c(g);function u(b){const M=b.eventObject,x=M.__r3f,E=x==null?void 0:x.handlers;if(x!=null&&x.eventCount)if(d){if(E.onPointerOver||E.onPointerEnter||E.onPointerOut||E.onPointerLeave){const C=we(b),R=m.hovered.get(C);R?R.stopped&&b.stopPropagation():(m.hovered.set(C,b),E.onPointerOver==null||E.onPointerOver(b),E.onPointerEnter==null||E.onPointerEnter(b))}E.onPointerMove==null||E.onPointerMove(b)}else{const C=E[s];C?(!p||m.initialHits.includes(M))&&(h(n,m.interaction.filter(R=>!m.initialHits.includes(R))),C(b)):p&&m.initialHits.includes(M)&&h(n,m.interaction.filter(R=>!m.initialHits.includes(R)))}}a(g,n,l,u)}}return{handlePointer:v}}const yt=e=>!!(e!=null&&e.render),bt=f.createContext(null),Rr=(e,t)=>{const r=lt((v,s)=>{const y=new $,n=new $,o=new $;function m(l=s().camera,u=n,b=s().size){const{width:M,height:x,top:E,left:C}=b,R=M/x;u instanceof $?o.copy(u):o.set(...u);const P=l.getWorldPosition(y).distanceTo(o);if(ft(l))return{width:M/l.zoom,height:x/l.zoom,top:E,left:C,factor:1,distance:P,aspect:R};{const S=l.fov*Math.PI/180,w=2*Math.tan(S/2)*P,O=w*(M/x);return{width:O,height:w,top:E,left:C,factor:M/O,distance:P,aspect:R}}}let d;const p=l=>v(u=>({performance:{...u.performance,current:l}})),_=new Ut;return{set:v,get:s,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(l=1)=>e(s(),l),advance:(l,u)=>t(l,u,s()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new Zt,pointer:_,mouse:_,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=s();d&&clearTimeout(d),l.performance.current!==l.performance.min&&p(l.performance.min),d=setTimeout(()=>p(s().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:m},setEvents:l=>v(u=>({...u,events:{...u.events,...l}})),setSize:(l,u,b,M,x)=>{const E=s().camera,C={width:l,height:u,top:M||0,left:x||0,updateStyle:b};v(R=>({size:C,viewport:{...R.viewport,...m(E,n,C)}}))},setDpr:l=>v(u=>{const b=vt(l);return{viewport:{...u.viewport,dpr:b,initialDpr:u.viewport.initialDpr||b}}}),setFrameloop:(l="always")=>{const u=s().clock;u.stop(),u.elapsedTime=0,l!=="never"&&(u.start(),u.elapsedTime=0),v(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:f.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,u,b)=>{const M=s().internal;return M.priority=M.priority+(u>0?1:0),M.subscribers.push({ref:l,priority:u,store:b}),M.subscribers=M.subscribers.sort((x,E)=>x.priority-E.priority),()=>{const x=s().internal;x!=null&&x.subscribers&&(x.priority=x.priority-(u>0?1:0),x.subscribers=x.subscribers.filter(E=>E.ref!==l))}}}}}),i=r.getState();let a=i.size,c=i.viewport.dpr,h=i.camera;return r.subscribe(()=>{const{camera:v,size:s,viewport:y,gl:n,set:o}=r.getState();if(s!==a||y.dpr!==c){var m;a=s,c=y.dpr,Mr(v,s),n.setPixelRatio(y.dpr);const d=(m=s.updateStyle)!=null?m:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(s.width,s.height,d)}v!==h&&(h=v,o(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(v)}})))}),r.subscribe(v=>e(v)),r};let Ee,Or=new Set,Ar=new Set,jr=new Set;function je(e,t){if(e.size)for(const{callback:r}of e.values())r(t)}function de(e,t){switch(e){case"before":return je(Or,t);case"after":return je(Ar,t);case"tail":return je(jr,t)}}let Te,De;function Le(e,t,r){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Te=t.internal.subscribers,Ee=0;Ee<Te.length;Ee++)De=Te[Ee],De.ref.current(De.store.getState(),i,r);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Tr(e){let t=!1,r,i,a;function c(s){i=requestAnimationFrame(c),t=!0,r=0,de("before",s);for(const n of e.values()){var y;a=n.store.getState(),a.internal.active&&(a.frameloop==="always"||a.internal.frames>0)&&!((y=a.gl.xr)!=null&&y.isPresenting)&&(r+=Le(s,a))}if(de("after",s),r===0)return de("tail",s),t=!1,cancelAnimationFrame(i)}function h(s,y=1){var n;if(!s)return e.forEach(o=>h(o.store.getState()),y);(n=s.gl.xr)!=null&&n.isPresenting||!s.internal.active||s.frameloop==="never"||(s.internal.frames=Math.min(60,s.internal.frames+y),t||(t=!0,requestAnimationFrame(c)))}function v(s,y=!0,n,o){if(y&&de("before",s),n)Le(s,n,o);else for(const m of e.values())Le(s,m.store.getState());y&&de("after",s)}return{loop:c,invalidate:h,advance:v}}function wt(){const e=f.useContext(bt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function I(e=r=>r,t){return wt()(e,t)}function he(e,t=0){const r=wt(),i=r.getState().internal.subscribe,a=dt(e);return ve(()=>i(a,t,r),[t,i,r]),null}function Et(e,t){return function(r,...i){const a=new r;return e&&e(a),Promise.all(i.map(c=>new Promise((h,v)=>a.load(c,s=>{s.scene&&Object.assign(s,_r(s.scene)),h(s)},t,s=>v(new Error(`Could not load ${c}: ${s.message})`))))))}}function X(e,t,r,i){const a=Array.isArray(t)?t:[t],c=mr(Et(r,i),[e,...a],{equal:T.equ});return Array.isArray(t)?c:c[0]}X.preload=function(e,t,r){const i=Array.isArray(t)?t:[t];return vr(Et(r),[e,...i])};X.clear=function(e,t){const r=Array.isArray(t)?t:[t];return hr([e,...r])};const ae=new Map,{invalidate:nt,advance:ot}=Tr(ae),{reconciler:xe,applyProps:U}=yr(ae,Pr),re={objects:"shallow",strict:!1},Dr=(e,t)=>{const r=typeof e=="function"?e(t):e;return yt(r)?r:new Nt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Lr(e,t){if(t)return t;if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:r,height:i,top:a,left:c}=e.parentElement.getBoundingClientRect();return{width:r,height:i,top:a,left:c}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0};return{width:0,height:0,top:0,left:0}}function kr(e){const t=ae.get(e),r=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const a=typeof reportError=="function"?reportError:console.error,c=i||Rr(nt,ot),h=r||xe.createContainer(c,ie.ConcurrentRoot,null,!1,null,"",a,null);t||ae.set(e,{fiber:h,store:c});let v,s=!1,y;return{configure(n={}){let{gl:o,size:m,scene:d,events:p,onCreated:_,shadows:g=!1,linear:l=!1,flat:u=!1,legacy:b=!1,orthographic:M=!1,frameloop:x="always",dpr:E=[1,2],performance:C,raycaster:R,camera:P,onPointerMissed:S}=n,w=c.getState(),O=w.gl;w.gl||w.set({gl:O=Dr(o,e)});let B=w.raycaster;B||w.set({raycaster:B=new Wt});const{params:Q,...k}=R||{};if(T.equ(k,B,re)||U(B,{...k}),T.equ(Q,B.params,re)||U(B,{params:{...B.params,...Q}}),!w.camera||w.camera===y&&!T.equ(y,P,re)){y=P;const F=P instanceof qt,A=F?P:M?new Ie(0,0,0,0,.1,1e3):new $e(75,0,.1,1e3);F||(A.position.z=5,P&&U(A,P),!w.camera&&!(P!=null&&P.rotation)&&A.lookAt(0,0,0)),w.set({camera:A})}if(!w.scene){let F;d instanceof Ze?F=d:(F=new Ze,d&&U(F,d)),w.set({scene:ne(F)})}if(!w.xr){const F=(L,ee)=>{const le=c.getState();le.frameloop!=="never"&&ot(L,!0,le,ee)},A=()=>{const L=c.getState();L.gl.xr.enabled=L.gl.xr.isPresenting,L.gl.xr.setAnimationLoop(L.gl.xr.isPresenting?F:null),L.gl.xr.isPresenting||nt(L)},W={connect(){const L=c.getState().gl;L.xr.addEventListener("sessionstart",A),L.xr.addEventListener("sessionend",A)},disconnect(){const L=c.getState().gl;L.xr.removeEventListener("sessionstart",A),L.xr.removeEventListener("sessionend",A)}};O.xr&&W.connect(),w.set({xr:W})}if(O.shadowMap){const F=O.shadowMap.enabled,A=O.shadowMap.type;if(O.shadowMap.enabled=!!g,T.boo(g))O.shadowMap.type=Ce;else if(T.str(g)){var V;const W={basic:Vt,percentage:Xt,soft:Ce,variance:Yt};O.shadowMap.type=(V=W[g])!=null?V:Ce}else T.obj(g)&&Object.assign(O.shadowMap,g);(F!==O.shadowMap.enabled||A!==O.shadowMap.type)&&(O.shadowMap.needsUpdate=!0)}const D=ut();D&&("enabled"in D?D.enabled=!b:"legacyMode"in D&&(D.legacyMode=b)),U(O,{outputEncoding:l?3e3:3001,toneMapping:u?Ht:It}),w.legacy!==b&&w.set(()=>({legacy:b})),w.linear!==l&&w.set(()=>({linear:l})),w.flat!==u&&w.set(()=>({flat:u})),o&&!T.fun(o)&&!yt(o)&&!T.equ(o,O,re)&&U(O,o),p&&!w.events.handlers&&w.set({events:p(c)});const z=Lr(e,m);return T.equ(z,w.size,re)||w.setSize(z.width,z.height,z.updateStyle,z.top,z.left),E&&w.viewport.dpr!==vt(E)&&w.setDpr(E),w.frameloop!==x&&w.setFrameloop(x),w.onPointerMissed||w.set({onPointerMissed:S}),C&&!T.equ(C,w.performance,re)&&w.set(F=>({performance:{...F.performance,...C}})),v=_,s=!0,this},render(n){return s||this.configure(),xe.updateContainer(f.createElement(Fr,{store:c,children:n,onCreated:v,rootElement:e}),h,null,()=>{}),c},unmount(){_t(e)}}}function Fr({store:e,children:t,onCreated:r,rootElement:i}){return ve(()=>{const a=e.getState();a.set(c=>({internal:{...c.internal,active:!0}})),r&&r(a),e.getState().events.connected||a.events.connect==null||a.events.connect(i)},[]),f.createElement(bt.Provider,{value:e},t)}function _t(e,t){const r=ae.get(e),i=r==null?void 0:r.fiber;if(i){const a=r==null?void 0:r.store.getState();a&&(a.internal.active=!1),xe.updateContainer(null,i,null,()=>{a&&setTimeout(()=>{try{var c,h,v,s;a.events.disconnect==null||a.events.disconnect(),(c=a.gl)==null||(h=c.renderLists)==null||h.dispose==null||h.dispose(),(v=a.gl)==null||v.forceContextLoss==null||v.forceContextLoss(),(s=a.gl)!=null&&s.xr&&a.xr.disconnect(),xr(a),ae.delete(e),t&&t(e)}catch{}},500)})}}xe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:f.version});const ke={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function zr(e){const{handlePointer:t}=Sr(e);return{priority:1,enabled:!0,compute(r,i,a){i.pointer.set(r.offsetX/i.size.width*2-1,-(r.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(ke).reduce((r,i)=>({...r,[i]:t(i)}),{}),update:()=>{var r;const{events:i,internal:a}=e.getState();(r=a.lastEvent)!=null&&r.current&&i.handlers&&i.handlers.onPointerMove(a.lastEvent.current)},connect:r=>{var i;const{set:a,events:c}=e.getState();c.disconnect==null||c.disconnect(),a(h=>({events:{...h.events,connected:r}})),Object.entries((i=c.handlers)!=null?i:[]).forEach(([h,v])=>{const[s,y]=ke[h];r.addEventListener(s,v,{passive:y})})},disconnect:()=>{const{set:r,events:i}=e.getState();if(i.connected){var a;Object.entries((a=i.handlers)!=null?a:[]).forEach(([c,h])=>{if(i&&i.connected instanceof HTMLElement){const[v]=ke[c];i.connected.removeEventListener(v,h)}}),r(c=>({events:{...c.events,connected:void 0}}))}}}}const Wr=f.forwardRef(function({children:t,fallback:r,resize:i,style:a,gl:c,events:h=zr,eventSource:v,eventPrefix:s,shadows:y,linear:n,flat:o,legacy:m,orthographic:d,frameloop:p,dpr:_,performance:g,raycaster:l,camera:u,onPointerMissed:b,onCreated:M,...x},E){f.useMemo(()=>gr(Kt),[]);const C=cr(),[R,P]=sr({scroll:!0,debounce:{scroll:50,resize:0},...i}),S=f.useRef(null),w=f.useRef(null);f.useImperativeHandle(E,()=>S.current);const O=dt(b),[B,Q]=f.useState(!1),[k,V]=f.useState(!1);if(B)throw B;if(k)throw k;const D=f.useRef(null);ve(()=>{const G=S.current;P.width>0&&P.height>0&&G&&(D.current||(D.current=kr(G)),D.current.configure({gl:c,events:h,shadows:y,linear:n,flat:o,legacy:m,orthographic:d,frameloop:p,dpr:_,performance:g,raycaster:l,camera:u,size:P,onPointerMissed:(...z)=>O.current==null?void 0:O.current(...z),onCreated:z=>{z.events.connect==null||z.events.connect(v?br(v)?v.current:v:w.current),s&&z.setEvents({compute:(F,A)=>{const W=F[s+"X"],L=F[s+"Y"];A.pointer.set(W/A.size.width*2-1,-(L/A.size.height)*2+1),A.raycaster.setFromCamera(A.pointer,A.camera)}}),M==null||M(z)}}),D.current.render(f.createElement(C,null,f.createElement(pt,{set:V},f.createElement(f.Suspense,{fallback:f.createElement(wr,{set:Q})},t)))))}),f.useEffect(()=>{const G=S.current;if(G)return()=>_t(G)},[]);const ce=v?"none":"auto";return f.createElement("div",N({ref:w,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:ce,...a}},x),f.createElement("div",{ref:R,style:{width:"100%",height:"100%"}},f.createElement("canvas",{ref:S,style:{display:"block"}},r)))}),dn=f.forwardRef(function(t,r){return f.createElement(ar,null,f.createElement(Wr,N({},t,{ref:r})))}),ge=new $,qe=new $,Hr=new $;function Ir(e,t,r){const i=ge.setFromMatrixPosition(e.matrixWorld);i.project(t);const a=r.width/2,c=r.height/2;return[i.x*a+a,-(i.y*c)+c]}function $r(e,t){const r=ge.setFromMatrixPosition(e.matrixWorld),i=qe.setFromMatrixPosition(t.matrixWorld),a=r.sub(i),c=t.getWorldDirection(Hr);return a.angleTo(c)>Math.PI/2}function Br(e,t,r,i){const a=ge.setFromMatrixPosition(e.matrixWorld),c=a.clone();c.project(t),r.setFromCamera(c,t);const h=r.intersectObjects(i,!0);if(h.length){const v=h[0].distance;return a.distanceTo(r.ray.origin)<v}return!0}function Gr(e,t){if(t instanceof Ie)return t.zoom;if(t instanceof $e){const r=ge.setFromMatrixPosition(e.matrixWorld),i=qe.setFromMatrixPosition(t.matrixWorld),a=t.fov*Math.PI/180,c=r.distanceTo(i);return 1/(2*Math.tan(a/2)*c)}else return 1}function Ur(e,t,r){if(t instanceof $e||t instanceof Ie){const i=ge.setFromMatrixPosition(e.matrixWorld),a=qe.setFromMatrixPosition(t.matrixWorld),c=i.distanceTo(a),h=(r[1]-r[0])/(t.far-t.near),v=r[1]-h*t.far;return Math.round(h*c+v)}}const He=e=>Math.abs(e)<1e-10?0:e;function xt(e,t,r=""){let i="matrix3d(";for(let a=0;a!==16;a++)i+=He(t[a]*e.elements[a])+(a!==15?",":")");return r+i}const Nr=(e=>t=>xt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),qr=(e=>(t,r)=>xt(t,e(r),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Vr(e){return e&&typeof e=="object"&&"current"in e}const pn=f.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:a,center:c,fullscreen:h,portal:v,distanceFactor:s,sprite:y=!1,transform:n=!1,occlude:o,onOcclude:m,castShadow:d,receiveShadow:p,material:_,geometry:g,zIndexRange:l=[16777271,0],calculatePosition:u=Ir,as:b="div",wrapperClass:M,pointerEvents:x="auto",...E},C)=>{const{gl:R,camera:P,scene:S,size:w,raycaster:O,events:B,viewport:Q}=I(),[k]=f.useState(()=>document.createElement(b)),V=f.useRef(),D=f.useRef(null),ce=f.useRef(0),G=f.useRef([0,0]),z=f.useRef(null),F=f.useRef(null),A=(v==null?void 0:v.current)||B.connected||R.domElement.parentNode,W=f.useRef(null),L=f.useRef(!1),ee=f.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Vr(o[0]),[o]);f.useLayoutEffect(()=>{const H=R.domElement;o&&o==="blending"?(H.style.zIndex=`${Math.floor(l[0]/2)}`,H.style.position="absolute",H.style.pointerEvents="none"):(H.style.zIndex=null,H.style.position=null,H.style.pointerEvents=null)},[o]),f.useLayoutEffect(()=>{if(D.current){const H=V.current=ur(k);if(S.updateMatrixWorld(),n)k.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const j=u(D.current,P,w);k.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${j[0]}px,${j[1]}px,0);transform-origin:0 0;`}return A&&(a?A.prepend(k):A.appendChild(k)),()=>{A&&A.removeChild(k),H.unmount()}}},[A,n]),f.useLayoutEffect(()=>{M&&(k.className=M)},[M]);const le=f.useMemo(()=>n?{position:"absolute",top:0,left:0,width:w.width,height:w.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:c?"translate3d(-50%,-50%,0)":"none",...h&&{top:-w.height/2,left:-w.width/2,width:w.width,height:w.height},...r},[r,c,h,w,n]),St=f.useMemo(()=>({position:"absolute",pointerEvents:x}),[x]);f.useLayoutEffect(()=>{if(L.current=!1,n){var H;(H=V.current)==null||H.render(f.createElement("div",{ref:z,style:le},f.createElement("div",{ref:F,style:St},f.createElement("div",{ref:C,className:i,style:r,children:e}))))}else{var j;(j=V.current)==null||j.render(f.createElement("div",{ref:C,style:le,className:i,children:e}))}});const te=f.useRef(!0);he(H=>{if(D.current){P.updateMatrixWorld(),D.current.updateWorldMatrix(!0,!1);const j=n?G.current:u(D.current,P,w);if(n||Math.abs(ce.current-P.zoom)>t||Math.abs(G.current[0]-j[0])>t||Math.abs(G.current[1]-j[1])>t){const Y=$r(D.current,P);let q=!1;ee&&(o!=="blending"?q=[S]:Array.isArray(o)&&(q=o.map(Z=>Z.current)));const ue=te.current;if(q){const Z=Br(D.current,P,O,q);te.current=Z&&!Y}else te.current=!Y;ue!==te.current&&(m?m(!te.current):k.style.display=te.current?"block":"none");const ye=Math.floor(l[0]/2),Rt=o?ee?[l[0],ye]:[ye-1,0]:l;if(k.style.zIndex=`${Ur(D.current,P,Rt)}`,n){const[Z,Xe]=[w.width/2,w.height/2],Me=P.projectionMatrix.elements[5]*Xe,{isOrthographicCamera:Ye,top:Ot,left:At,bottom:jt,right:Tt}=P,Dt=Nr(P.matrixWorldInverse),Lt=Ye?`scale(${Me})translate(${He(-(Tt+At)/2)}px,${He((Ot+jt)/2)}px)`:`translateZ(${Me}px)`;let K=D.current.matrixWorld;y&&(K=P.matrixWorldInverse.clone().transpose().copyPosition(K).scale(D.current.scale),K.elements[3]=K.elements[7]=K.elements[11]=0,K.elements[15]=1),k.style.width=w.width+"px",k.style.height=w.height+"px",k.style.perspective=Ye?"":`${Me}px`,z.current&&F.current&&(z.current.style.transform=`${Lt}${Dt}translate(${Z}px,${Xe}px)`,F.current.style.transform=qr(K,1/((s||10)/400)))}else{const Z=s===void 0?1:Gr(D.current,P)*s;k.style.transform=`translate3d(${j[0]}px,${j[1]}px,0) scale(${Z})`}G.current=j,ce.current=P.zoom}}if(!ee&&W.current&&!L.current)if(n){if(z.current){const j=z.current.children[0];if(j!=null&&j.clientWidth&&j!=null&&j.clientHeight){const{isOrthographicCamera:Y}=P;if(Y||g)E.scale&&(Array.isArray(E.scale)?E.scale instanceof $?W.current.scale.copy(E.scale.clone().divideScalar(1)):W.current.scale.set(1/E.scale[0],1/E.scale[1],1/E.scale[2]):W.current.scale.setScalar(1/E.scale));else{const q=(s||10)/400,ue=j.clientWidth*q,ye=j.clientHeight*q;W.current.scale.set(ue,ye,1)}L.current=!0}}}else{const j=k.children[0];if(j!=null&&j.clientWidth&&j!=null&&j.clientHeight){const Y=1/Q.factor,q=j.clientWidth*Y,ue=j.clientHeight*Y;W.current.scale.set(q,ue,1),L.current=!0}W.current.lookAt(H.camera.position)}});const Ve=f.useMemo(()=>({vertexShader:n?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom" 
            is false. 
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;
            
            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[n]);return f.createElement("group",N({},E,{ref:D}),o&&!ee&&f.createElement("mesh",{castShadow:d,receiveShadow:p,ref:W},g||f.createElement("planeGeometry",null),_||f.createElement("shaderMaterial",{side:Jt,vertexShader:Ve.vertexShader,fragmentShader:Ve.fragmentShader})))});let pe=0;const mn=lt(e=>(be.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-pe)/(i-pe)*100})},be.onLoad=()=>{e({active:!1})},be.onError=t=>e(r=>({errors:[...r.errors,t]})),be.onProgress=(t,r,i)=>{r===i&&(pe=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-pe)/(i-pe)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0})),it=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function Mt(e,t){const r=I(a=>a.gl),i=X(Be,it(e)?Object.values(e):e);if(f.useLayoutEffect(()=>{t==null||t(i)},[t]),f.useEffect(()=>{(Array.isArray(i)?i:[i]).forEach(r.initTexture)},[r,i]),it(e)){const a=Object.keys(e),c={};return a.forEach(h=>Object.assign(c,{[h]:i[a.indexOf(h)]})),c}else return i}Mt.preload=e=>X.preload(Be,e);Mt.clear=e=>X.clear(Be,e);function Xr(e){return Array.isArray(e)}function Fe(e=[0,0,0]){return Xr(e)?e:e instanceof $||e instanceof ct?[e.x,e.y,e.z]:[e,e,e]}const vn=f.forwardRef(function({debug:t,depthTest:r=!1,polygonOffsetFactor:i=-10,map:a,mesh:c,children:h,position:v,rotation:s,scale:y,...n},o){const m=f.useRef(null);f.useImperativeHandle(o,()=>m.current);const d=f.useRef(null);return f.useLayoutEffect(()=>{const p=(c==null?void 0:c.current)||m.current.parent,_=m.current;if(!(p instanceof Qt))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const g={position:new $,rotation:new ct,scale:new $(1,1,1)};if(p){U(g,{position:v,scale:y});const l=p.matrixWorld.clone();if(p.matrixWorld.identity(),!s||typeof s=="number"){const u=new er;u.position.copy(g.position),u.lookAt(p.position),typeof s=="number"&&u.rotateZ(s),U(g,{rotation:u.rotation})}else U(g,{rotation:s});return _.geometry=new fr(p,g.position,g.rotation,g.scale),d.current&&(U(d.current,g),d.current.traverse(u=>u.raycast=()=>null)),p.matrixWorld=l,()=>{_.geometry.dispose()}}},[c,...Fe(v),...Fe(y),...Fe(s)]),f.createElement("mesh",N({ref:m,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":r,"material-map":a},n),h,t&&f.createElement("mesh",{ref:d},f.createElement("boxGeometry",null),f.createElement("meshNormalMaterial",{wireframe:!0}),f.createElement("axesHelper",null)))});let _e=null;function Pt(e,t,r){return i=>{r&&r(i),e&&(_e||(_e=new dr),_e.setDecoderPath(typeof e=="string"?e:"https://www.gstatic.com/draco/versioned/decoders/1.5.5/"),i.setDRACOLoader(_e)),t&&i.setMeshoptDecoder(typeof Se=="function"?Se():Se)}}function Ct(e,t=!0,r=!0,i){return X(Ge,e,Pt(t,r,i))}Ct.preload=(e,t=!0,r=!0,i)=>X.preload(Ge,e,Pt(t,r,i));Ct.clear=e=>X.clear(Ge,e);const hn=f.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:a=!0,keyEvents:c=!1,onChange:h,onStart:v,onEnd:s,...y},n)=>{const o=I(E=>E.invalidate),m=I(E=>E.camera),d=I(E=>E.gl),p=I(E=>E.events),_=I(E=>E.setEvents),g=I(E=>E.set),l=I(E=>E.get),u=I(E=>E.performance),b=t||m,M=i||p.connected||d.domElement,x=f.useMemo(()=>new pr(b),[b]);return he(()=>{x.enabled&&x.update()},-1),f.useEffect(()=>(c&&x.connect(c===!0?M:c),x.connect(M),()=>void x.dispose()),[c,M,r,x,o]),f.useEffect(()=>{const E=P=>{o(),r&&u.regress(),h&&h(P)},C=P=>{v&&v(P)},R=P=>{s&&s(P)};return x.addEventListener("change",E),x.addEventListener("start",C),x.addEventListener("end",R),()=>{x.removeEventListener("start",C),x.removeEventListener("end",R),x.removeEventListener("change",E)}},[h,v,s,x,o,_]),f.useEffect(()=>{if(e){const E=l().controls;return g({controls:x}),()=>g({controls:E})}},[e,x]),f.createElement("primitive",N({ref:n,object:x,enableDamping:a},y))});class Yr extends tr{constructor(t){super(t),this.onBeforeCompile=(r,i)=>{const{isWebGL2:a}=i.capabilities;r.fragmentShader=r.fragmentShader.replace("#include <output_fragment>",`
        ${a?"#include <output_fragment>":`#extension GL_OES_standard_derivatives : enable
#include <output_fragment>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <encodings_fragment>
      `)}}}const gn=f.forwardRef((e,t)=>{const[r]=f.useState(()=>new Yr(null));return f.createElement("primitive",N({},e,{object:r,ref:t,attach:"material"}))}),yn=f.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:i=1,floatIntensity:a=1,floatingRange:c=[-.1,.1],...h},v)=>{const s=f.useRef(null),y=f.useRef(Math.random()*1e4);return he(n=>{var o,m;if(!t||r===0)return;const d=y.current+n.clock.getElapsedTime();s.current.rotation.x=Math.cos(d/4*r)/8*i,s.current.rotation.y=Math.sin(d/4*r)/8*i,s.current.rotation.z=Math.sin(d/4*r)/20*i;let p=Math.sin(d/4*r)/10;p=rr.mapLinear(p,-.1,.1,(o=c==null?void 0:c[0])!==null&&o!==void 0?o:-.1,(m=c==null?void 0:c[1])!==null&&m!==void 0?m:.1),s.current.position.y=p*a,s.current.updateMatrix()}),f.createElement("group",h,f.createElement("group",{ref:Ue([s,v]),matrixAutoUpdate:!1},e))});let J,me;const Zr=f.createContext(null),st=new nr,at=new $,Kr=f.forwardRef(({children:e,range:t,limit:r=1e3,...i},a)=>{const c=f.useRef(null),[h,v]=f.useState([]),[[s,y,n]]=f.useState(()=>[new Float32Array(r*3),Float32Array.from({length:r*3},()=>1),Float32Array.from({length:r},()=>1)]);f.useEffect(()=>{c.current.geometry.attributes.position.needsUpdate=!0}),he(()=>{for(c.current.updateMatrix(),c.current.updateMatrixWorld(),st.copy(c.current.matrixWorld).invert(),c.current.geometry.drawRange.count=Math.min(r,t!==void 0?t:r,h.length),J=0;J<h.length;J++)me=h[J].current,me.getWorldPosition(at).applyMatrix4(st),at.toArray(s,J*3),c.current.geometry.attributes.position.needsUpdate=!0,me.matrixWorldNeedsUpdate=!0,me.color.toArray(y,J*3),c.current.geometry.attributes.color.needsUpdate=!0,n.set([me.size],J),c.current.geometry.attributes.size.needsUpdate=!0});const o=f.useMemo(()=>({getParent:()=>c,subscribe:m=>(v(d=>[...d,m]),()=>v(d=>d.filter(p=>p.current!==m.current)))}),[]);return f.createElement("points",N({userData:{instances:h},matrixAutoUpdate:!1,ref:Ue([a,c]),raycast:()=>null},i),f.createElement("bufferGeometry",null,f.createElement("bufferAttribute",{attach:"attributes-position",count:s.length/3,array:s,itemSize:3,usage:se}),f.createElement("bufferAttribute",{attach:"attributes-color",count:y.length/3,array:y,itemSize:3,usage:se}),f.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:se})),f.createElement(Zr.Provider,{value:o},e))}),Jr=f.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:a=3,...c},h)=>{const v=f.useRef(null);return he(()=>{const s=v.current.geometry.attributes;s.position.needsUpdate=!0,r&&(s.color.needsUpdate=!0),i&&(s.size.needsUpdate=!0)}),f.createElement("points",N({ref:Ue([h,v])},c),f.createElement("bufferGeometry",null,f.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/a,array:t,itemSize:a,usage:se}),r&&f.createElement("bufferAttribute",{attach:"attributes-color",count:r.length/a,array:r,itemSize:3,usage:se}),i&&f.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/a,array:i,itemSize:1,usage:se})),e)}),bn=f.forwardRef((e,t)=>e.positions instanceof Float32Array?f.createElement(Jr,N({},e,{ref:t})):f.createElement(Kr,N({},e,{ref:t})));function wn({all:e,scene:t,camera:r}){const i=I(({gl:h})=>h),a=I(({camera:h})=>h),c=I(({scene:h})=>h);return f.useLayoutEffect(()=>{const h=[];e&&(t||c).traverse(y=>{y.visible===!1&&(h.push(y),y.visible=!0)}),i.compile(t||c,r||a);const v=new or(128);new ir(.01,1e5,v).update(i,t||c),v.dispose(),h.forEach(y=>y.visible=!1)},[]),null}export{dn as C,vn as D,yn as F,pn as H,hn as O,wn as P,Ct as a,Mt as b,he as c,bn as d,gn as e,mn as u};
